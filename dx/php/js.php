window.DX_MODEL = {ACCOUNT:{"ownerName":"Teri Campbell","businessName":"Teri Studios","phone":"","mobilePhone":"","streetAddress":"3344 Central ParkwayCincinnati OH 45225","email":"teri@teristudios.com","pageStatistics":"<script type=\"text\/javascript\">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-16304371-1']);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text\/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https:\/\/ssl' : 'http:\/\/www') + '.google-analytics.com\/ga.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();<\/script>","signUpStatus":"","signUpLink":"","signUpToken":"","fotoMotoId":""},LAYOUT:{"captionBackgroundAlpha":0.9,"captionBackgroundRectColor":"#000000","captionFont":"Signika Negative Light","captionFontColor":"#ffffff","captionFontSize":12,"colorCorrection":false,"contactFont":"Verdana","contactFontColor":"#555555","contactFieldRectColor":"#999999","contactFontSize":12,"contactTitleShow":true,"contactTitleFont":"Verdana","contactTitleFontSize":26,"containerColor":"#000000","containerHeight":"FLUID","containerWidth":"FLUID","copyrightAlignHorizontal":"right","copyrightAlignVertical":"bottom","copyrightOffsetX":-20,"copyrightColor":"#E3E3E3","copyrightFont":"Verdana","copyrightFontSize":10,"copyrightOffsetY":-5,"cursorBlendMode":"difference","cursorColor":"#B9C5C9","cursorIconStyle":"arrow2","videoScaleType":"fit","imageAlignHorizontal":"center","imageScaleType":"fit","introFont":"Georgia","introFontColor":"#CC0000","introFontSize":20,"introFile":"","introText":"","introType":"none","landingMediaScaleType":"fillSite","landingMediaSpeed":4.55,"landingMediaTransitionDuration":1.2,"logoAlignHorizontal":"left","logoAlignVertical":"top","logoFile":"website-logo---white-170PX-copy2.png","logoFont":"Verdana","logoFontColor":"#707070","logoFontSize":20,"logoOffsetX":23,"logoOffsetY":25,"logoText":"Teri Studios","logoType":"text","menuAlignHorizontal":"left","menuAlignVertical":"top","menuBgAlpha":0,"menuBgColor":"#000000","menuBulletType":"bullet","menuBulletOffsetHorizontal":0,"menuBulletOffsetVertical":0,"menuSubBulletOffsetHorizontal":0,"menuSubBulletOffsetVertical":0,"menuExpandAll":false,"menuFont":"Verdana","menuFontColor":"#757575","menuFontColorHover":"#e3e3e3","menuFontColorSelected":"#E3E3E3","menuFontSize":13,"menuOffsetX":2,"menuOffsetY":0,"menuScrollbarAlign":"right","menuScrollbarColor":"#ffffff","menuScrollbarHover":"#FAFEFF","menuSubFontSize":9,"menuSubGapLeading":0,"menuSubGapTrailing":7,"menuSubIndent":8,"menuSubTextGap":2,"menuTextAlignHorizontal":"left","menuTextAlignVertical":"top","menuTextGap":6,"menuTextPaddingHorizontal":27,"menuTextPaddingVertical":170,"menuWidth":210,"navbarAlignHorizontal":"center","navbarAlignVertical":"bottom","navbarColor":"#FFFFFF","navbarColorDeselected":"#556699","navbarColorHover":"#FFFFFF","navbarFont":"Lato-Light","navbarFontSize":12,"navbarGap":10,"navbarIconOffsetX":1,"navbarIconOffsetY":1,"navbarOffsetX":10,"navbarOffsetY":-10,"overlayAlpha":1,"overlayColor":"#000000","pageHorizontalMargin":70,"pageMarginTop":"35px","pageMarginRight":"10%","pageMarginBottom":"10%","pageMarginLeft":"5%","pageVerticalMargin":50,"pageScrollbarAlignment":"right","pageScrollbarColor":"#545454","pageScrollbarHorizontalOffset":0,"pageScrollbarHover":"#A9A9A9","pageScrollbarVerticalOffset":0,"pageTextFont":"Verdana","pageTextFontColor":"#8F8F8F","pageTextFontSize":12,"pageTitle":true,"pageTitleFont":"Verdana","pageTitleFontColor":"#b3b3b3","pageTitleFontSize":30,"sitePaddingBottom":30,"sitePaddingLeft":0,"sitePaddingRight":20,"sitePaddingTop":0,"siteBackgroundColor":"#000000","thumbnailGap":10,"footerIconColor":"#8A8A8A","footerIconType":"vector","thumbnailGridTransparency":0,"thumbnailHoverColor":"#ffffff","thumbnailScrollbarAlignment":"right","thumbnailScrollbarColor":"#8C8C8C","thumbnailScrollbarHorizontalOffset":10,"thumbnailScrollbarHover":"#2fa0d9","thumbnailScrollbarVerticalOffset":0,"thumbnailScrollType":"scrollbar","thumbnailSelectedColor":"#555555","thumbnailSize":"large","thumbnailTitleFont":"Verdana","thumbnailTitleFontColor":"#989898","thumbnailTitleFontSize":16,"transitionDuration":0.5,"transitionType":"fade","videoAutoPlay":false,"captionDefault":false,"imageVideoMarginTop":"0px","imageVideoMarginRight":"0px","imageVideoMarginBottom":"0px","imageVideoMarginLeft":"0px","thumbnailHoverAlpha":0.4,"imageAlignVertical":"center","tabletLogoFile":"","mobileLogoFile":"","fotomotoToolbarAlignHorizontal":"right","fotomotoToolbarAlignVertical":"top","fotomotoToolbarOffsetX":0,"fotomotoToolbarOffsetY":0,"landingMediaAlignHorizontal":"center","landingMediaAlignVertical":"center","landingMediaRandomize":false,"tabletLogoOffsetX":0,"tabletLogoOffsetY":0,"landingMediaTransitionType":"fade","menuKerning":0,"footerKerning":0,"logoKerning":0,"navbarKerning":0,"pageTextKerning":0,"pageTitleKerning":0,"navbarLayout":"horizontal","navbarJustification":"left","imageVideoScrollbarAlignment":"bottom","imageVideoScrollbarHorizontalOffset":0,"imageVideoScrollbarVerticalOffset":-10,"imageVideoScrollbarColor":"#222222","imageVideoScrollbarHover":"#2FA0D9","imageVideoScrollbarBgTransparency":0,"imageVideoScrollbarWidth":10,"imageVideoInactiveAlpha":0.1,"introScaleType":"native","pageScrollbarBgAlpha":0,"pageScrollbarWidth":10,"pageScrollVerticalMargin":0,"thumbnailScrollbarBgAlpha":0,"thumbnailScrollbarWidth":10,"menuScrollbarBgAlpha":0,"menuScrollbarWidth":10,"logoHtml":"","thumbnailDefaultOn":true,"thumbnailMasonry":true,"thumbnailDock":"displace","thumbnailType":"fill","thumbnailSide":"bottom","thumbnailVerticalMargin":20,"thumbnailHorizontalMargin":20,"imageRendering":{"optimizeQuality":true,"webkitOptimizeContrast":false,"webkitBackfaceVisibility":false},"footerIconColorHover":"#2292E2","footerIconScale":1,"footerIconBgColor":"#E3E3E3","footerIconShape":"rectangle","navbarIconSet":"thin","navbarIconScale":1,"captionAutoPosition":true,"captionAlignHorizontal":"center","captionAlignVertical":"bottom","captionOffsetX":0,"captionOffsetY":0,"captionWidth":300,"captionHeight":100,"captionTextAlign":"center","captionTextAlignVertical":"top","captionPaddingTop":10,"captionPaddingRight":10,"captionPaddingBottom":10,"captionPaddingLeft":10,"captionScrollbarAlignment":"right","captionScrollbarColor":"#4A5043","captionScrollbarHover":"#949D6A","captionScrollbarHorizontalOffset":0,"captionScrollbarVerticalOffset":0,"captionScrollbarWidth":7,"captionScrollbarBgAlpha":0.35,"captionAnchorTo":"media area","fontRenderingOptions":{"enable":false,"webkitFontSmoothing":"antialiased","webkitTextStrokeWidth":0.3},"menuBgAlphaMobile":0,"menuSubTextAlignHorizontal":"left","enableThumbsMobile":false},MEDIA:{"10002":{"id":10002,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":400,"height":543},"bytes":0},"label":"About","type":"html","content":"Cincinnati based visual artist and author <b>Teri Campbell <\/b>has been called a lighting master by <b>PDN<\/b>, and named one of the 200 best digital artist worldwide by <b>Archive Magazine<\/b>. His company, Teri Studios has become a destination for consumer packaged goods companies, restaurants, beverage and travel related businesses seeking original photography and motion work for advertising and packaging. Clients include - KFC, Burger King, Marzetti, Heinz, Red Gold Tomatoes, Kellogg\u2019s and Hershey\u2019s.\r\n\r\nWhen not in the studio, Teri is a frequent speaker at industry conferences and events like the International Conference on Food Styling & Photography, PDN\u2019s PhotoPlus Expo and the FoodPhoto Festival in Tarragona Spain. He is also the author of <i><b>Food Photography and Lighting: A Commercial Photographers Guide to Creating Irresistible Images.<\/i><\/b>\r\n\r\n\r\n\r\n\r\nFOOD AND ME <i>...the beginning.<\/i>\r\n\r\n<i>My love for food began as a child. Growing up, my mom worked as a waitress at an upscale restaurant. She worked a split shift and would often take me to the restaurant with her after school. She would feed me dinner, usually shrimp or halibut, and let me hang out until my Dad could pick me up. The sights and sounds of the kitchen, and the people who worked there, began to cultivate in me a love of food even then.<\/i>\r\n\r\n","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"Teri2.jpg","filters":"","dateAdded":"2012-09-13 15:56:34"},"10003":{"id":10003,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":400,"height":533},"bytes":0},"label":"Contact","type":"html","content":"To see more of Teri's work, or to discuss an upcoming project, contact Sherry at 888.784.9696\r\n\r\nYou can also find us on <a\r\nhref=\"https:\/\/wonderfulmachine.com\/photographer\/teri-campbell\">Wonderful Machine<\/a>\r\n\r\nIf you would like to connect with us on Facebook or LinkedIn, just click on the icons below.\r\n\r\n\r\n\r\n<b>Teri Studios<\/b><br \/>3344 Central Parkway<br \/>Cincinnati OH 45225<br \/><i>ph 888.784.9696<\/i>\r\n\r\nemail<br \/><a href=\"mailto:sherry@teristudios.com\">sherry@teristudios.com<\/a>\r\n","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"3126-44.jpg","filters":"","dateAdded":"2012-09-13 15:56:34"},"10008":{"id":10008,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":false,"height":false},"bytes":0},"label":"[facebook]","type":"link","content":"http:\/\/facebook.com\/pages\/Teri-Studios\/104004692977573?ref=ts","thumb":"","linkTarget":"_blank","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2012-09-13 15:56:34"},"10013":{"id":10013,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":false,"height":false},"bytes":0},"label":"[linkedin]","type":"link","content":"http:\/\/www.linkedin.com\/in\/terishootsfood","thumb":"","linkTarget":"_blank","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2012-09-13 15:56:34"},"10112":{"id":10112,"size":{"content":{"width":1860,"height":1028},"thumb":{"width":1860,"height":1028},"featuredImage":{"width":false,"height":false},"bytes":303970},"label":"Italy-Kids","type":"image","content":"italy08_tc_1308.jpg","thumb":"italy08_tc_1308.jpg","linkTarget":"","caption":"Italy, Kids, Icecream","overrides":{},"featuredImage":"","filters":"","dateAdded":"2012-09-13 15:56:42"},"10120":{"id":10120,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":1860,"height":1240},"featuredImage":{"width":false,"height":false},"bytes":474516},"label":"South Africa 2010","type":"image","content":"Go-Mamelodi-2010---0581.jpg","thumb":"Go-Mamelodi-2010---0581.jpg","linkTarget":"","caption":"Mamelodi, South Africa","overrides":{},"featuredImage":"","filters":"","dateAdded":"2012-09-13 15:56:43"},"10294":{"id":10294,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":false,"height":false},"bytes":0},"label":"teri@teristudios.com","type":"link","content":"mailto:teri@teristudios.com","thumb":"","linkTarget":"_blank","caption":"null","overrides":{},"featuredImage":" ","filters":"","dateAdded":"2012-09-27 09:47:52"},"10305":{"id":10305,"size":{"content":{"width":false,"height":false},"thumb":{"width":false,"height":false},"featuredImage":{"width":650,"height":434},"bytes":0},"label":"Food Photography and Lighting","type":"html","content":"Food Photography & Lighting: A Commercial Photographer's Guide to Creating Irresistible Images, by Teri Campbell is now available at bookstores nationwide. Below is a review from Amazon.com.\r\n\r\n\r\n\"This book is a must read and own for anyone who has anything to do with food photography! Teri really nails all of the points from the flow chart on set, to how to use lighting to create the mood and feel you want in your photographs. This is not the typical look at me book or look at this shot book, Teri talks you thru HIS thought process and how he arrived at the decisions that he made in locations, propping and lighting. You get a real glimpse into the things you should be thinking about on every shoot. The real life examples in the second half of the book are amazing, it shows you things from a cool personal shoot to how you need to consider things like barcodes and text in packaging. The example of the can of beans is an excellent lesson in how all the pieces add up to a whole! This book is a good read for beginners, bloggers and seasoned pros, everyone can pick up something here! Great job Teri!\"\r\n\r\nReview by Peter Taylor","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"FPL.jpg","filters":"","dateAdded":"2013-02-27 08:35:55"},"10341":{"id":10341,"size":{"content":{"width":1860,"height":1239},"thumb":{"width":1860,"height":1239},"featuredImage":{"width":false,"height":false},"bytes":299310},"label":"500-3_0175.jpg","type":"image","content":"500-3_0175.jpg","thumb":"500-3_0175.jpg","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"Sonic","dateAdded":"2014-01-29 10:36:42"},"10483":{"id":10483,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":1860,"height":1240},"featuredImage":{"width":false,"height":false},"bytes":766617},"label":"20130530_062.jpg","type":"image","content":"20130530_062.jpg","thumb":"20130530_062.jpg","linkTarget":"","caption":"Street scene - Kolkata, India","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-03-08 14:30:35"},"10496":{"id":10496,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":1860,"height":1240},"featuredImage":{"width":false,"height":false},"bytes":226644},"label":"3668_0746.jpg","type":"image","content":"3668_0746.jpg","thumb":"3668_0746.jpg","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-03-08 14:36:34"},"10513":{"id":10513,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":200825},"label":"studio-black","type":"image","content":"studio-black.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-03-11 15:40:23"},"10516":{"id":10516,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":489571},"label":"Spain_2010-0911-Portrait-Drama-C","type":"image","content":"Spain_2010-0911-Portrait-Drama-C.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-03-19 08:32:36"},"10522":{"id":10522,"size":{"content":{"width":1222,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":101479},"label":"Fruit_Splash_438(1A)","type":"image","content":"Fruit_Splash_438(1A).jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-03-19 20:13:45"},"10534":{"id":10534,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":548544},"label":"20130920_357","type":"image","content":"20130920_357.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-04-23 20:52:28"},"10572":{"id":10572,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":266232},"label":"500_691","type":"image","content":"500_691.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-05-09 12:31:43"},"10573":{"id":10573,"size":{"content":{"width":1860,"height":1240},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":465491},"label":"page_1","type":"image","content":"page_1.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-07-17 12:33:16"},"10575":{"id":10575,"size":{"content":{"width":0,"height":0},"thumb":{"width":1860,"height":1046},"featuredImage":{"width":0,"height":0},"bytes":false},"label":"Creating the Bacardi Bat behind the scenes","type":"video","content":"vimeo:104412529","thumb":"barcadibat.jpg","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-08-26 12:54:02"},"10577":{"id":10577,"size":{"content":{"width":1860,"height":1341},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":175884},"label":"Bacardi_029n","type":"image","content":"Bacardi_029n.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2014-08-27 12:50:49"},"10589":{"id":10589,"size":{"content":{"width":0,"height":0},"thumb":{"width":1922,"height":1078},"featuredImage":{"width":0,"height":0},"bytes":false},"label":"Date night dinner! Pasta Carbonara ","type":"video","content":"vimeo:140314406","thumb":"Video Stil.png","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2015-09-24 16:13:52"},"10599":{"id":10599,"size":{"content":{"width":0,"height":0},"thumb":{"width":1916,"height":1070},"featuredImage":{"width":0,"height":0},"bytes":false},"label":"Hang Over Easy. Best night yet!","type":"video","content":"vimeo:152078838","thumb":"Screen Shot 2016-01-27 at 9.16.49 PM.png","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2016-01-27 20:16:37"},"10600":{"id":10600,"size":{"content":{"width":0,"height":0},"thumb":{"width":1922,"height":992},"featuredImage":{"width":0,"height":0},"bytes":false},"label":"Hang Over Easy, BTS","type":"video","content":"vimeo:144418734","thumb":"Screen Shot 2016-01-27 at 9.19.02 PM.png","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2016-01-27 20:20:02"},"10621":{"id":10621,"size":{"content":{"width":1860,"height":1140},"thumb":{"width":0,"height":0},"featuredImage":{"width":0,"height":0},"bytes":394634},"label":"Client_List_14-(Logos)","type":"image","content":"Client_List_14-Logos.jpg","thumb":"","linkTarget":"","caption":"","overrides":{},"featuredImage":"","filters":"","dateAdded":"2016-06-06 15:56:24"}},NAVBAR:{"0":{"id":2,"order":0,"type":"caption","name":"caption","iconType":"both","tooltip":"image info"},"1":{"id":3,"order":1,"type":"email","name":"email","iconType":"both","tooltip":"email image"},"2":{"id":4,"order":2,"type":"thumbs","name":"thumbs","iconType":"both","tooltip":"show thumbnails"},"3":{"id":5,"order":3,"type":"prev","name":"prev","iconType":"both","tooltip":"previous image"},"4":{"id":6,"order":4,"type":"count","name":"count","iconType":"both","tooltip":"image info"},"5":{"id":7,"order":5,"type":"next","name":"next","iconType":"both","tooltip":"next image"}},SECTIONS:{"ROOT_SECTION":{"id":1,"visible":1,"password":"","isOpen":1,"label":"ROOT_SECTION","overrides":{},"media":"16,56,18,24,3,45,23,22,5,6,8,9,10,12,11,15,25,26,27,17,19,20,30,31,32,33,34,35,41,43,42","mediaItems":"16,56,18,24,3,45,23,22,5,6,8,9,10,12,11,15,25,26,27,17,19,20,30,31,32,33,34,35,41,43,42","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Destinations\/Portfolio":{"id":2,"visible":0,"password":"","isOpen":0,"label":"Portfolio","overrides":{},"media":"10489,10520,10493,10517,10120,10519,10483,10119,10518,10482,10484,10485,10516,10486,10490,10491,10127,10118,10100,10107","mediaItems":"10489,10520,10493,10517,10120,10519,10483,10119,10518,10482,10484,10485,10516,10486,10490,10491,10127,10118,10100,10107","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Projects":{"id":3,"visible":1,"password":"","isOpen":0,"label":"Projects","overrides":{},"media":"21,46","mediaItems":"21,46","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Motion":{"id":24,"visible":1,"password":"","isOpen":0,"label":"Motion","overrides":{},"media":"55,10575,53,10589,10312,10590,10591","mediaItems":"55,10575,53,10589,10312,10590,10591","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"About":{"id":5,"visible":1,"password":"","isOpen":0,"label":"About","overrides":{},"media":"10002","mediaItems":"10002","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Contact":{"id":6,"visible":1,"password":"","isOpen":0,"label":"Contact","overrides":{},"media":"10003","mediaItems":"10003","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"motion2":{"id":43,"visible":0,"password":"","isOpen":0,"label":"motion2","overrides":{},"media":"10579","mediaItems":"10579","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"SPACER_1":{"id":8,"visible":1,"password":"","isOpen":0,"label":"%SPACER%","overrides":{},"media":"","mediaItems":"","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Our Book":{"id":12,"visible":1,"password":"","isOpen":0,"label":"Our Book","overrides":{},"media":"10305","mediaItems":"10305","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"IACP Contest":{"id":25,"visible":0,"password":"","isOpen":0,"label":"IACP Contest","overrides":{},"media":"10327,10317,10326,10331,10318,10329,10315,10319,10320,10321,10322,10323,10324,10325,10328","mediaItems":"10327,10317,10326,10331,10318,10329,10315,10319,10320,10321,10322,10323,10324,10325,10328","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"SPACER_2":{"id":15,"visible":1,"password":"","isOpen":0,"label":"%SPACER%","overrides":{},"media":"","mediaItems":"","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Food":{"id":16,"visible":1,"password":"","isOpen":0,"label":"Food","overrides":{},"media":"10341,10603,10620,10602,10103,10587,10501,10481,10502,10498,10604,10506,10184,10507,10606,10601,10521,10572,10515,10503,10496,10605","mediaItems":"10341,10603,10620,10602,10103,10587,10501,10481,10502,10498,10604,10506,10184,10507,10606,10601,10521,10572,10515,10503,10496,10605","thumb":{}},"Drinks":{"id":56,"visible":1,"password":"","isOpen":0,"label":"Drinks","overrides":{},"media":"10577,10578,10583,10581,10584,10618,10234,10045,10494,10586,10582,10619","mediaItems":"10577,10578,10583,10581,10584,10618,10234,10045,10494,10586,10582,10619","thumb":{}},"Liquid":{"id":17,"visible":0,"password":"","isOpen":0,"label":"Liquid","overrides":{},"media":"10234,10048,10281,10270,10243,10284,10238,10055,10045,10237,10494,10495","mediaItems":"10234,10048,10281,10270,10243,10284,10238,10055,10045,10237,10494,10495","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Destinations":{"id":18,"visible":1,"password":"","isOpen":0,"label":"Destinations","overrides":{},"media":"39,38,40,10489,10520,2,10493,10120,10517,10519,10483,10119,10518,10482,10484,10485,10516,10486,10490,10491,10127,10118,10100,10107,36,37","mediaItems":"39,38,40,10489,10520,2,10493,10120,10517,10519,10483,10119,10518,10482,10484,10485,10516,10486,10490,10491,10127,10118,10100,10107,36,37","thumb":{}},"italy":{"id":19,"visible":0,"password":"","isOpen":0,"label":"italy","overrides":{},"media":"10287,10062,10098,10109,10108,10111,10102,10107,10105,10097,10115,10114,10099,10103,10110,10112,10101,10100,10113","mediaItems":"10287,10062,10098,10109,10108,10111,10102,10107,10105,10097,10115,10114,10099,10103,10110,10112,10101,10100,10113","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"old South Africa":{"id":20,"visible":0,"password":"","isOpen":0,"label":"old South Africa","overrides":{},"media":"10067,10133,10134,10129,10117,10118,10135,10120,10122,10132,10123,10119,10124,10068,10130,10125,10126,10127,10288,10131","mediaItems":"10067,10133,10134,10129,10117,10118,10135,10120,10122,10132,10123,10119,10124,10068,10130,10125,10126,10127,10288,10131","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Projects\/Dipped":{"id":21,"visible":1,"password":"","isOpen":0,"label":"Dipped","overrides":{},"media":"10522,10523","mediaItems":"10522,10523","thumb":{}},"Studio Space":{"id":22,"visible":1,"password":"","isOpen":0,"label":"Studio Space","overrides":{},"media":"10513,10511,10510,10512,10292","mediaItems":"10513,10511,10510,10512,10292","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Client List":{"id":23,"visible":1,"password":"","isOpen":0,"label":"Client List","overrides":{},"media":"10621","mediaItems":"10621","thumb":{"type":"fill","defaultOn":false,"masonry":false,"gap":20,"dock":"overlay","size":"medium","side":"bottom","verticalMargin":50,"horizontalMargin":50}},"Sonic":{"id":26,"visible":0,"password":"","isOpen":0,"label":"Sonic","overrides":{},"media":"10341,10373,10359,10389,10382,10377,10383,10348,10388,10339,10363,10392,10387,10371,10380,10396,10340,10386,10360,10349,10343,10394,10378,10355,10372,10346,10362,10364,10376","mediaItems":"10341,10373,10359,10389,10382,10377,10383,10348,10388,10339,10363,10392,10387,10371,10380,10396,10340,10386,10360,10349,10343,10394,10378,10355,10372,10346,10362,10364,10376","thumb":{"horizontalMargin":0,"defaultOn":false,"masonry":false,"dock":"displace","verticalMargin":0,"type":"fill","side":"bottom","gap":0,"size":"medium"}},"IACP2014":{"id":27,"visible":0,"password":"","isOpen":0,"label":"IACP2014","overrides":{},"media":"10397,10398,10399,10401,10402,10404,10405,10406,10407,10408,10409,10410,10411,10412,10413,10414,10415,10416,10418,10419,10421,10422,10423,10424,10425,10426,10427,10429,10430,10479,10480,10478,10431,10432,10434,10435,10436,10437,10438,10439,10440,10441,10442,10443,10445,10446,10447,10448,10450,10451,10453,10454,10455,10457,10458,10459,10462,10465,10466,10467,10469,10470,10471,10472,10473,10474,10475,10476,10477","mediaItems":"10397,10398,10399,10401,10402,10404,10405,10406,10407,10408,10409,10410,10411,10412,10413,10414,10415,10416,10418,10419,10421,10422,10423,10424,10425,10426,10427,10429,10430,10479,10480,10478,10431,10432,10434,10435,10436,10437,10438,10439,10440,10441,10442,10443,10445,10446,10447,10448,10450,10451,10453,10454,10455,10457,10458,10459,10462,10465,10466,10467,10469,10470,10471,10472,10473,10474,10475,10476,10477","thumb":{"horizontalMargin":0,"defaultOn":false,"masonry":false,"dock":"displace","verticalMargin":0,"type":"fill","side":"bottom","gap":0,"size":"medium"}},"South Africa":{"id":30,"visible":0,"password":"","isOpen":0,"label":"South Africa","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"Italy":{"id":31,"visible":0,"password":"","isOpen":0,"label":"Italy","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"India":{"id":32,"visible":0,"password":"","isOpen":0,"label":"India","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"South Africa_copy1":{"id":33,"visible":0,"password":"","isOpen":0,"label":"South Africa_copy1","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"Italy_copy1":{"id":34,"visible":0,"password":"","isOpen":0,"label":"Italy_copy1","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"India_copy1":{"id":35,"visible":0,"password":"","isOpen":0,"label":"India_copy1","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"Destinations\/South Africa":{"id":36,"visible":1,"password":"","isOpen":0,"label":"South Africa","overrides":{},"media":"10120,10615,10610,10519,10542,10548,10131,10118,10129,10613,10127,10124,10607,10617,10611,10616,10067,10612,10608,10549,10545,10614,10543,10609,10546","mediaItems":"10120,10615,10610,10519,10542,10548,10131,10118,10129,10613,10127,10124,10607,10617,10611,10616,10067,10612,10608,10549,10545,10614,10543,10609,10546","thumb":{}},"Destinations\/Italy":{"id":37,"visible":1,"password":"","isOpen":0,"label":"Italy","overrides":{},"media":"10112,10109,10110,10107,10102,10100,10099,10097,10062,10287","mediaItems":"10112,10109,10110,10107,10102,10100,10099,10097,10062,10287","thumb":{}},"Destinations\/Spain":{"id":38,"visible":1,"password":"","isOpen":0,"label":"Spain","overrides":{},"media":"10516,10530,10524,10520,10525,10526,10528,10527,10529","mediaItems":"10516,10530,10524,10520,10525,10526,10528,10527,10529","thumb":{}},"Destinations\/Paris":{"id":39,"visible":1,"password":"","isOpen":0,"label":"Paris","overrides":{},"media":"10534,10492,10487,10532,10486,10537,10533,10535,10536,10540,10539","mediaItems":"10534,10492,10487,10532,10486,10537,10533,10535,10536,10540,10539","thumb":{}},"Destinations\/India":{"id":40,"visible":1,"password":"","isOpen":0,"label":"India","overrides":{},"media":"10483,10484,10485,10489,10490,10491,10553,10556,10555,10557,10552,10554,10559,10560,10561,10558,10571,10566,10569,10568,10570","mediaItems":"10483,10484,10485,10489,10490,10491,10553,10556,10555,10557,10552,10554,10559,10560,10561,10558,10571,10566,10569,10568,10570","thumb":{}},"SPACER_3":{"id":41,"visible":1,"password":"","isOpen":0,"label":"%SPACER%","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"SPACER_4":{"id":42,"visible":0,"password":"","isOpen":0,"label":"%SPACER%","overrides":{},"media":"","mediaItems":"","thumb":{"defaultOn":false,"masonry":false,"gap":10,"dock":"overlay","type":"fill","size":"medium","side":"bottom","verticalMargin":0,"horizontalMargin":0}},"Street Cred":{"id":45,"visible":1,"password":"","isOpen":0,"label":"Street Cred","overrides":{},"media":"10573,10574","mediaItems":"10573,10574","thumb":{"defaultOn":false}},"Projects\/New Work":{"id":46,"visible":0,"password":"","isOpen":0,"label":"New Work","overrides":{},"media":"10588","mediaItems":"10588","thumb":{}},"Behind the scenes":{"id":52,"visible":1,"password":"","isOpen":0,"label":"Behind the scenes","overrides":{},"media":"10575,10590","mediaItems":"10575,10590","thumb":{}},"Commercials":{"id":51,"visible":1,"password":"","isOpen":0,"label":"Commercials","overrides":{},"media":"10589,10312,10591","mediaItems":"10589,10312,10591","thumb":{}},"Motion\/Behind the scenes":{"id":53,"visible":1,"password":"","isOpen":0,"label":"Behind the scenes","overrides":{},"media":"10600,10575,10590,10598","mediaItems":"10600,10575,10590,10598","thumb":{}},"Motion\/Commercials":{"id":55,"visible":1,"password":"","isOpen":0,"label":"Commercials","overrides":{},"media":"10599,10589,10312,10591","mediaItems":"10599,10589,10312,10591","thumb":{}}},SETTINGS:{"dbUser":"tcampbell","url":"teristudios.com","browserTitle":"Teri Studios: Food Photography for advertising and packaging.","contactFormEmail":"teri@teristudios.com","contactFormFields":"Name,Email,Phone,Comments","contactFormExtra":"<p>John Doe<\/p><br \/><p>100 Some St.Durango, CO  81301<\/p><br \/><p>P \/ 800-555-1212<\/p><p>E \/ <a href=\"mailto:johndoe@gmail.com\">johndoe@gmail.com<\/a><\/p>","copyright":"&#169; Teri Campbell","metaDescription":"Teri is an artist passionate about capturing beautiful images of food, drinks and destinations. Get to know Teri.","metaKeywords":"Food, Drink, Travel, Photography, Photographer, Delicious, Creative, Teri, Teri Shoots Food, Cincinnati, Ohio, Midwest, National, Teri Campbell, ","rollbackVersion":12.3,"localMasterVersion":13.5,"updatePath":"fitzroy.aphotofolio.com\/update\/","backgroundImages":"10341,10534,10572,10577,10589,10496","filters":"IACP Contaest 2014,IACP Contest,Sonic","portfolioEmailMessage":" &#169; Teri Campbell - for usage contact teri@teristudios.com","socialLinks":"10294,10013,10008","useHTML":true,"globalBrowserTitle":true,"facebookImage":"","facebookAdmins":"","facebookUseMeta":true,"podUseDesktop":false,"padUseDesktop":false,"generalEmail":"","inquiryTitle":"","inquiryInfo":"","lang":"en","betaProgramVisible":true,"betaProgramEnabled":false,"advancedSeo":false,"adminSortDefault":"label ascending","enablePinterest":true,"enableCookieBanner":false,"currentTemplate":8,"cookieBannerPosition":"bottom","cookieBannerLink":"http:\/\/aboutcookies.org","cookieBannerMessage":"We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies."},};
window.DX_REWRITE_BASE = '/';

function DesignX() {

var ACCOUNT_MODEL = window.DX_MODEL.ACCOUNT,
	LAYOUT_MODEL = window.DX_MODEL.LAYOUT,
	MEDIA_MODEL = window.DX_MODEL.MEDIA,
	NAVBAR_MODEL = window.DX_MODEL.NAVBAR,
	SECTIONS_MODEL = window.DX_MODEL.SECTIONS,
	SETTINGS_MODEL = window.DX_MODEL.SETTINGS,
	REWRITE_BASE = window.DX_REWRITE_BASE;

var HTTP_USER_AGENT = navigator.userAgent,
	USER_AGENT = 'html',
	TABLET = 'pad',
	MOBILE = 'pod',
	INTRO = 'intro',
	HOME = 'home',
	LANDING_MEDIA = 'landingMedia',
	IMAGE = 'image',
	VIDEO = 'video',
	HTML = 'html',
	SWF = 'swf',
	LINK = 'link',
	PDF = 'pdf',
	CONTACT = 'contactForm',
	NORMAL = 'normal',
	ERROR = 'error',
	LOAD = 'load',
	RESIZE = 'resize',
	RESIZE_END = 'resizeEnd',
	PANEL_RESIZE = 'panelResize',
	PANEL_RESIZE_END = 'panelResizeEnd',
	FOCUS = 'focus',
	BLUR = 'blur',
	TOUCH_START = 'touchstart',
	TOUCH_MOVE = 'touchmove',
	TOUCH_END = 'touchend',
	TOUCH_CANCEL = 'touchcancel',
	MOUSE_OVER = 'mouseover',
	MOUSE_DOWN = 'mousedown',
	MOUSE_MOVE = 'mousemove',
	MOUSE_UP = 'mouseup',
	MOUSE_OUT = 'mouseout',
	MOUSE_WHEEL = 'mousewheel',
	WHEEL = 'wheel',
	KEY_DOWN = 'keydown',
	KEY_UP = 'keyup',
	LEFT_ARROW = 'leftArrow',
	RIGHT_ARROW = 'rightArrow',
	ESCAPE = 'escape',
	SPACE_BAR = 'spaceBar',
	ENTER = 'enter',
	DELETE = 'delete',
	CLICK = 'click',
	DOUBLE_CLICK = 'dblclick',
	SHIFT = 'shift',
	COMMAND = 'command',
	CONTROL = 'control',
	CHANGE = 'change',
	SELECT_ACCORDION_ITEM = 'selectAccordionItem',
	ACCORDION_SELECT = 'accordionSelect',
	ACCORDION_SIZE_CHANGE = 'accordionSizeChange',
	ADDRESS_CHANGE = 'addressChange',
	ADDRESS_URI_CHANGE = 'addressUriChange',
	SITE_URI_CHANGE = 'siteUriChange',
	NAVIGATION_EVENT = 'navigationEvent',
	ADMIN_LOADED = 'adminLoaded',
	MODEL_CHANGE = 'modelChange',
	ADMIN_MODEL_CHANGE = 'adminModelChange',
	ACCOUNT_MODEL_CHANGE = 'accountModelChange',
	FONTS_MODEL_CHANGE = 'fontsModelChange',
	FILES_MODEL_CHANGE = 'filesModelChange',
	LAYOUT_MODEL_CHANGE = 'layoutModelChange',
	MEDIA_MODEL_CHANGE = 'mediaModelChange',
	NAVBAR_MODEL_CHANGE = 'navbarModelChange',
	PDF_MODEL_CHANGE = 'pdfModelChange',
	SETTINGS_MODEL_CHANGE = 'settingsModelChange',
	SECTIONS_MODEL_CHANGE = 'sectionsModelChange',
	MENU_CLICK = 'menuClick',
	NAVBAR_CLICK = 'navbarClick',
	NAVBAR_TOOLBAR_CLICK = 'navbarToolbarClick',
	NAVBAR_FULLSCREEN = 'navbarFullscreen',
	THUMB_CLICK = 'thumbClick',
	TOGGLE_PLAY_MEDIA = 'togglePlayMedia',
	PAUSED = 'paused',
	PLAY = 'play',
	PAUSE_MEDIA = 'pauseMedia',
	DESTROY_MEDIA = 'destroyMedia',
	FOOTER_CLICK = 'footerClick',
	LOGO_CLICK = 'logoClick',
	LOGO_LOADED = 'logoLoaded',
	SCROLL = 'scroll',
	LANDING_INIT = 'landingInit',
	OVERLAY_CHANGE = 'overlayChange',
	POP_UP = 'popUp',
	FULLSCREEN_TOGGLE = 'fullscreenToggle',
	FULLSCREEN_TOGGLE_ELEMENT = 'fullscreenToggleElement',
	ORIENTATION = false,
	ORIENTATION_CHANGE = 'orientationchange',
	GESTURE_START = 'gesturestart',
	GESTURE_CHANGE = 'gesturechange',
	GESTURE_END = 'gestureend',
	RETINA = (window.retina || window.devicePixelRatio > 1),
	TOUCH_DEVICE = !!("ontouchstart" in window),
	MEDIA_ORIGINAL = 'media/original/',
	MEDIA_THUMB = 'media/thumb/',
	ICONS = 'dx/icon/',
	PHP = 'dx/php/',
	SERVICE_PATH = './',
	TRANSITION_START = 'transitionStart',
	TRANSITION_END = 'transitionEnd',
	METADATA_LOADED = 'loadedmetadata',
	VIMEO_METADATA_LOADED = 'vimeoMetadataLoaded',
	MEDIA_LOADED = 'mediaLoaded',
	UPDATE_SPEED = 0.5,
	CHILD_ADDED = 'childAdded',
	DROP = 'drop',
	DRAG_ENTER = 'dragenter',
	DRAG_LEAVE = 'dragleave',
	DRAG_OVER = 'dragover',
	DRAG_START = 'dragStart',
	DRAG_MOVE = 'dragMove',
	DRAG_STOP = 'dragStop',
	DRAG_CANCEL = 'dragCancel',
	REORDER_START = 'reorderStart',
	REORDER_MOVE = 'reorderMove',
	REORDER_STOP = 'reorderStop',
	ELEMENT_EVENTS = [TOUCH_START, TOUCH_MOVE, TOUCH_END, TOUCH_CANCEL, KEY_DOWN, KEY_UP, MOUSE_OVER, MOUSE_DOWN, MOUSE_MOVE, MOUSE_UP, MOUSE_OUT, CLICK, DOUBLE_CLICK, LOAD, ERROR, FOCUS, BLUR, DRAG_ENTER, DRAG_OVER, DRAG_LEAVE, DROP],
	THUMB_SIZES = {small: {width: 100, height: 66}, medium: {width: 200, height: 133}, large: {width: 300, height: 200}, xLarge: {width: 400, height: 266}},
	AUTHENTICATED = "authenticated",
	CONTACT_FORM_SUBMIT = 'contactFormSubmit',
	SITE_SERVICE_CONTACT_FORM_SUBMIT = 'siteServiceContactFormSubmit',
	CONTACT_FORM_SENT = 'contactFormSent',
	LAYOUT_FILE_CHANGE = 'layoutFileChange',
	SETTINGS_FILE_CHANGE = 'settingsFileChange',
	PDF_FILE_CHANGE = 'pdfFileChange',
	SHARE_FORM_SUBMIT = 'shareFormSubmit',
	SITE_SERVICE_SHARE_FORM_SUBMIT = 'siteServiceShareFormSubmit',
	SHARE_FORM_SENT = 'shareFormSent',
	INQUIRY_FORM_SUBMIT = 'inquiryFormSubmit',
	SITE_SERVICE_INQUIRY_FORM_SUBMIT = 'siteServiceInquiryFormSubmit',
	INQUIRY_FORM_SENT = 'inquiryFormSent',
	TOUCH_NAVIGATION_START = 'touchNavigationStart',
	TOUCH_NAVIGATION_MOVE = 'touchNavigationMove',
	TOUCH_NAVIGATION_END = 'touchNavigationEnd',
	MENU_DOCK_OPEN = 'menuDockOpen',
	MENU_DOCK_CLOSE = 'menuDockClose',
	INTRO_COMPLETE = 'introComplete',
	MENU_BUILT = 'menuBuilt',
	MENU_SIZE_CHANGE = 'menuSizeChange',
	ADDRESS_SECTION_CHANGE = 'addressSectionChange',
	ADDRESS_OVERLAY_CHANGE = 'addressOverlayChange',
	ADDRESS_ASSET_CHANGE = 'addressAssetChange',
	NAVBAR_NAV_CLICK = 'navbarNavClick',
	NAVBAR_OVERLAY_BTN_CLICK = 'navbaOverlayBtnClick',
	ADMIN_MOUSE_DOWN = 'adminMouseDown',
	ADMIN_MOUSE_UP = 'adminMouseUp',
	SITE_SERVICE_GET_FILE = 'siteServiceGetFile',
	PAGE_LOADED = 'pageLoaded';


var JSONP = function JSONP(vars) {

	var jsonp = document.createElement("script"),
		head = document.getElementsByTagName("head")[0];

	jsonp.setAttribute("src", vars.url + "?" + vars.params + '&callback=' + vars.callback);
	jsonp.setAttribute("id", "jsonp");
	var id = document.getElementById("jsonp");

	if(!id) {
		head.appendChild(jsonp);
	} else {
		head.replaceChild(jsonp, id);
	}
};


function JSONXHR(vars) {

	var url = vars.url,
		params = vars.params,
		callback = vars.callback;

	var formData = new FormData();
	var i; for(i in params) {
		formData.append(i, params[i]);
	}

	var xhr = new XMLHttpRequest();
	xhr.addEventListener("load", response, false);
	xhr.addEventListener("error", error, false);
	xhr.addEventListener("abort", error, false);
	xhr.open("POST", url);
	xhr.send(formData);

	function response(e) {
		if(e.target.response) callback.apply(callback, [JSON.parse(e.target.response)]);
	}

	function error(e) {
		console.error(e);
	}
}

var Mth = {

	E: 2.718281828459045,
	LN2: 0.6931471805599453,
	LN10: 2.302585092994046,
	LOG2E: 1.4426950408889634,
	LOG10E: 0.4342944819032518,
	PI: 3.141592653589793,
	SQRT1_2: 0.7071067811865476,
	SQRT2: 1.4142135623730951,

	floor: function(x) {
		return x | 0;
	},

	ceil: function(x) {
		return x + 1 | 0;
	},

	round: function(x) {
		return x + 0.5 | 0;
	},

	abs: function(x) {
		return x > 0 ? x : -x;
	},

	pow: function(value, exp) {
		var result = value;
		while(--exp) { result *= value; }
		return result;
	},

	max: Math.max,
	min: Math.min,
	random: Math.random,
	acos: Math.acos,
	asin: Math.asin,
	atan: Math.atan,
	atan2: Math.atan2,
	cos: Math.cos,
	exp: Math.exp,
	log: Math.log,
	sin: Math.sin,
	sqrt: Math.sqrt,
	tan: Math.tan
};


if(window.console) {
	window.trace = console.log.bind ? console.log.bind(console) : function(){ console.log(arguments); };
} else {
	window.console = window.trace = {}; console.log = function() {};
}

function isSection(id) {
	return Number(id) < 10000 && id !== '';
}

function isMediaItem(id) {
	return Number(id) > 9999;
}

function getObjById(obj, id) {
	var i;
	id = Number(id);
	for(i in obj) {
		if(obj[i].id === id) {
			obj[i].key = i;
			return obj[i];
		}
	}
	return false;
}

function getSectionById(id) {
	return getObjById(SECTIONS_MODEL, Number(id));
}

function getMediaById(id) {
	return getObjById(MEDIA_MODEL, Number(id));
	// return MEDIA_MODEL[Number(id)];
}

function getThumbQuery(width, height, file) {
	var x = RETINA ? 2 : 1;
	return REWRITE_BASE + MEDIA_THUMB + encodeURIComponent(file) + '?w=' + (width * x) + '&h=' + (height * x) ;
}

function getObjectLength(obj) {
	var length = 0, key;
	for (key in obj) if (obj.hasOwnProperty(key)) length++;
	return length;
}

function getFirstValidSub(section) {
	var media = csvToArray(section.media);
	var i; for(i in media) {
		var subSection = getSectionById(media[i]);
		if(isSection(media[i]) && subSection.label !== '%SPACER%' && subSection.visible === 1) {
			return subSection;
		}
	}
	return false;
}

function getValidMedia(media) {
	media = csvToArray(media);
	var i = 0,
		l = media.length,
		validMedia = [];
	for(; i < l; i++) {
		if(media[i] > 9999) {
			validMedia.push(media[i]);
		}
	}
	return validMedia.toString();
}

function isIndexSection(section) {
	if(section.media) {
		var firstMediaItem = getMediaById(csvToArray(section.media)[0]);
		return firstMediaItem.type === 'link' && firstMediaItem.thumb !== '';
	}
	return false;
}

function removeLinksFromMedia(media) {
	var i = 0,
		l = media.length,
		valid = [];
	for(; i < l; i++) {
		var mediaItem = getMediaById(media[i]);
		if(mediaItem.type !== 'link') valid.push(media[i]);
	}
	return valid;
}

function TransformMatrix(element) {
	var computed = window.getComputedStyle(element, null);
	var matrix = computed.getPropertyValue("-webkit-transform") ||
		computed.getPropertyValue("-moz-transform") ||
		computed.getPropertyValue("-ms-transform") ||
		computed.getPropertyValue("-o-transform") ||
		computed.getPropertyValue("transform") ||
		"cannot get transform matrix";
	if(matrix.indexOf('matrix3d') > -1) {
		matrix = csvToArray(matrix.replace(/[\smatrix3d()]/gi, ''));
		this.matrix = matrix;
		this.x = matrix[12];
		this.y = matrix[13];
	} else {
		matrix = csvToArray(matrix.replace(/[\smatrix()]/gi, ''));
		this.matrix = matrix;
		this.x = matrix[4];
		this.y = matrix[5];
	}
}

function csvToArray(value) {
	if(value) {
		if(value === '') {
			return [];
		} else if(typeof value === 'number') {
			return [value.toString()];
		} else if(typeof value === 'boolean') {
			return [value.toString()];
		} else if(value.toString().indexOf(',') > -1) {
			return value.split(',');
		} else {
			return [value.toString()];
		}
	}
	return [];
}

function uniquePush(arr, item) {
	var i = 0,
		length = arr.length;
	if(length === 0) {
		arr.push(item);
	}
	for(;i<length;i++) {
		if(arr.indexOf(item) === -1) {
			arr.push(item);
		}
	}
	return arr;
}

function removeSysFonts(fonts) {
	var sys = ['Arial','Georgia','Helvetica','Times New Roman','Verdana'],
		i = fonts.length;
	while(i--) {
		if(sys.indexOf(fonts[i]) > -1) {
			fonts.splice(i, 1);
		}
	}
	return fonts;
}

function findInArray(needle, haystack) {
	var i = haystack.length;
	while(i--) {
		if(needle === haystack[i]) {
			return true;
		}
	}
	return false;
}

function hasClass(o, cls) {
	return new RegExp('(^|\\s)' + cls + '(\\s|$)').test(o.className);
}

function parseColor(c) {
	var color = [];
	if (c && c.charAt(0) === "#") {
		c = parseInt(c.substr(1), 16);
		color = [(c >> 16) & 255, (c >> 8) & 255, c & 255];
	} else if(c && c.charAt(0) === "r") {
		c = c.replace(/[rgba()]/ig,'').split(',');
		color = [Number(c[0]), Number(c[1]), Number(c[2]), Number(c[3])];
	}
	return color;
}

function getLoaderColor(bgColor) {
	var avg, tint, c;
	c = parseColor(bgColor);
	avg = (c[0] + c[1] + c[2]) * 0.33;
	tint = avg < 128 ? '#FFFFFF' : '#000000';
	return tint;
}

function toRgba(color, alpha) {
	color = parseColor(color);
	return 'rgba(' + color[0] + ',' + color[1] + ',' + color[2] + ',' + alpha + ')';
}

function getDocHeight() {
	return Math.max(Math.max(document.body.scrollHeight, document.documentElement.scrollHeight), Math.max(document.body.offsetHeight, document.documentElement.offsetHeight), Math.max(document.body.clientHeight, document.documentElement.clientHeight));
}

function percentToPixels(value, range) {
	if(!isNaN(value) || typeof value === 'string') {
		if(!isNaN(value)){
			return Number(value);
		} else if(value.search('%') > -1) {
			value = value.replace('%', '');
			value = (Number(value) * 0.01) * range;
			return Math.round(value);
		} else if(value.search('px') > -1) {
			value = value.replace('px', '');
			return Number(value);
		}
		return Number(value);
	}
}

function getExt(file) {
	return file.split('.').pop().toLowerCase();
}

function getX(e) {
	if (!TOUCH_DEVICE && !e.touches) {
		return e.clientX;
	} else if(TOUCH_DEVICE && e.touches) {
		return e.touches[0].pageX;
	}
	return false;
}

function getY(e) {
	if (!TOUCH_DEVICE && !e.touches) {
		return e.clientY;
	} else if(TOUCH_DEVICE && e.touches) {
		return e.touches[0].pageY;
	}
	return false;
}

function hardwareAccel(el) {
	el.style.webkitTransform = 'translateZ(0)';
	el.style.webkitPerspective = '1000';
	el.style.webkitBackfaceVisibility = 'hidden';
}

function spacesToCamelCase(str) {
	return str.replace(/(\s[a-z])/ig, function($1) {
		return $1.replace(/\s/g,'').toUpperCase();
	});
}

function camelCaseToSpaces(str) {
	return str.replace(/([A-Z])/g, function($1) {
		return $1.replace($1,' '+$1.toLowerCase());
	});
}

function cssToJs(str) {
	return str.replace(/(-[a-z])/g, function($1) {
		return $1.replace('-','').toUpperCase();
	});
}

function jsToCss(str) {
	return str.replace(/([A-Z])/g, function($1) {
		return $1.replace($1,'-'+$1.toLowerCase());
	});
}

function plainTextToHtml(str) {
	/*do not honor carriage returns for html, except for </a>*/
	return str.replace(/\t/g, '&#9;').replace(/\\/g, '').replace(/([^a])(>)(\r\n|\n|\r)/g, '$1>');
}

function isFullscreenCapable() {
	return document.documentElement.requestFullScreen || document.documentElement.mozRequestFullScreen || document.documentElement.webkitRequestFullScreen;
}

function replaceCSS(file, replace) {
	var links = document.getElementsByTagName("link"),
		old,
		i = links.length;
	while(i--) {
		if(links[i].getAttribute('href').search(replace) > -1) {
			old = document.getElementsByTagName("link")[i];
		}
	}
	var newCss = document.createElement("link");
	newCss.setAttribute("rel", "stylesheet");
	newCss.setAttribute("type", "text/css");
	newCss.setAttribute("href", REWRITE_BASE + PHP + file + '?' + new Date());
	document.getElementsByTagName("head")[0].replaceChild(newCss, old);
}

function prepend(child, parent) {
	parent.insertBefore(child, parent.firstChild);
}

function addDashes(str) {
	str = str.replace(/ /g, '-');
	str = str.replace(/%20/g, '-');
	return str;
}

function removeDashes(str) {
	if(str && str.search('-') > -1) {
		str = str.replace(/-/g, ' ');
	}
	return str;
}

function hitTarget(element) {
	return {
		hitTestPoint: function(xPoint, yPoint) {
			return xPoint >= this.absX && xPoint <= this.absX + element.offsetWidth && yPoint >= this.absY && yPoint <= this.absY + element.offsetHeight;
		},
		hitTestAbs: function(xPoint, yPoint) {
			return xPoint >= this.absX && xPoint <= this.absX + element.offsetWidth && yPoint >= this.absY && yPoint <= this.absY + element.offsetHeight;
		},
		get absX() {
			var x = 0;
			var el = element;
			if (el.offsetParent) {
				do { x += el.offsetLeft; } while (el = el.offsetParent);
			}
			return x;
		},
		get absY() {
			var y = 0;
			var el = element;
			if (el.offsetParent) {
				do { y += el.offsetTop; } while (el = el.offsetParent);
			}
			return y;
		}
	};
}

function fileExist(urlToFile) {
	var xhr = new XMLHttpRequest();
	xhr.open('HEAD', urlToFile, false);
	xhr.send();
	return xhr.status === 200;
}

function isReconciledSize(id, sizeType, width, height) {
	var mediaItem = getMediaById(id);
	if(!(mediaItem.size[sizeType].width === width && mediaItem.size[sizeType].height === height)) {
		reconcileSize(mediaItem, sizeType, width, height);
		return false;
	}
	return true;
}

function reconcileSize(mediaItem, sizeType, width, height) {
	mediaItem.size[sizeType].width = width;
	mediaItem.size[sizeType].height = height;
}

function isFillSite() {
	return LAYOUT_MODEL.landingMediaScaleType === 'fillSite';
}

function formatMediaType(str) {
	switch(str) {
		case 'image':
			return 'imageVideo';
		case 'video':
			return 'imageVideo';
		case 'html':
			return 'page';
		default:
			return str;
	}
}

window.requestAnimationFrame = window.requestAnimationFrame || (function(){
	return  window.webkitRequestAnimationFrame ||
			window.mozRequestAnimationFrame    ||
			function( callback ){ return window.setTimeout(callback, 1000 / 60); };
})();

window.cancelAnimationFrame = window.cancelAnimationFrame || (function(){
	return  window.webkitCancelAnimationFrame ||
			window.mozCancelAnimationFrame    ||
			function( timer ){ window.clearTimeout(timer); };
})();

window.performance = window.performance || {};

performance.now = (function() {
	return 	performance.now       ||
			performance.mozNow    ||
			performance.msNow     ||
			performance.oNow      ||
			performance.webkitNow ||
			function() { return new Date().getTime(); };
})();

function isNumber(value) {
	return !isNaN(value);
}

// bug #758
function exists(obj, pathToProp) {
	var props = pathToProp.split('.');
	return props.reduce(function(prev, next) {
		return prev !== undefined && prev !== null ? prev[next] : null;
	}, obj);
};

function firstValid() {
	/* excludes undefined, empty strings, null */ 
	var i = 0, l = arguments.length;
	for(; i < l; i++) {
		if(typeof arguments[i] === 'number' || typeof arguments[i] === 'boolean' || !!arguments[i]) {
			return arguments[i];
		}
	}
}

function randId() {
	 return Math.random().toString(36).substr(2, 10);
}

function randRange(min, max) {
	return ~~(min + Math.random() * (max - min));
}

function randHex() {
	return '#' + Math.floor(Math.random()*16777215).toString(16);
}

function randRGB() {
	return 'rgba('+Math.round(Math.random()*255) + ',' + Math.round(Math.random()*255) + ',' + Math.round(Math.random()*255) + ')';
}

function randRGBA() {
	return 'rgba('+Math.round(Math.random()*255) + ',' + Math.round(Math.random()*255) + ',' + Math.round(Math.random()*255) + ',' + 0.5 + ')';
}

function getSpriteDims(sprite) {
	document.body.appendChild(sprite.element);
	var width = sprite.element.offsetWidth;
	var height = sprite.element.offsetHeight;
	document.body.removeChild(sprite.element);
	return {width:width, height:height};
}

function isVerticalMenu() {
	return /left|right/.test(LAYOUT_MODEL.menuAlignHorizontal) || (USER_AGENT === MOBILE || USER_AGENT === TABLET);
}

function isHorizontalMenu() {
	return /top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal) && USER_AGENT !== MOBILE && USER_AGENT !== TABLET;
}

function bytesToSize(bytes) {
    var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    if (bytes == 0) return '';
    var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
    return (bytes / Math.pow(1024, i)).toFixed(1) + ' ' + sizes[i];
}

function regexMatchAll(str, tests) {
	var regex,
		tempArr = [],
		i = 0,
		l = tests.length;

	for(; i < l; i++) {
		tempArr.push('(' + tests[i] + ')');
	}
	regex = new RegExp(tempArr.join('.+'), 'i');
	return regex.test(str);
}

function tryJSON(str) {
	try {
		return JSON.parse(str);
	} catch(e) {
		return false;
	}
}

function getVendorName(ua) {
	if (/chrome/.test(ua)) {
		return 'Chrome';
	} else if (/safari/.test(ua)) {
		return 'Safari';
	} else if (/firefox/.test(ua)) {
		return 'Firefox';
	} else if (/opera/.test(ua)) {
		return 'Opera';
	} else if (/msie|rv:/.test(ua)) {
		return 'MSIE';
	}
	return 'Other';
}

var BROWSER_NAME = (function() {
	var ua = HTTP_USER_AGENT.toLowerCase();
	if(/mobile/.test(ua)) {
		return 'Mobile ' + getVendorName(ua);
	} else {
		return getVendorName(ua);
	}
})();

function isPod() {
	return isAndroidMobile() || isAppleMobile();
}

function isAppleMobile() {
	var ua = HTTP_USER_AGENT.toLowerCase();
	return	(/ipod/.test(ua) || /iphone/.test(ua));
}

function isAndroidMobile() {
	var ua = HTTP_USER_AGENT.toLowerCase();
	if(/android/.test(ua)) {
		return (/galaxy nexus/.test(ua)) || /* android galaxy nexus phone */
				(/nexus 5/.test(ua)) ||		/* android nexus 5 phone */
				(/touch/.test(ua)) ||		/* android phone */
				(/htc/.test(ua)) ||			/* android htc phone */
				(/droid/.test(ua)) ||		/* android droid x phone and others */
				(/sch/.test(ua))			/* android galaxy sIII phone */
	}
	return false;
}

function isPad() {
	var ua = HTTP_USER_AGENT.toLowerCase();
	return	(/pad/.test(ua)) || 								/* iPad and others */
			(/silk/.test(ua)) || 								/* kindle fire hd */
			(/android/.test(ua) && /nexus 7/.test(ua)) || 		/* andriod nexus 7 pad */
			false;
}

function isIpad() {
	var ua = HTTP_USER_AGENT.toLowerCase();
	return	(/ipad/.test(ua)) || false;
}

USER_AGENT = (function() {
	if (isPad() && !SETTINGS_MODEL.padUseDesktop) {
		return TABLET;
	} else if (isPod() && !SETTINGS_MODEL.podUseDesktop) {
		return MOBILE;
	}
	return HTML;
})();

function setViewport() {

	var viewport = document.createElement('meta');
	viewport.setAttribute('name', 'viewport');
	if(USER_AGENT === HTML && isPod()) {
		viewport.setAttribute('content', 'minimal-ui, user-scalable=0, initial-scale=0.5, minimum-scale=0.5, maximum-scale=0.5');
	} else if(USER_AGENT === HTML && isPad()) {
		viewport.setAttribute('content', 'minimal-ui, user-scalable=0, initial-scale=1, minimum-scale=1, maximum-scale=1');
	} else if (isAndroidMobile()) {
		viewport.setAttribute('content', 'initial-scale=1, width=device-width');
	} else if (isAppleMobile()) {
		viewport.setAttribute('content', 'minimal-ui, user-scalable=0, initial-scale=1, minimum-scale=1, maximum-scale=1');
	} else if (isPad()) {
		viewport.setAttribute('content', 'minimal-ui, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1');
	} else if(USER_AGENT == MOBILE) {
		viewport.setAttribute('content', 'minimal-ui, user-scalable=0, initial-scale=1, minimum-scale=1, maximum-scale=1');
	}
	document.getElementsByTagName("head")[0].appendChild(viewport);

	if(isPod() || isPad()) {
		var webAppCapable = document.createElement('meta');
		webAppCapable.setAttribute('name', 'apple-mobile-web-app-capable');
		webAppCapable.setAttribute('content', 'yes');
		document.getElementsByTagName("head")[0].appendChild(webAppCapable);

		var webAppStatusBar = document.createElement('meta');
		webAppStatusBar.setAttribute('name', 'apple-mobile-web-app-status-bar-style');
		webAppStatusBar.setAttribute('content', 'black');
		document.getElementsByTagName("head")[0].appendChild(webAppStatusBar);

		var appleTouchIcon = document.createElement('link');
		appleTouchIcon.setAttribute('href', REWRITE_BASE + 'dx/icon/apple-touch-icon.png');
		appleTouchIcon.setAttribute('rel', 'apple-touch-icon');
		appleTouchIcon.setAttribute('sizes', '144x144');
		document.getElementsByTagName("head")[0].appendChild(appleTouchIcon);

	}
}

setViewport();


var keyCode = {
	"8":DELETE,
	"13":ENTER,
	"27":ESCAPE,
	"32":SPACE_BAR,
	"37":LEFT_ARROW,
	"39":RIGHT_ARROW,
	"16":SHIFT,
	"91":COMMAND,
	"93":COMMAND,
	"224":COMMAND,
	"17":CONTROL,
	"65":'a'
};

var keyName = {
	DELETE:8,
	ENTER:13,
	ESCAPE:27,
	SPACE_BAR:32,
	LEFT_ARROW:37,
	RIGHT_ARROW:39,
	SHIFT:16,
	COMMAND:91,
	COMMAND:93,
	COMMAND:224,
	CONTROL:17,
	'a':65
};

var socialIcons = {
	'[500px]': {
		filename: "500px@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M7.14517241,9.90206897 C7.26551724,9.58448276 7.41413793,9.30758621 7.625,9.06775862 C8.08758621,8.54189655 8.67189655,8.25844828 9.36655172,8.19431034 C10.3455172,8.10396552 11.15,8.48189655 11.8543103,9.12465517 C12.1460345,9.39086207 12.4044828,9.68931034 12.6581034,9.99137931 C12.712069,10.0558621 12.7356897,10.0615517 12.7931034,9.99362069 C13.1196552,9.60568966 13.445,9.21603448 13.8468966,8.90086207 C14.3103448,8.53741379 14.8210345,8.275 15.4134483,8.20568966 C16.8775862,8.03413793 18.1012069,8.83155172 18.4127586,10.3427586 C18.5437931,10.9784483 18.5034483,11.6068966 18.2832759,12.2196552 C17.8762069,13.352069 16.9332759,13.9984483 15.7284483,13.9843103 C14.9944828,13.9756897 14.367931,13.6912069 13.7963793,13.2577586 C13.422931,12.9744828 13.1031034,12.6346552 12.7953448,12.2837931 C12.7436207,12.225 12.7196552,12.2118966 12.6568966,12.277069 C12.3422414,12.6037931 12.0434483,12.9467241 11.6901724,13.2343103 C11.2434483,13.597931 10.7503448,13.8712069 10.172931,13.9496552 C9.15172414,14.0884483 8.26982759,13.8193103 7.58413793,13.0181034 C7.4287931,12.8363793 7.31155172,12.6293103 7.21534483,12.4105172 C7.20327586,12.382931 7.19965517,12.3496552 7.16844828,12.3265517 C7.03396552,12.6167241 6.86741379,12.8839655 6.6487931,13.1162069 C6.09844828,13.7013793 5.41965517,14.0065517 4.61844828,14.0348276 C4.03948276,14.0553448 3.47241379,13.9815517 2.94431034,13.7312069 C2.05965517,13.3118966 1.57310345,12.6139655 1.51275862,11.6282759 C1.50827586,11.5532759 1.52896552,11.5343103 1.60327586,11.5346552 C2.07913793,11.5381034 2.555,11.5381034 3.03068966,11.5346552 C3.10206897,11.5341379 3.12206897,11.5551724 3.13413793,11.625 C3.22568966,12.167931 3.51775862,12.5460345 4.06482759,12.6818966 C4.82827586,12.8713793 5.52965517,12.4381034 5.73017241,11.6522414 C5.86517241,11.1232759 5.80689655,10.6175862 5.4562069,10.177069 C5.22344828,9.88465517 4.90724138,9.74224138 4.53603448,9.71603448 C4.00189655,9.67844828 3.565,9.85448276 3.24948276,10.297931 C3.22017241,10.3394828 3.18603448,10.3496552 3.13862069,10.3494828 C2.70965517,10.3482759 2.28086207,10.347069 1.85206897,10.3503448 C1.77741379,10.3508621 1.76224138,10.33 1.775,10.2591379 C1.99758621,9.02189655 2.21810345,7.78431034 2.43913793,6.54672414 C2.46931034,6.37741379 2.50017241,6.20810345 2.52810345,6.03844828 C2.53706897,5.98275862 2.55844828,5.96224138 2.61844828,5.96241379 C4.04275862,5.96431034 5.46689655,5.96431034 6.89103448,5.96241379 C6.95913793,5.96224138 6.97362069,5.98448276 6.97327586,6.04810345 C6.97034483,6.42982759 6.96965517,6.81189655 6.9737931,7.19362069 C6.97448276,7.27137931 6.95465517,7.29275862 6.87568966,7.29241379 C5.85534483,7.28965517 4.835,7.29155172 3.81465517,7.2887931 C3.73,7.28862069 3.69224138,7.30258621 3.67637931,7.39775862 C3.58655172,7.94068966 3.48741379,8.48224138 3.39241379,9.02431034 C3.38844828,9.04724138 3.37224138,9.07844828 3.39706897,9.09362069 C3.42465517,9.11051724 3.44017241,9.07706897 3.45655172,9.0612069 C3.92413793,8.61103448 4.49448276,8.47344828 5.12344828,8.50706897 C5.72844828,8.53931034 6.245,8.76637931 6.67103448,9.19672414 C6.84896552,9.3762069 6.98724138,9.58396552 7.0987931,9.81 C7.11103448,9.83431034 7.12362069,9.8587931 7.14517241,9.90206897 Z M17.0048276,11.0737931 C17.007069,11.0189655 16.997931,10.9382759 16.9877586,10.8575862 C16.8974138,10.1372414 16.2906897,9.67137931 15.572069,9.7662069 C15.1948276,9.8162069 14.8836207,10.0027586 14.5905172,10.2274138 C14.2637931,10.4781034 13.9898276,10.7841379 13.7075862,11.0813793 C13.6696552,11.1212069 13.6865517,11.1422414 13.7143103,11.1732759 C13.9125862,11.3953448 14.1174138,11.6112069 14.3496552,11.7981034 C14.7353448,12.1084483 15.1527586,12.3474138 15.6613793,12.3944828 C16.2341379,12.4477586 16.6982759,12.1796552 16.9031034,11.6605172 C16.9741379,11.4808621 17.0037931,11.2932759 17.0048276,11.0737931 Z M8.44758621,11.1437931 C8.45034483,11.18 8.45344828,11.2394828 8.45862069,11.2984483 C8.50724138,11.8562069 8.87965517,12.2755172 9.41948276,12.3741379 C9.7162069,12.4284483 10.0046552,12.3889655 10.2844828,12.2801724 C10.8818966,12.0472414 11.337069,11.6287931 11.7532759,11.1584483 C11.7837931,11.1239655 11.7687931,11.107069 11.7448276,11.082069 C11.4468966,10.7694828 11.1431034,10.462931 10.7912069,10.2093103 C10.5468966,10.0332759 10.2898276,9.8762069 9.99413793,9.80310345 C9.54396552,9.69172414 9.13396552,9.75568966 8.8137931,10.1222414 C8.56551724,10.4063793 8.44689655,10.7431034 8.44758621,11.1437931 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M7.14517241,9.90206897 C7.26551724,9.58448276 7.41413793,9.30758621 7.625,9.06775862 C8.08758621,8.54189655 8.67189655,8.25844828 9.36655172,8.19431034 C10.3455172,8.10396552 11.15,8.48189655 11.8543103,9.12465517 C12.1460345,9.39086207 12.4044828,9.68931034 12.6581034,9.99137931 C12.712069,10.0558621 12.7356897,10.0615517 12.7931034,9.99362069 C13.1196552,9.60568966 13.445,9.21603448 13.8468966,8.90086207 C14.3103448,8.53741379 14.8210345,8.275 15.4134483,8.20568966 C16.8775862,8.03413793 18.1012069,8.83155172 18.4127586,10.3427586 C18.5437931,10.9784483 18.5034483,11.6068966 18.2832759,12.2196552 C17.8762069,13.352069 16.9332759,13.9984483 15.7284483,13.9843103 C14.9944828,13.9756897 14.367931,13.6912069 13.7963793,13.2577586 C13.422931,12.9744828 13.1031034,12.6346552 12.7953448,12.2837931 C12.7436207,12.225 12.7196552,12.2118966 12.6568966,12.277069 C12.3422414,12.6037931 12.0434483,12.9467241 11.6901724,13.2343103 C11.2434483,13.597931 10.7503448,13.8712069 10.172931,13.9496552 C9.15172414,14.0884483 8.26982759,13.8193103 7.58413793,13.0181034 C7.4287931,12.8363793 7.31155172,12.6293103 7.21534483,12.4105172 C7.20327586,12.382931 7.19965517,12.3496552 7.16844828,12.3265517 C7.03396552,12.6167241 6.86741379,12.8839655 6.6487931,13.1162069 C6.09844828,13.7013793 5.41965517,14.0065517 4.61844828,14.0348276 C4.03948276,14.0553448 3.47241379,13.9815517 2.94431034,13.7312069 C2.05965517,13.3118966 1.57310345,12.6139655 1.51275862,11.6282759 C1.50827586,11.5532759 1.52896552,11.5343103 1.60327586,11.5346552 C2.07913793,11.5381034 2.555,11.5381034 3.03068966,11.5346552 C3.10206897,11.5341379 3.12206897,11.5551724 3.13413793,11.625 C3.22568966,12.167931 3.51775862,12.5460345 4.06482759,12.6818966 C4.82827586,12.8713793 5.52965517,12.4381034 5.73017241,11.6522414 C5.86517241,11.1232759 5.80689655,10.6175862 5.4562069,10.177069 C5.22344828,9.88465517 4.90724138,9.74224138 4.53603448,9.71603448 C4.00189655,9.67844828 3.565,9.85448276 3.24948276,10.297931 C3.22017241,10.3394828 3.18603448,10.3496552 3.13862069,10.3494828 C2.70965517,10.3482759 2.28086207,10.347069 1.85206897,10.3503448 C1.77741379,10.3508621 1.76224138,10.33 1.775,10.2591379 C1.99758621,9.02189655 2.21810345,7.78431034 2.43913793,6.54672414 C2.46931034,6.37741379 2.50017241,6.20810345 2.52810345,6.03844828 C2.53706897,5.98275862 2.55844828,5.96224138 2.61844828,5.96241379 C4.04275862,5.96431034 5.46689655,5.96431034 6.89103448,5.96241379 C6.95913793,5.96224138 6.97362069,5.98448276 6.97327586,6.04810345 C6.97034483,6.42982759 6.96965517,6.81189655 6.9737931,7.19362069 C6.97448276,7.27137931 6.95465517,7.29275862 6.87568966,7.29241379 C5.85534483,7.28965517 4.835,7.29155172 3.81465517,7.2887931 C3.73,7.28862069 3.69224138,7.30258621 3.67637931,7.39775862 C3.58655172,7.94068966 3.48741379,8.48224138 3.39241379,9.02431034 C3.38844828,9.04724138 3.37224138,9.07844828 3.39706897,9.09362069 C3.42465517,9.11051724 3.44017241,9.07706897 3.45655172,9.0612069 C3.92413793,8.61103448 4.49448276,8.47344828 5.12344828,8.50706897 C5.72844828,8.53931034 6.245,8.76637931 6.67103448,9.19672414 C6.84896552,9.3762069 6.98724138,9.58396552 7.0987931,9.81 C7.11103448,9.83431034 7.12362069,9.8587931 7.14517241,9.90206897 Z M17.0048276,11.0737931 C17.007069,11.0189655 16.997931,10.9382759 16.9877586,10.8575862 C16.8974138,10.1372414 16.2906897,9.67137931 15.572069,9.7662069 C15.1948276,9.8162069 14.8836207,10.0027586 14.5905172,10.2274138 C14.2637931,10.4781034 13.9898276,10.7841379 13.7075862,11.0813793 C13.6696552,11.1212069 13.6865517,11.1422414 13.7143103,11.1732759 C13.9125862,11.3953448 14.1174138,11.6112069 14.3496552,11.7981034 C14.7353448,12.1084483 15.1527586,12.3474138 15.6613793,12.3944828 C16.2341379,12.4477586 16.6982759,12.1796552 16.9031034,11.6605172 C16.9741379,11.4808621 17.0037931,11.2932759 17.0048276,11.0737931 Z M8.44758621,11.1437931 C8.45034483,11.18 8.45344828,11.2394828 8.45862069,11.2984483 C8.50724138,11.8562069 8.87965517,12.2755172 9.41948276,12.3741379 C9.7162069,12.4284483 10.0046552,12.3889655 10.2844828,12.2801724 C10.8818966,12.0472414 11.337069,11.6287931 11.7532759,11.1584483 C11.7837931,11.1239655 11.7687931,11.107069 11.7448276,11.082069 C11.4468966,10.7694828 11.1431034,10.462931 10.7912069,10.2093103 C10.5468966,10.0332759 10.2898276,9.8762069 9.99413793,9.80310345 C9.54396552,9.69172414 9.13396552,9.75568966 8.8137931,10.1222414 C8.56551724,10.4063793 8.44689655,10.7431034 8.44758621,11.1437931 Z'    
	},
	'[behance]': {
		filename: "behance@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M10.484622,12.1908776 C10.484622,15.3263776 7.287372,15.2228776 7.287372,15.2228776 L4.356192,15.2228776 L4.270442,15.2228776 L2.048292,15.2228776 L2.048292,4.94987755 L4.270442,4.94987755 L4.356192,4.94987755 L7.287372,4.94987755 C8.878892,4.94987755 10.135252,5.84687755 10.135252,7.68487755 C10.135252,9.52287755 8.599102,9.63987755 8.599102,9.63987755 C10.624272,9.63987755 10.484622,12.1908776 10.484622,12.1908776 Z M12.584272,5.55487755 L16.738002,5.55487755 L16.738002,6.81987755 L12.584272,6.81987755 L12.584272,5.55487755 L12.584272,5.55487755 Z M18.255042,12.0228776 L13.038012,12.0228776 C13.038012,13.9308776 14.809362,13.8108776 14.809362,13.8108776 C16.482222,13.8108776 16.423912,12.7053776 16.423912,12.7053776 L18.196242,12.7053776 C18.196242,15.6388776 14.750072,15.4378776 14.750072,15.4378776 C10.616432,15.4378776 10.882502,11.5103776 10.882502,11.5103776 C10.882502,11.5103776 10.878582,7.56387755 14.750072,7.56387755 C18.825402,7.56387755 18.255042,12.0228776 18.255042,12.0228776 Z M14.8853775,9.17470139 C13.3535087,9.17470139 13.1406686,10.7667184 13.1406686,10.7667184 L16.3974586,10.7667184 C16.3974586,10.7667184 16.4182117,9.17470139 14.8853775,9.17470139 Z M7.49630612,10.7667184 L4.60921107,10.7667184 L4.60921107,13.5266165 L7.16522166,13.5266165 C7.2086584,13.5266165 7.2738135,13.5276216 7.35006911,13.5266165 C7.76127021,13.5165659 8.5407183,13.3919383 8.5407183,12.1848598 C8.5407183,10.752145 7.49630612,10.7667184 7.49630612,10.7667184 Z M8.19756809,7.94500898 C8.19756809,6.87110106 7.49630612,6.87110106 7.49630612,6.87110106 L7.12468071,6.87110106 L4.60921107,6.87110106 L4.60921107,9.17470139 L7.31725024,9.17470139 C7.78443647,9.17470139 8.19756809,9.01841437 8.19756809,7.94500898 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M10.4240442,12.4717898 C10.4240442,15.2937398 7.6264505,15.2005898 7.6264505,15.2005898 L5.061668,15.2005898 L4.98663675,15.2005898 L3.0422555,15.2005898 L3.0422555,5.9548898 L4.98663675,5.9548898 L5.061668,5.9548898 L7.6264505,5.9548898 C9.0190305,5.9548898 10.1183455,6.7621898 10.1183455,8.4163898 C10.1183455,10.0705898 8.77421425,10.1758898 8.77421425,10.1758898 C10.546238,10.1758898 10.4240442,12.4717898 10.4240442,12.4717898 Z M12.261238,6.4993898 L15.8957518,6.4993898 L15.8957518,7.6378898 L12.261238,7.6378898 L12.261238,6.4993898 L12.261238,6.4993898 Z M17.2231618,12.3205898 L12.6582605,12.3205898 C12.6582605,14.0377898 14.2081918,13.9297898 14.2081918,13.9297898 C15.6719443,13.9297898 15.620923,12.9348398 15.620923,12.9348398 L17.1717118,12.9348398 C17.1717118,15.5749898 14.156313,15.3940898 14.156313,15.3940898 C10.539378,15.3940898 10.7721893,11.8593398 10.7721893,11.8593398 C10.7721893,11.8593398 10.7687593,8.3074898 14.156313,8.3074898 C17.7222268,8.3074898 17.2231618,12.3205898 17.2231618,12.3205898 Z M14.2747053,9.75723125 C12.9343201,9.75723125 12.7480851,11.1900465 12.7480851,11.1900465 L15.5977763,11.1900465 C15.5977763,11.1900465 15.6159352,9.75723125 14.2747053,9.75723125 Z M7.80926785,11.1900465 L5.28305968,11.1900465 L5.28305968,13.6739548 L7.51956896,13.6739548 C7.5575761,13.6739548 7.61458682,13.6748594 7.68131047,13.6739548 C8.04111143,13.6649093 8.72312852,13.5527445 8.72312852,12.4663738 C8.72312852,11.1769305 7.80926785,11.1900465 7.80926785,11.1900465 Z M8.42287208,8.65050808 C8.42287208,7.68399096 7.80926785,7.68399096 7.80926785,7.68399096 L7.48409562,7.68399096 L5.28305968,7.68399096 L5.28305968,9.75723125 L7.65259396,9.75723125 C8.06138191,9.75723125 8.42287208,9.61657293 8.42287208,8.65050808 Z'    
	},
	'[blogger]': {
		filename: "blogger@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M16.509,12.704 C16.4965,14.991 14.635,16.864 12.344,16.864 L7.559,16.864 C5.2675,16.864 3.395,14.991 3.395,12.704 L3.395,7.8435 C3.395,5.5515 5.2675,3.6745 7.559,3.6745 L10.471,3.6745 C11.547,3.8025 13.1115,4.7235 13.689,5.949 C13.847,6.292 13.931,6.3455 14.062,7.3645 C14.1335,7.889 14.1695,8.2765 14.404,8.4915 C14.733,8.7915 15.9585,8.59 16.2,8.7785 L16.3865,8.924 L16.497,9.1535 L16.535,9.337 L16.509,12.704 Z M12.304,11.8505 L7.6115,11.8505 C7.171,11.8505 6.8145,12.204 6.8145,12.6425 C6.8145,13.073 7.171,13.4365 7.6115,13.4365 L12.304,13.4365 C12.7425,13.4365 13.097,13.073 13.097,12.6425 C13.097,12.204 12.7425,11.8505 12.304,11.8505 Z M7.6115,8.6735 L9.921,8.6735 C10.3615,8.6735 10.719,8.311 10.719,7.8755 C10.719,7.439 10.3615,7.0795 9.921,7.0795 L7.6115,7.0795 C7.171,7.0795 6.8145,7.439 6.8145,7.8755 C6.8145,8.3115 7.171,8.6735 7.6115,8.6735 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M16.509,12.704 C16.4965,14.991 14.635,16.864 12.344,16.864 L7.559,16.864 C5.2675,16.864 3.395,14.991 3.395,12.704 L3.395,7.8435 C3.395,5.5515 5.2675,3.6745 7.559,3.6745 L10.471,3.6745 C11.547,3.8025 13.1115,4.7235 13.689,5.949 C13.847,6.292 13.931,6.3455 14.062,7.3645 C14.1335,7.889 14.1695,8.2765 14.404,8.4915 C14.733,8.7915 15.9585,8.59 16.2,8.7785 L16.3865,8.924 L16.497,9.1535 L16.535,9.337 L16.509,12.704 Z M12.304,11.8505 L7.6115,11.8505 C7.171,11.8505 6.8145,12.204 6.8145,12.6425 C6.8145,13.073 7.171,13.4365 7.6115,13.4365 L12.304,13.4365 C12.7425,13.4365 13.097,13.073 13.097,12.6425 C13.097,12.204 12.7425,11.8505 12.304,11.8505 Z M7.6115,8.6735 L9.921,8.6735 C10.3615,8.6735 10.719,8.311 10.719,7.8755 C10.719,7.439 10.3615,7.0795 9.921,7.0795 L7.6115,7.0795 C7.171,7.0795 6.8145,7.439 6.8145,7.8755 C6.8145,8.3115 7.171,8.6735 7.6115,8.6735 Z'    
	},
	'[digg]': {
		filename: "digg@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M5.96772727,12.68 L2.08090909,12.68 L2.08090909,7.93136364 L4.43727273,7.93136364 L4.43727273,5.85636364 L5.96772727,5.85636364 L5.96772727,12.68 Z M8.34181818,12.6977273 L6.75727273,12.6977273 L6.75727273,7.92181818 L8.34181818,7.92181818 L8.34181818,12.6977273 Z M8.34181818,7.23636364 L6.75727273,7.23636364 L6.75727273,5.94090909 L8.34181818,5.94090909 L8.34181818,7.23636364 Z M13.0459091,14.7736364 L12.3695455,14.7736364 L9.13181818,14.7736364 L9.13181818,13.4409091 L11.5154545,13.4409091 L11.5154545,12.6977273 L9.15818182,12.6977273 L9.15818182,7.95 L13.0459091,7.95 L13.0459091,14.7736364 Z M17.74,14.7736364 L17.0645455,14.7736364 L13.8259091,14.7736364 L13.8259091,13.4409091 L16.2095455,13.4409091 L16.2095455,12.6977273 L13.8531818,12.6977273 L13.8531818,7.95 L17.74,7.95 L17.74,14.7736364 Z M3.51,9.16227273 L3.51,11.3213636 L4.30818182,11.3213636 L4.30818182,9.16227273 L3.51,9.16227273 Z M10.7827273,9.16227273 L10.7827273,11.3213636 L11.5818182,11.3213636 L11.5818182,9.16227273 L10.7827273,9.16227273 Z M15.3281818,9.16227273 L15.3281818,11.3213636 L16.1263636,11.3213636 L16.1263636,9.16227273 L15.3281818,9.16227273 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M5.96772727,12.68 L2.08090909,12.68 L2.08090909,7.93136364 L4.43727273,7.93136364 L4.43727273,5.85636364 L5.96772727,5.85636364 L5.96772727,12.68 Z M8.34181818,12.6977273 L6.75727273,12.6977273 L6.75727273,7.92181818 L8.34181818,7.92181818 L8.34181818,12.6977273 Z M8.34181818,7.23636364 L6.75727273,7.23636364 L6.75727273,5.94090909 L8.34181818,5.94090909 L8.34181818,7.23636364 Z M13.0459091,14.7736364 L12.3695455,14.7736364 L9.13181818,14.7736364 L9.13181818,13.4409091 L11.5154545,13.4409091 L11.5154545,12.6977273 L9.15818182,12.6977273 L9.15818182,7.95 L13.0459091,7.95 L13.0459091,14.7736364 Z M17.74,14.7736364 L17.0645455,14.7736364 L13.8259091,14.7736364 L13.8259091,13.4409091 L16.2095455,13.4409091 L16.2095455,12.6977273 L13.8531818,12.6977273 L13.8531818,7.95 L17.74,7.95 L17.74,14.7736364 Z M3.51,9.16227273 L3.51,11.3213636 L4.30818182,11.3213636 L4.30818182,9.16227273 L3.51,9.16227273 Z M10.7827273,9.16227273 L10.7827273,11.3213636 L11.5818182,11.3213636 L11.5818182,9.16227273 L10.7827273,9.16227273 Z M15.3281818,9.16227273 L15.3281818,11.3213636 L16.1263636,11.3213636 L16.1263636,9.16227273 L15.3281818,9.16227273 Z'    
	},
	'[dribbble]': {
		filename: "dribbble@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M18.2541379,8.18724138 C18.1424138,7.63965517 17.9744828,7.10034483 17.7572414,6.58517241 C17.5437931,6.07931034 17.2789655,5.59241379 16.9713793,5.13724138 C16.6662069,4.68586207 16.3162069,4.26172414 15.9306897,3.87655172 C15.5455172,3.49068966 15.1210345,3.14034483 14.67,2.83586207 C14.2148276,2.52724138 13.7272414,2.26344828 13.222069,2.04931034 C12.7068966,1.83241379 12.167931,1.66413793 11.62,1.55310345 C11.0589655,1.43793103 10.4810345,1.37931034 9.9037931,1.37931034 C9.32586207,1.37931034 8.74862069,1.43793103 8.18689655,1.55310345 C7.63931034,1.66413793 7.1,1.83275862 6.58517241,2.04931034 C6.08,2.26344828 5.59241379,2.52758621 5.13655172,2.83586207 C4.68517241,3.14034483 4.26103448,3.49034483 3.87586207,3.87655172 C3.49034483,4.26172414 3.14068966,4.6862069 2.83586207,5.13724138 C2.52793103,5.59241379 2.26344828,6.07931034 2.05,6.58517241 C1.83172414,7.10034483 1.66448276,7.63965517 1.55241379,8.18724138 C1.43758621,8.74758621 1.37931034,9.32551724 1.37931034,9.90310345 C1.37931034,10.4817241 1.43758621,11.0596552 1.55241379,11.6203448 C1.66448276,12.167931 1.83206897,12.7072414 2.04965517,13.222069 C2.26310345,13.7272414 2.52793103,14.2155172 2.83551724,14.6706897 C3.14034483,15.122069 3.49,15.5455172 3.87551724,15.9313793 C4.26068966,16.3165517 4.68517241,16.6662069 5.1362069,16.9713793 C5.59206897,17.2793103 6.07965517,17.5437931 6.58482759,17.7572414 C7.09931034,17.9755172 7.63896552,18.1417241 8.18655172,18.2541379 C8.74827586,18.37 9.32551724,18.427931 9.90344828,18.427931 C10.4806897,18.427931 11.0586207,18.37 11.6196552,18.2541379 C12.167931,18.1417241 12.7065517,17.9751724 13.2217241,17.7572414 C13.7268966,17.5437931 14.2144828,17.2789655 14.6696552,16.9713793 C15.1210345,16.6662069 15.5451724,16.3168966 15.9303448,15.9313793 C16.3155172,15.5455172 16.6658621,15.1217241 16.9710345,14.6706897 C17.2789655,14.2155172 17.5434483,13.7272414 17.7568966,13.222069 C17.9744828,12.7075862 18.142069,12.167931 18.2537931,11.6203448 C18.3689655,11.0593103 18.4268966,10.4813793 18.4268966,9.90310345 C18.4272414,9.32551724 18.3693103,8.74758621 18.2541379,8.18724138 Z M17.1803448,9.83103448 C17.0751724,9.80827586 14.6117241,9.27793103 12.1103448,9.59241379 C12.0593103,9.46793103 12.0072414,9.34241379 11.9534483,9.21655172 C11.802069,8.86034483 11.6389655,8.50724138 11.4693103,8.16068966 C14.3444828,6.98758621 15.5117241,5.29965517 15.5251724,5.27965517 C16.5462069,6.51896552 17.1637931,8.10310345 17.1803448,9.83103448 Z M14.7113793,4.44 C14.6931034,4.46827586 13.6565517,6.0462069 10.9089655,7.0762069 C9.66448276,4.78965517 8.29724138,2.97344828 8.18793103,2.82931034 C8.73827586,2.69586207 9.31206897,2.6237931 9.90344828,2.6237931 C11.7468966,2.6237931 13.4286207,3.31068966 14.7113793,4.44 Z M8.15965517,2.83517241 C8.15965517,2.83586207 8.15827586,2.83655172 8.15827586,2.83655172 C8.15827586,2.83655172 8.15034483,2.83862069 8.13689655,2.84137931 C8.14413793,2.83931034 8.15241379,2.83793103 8.15965517,2.83517241 Z M6.79724138,3.31931034 C6.89413793,3.44931034 8.24068966,5.27448276 9.50068966,7.5137931 C6.00517241,8.44241379 2.97172414,8.4062069 2.77931034,8.40275862 C3.25241379,6.14793103 4.76724138,4.27827586 6.79724138,3.31931034 Z M2.6237931,9.90310345 C2.6237931,9.82551724 2.62724138,9.74965517 2.63,9.67310345 C2.75827586,9.67586207 6.35551724,9.75758621 10.1034483,8.63586207 C10.312069,9.04413793 10.5117241,9.45896552 10.6941379,9.87344828 C10.597931,9.90034483 10.502069,9.92931034 10.4072414,9.96034483 C6.47862069,11.23 4.48586207,14.7651724 4.48586207,14.7651724 C4.48586207,14.7651724 4.48862069,14.7672414 4.48862069,14.7686207 C3.32965517,13.4786207 2.6237931,11.7734483 2.6237931,9.90310345 Z M9.90344828,17.1834483 C8.14172414,17.1834483 6.52586207,16.5572414 5.26655172,15.5151724 C5.36206897,15.5927586 5.42965517,15.6424138 5.42965517,15.6424138 C5.42965517,15.6424138 6.82517241,12.5989655 11.142069,11.0948276 C11.1582759,11.0886207 11.1744828,11.0841379 11.1906897,11.0793103 C12.2151724,13.7410345 12.637931,15.9703448 12.7458621,16.6065517 C11.872069,16.9782759 10.9117241,17.1834483 9.90344828,17.1834483 Z M13.9713793,15.9417241 C13.8972414,15.502069 13.5093103,13.3655172 12.5544828,10.7417241 C14.9041379,10.3658621 16.9410345,11.0103448 17.0910345,11.0596552 C16.7668966,13.087931 15.6058621,14.8375862 13.9713793,15.9417241 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M18.2541379,8.18724138 C18.1424138,7.63965517 17.9744828,7.10034483 17.7572414,6.58517241 C17.5437931,6.07931034 17.2789655,5.59241379 16.9713793,5.13724138 C16.6662069,4.68586207 16.3162069,4.26172414 15.9306897,3.87655172 C15.5455172,3.49068966 15.1210345,3.14034483 14.67,2.83586207 C14.2148276,2.52724138 13.7272414,2.26344828 13.222069,2.04931034 C12.7068966,1.83241379 12.167931,1.66413793 11.62,1.55310345 C11.0589655,1.43793103 10.4810345,1.37931034 9.9037931,1.37931034 C9.32586207,1.37931034 8.74862069,1.43793103 8.18689655,1.55310345 C7.63931034,1.66413793 7.1,1.83275862 6.58517241,2.04931034 C6.08,2.26344828 5.59241379,2.52758621 5.13655172,2.83586207 C4.68517241,3.14034483 4.26103448,3.49034483 3.87586207,3.87655172 C3.49034483,4.26172414 3.14068966,4.6862069 2.83586207,5.13724138 C2.52793103,5.59241379 2.26344828,6.07931034 2.05,6.58517241 C1.83172414,7.10034483 1.66448276,7.63965517 1.55241379,8.18724138 C1.43758621,8.74758621 1.37931034,9.32551724 1.37931034,9.90310345 C1.37931034,10.4817241 1.43758621,11.0596552 1.55241379,11.6203448 C1.66448276,12.167931 1.83206897,12.7072414 2.04965517,13.222069 C2.26310345,13.7272414 2.52793103,14.2155172 2.83551724,14.6706897 C3.14034483,15.122069 3.49,15.5455172 3.87551724,15.9313793 C4.26068966,16.3165517 4.68517241,16.6662069 5.1362069,16.9713793 C5.59206897,17.2793103 6.07965517,17.5437931 6.58482759,17.7572414 C7.09931034,17.9755172 7.63896552,18.1417241 8.18655172,18.2541379 C8.74827586,18.37 9.32551724,18.427931 9.90344828,18.427931 C10.4806897,18.427931 11.0586207,18.37 11.6196552,18.2541379 C12.167931,18.1417241 12.7065517,17.9751724 13.2217241,17.7572414 C13.7268966,17.5437931 14.2144828,17.2789655 14.6696552,16.9713793 C15.1210345,16.6662069 15.5451724,16.3168966 15.9303448,15.9313793 C16.3155172,15.5455172 16.6658621,15.1217241 16.9710345,14.6706897 C17.2789655,14.2155172 17.5434483,13.7272414 17.7568966,13.222069 C17.9744828,12.7075862 18.142069,12.167931 18.2537931,11.6203448 C18.3689655,11.0593103 18.4268966,10.4813793 18.4268966,9.90310345 C18.4272414,9.32551724 18.3693103,8.74758621 18.2541379,8.18724138 Z M17.1803448,9.83103448 C17.0751724,9.80827586 14.6117241,9.27793103 12.1103448,9.59241379 C12.0593103,9.46793103 12.0072414,9.34241379 11.9534483,9.21655172 C11.802069,8.86034483 11.6389655,8.50724138 11.4693103,8.16068966 C14.3444828,6.98758621 15.5117241,5.29965517 15.5251724,5.27965517 C16.5462069,6.51896552 17.1637931,8.10310345 17.1803448,9.83103448 Z M14.7113793,4.44 C14.6931034,4.46827586 13.6565517,6.0462069 10.9089655,7.0762069 C9.66448276,4.78965517 8.29724138,2.97344828 8.18793103,2.82931034 C8.73827586,2.69586207 9.31206897,2.6237931 9.90344828,2.6237931 C11.7468966,2.6237931 13.4286207,3.31068966 14.7113793,4.44 Z M8.15965517,2.83517241 C8.15965517,2.83586207 8.15827586,2.83655172 8.15827586,2.83655172 C8.15827586,2.83655172 8.15034483,2.83862069 8.13689655,2.84137931 C8.14413793,2.83931034 8.15241379,2.83793103 8.15965517,2.83517241 Z M6.79724138,3.31931034 C6.89413793,3.44931034 8.24068966,5.27448276 9.50068966,7.5137931 C6.00517241,8.44241379 2.97172414,8.4062069 2.77931034,8.40275862 C3.25241379,6.14793103 4.76724138,4.27827586 6.79724138,3.31931034 Z M2.6237931,9.90310345 C2.6237931,9.82551724 2.62724138,9.74965517 2.63,9.67310345 C2.75827586,9.67586207 6.35551724,9.75758621 10.1034483,8.63586207 C10.312069,9.04413793 10.5117241,9.45896552 10.6941379,9.87344828 C10.597931,9.90034483 10.502069,9.92931034 10.4072414,9.96034483 C6.47862069,11.23 4.48586207,14.7651724 4.48586207,14.7651724 C4.48586207,14.7651724 4.48862069,14.7672414 4.48862069,14.7686207 C3.32965517,13.4786207 2.6237931,11.7734483 2.6237931,9.90310345 Z M9.90344828,17.1834483 C8.14172414,17.1834483 6.52586207,16.5572414 5.26655172,15.5151724 C5.36206897,15.5927586 5.42965517,15.6424138 5.42965517,15.6424138 C5.42965517,15.6424138 6.82517241,12.5989655 11.142069,11.0948276 C11.1582759,11.0886207 11.1744828,11.0841379 11.1906897,11.0793103 C12.2151724,13.7410345 12.637931,15.9703448 12.7458621,16.6065517 C11.872069,16.9782759 10.9117241,17.1834483 9.90344828,17.1834483 Z M13.9713793,15.9417241 C13.8972414,15.502069 13.5093103,13.3655172 12.5544828,10.7417241 C14.9041379,10.3658621 16.9410345,11.0103448 17.0910345,11.0596552 C16.7668966,13.087931 15.6058621,14.8375862 13.9713793,15.9417241 Z'    
	},
	'[ello]': {
		filename: "ello@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M10,1.66666667 C5.39762708,1.66666667 1.66666667,5.40699199 1.66666667,10 C1.66666667,14.6023729 5.40699199,18.3333333 10,18.3333333 C14.6023729,18.3333333 18.3333333,14.593008 18.3333333,10 C18.3333333,5.39762708 14.593008,1.66666667 10,1.66666667 Z M10,15 C7.72222222,15 5.72222222,13.4444444 5.16666667,11.25 C5.11111111,11 5.25,10.7222222 5.5,10.6666667 C5.75,10.6111111 6.02777778,10.75 6.08333333,11 C6.55555556,12.7777778 8.16666667,14.0277778 10,14.0277778 C11.8333333,14.0277778 13.4444444,12.7777778 13.9166667,11 C13.9722222,10.75 14.25,10.5833333 14.5,10.6666667 C14.75,10.7222222 14.9166667,11 14.8333333,11.25 C14.2777778,13.4444444 12.2777778,15 10,15 L10,15 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M10,1.66666667 C5.39762708,1.66666667 1.66666667,5.40699199 1.66666667,10 C1.66666667,14.6023729 5.40699199,18.3333333 10,18.3333333 C14.6023729,18.3333333 18.3333333,14.593008 18.3333333,10 C18.3333333,5.39762708 14.593008,1.66666667 10,1.66666667 Z M10,15 C7.72222222,15 5.72222222,13.4444444 5.16666667,11.25 C5.11111111,11 5.25,10.7222222 5.5,10.6666667 C5.75,10.6111111 6.02777778,10.75 6.08333333,11 C6.55555556,12.7777778 8.16666667,14.0277778 10,14.0277778 C11.8333333,14.0277778 13.4444444,12.7777778 13.9166667,11 C13.9722222,10.75 14.25,10.5833333 14.5,10.6666667 C14.75,10.7222222 14.9166667,11 14.8333333,11.25 C14.2777778,13.4444444 12.2777778,15 10,15 L10,15 Z'    
	},
	'[email]': {
		filename: "email@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M17.9766923,14.7623077 L13.3169231,9.70953846 L17.9809231,5.03761538 C18.0773846,4.941 18.2423846,5.00930769 18.2423846,5.14576923 L18.2423846,14.6585385 C18.2423846,14.7979231 18.0712308,14.8648462 17.9766923,14.7623077 Z M10.8596923,12.1710769 C10.5922308,12.439 10.2291538,12.5896154 9.85053846,12.5896154 L9.83846154,12.5896154 C9.45323077,12.5896154 9.08369231,12.4367692 8.811,12.1645385 L7.42969231,10.7856154 L2.69,15.6105385 C2.59484615,15.7073846 2.66346154,15.871 2.79923077,15.871 L17.1914615,15.871 C17.3249231,15.871 17.3944615,15.7121538 17.304,15.6140769 L12.5590769,10.4688462 L10.8596923,12.1710769 Z M9.83853846,11.5176923 L9.83884615,11.5176923 C9.94115385,11.5176923 10.0373077,11.4777692 10.1096154,11.4053846 L17.1646923,4.33823077 C17.261,4.24169231 17.1926923,4.07692308 17.0563077,4.07692308 L2.59707692,4.07692308 C2.46061538,4.07692308 2.39230769,4.242 2.48892308,4.33838462 L9.56823077,11.4058462 C9.64038462,11.4780769 9.73638462,11.5176923 9.83853846,11.5176923 Z M1.69230769,5.427 L1.69230769,14.7220769 C1.69230769,14.8591538 1.85861538,14.9271538 1.95469231,14.8293846 L6.67115385,10.0281538 L1.95369231,5.31861538 C1.85715385,5.22230769 1.69230769,5.29069231 1.69230769,5.427 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M16.9796058,14.8654487 L12.9023077,10.2337436 L16.9833077,5.95114744 C17.0677115,5.86258333 17.2120865,5.92519872 17.2120865,6.05028846 L17.2120865,14.7703269 C17.2120865,14.8980962 17.0623269,14.9594423 16.9796058,14.8654487 Z M10.7522308,12.4901538 C10.5182019,12.73575 10.2005096,12.8738141 9.86922115,12.8738141 L9.85865385,12.8738141 C9.52157692,12.8738141 9.19823077,12.7337051 8.959625,12.4841603 L7.75098077,11.2201474 L3.60375,15.6429936 C3.52049038,15.7317692 3.58052885,15.88175 3.69932692,15.88175 L16.2925288,15.88175 C16.4093077,15.88175 16.4701538,15.736141 16.391,15.6462372 L12.2391923,10.9297756 L10.7522308,12.4901538 Z M9.85872115,11.8912179 L9.85899038,11.8912179 C9.94850962,11.8912179 10.0326442,11.8546218 10.0959135,11.7882692 L16.2691058,5.31004487 C16.353375,5.22155128 16.2936058,5.07051282 16.1742692,5.07051282 L3.52244231,5.07051282 C3.40303846,5.07051282 3.34326923,5.22183333 3.42780769,5.3101859 L9.62220192,11.7886923 C9.68533654,11.8549038 9.76933654,11.8912179 9.85872115,11.8912179 Z M2.73076923,6.30808333 L2.73076923,14.8285705 C2.73076923,14.9542244 2.87628846,15.0165577 2.96035577,14.9269359 L7.08725962,10.5258077 L2.95948077,6.20873077 C2.87500962,6.12044872 2.73076923,6.18313462 2.73076923,6.30808333 Z'    
	},
	'[facebook]': {
		filename: "facebook@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M13.75,20 L13.75,12.5 L16.25,12.5 L16.875,9.375 L13.75,9.375 L13.75,8.125 C13.75,6.875 14.37625,6.25 15.625,6.25 L16.875,6.25 L16.875,3.125 L14.375,3.125 C12.078125,3.125 10.625,4.925625 10.625,7.5 L10.625,9.375 L8.125,9.375 L8.125,12.5 L10.625,12.5 L10.625,20 L13.75,20 Z",
		svgCircPath:'M9.625,19.9931017 C4.27478571,19.7959399 0,15.3973202 0,10 C0,4.47593818 4.4771525,0 10,0 C15.5240618,0 20,4.4771525 20,10 C20,14.5701102 16.9356514,18.4228412 12.75,19.6172098 L12.75,12.5 L15.25,12.5 L15.875,9.375 L12.75,9.375 L12.75,8.125 C12.75,6.875 13.37625,6.25 14.625,6.25 L15.875,6.25 L15.875,3.125 L13.375,3.125 C11.078125,3.125 9.625,4.925625 9.625,7.5 L9.625,9.375 L7.125,9.375 L7.125,12.5 L9.625,12.5 L9.625,19.9931017 Z'    
	},
	'[flickr]': {
		filename: "flickr@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M5.73130435,13.153913 C3.87,13.153913 2.36130435,11.6465217 2.36130435,9.78521739 C2.36130435,7.92304348 3.87,6.41565217 5.73130435,6.41565217 C7.5926087,6.41565217 9.10086957,7.92304348 9.10086957,9.78521739 C9.10043478,11.6465217 7.5926087,13.153913 5.73130435,13.153913 Z M14.1865217,13.153913 C12.3252174,13.153913 10.8169565,11.6465217 10.8169565,9.78521739 C10.8169565,7.92304348 12.3252174,6.41565217 14.1865217,6.41565217 C16.0469565,6.41565217 17.556087,7.92304348 17.556087,9.78521739 C17.556087,11.6465217 16.0469565,13.153913 14.1865217,13.153913 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M5.73130435,13.153913 C3.87,13.153913 2.36130435,11.6465217 2.36130435,9.78521739 C2.36130435,7.92304348 3.87,6.41565217 5.73130435,6.41565217 C7.5926087,6.41565217 9.10086957,7.92304348 9.10086957,9.78521739 C9.10043478,11.6465217 7.5926087,13.153913 5.73130435,13.153913 Z M14.1865217,13.153913 C12.3252174,13.153913 10.8169565,11.6465217 10.8169565,9.78521739 C10.8169565,7.92304348 12.3252174,6.41565217 14.1865217,6.41565217 C16.0469565,6.41565217 17.556087,7.92304348 17.556087,9.78521739 C17.556087,11.6465217 16.0469565,13.153913 14.1865217,13.153913 Z'    
	},
	'[google plus]': {
		filename: "google-plus@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M6.55120402e-12,2.66637457 L6.55120402e-12,1.99079514 C6.55120402e-12,0.898212381 0.891309342,0 1.99079514,0 L18.0092049,0 C19.1017876,0 20,0.891309342 20,1.99079514 L20,18.0092049 C20,19.1017876 19.1086907,20 18.0092049,20 L9.30552273,20 C9.71516691,19.3463042 9.926,18.6263664 9.926,17.9053333 C9.92666667,15.9913333 9.36133333,14.846 7.61666667,13.61 C7.01866667,13.1873333 5.87733333,12.1593333 5.87733333,11.5546667 C5.87733333,10.8466667 6.07933333,10.4973333 7.14533333,9.66466667 C8.23733333,8.81066667 9.01133333,7.41133333 9.01133333,6.014 C9.01133333,4.35266667 8.27,3.33333333 6.88066667,2 L8.97666667,2 L10.4553333,1.33333333 L3.84666667,1.33333333 C2.42880728,1.33333333 1.05123982,1.84644485 -1.82087678e-12,2.66637457 Z M6.55120402e-12,10.0101131 L6.55120402e-12,14.6533997 C0.927833668,14.2585192 2.00232739,14.0257895 3.16133333,14.026 C3.56066667,14.026 3.928,14.0153333 4.306,14.0153333 C3.80466667,13.526 3.40733333,12.9273333 3.40733333,12.1886667 C3.40733333,11.7506667 3.54666667,11.3293333 3.74266667,10.956 C3.54266667,10.9693333 3.33933333,10.9746667 3.13,10.9746667 C1.89672151,10.9746667 0.830018948,10.615965 6.55103749e-12,10.0101131 Z M15.3333333,6 L15.3333333,2.66666667 L14,2.66666667 L14,6 L10.6666667,6 L10.6666667,7.33333333 L14,7.33333333 L14,10.6666667 L15.3333333,10.6666667 L15.3333333,7.33333333 L18.6666667,7.33333333 L18.6666667,6 L15.3333333,6 Z M6.31905639e-12,16.0541177 C0.897166939,15.1887507 2.33005777,14.6235259 3.85933333,14.64 C4.45133333,14.6466667 5.00266667,14.7413333 5.50266667,14.9033333 C6.88,15.862 7.868,16.4033333 8.148,17.4933333 C8.19866667,17.7146667 8.22866667,17.9433333 8.22866667,18.1753333 C8.22866667,18.8508362 8.07604088,19.4746182 7.72433945,20 L1.99079514,20 C0.898212381,20 6.55120402e-12,19.1086907 6.55120402e-12,18.0092049 L6.55120402e-12,16.0541177 Z M4.086,10.2986667 C2.38266667,10.248 0.765333333,8.394 0.471333333,6.15933333 C0.178,3.92266667 1.31933333,2.21133333 3.02066667,2.262 C4.72333333,2.314 6.34133333,4.10733333 6.636,6.34333333 C6.93,8.58 5.78733333,10.3493333 4.086,10.2986667 Z",
		svgCircPath:'M4.9782536,18.6498759 C6.45390443,19.508333 8.16940136,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,8.2253474 19.5378482,6.55866543 18.7272727,5.11380317 L18.7272727,5.11380317 L18.7272727,6.18181818 L16,6.18181818 L16,8.90909091 L14.9090909,8.90909091 L14.9090909,6.18181818 L12.1818182,6.18181818 L12.1818182,5.09090909 L14.9090909,5.09090909 L14.9090909,2.36363636 L16,2.36363636 L16,5.09090909 L18.7143894,5.09090909 C16.9989263,2.05184013 13.7396361,0 10,0 C7.76542737,0 5.70204059,0.732734987 4.03712578,1.97116014 C4.79542358,1.53300269 5.68840186,1.27272727 6.60181818,1.27272727 L12.0089091,1.27272727 L10.7990909,1.81818182 L9.08418182,1.81818182 C10.2209091,2.90909091 10.8274545,3.74309091 10.8274545,5.10236364 C10.8274545,6.24563636 10.1941818,7.39054545 9.30072727,8.08927273 C8.42854545,8.77054545 8.26327273,9.05636364 8.26327273,9.63563636 C8.26327273,10.1303636 9.19709091,10.9714545 9.68636364,11.3172727 C11.1138182,12.3285455 11.5763636,13.2656364 11.5758182,14.8316364 C11.5758182,16.7843636 9.68581818,18.7272727 6.26254545,18.7272727 C5.8222024,18.7272727 5.39193125,18.7009543 4.9782536,18.6498759 L4.9782536,18.6498759 Z M1.00061862,14.3658299 C0.359554087,13.0466388 0,11.56532 0,10 C0,7.48320814 0.92935027,5.18398179 2.46352822,3.42649902 C2.10536848,3.97353264 1.89672727,4.59000394 1.89672727,5.23327273 C1.89672727,7.40745455 3.54890909,9.16109091 6.01545455,9.16109091 C6.18672727,9.16109091 6.35309091,9.15672727 6.51672727,9.14581818 C6.35636364,9.45127273 6.24236364,9.796 6.24236364,10.1543636 C6.24236364,10.7587273 6.56745455,11.2485455 6.97763636,11.6489091 C6.66836364,11.6489091 6.36781818,11.6576364 6.04109091,11.6576364 C3.64852587,11.6572019 1.69613637,12.8700186 1.00061862,14.3658299 Z M6.25163636,17.8627273 C4.17618182,17.8627273 2.67727273,16.5498182 2.67727273,14.9712727 C2.67727273,13.4254545 4.53618182,12.1376364 6.61218182,12.16 C7.09654545,12.1654545 7.54763636,12.2429091 7.95672727,12.3754545 C9.08363636,13.1598182 9.892,13.6027273 10.1210909,14.4945455 C10.1625455,14.6756364 10.1870909,14.8627273 10.1870909,15.0525455 C10.1870909,16.63 9.16981818,17.8627273 6.25163636,17.8627273 Z M6.79763636,8.608 C5.404,8.56654545 4.08072727,7.04963636 3.84018182,5.22127273 C3.60018182,3.39127273 4.534,1.99109091 5.926,2.03254545 C7.31909091,2.07509091 8.64290909,3.54236364 8.884,5.37181818 C9.12454545,7.20181818 8.18963636,8.64945455 6.79763636,8.608 Z'    
	},
	'[houzz]': {
		filename: "houzz@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M10.0161105,6.9372511 L10.0161105,6.82434949 L14.5161105,4 L14.5161105,9.71724392 L10.0161105,6.9372511 Z M10.0161105,13.2103483 L10.0161105,19 L14.5161105,16.1756505 L14.5161105,10.3445536 L10.0161105,13.2103483 Z M9.5,13.0627489 L9.5,13.1756505 L5,16 L5,10.2827561 L9.5,13.0627489 Z M9.5,6.78965167 L9.5,1 L5,3.82434949 L5,9.65544636 L9.5,6.78965167 L9.5,6.78965167 Z M5.5,9.96340065 L9.51611053,12.4619386 L9.47856618,7.46421069 L5.5,9.96340065 Z M14.0161105,10.0365994 L10,7.53806139 L10.0375444,12.5357893 L14.0161105,10.0365994 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M10.0161105,6.9372511 L10.0161105,6.82434949 L14.5161105,4 L14.5161105,9.71724392 L10.0161105,6.9372511 Z M10.0161105,13.2103483 L10.0161105,19 L14.5161105,16.1756505 L14.5161105,10.3445536 L10.0161105,13.2103483 Z M9.5,13.0627489 L9.5,13.1756505 L5,16 L5,10.2827561 L9.5,13.0627489 Z M9.5,6.78965167 L9.5,1 L5,3.82434949 L5,9.65544636 L9.5,6.78965167 L9.5,6.78965167 Z M5.5,9.96340065 L9.51611053,12.4619386 L9.47856618,7.46421069 L5.5,9.96340065 Z M14.0161105,10.0365994 L10,7.53806139 L10.0375444,12.5357893 L14.0161105,10.0365994 Z'    
	},
	'[imdb]': {
		filename: "imdb@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M3.60839844,6.71386719 L3.60839844,13.1818182 L1.92649148,13.1818182 L1.92649148,6.71386719 L3.60839844,6.71386719 Z M9.47310014,6.71386719 L9.47310014,13.1818182 L8.00292969,13.1818182 L8.00292969,8.81525213 L7.41566051,13.1818182 L6.3729581,13.1818182 L5.75372869,8.91512784 L5.75372869,13.1818182 L4.28355824,13.1818182 L4.28355824,6.71386719 L6.46084872,6.71386719 C6.5247695,7.10271856 6.5926843,7.56081057 6.66459517,8.08815696 L6.89630682,9.73410866 L7.27982955,6.71386719 L9.47310014,6.71386719 Z M10.1482599,6.71386719 L11.4066939,6.71386719 C12.2190204,6.71386719 12.7683313,6.75115375 13.0546431,6.82572798 C13.3409549,6.90030222 13.5586818,7.0228152 13.7078303,7.1932706 C13.8569787,7.36372599 13.9501951,7.55348795 13.9874822,7.76256214 C14.0247694,7.97163634 14.0434126,8.38245432 14.0434126,8.99502841 L14.0434126,11.2602095 C14.0434126,11.8408232 14.0161136,12.2290029 13.9615146,12.4247603 C13.9069156,12.6205177 13.8117017,12.7736589 13.67587,12.8841886 C13.5400384,12.9947182 13.3722489,13.0719547 13.1724964,13.1159002 C12.972744,13.1598457 12.6717882,13.1818182 12.26962,13.1818182 L10.1482599,13.1818182 L10.1482599,6.71386719 Z M16.2366832,6.71386719 L16.2366832,8.24396307 C16.3698515,8.08948786 16.5183319,7.97429903 16.6821289,7.89839311 C16.8459259,7.82248719 17.0237029,7.7845348 17.2154652,7.7845348 C17.4365245,7.7845348 17.628284,7.81915803 17.7907493,7.88840554 C17.9532146,7.95765305 18.0770592,8.05486443 18.1622869,8.18004261 C18.2475146,8.3052208 18.2987836,8.42773378 18.3160955,8.54758523 C18.3334074,8.66743668 18.3420632,8.92311594 18.3420632,9.31463068 L18.3420632,11.7036577 C18.3420632,12.092509 18.3160958,12.3821457 18.2641602,12.5725763 C18.2122245,12.763007 18.0903774,12.9281332 17.8986151,13.0679599 C17.7068527,13.2077866 17.4791384,13.2776989 17.2154652,13.2776989 C17.0263662,13.2776989 16.8499209,13.2364173 16.6861239,13.153853 C16.522327,13.0712886 16.3725149,12.947444 16.2366832,12.7823153 L16.1328125,13.1818182 L14.6226918,13.1818182 L14.6226918,6.71386719 L16.2366832,6.71386719 Z M11.8301669,7.82049006 L11.8301669,12.0751953 C12.0725332,12.0751953 12.2216794,12.0265896 12.2776101,11.9293768 C12.3335408,11.8321639 12.3615057,11.5678289 12.3615057,11.1363636 L12.3615057,8.62349077 C12.3615057,8.33052055 12.352184,8.14275609 12.3335405,8.06019176 C12.3148969,7.97762743 12.2722837,7.91703677 12.2056996,7.87841797 C12.1391154,7.83979917 12.0139391,7.82049006 11.8301669,7.82049006 Z M16.7280717,9.38654119 C16.7280717,9.11221454 16.7107601,8.93310589 16.6761364,8.84920987 C16.6415126,8.76531386 16.5735978,8.72336648 16.4723899,8.72336648 C16.3738454,8.72336648 16.3099256,8.7599872 16.2806286,8.83322976 C16.2513315,8.90647231 16.2366832,9.09090761 16.2366832,9.38654119 L16.2366832,11.6716974 C16.2366832,11.9566776 16.253329,12.1391154 16.2866211,12.2190163 C16.3199132,12.2989173 16.3858305,12.3388672 16.484375,12.3388672 C16.5855829,12.3388672 16.6515002,12.2975856 16.6821289,12.2150213 C16.7127576,12.132457 16.7280717,11.9340392 16.7280717,11.6197621 L16.7280717,9.38654119 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M3.60839844,6.71386719 L3.60839844,13.1818182 L1.92649148,13.1818182 L1.92649148,6.71386719 L3.60839844,6.71386719 Z M9.47310014,6.71386719 L9.47310014,13.1818182 L8.00292969,13.1818182 L8.00292969,8.81525213 L7.41566051,13.1818182 L6.3729581,13.1818182 L5.75372869,8.91512784 L5.75372869,13.1818182 L4.28355824,13.1818182 L4.28355824,6.71386719 L6.46084872,6.71386719 C6.5247695,7.10271856 6.5926843,7.56081057 6.66459517,8.08815696 L6.89630682,9.73410866 L7.27982955,6.71386719 L9.47310014,6.71386719 Z M10.1482599,6.71386719 L11.4066939,6.71386719 C12.2190204,6.71386719 12.7683313,6.75115375 13.0546431,6.82572798 C13.3409549,6.90030222 13.5586818,7.0228152 13.7078303,7.1932706 C13.8569787,7.36372599 13.9501951,7.55348795 13.9874822,7.76256214 C14.0247694,7.97163634 14.0434126,8.38245432 14.0434126,8.99502841 L14.0434126,11.2602095 C14.0434126,11.8408232 14.0161136,12.2290029 13.9615146,12.4247603 C13.9069156,12.6205177 13.8117017,12.7736589 13.67587,12.8841886 C13.5400384,12.9947182 13.3722489,13.0719547 13.1724964,13.1159002 C12.972744,13.1598457 12.6717882,13.1818182 12.26962,13.1818182 L10.1482599,13.1818182 L10.1482599,6.71386719 Z M16.2366832,6.71386719 L16.2366832,8.24396307 C16.3698515,8.08948786 16.5183319,7.97429903 16.6821289,7.89839311 C16.8459259,7.82248719 17.0237029,7.7845348 17.2154652,7.7845348 C17.4365245,7.7845348 17.628284,7.81915803 17.7907493,7.88840554 C17.9532146,7.95765305 18.0770592,8.05486443 18.1622869,8.18004261 C18.2475146,8.3052208 18.2987836,8.42773378 18.3160955,8.54758523 C18.3334074,8.66743668 18.3420632,8.92311594 18.3420632,9.31463068 L18.3420632,11.7036577 C18.3420632,12.092509 18.3160958,12.3821457 18.2641602,12.5725763 C18.2122245,12.763007 18.0903774,12.9281332 17.8986151,13.0679599 C17.7068527,13.2077866 17.4791384,13.2776989 17.2154652,13.2776989 C17.0263662,13.2776989 16.8499209,13.2364173 16.6861239,13.153853 C16.522327,13.0712886 16.3725149,12.947444 16.2366832,12.7823153 L16.1328125,13.1818182 L14.6226918,13.1818182 L14.6226918,6.71386719 L16.2366832,6.71386719 Z M11.8301669,7.82049006 L11.8301669,12.0751953 C12.0725332,12.0751953 12.2216794,12.0265896 12.2776101,11.9293768 C12.3335408,11.8321639 12.3615057,11.5678289 12.3615057,11.1363636 L12.3615057,8.62349077 C12.3615057,8.33052055 12.352184,8.14275609 12.3335405,8.06019176 C12.3148969,7.97762743 12.2722837,7.91703677 12.2056996,7.87841797 C12.1391154,7.83979917 12.0139391,7.82049006 11.8301669,7.82049006 Z M16.7280717,9.38654119 C16.7280717,9.11221454 16.7107601,8.93310589 16.6761364,8.84920987 C16.6415126,8.76531386 16.5735978,8.72336648 16.4723899,8.72336648 C16.3738454,8.72336648 16.3099256,8.7599872 16.2806286,8.83322976 C16.2513315,8.90647231 16.2366832,9.09090761 16.2366832,9.38654119 L16.2366832,11.6716974 C16.2366832,11.9566776 16.253329,12.1391154 16.2866211,12.2190163 C16.3199132,12.2989173 16.3858305,12.3388672 16.484375,12.3388672 C16.5855829,12.3388672 16.6515002,12.2975856 16.6821289,12.2150213 C16.7127576,12.132457 16.7280717,11.9340392 16.7280717,11.6197621 L16.7280717,9.38654119 Z'    
	},
	'[instagram]': {
		filename: "instagram@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M15.205,1.9655128 C16.5344012,1.930858 17.93,3.2858788 17.93,4.5667628 C17.93,5.0951732 17.9317888,6.1884176 17.9325,7.0455128 L13.13375,7.0455128 L13.6025,7.5855128 L17.9325,7.5855128 C17.9347112,10.0792656 17.9375,13.0178912 17.9375,15.1892628 C17.9375,16.6223988 16.564236,17.9155128 15.16625,17.9155128 C12.5855816,17.9155128 6.411848,17.9230128 4.64875,17.9230128 C3.35756808,17.9230128 1.97125,16.5241948 1.97125,15.2330128 C1.97125,13.9786816 1.97723068,10.386994 1.98125,7.5855128 L6.31,7.5855128 L6.77875,7.0455128 L1.98125,7.0455128 C1.98243548,6.1799748 1.985,4.9093004 1.985,4.5680128 C1.985,3.86818852 2.45656456,3.10210656 3.0875,2.5830128 L3.0875,6.5605128 L6.20375,6.5605128 L6.20375,1.9705128 C8.81225,1.98297252 13.6215036,2.00679228 15.205,1.9655128 Z M14.11125,3.0705128 C13.8687884,3.070374 13.58613,3.3318008 13.58625,3.5742628 C13.58657,4.2484612 13.58625,5.0084728 13.58625,5.6292628 C13.58625,5.8717056 13.8675568,6.1343428 14.11,6.1342628 C14.8496016,6.1340628 15.4283508,6.1342628 16.1225,6.1342628 C16.362278,6.1342628 16.63375,5.8690408 16.63375,5.6292628 L16.63375,3.5742628 C16.63375,3.3350696 16.3616928,3.0705128 16.1225,3.0705128 C15.404152,3.0705128 14.7773088,3.0709128 14.11125,3.0705128 Z M9.95625,5.8917628 C7.6939772,5.8917628 5.86,7.7135508 5.86,9.9605128 C5.86,12.2074744 7.6939772,14.0292628 9.95625,14.0292628 C12.2185228,14.0292628 14.0525,12.2074744 14.0525,9.9605128 C14.0525,7.7135508 12.2185228,5.8917628 9.95625,5.8917628 Z M9.95875,6.3467628 C11.938712,6.3467628 13.54375,7.9520884 13.54375,9.9330128 C13.54375,11.9139372 11.938712,13.5192628 9.95875,13.5192628 C7.978788,13.5192628 6.37375,11.9139372 6.37375,9.9330128 C6.37375,7.9520884 7.978788,6.3467628 9.95875,6.3467628 Z M9.9925,7.2205128 C8.5161512,7.2205128 7.31875,8.417914 7.31875,9.8942628 C7.31875,11.3706116 8.5161512,12.5667628 9.9925,12.5667628 C11.4688488,12.5667628 12.665,11.3706116 12.665,9.8942628 C12.665,8.417914 11.4688488,7.2205128 9.9925,7.2205128 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M14.554375,2.9698237 C15.717601,2.93950075 16.93875,4.12514395 16.93875,5.24591745 C16.93875,5.70827655 16.9403152,6.6648654 16.9409375,7.4148237 L12.7420312,7.4148237 L13.1521875,7.8873237 L16.9409375,7.8873237 C16.9428723,10.0693574 16.9453125,12.6406548 16.9453125,14.540605 C16.9453125,15.794599 15.7437065,16.9260737 14.5204687,16.9260737 C12.2623839,16.9260737 6.860367,16.9326362 5.31765625,16.9326362 C4.18787207,16.9326362 2.97484375,15.7086705 2.97484375,14.5788862 C2.97484375,13.4813464 2.98007684,10.3386198 2.98359375,7.8873237 L6.77125,7.8873237 L7.18140625,7.4148237 L2.98359375,7.4148237 C2.98463104,6.65747795 2.986875,5.54563785 2.986875,5.2470112 C2.986875,4.63466496 3.39949399,3.96434324 3.9515625,3.5101362 L3.9515625,6.9904487 L6.67828125,6.9904487 L6.67828125,2.9741987 C8.96071875,2.98510096 13.1688156,3.00594325 14.554375,2.9698237 Z M13.5973437,3.9366987 C13.3851898,3.93657725 13.1378637,4.1653257 13.1379687,4.37747995 C13.1382487,4.96740355 13.1379687,5.6324137 13.1379687,6.17560495 C13.1379687,6.3877424 13.3841122,6.61754995 13.59625,6.61747995 C14.2434014,6.61730495 14.7498069,6.61747995 15.3571875,6.61747995 C15.5669932,6.61747995 15.8045312,6.3854107 15.8045312,6.17560495 L15.8045312,4.37747995 C15.8045312,4.1681859 15.5664812,3.9366987 15.3571875,3.9366987 C14.728633,3.9366987 14.1801452,3.9370487 13.5973437,3.9366987 Z M9.96171875,6.40529245 C7.98223005,6.40529245 6.3775,7.99935695 6.3775,9.9654487 C6.3775,11.9315401 7.98223005,13.525605 9.96171875,13.525605 C11.9412075,13.525605 13.5459375,11.9315401 13.5459375,9.9654487 C13.5459375,7.99935695 11.9412075,6.40529245 9.96171875,6.40529245 Z M9.96390625,6.80341745 C11.696373,6.80341745 13.1007812,8.20807735 13.1007812,9.9413862 C13.1007812,11.6746951 11.696373,13.079355 9.96390625,13.079355 C8.2314395,13.079355 6.82703125,11.6746951 6.82703125,9.9413862 C6.82703125,8.20807735 8.2314395,6.80341745 9.96390625,6.80341745 Z M9.9934375,7.5679487 C8.7016323,7.5679487 7.65390625,8.61567475 7.65390625,9.90747995 C7.65390625,11.1992852 8.7016323,12.2459175 9.9934375,12.2459175 C11.2852427,12.2459175 12.331875,11.1992852 12.331875,9.90747995 C12.331875,8.61567475 11.2852427,7.5679487 9.9934375,7.5679487 Z'    
	},
	'[like]': {
		filename: "like@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M7.05647059,15.8828793 L8.21911765,15.88 C8.64323529,16.0064706 8.58617647,16.0467647 8.82058824,16.1908824 C8.89382353,16.2361765 9.10705882,16.4676471 9.40735294,16.4676471 L9.40735294,16.4676471 L15.9523529,16.4676471 L16.0473529,16.4614706 C16.3541176,16.4405882 17.0729412,16.3926471 17.2297059,15.5626471 C17.2961765,15.2088235 17.2173529,14.9123529 17.0905882,14.7188235 C17.3594118,14.5741176 17.6208824,14.2758824 17.6929412,13.8479412 C17.7679412,13.4035294 17.6532353,13.0755882 17.4835294,12.8488235 C17.7908824,12.6858824 18.055,12.3676471 18.1226471,11.8347059 C18.1926471,11.2855882 17.9973529,10.9961765 17.7467647,10.7732353 C18.0102941,10.5714706 18.2367647,10.2252941 18.2367647,9.66823529 C18.2364706,8.44676471 17.0417647,8.24911765 16.4094118,8.24382353 L14.2214706,8.23558824 C14.2064706,8.235 13.8567647,8.22588235 13.8291176,7.99852941 C13.7708824,7.52088235 13.9038235,7.21029412 14.1855882,6.89676471 C14.51,6.53647059 14.8614706,5.54058824 14.9741176,4.77029412 C15.0835294,4.02029412 14.7932353,2.89117647 14.2405882,2.50323529 C14.0964706,2.40205882 13.9444118,2.35058824 13.7885294,2.35088235 C13.3558824,2.35058824 13.0188235,2.74823529 12.9426471,3.13264706 C12.9232353,3.22970588 12.9070588,3.32705882 12.8911765,3.42117647 C12.8017647,3.95294118 12.7097059,4.50264706 12.0332353,5.36676471 C11.6111765,5.90617647 11.6544118,5.94117647 11.4423529,6.09470588 C11.2361765,6.245 11.0226471,6.4 10.6823529,6.82323529 C10.4335294,7.13147059 10.1979412,7.50588235 9.94823529,7.90176471 C9.63941176,8.39147059 9.32029412,8.94441176 8.95941176,9.35088235 C8.755,9.58176471 8.63970588,9.68 8.60264706,9.7 L7.04985884,9.7 C7.05421692,9.73114361 7.05647059,9.76295808 7.05647059,9.79529412 L7.05647059,15.8828793 L7.05647059,15.8828793 Z M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M7.05647059,15.8828793 L7.03147059,15.8829412 C6.88352941,15.8829412 6.76352941,15.7641176 6.76352941,15.6176471 L6.76352941,9.96529412 C6.76352941,9.81852941 6.88352941,9.7 7.03147059,9.7 L7.04985884,9.7 C7.00351789,9.36883908 6.71923567,9.11352941 6.37647059,9.11352941 L2.14941176,9.11352941 C1.77470588,9.11352941 1.46970588,9.41911765 1.46970588,9.79529412 L2.44147059,16.0835294 C2.44147059,16.4591176 2.74676471,16.765 3.12147059,16.765 L6.37647059,16.765 C6.75117647,16.765 7.05617647,16.4591176 7.05647059,16.0835294 L7.05647059,15.8828793 L7.05647059,15.8828793 Z M5.29205882,14.1194118 C5.61705882,14.1194118 5.88058824,14.3826471 5.88058824,14.7073529 C5.88058824,15.0317647 5.61705882,15.2947059 5.29205882,15.2947059 C4.96705882,15.2947059 4.70323529,15.0314706 4.70323529,14.7073529 C4.70323529,14.3823529 4.96676471,14.1194118 5.29205882,14.1194118 L5.29205882,14.1194118 Z",
		svgCircPath:'M7.34394464,14.957354 L8.36980969,14.9546667 C8.74403114,15.0727059 8.69368512,15.1103137 8.90051903,15.2448235 C8.96513841,15.287098 9.1532872,15.5031373 9.4182526,15.5031373 L9.4182526,15.5031373 L15.1932526,15.5031373 L15.2770761,15.4973725 C15.5477509,15.4778824 16.1820069,15.4331373 16.3203287,14.6584706 C16.3789792,14.3282353 16.3094291,14.0515294 16.1975779,13.870902 C16.4347751,13.7358431 16.6654844,13.4574902 16.7290657,13.0580784 C16.7952422,12.6432941 16.6940311,12.3372157 16.5442907,12.1255686 C16.8154844,11.9734902 17.0485294,11.6764706 17.108218,11.1790588 C17.1699827,10.666549 16.9976644,10.3964314 16.7765571,10.1883529 C17.009083,10.0000392 17.20891,9.67694118 17.20891,9.15701961 C17.2086505,8.01698039 16.1544983,7.8325098 15.5965398,7.82756863 L13.6660035,7.81988235 C13.6527682,7.81933333 13.3442042,7.81082353 13.3198097,7.59862745 C13.2684256,7.15282353 13.3857266,6.86294118 13.6343426,6.57031373 C13.9205882,6.23403922 14.2307093,5.30454902 14.3301038,4.58560784 C14.4266436,3.88560784 14.1705017,2.83176471 13.682872,2.46968627 C13.5557093,2.3752549 13.4215398,2.32721569 13.2839965,2.3274902 C12.9022491,2.32721569 12.6048443,2.69835294 12.5376298,3.05713725 C12.5205017,3.14772549 12.5062284,3.23858824 12.4922145,3.32643137 C12.4133218,3.8227451 12.3320934,4.33580392 11.7352076,5.14231373 C11.3628028,5.64576471 11.4009516,5.67843137 11.2138408,5.82172549 C11.0319204,5.962 10.8435121,6.10666667 10.5432526,6.50168627 C10.3237024,6.78937255 10.1158304,7.13882353 9.89550173,7.50831373 C9.62301038,7.96537255 9.34143599,8.48145098 9.02301038,8.86082353 C8.84264706,9.07631373 8.74091696,9.168 8.70821799,9.18666667 L7.33811074,9.18666667 C7.3419561,9.21573404 7.34394464,9.24542754 7.34394464,9.27560784 L7.34394464,14.957354 L7.34394464,14.957354 Z M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M7.34394464,14.957354 L7.32188581,14.9574118 C7.19134948,14.9574118 7.08546713,14.8465098 7.08546713,14.7098039 L7.08546713,9.43427451 C7.08546713,9.29729412 7.19134948,9.18666667 7.32188581,9.18666667 L7.33811074,9.18666667 C7.29722167,8.87758314 7.04638442,8.63929412 6.74394464,8.63929412 L3.01418685,8.63929412 C2.68356401,8.63929412 2.41444637,8.9245098 2.41444637,9.27560784 L3.27188581,15.1446275 C3.27188581,15.4951765 3.54126298,15.7806667 3.87188581,15.7806667 L6.74394464,15.7806667 C7.07456747,15.7806667 7.34368512,15.4951765 7.34394464,15.1446275 L7.34394464,14.957354 L7.34394464,14.957354 Z M5.78711073,13.311451 C6.07387543,13.311451 6.30640138,13.5571373 6.30640138,13.8601961 C6.30640138,14.1629804 6.07387543,14.4083922 5.78711073,14.4083922 C5.50034602,14.4083922 5.26756055,14.1627059 5.26756055,13.8601961 C5.26756055,13.5568627 5.50008651,13.311451 5.78711073,13.311451 L5.78711073,13.311451 Z'    
	},
	'[linkedin]': {
		filename: "linkedin@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M4.375,6.875 L4.375,15.625 L6.875,15.625 L6.875,6.875 L4.375,6.875 Z M12.811875,6.875 C11.0675,6.875 10.7675,7.51125 10.625,8.125 L10.625,6.875 L8.125,6.875 L8.125,15.625 L10.625,15.625 L10.625,10.625 C10.625,9.814375 11.064375,9.375 11.875,9.375 C12.66625,9.375 13.125,9.805 13.125,10.625 L13.125,15.625 L15.625,15.625 L15.625,11.25 C15.625,8.75 15.299375,6.875 12.811875,6.875 Z M5.625,6.25 C6.31535594,6.25 6.875,5.69035594 6.875,5 C6.875,4.30964406 6.31535594,3.75 5.625,3.75 C4.93464406,3.75 4.375,4.30964406 4.375,5 C4.375,5.69035594 4.93464406,6.25 5.625,6.25 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M4.375,6.875 L4.375,15.625 L6.875,15.625 L6.875,6.875 L4.375,6.875 Z M12.811875,6.875 C11.0675,6.875 10.7675,7.51125 10.625,8.125 L10.625,6.875 L8.125,6.875 L8.125,15.625 L10.625,15.625 L10.625,10.625 C10.625,9.814375 11.064375,9.375 11.875,9.375 C12.66625,9.375 13.125,9.805 13.125,10.625 L13.125,15.625 L15.625,15.625 L15.625,11.25 C15.625,8.75 15.299375,6.875 12.811875,6.875 Z M5.625,6.25 C6.31535594,6.25 6.875,5.69035594 6.875,5 C6.875,4.30964406 6.31535594,3.75 5.625,3.75 C4.93464406,3.75 4.375,4.30964406 4.375,5 C4.375,5.69035594 4.93464406,6.25 5.625,6.25 Z'    
	},
	'[mail]': {
		filename: "email@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M17.9766923,14.7623077 L13.3169231,9.70953846 L17.9809231,5.03761538 C18.0773846,4.941 18.2423846,5.00930769 18.2423846,5.14576923 L18.2423846,14.6585385 C18.2423846,14.7979231 18.0712308,14.8648462 17.9766923,14.7623077 Z M10.8596923,12.1710769 C10.5922308,12.439 10.2291538,12.5896154 9.85053846,12.5896154 L9.83846154,12.5896154 C9.45323077,12.5896154 9.08369231,12.4367692 8.811,12.1645385 L7.42969231,10.7856154 L2.69,15.6105385 C2.59484615,15.7073846 2.66346154,15.871 2.79923077,15.871 L17.1914615,15.871 C17.3249231,15.871 17.3944615,15.7121538 17.304,15.6140769 L12.5590769,10.4688462 L10.8596923,12.1710769 Z M9.83853846,11.5176923 L9.83884615,11.5176923 C9.94115385,11.5176923 10.0373077,11.4777692 10.1096154,11.4053846 L17.1646923,4.33823077 C17.261,4.24169231 17.1926923,4.07692308 17.0563077,4.07692308 L2.59707692,4.07692308 C2.46061538,4.07692308 2.39230769,4.242 2.48892308,4.33838462 L9.56823077,11.4058462 C9.64038462,11.4780769 9.73638462,11.5176923 9.83853846,11.5176923 Z M1.69230769,5.427 L1.69230769,14.7220769 C1.69230769,14.8591538 1.85861538,14.9271538 1.95469231,14.8293846 L6.67115385,10.0281538 L1.95369231,5.31861538 C1.85715385,5.22230769 1.69230769,5.29069231 1.69230769,5.427 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M16.9796058,14.8654487 L12.9023077,10.2337436 L16.9833077,5.95114744 C17.0677115,5.86258333 17.2120865,5.92519872 17.2120865,6.05028846 L17.2120865,14.7703269 C17.2120865,14.8980962 17.0623269,14.9594423 16.9796058,14.8654487 Z M10.7522308,12.4901538 C10.5182019,12.73575 10.2005096,12.8738141 9.86922115,12.8738141 L9.85865385,12.8738141 C9.52157692,12.8738141 9.19823077,12.7337051 8.959625,12.4841603 L7.75098077,11.2201474 L3.60375,15.6429936 C3.52049038,15.7317692 3.58052885,15.88175 3.69932692,15.88175 L16.2925288,15.88175 C16.4093077,15.88175 16.4701538,15.736141 16.391,15.6462372 L12.2391923,10.9297756 L10.7522308,12.4901538 Z M9.85872115,11.8912179 L9.85899038,11.8912179 C9.94850962,11.8912179 10.0326442,11.8546218 10.0959135,11.7882692 L16.2691058,5.31004487 C16.353375,5.22155128 16.2936058,5.07051282 16.1742692,5.07051282 L3.52244231,5.07051282 C3.40303846,5.07051282 3.34326923,5.22183333 3.42780769,5.3101859 L9.62220192,11.7886923 C9.68533654,11.8549038 9.76933654,11.8912179 9.85872115,11.8912179 Z M2.73076923,6.30808333 L2.73076923,14.8285705 C2.73076923,14.9542244 2.87628846,15.0165577 2.96035577,14.9269359 L7.08725962,10.5258077 L2.95948077,6.20873077 C2.87500962,6.12044872 2.73076923,6.18313462 2.73076923,6.30808333 Z'    
	},
	'[mailto]': {
		filename: "email@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M17.9766923,14.7623077 L13.3169231,9.70953846 L17.9809231,5.03761538 C18.0773846,4.941 18.2423846,5.00930769 18.2423846,5.14576923 L18.2423846,14.6585385 C18.2423846,14.7979231 18.0712308,14.8648462 17.9766923,14.7623077 Z M10.8596923,12.1710769 C10.5922308,12.439 10.2291538,12.5896154 9.85053846,12.5896154 L9.83846154,12.5896154 C9.45323077,12.5896154 9.08369231,12.4367692 8.811,12.1645385 L7.42969231,10.7856154 L2.69,15.6105385 C2.59484615,15.7073846 2.66346154,15.871 2.79923077,15.871 L17.1914615,15.871 C17.3249231,15.871 17.3944615,15.7121538 17.304,15.6140769 L12.5590769,10.4688462 L10.8596923,12.1710769 Z M9.83853846,11.5176923 L9.83884615,11.5176923 C9.94115385,11.5176923 10.0373077,11.4777692 10.1096154,11.4053846 L17.1646923,4.33823077 C17.261,4.24169231 17.1926923,4.07692308 17.0563077,4.07692308 L2.59707692,4.07692308 C2.46061538,4.07692308 2.39230769,4.242 2.48892308,4.33838462 L9.56823077,11.4058462 C9.64038462,11.4780769 9.73638462,11.5176923 9.83853846,11.5176923 Z M1.69230769,5.427 L1.69230769,14.7220769 C1.69230769,14.8591538 1.85861538,14.9271538 1.95469231,14.8293846 L6.67115385,10.0281538 L1.95369231,5.31861538 C1.85715385,5.22230769 1.69230769,5.29069231 1.69230769,5.427 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M16.9796058,14.8654487 L12.9023077,10.2337436 L16.9833077,5.95114744 C17.0677115,5.86258333 17.2120865,5.92519872 17.2120865,6.05028846 L17.2120865,14.7703269 C17.2120865,14.8980962 17.0623269,14.9594423 16.9796058,14.8654487 Z M10.7522308,12.4901538 C10.5182019,12.73575 10.2005096,12.8738141 9.86922115,12.8738141 L9.85865385,12.8738141 C9.52157692,12.8738141 9.19823077,12.7337051 8.959625,12.4841603 L7.75098077,11.2201474 L3.60375,15.6429936 C3.52049038,15.7317692 3.58052885,15.88175 3.69932692,15.88175 L16.2925288,15.88175 C16.4093077,15.88175 16.4701538,15.736141 16.391,15.6462372 L12.2391923,10.9297756 L10.7522308,12.4901538 Z M9.85872115,11.8912179 L9.85899038,11.8912179 C9.94850962,11.8912179 10.0326442,11.8546218 10.0959135,11.7882692 L16.2691058,5.31004487 C16.353375,5.22155128 16.2936058,5.07051282 16.1742692,5.07051282 L3.52244231,5.07051282 C3.40303846,5.07051282 3.34326923,5.22183333 3.42780769,5.3101859 L9.62220192,11.7886923 C9.68533654,11.8549038 9.76933654,11.8912179 9.85872115,11.8912179 Z M2.73076923,6.30808333 L2.73076923,14.8285705 C2.73076923,14.9542244 2.87628846,15.0165577 2.96035577,14.9269359 L7.08725962,10.5258077 L2.95948077,6.20873077 C2.87500962,6.12044872 2.73076923,6.18313462 2.73076923,6.30808333 Z'    
	},
	'[one]': {
		filename: "plus1@2x.png",
		width: 33,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 3,
		svgRectPath: "M2.32280861e-12,6.47367287 L2.32280861e-12,1.99079514 C2.32280861e-12,0.898212381 0.896453677,0 2.00228533,0 L30.9977147,0 C32.1002151,0 33,0.891309342 33,1.99079514 L33,18.0092049 C33,19.1017876 32.1035463,20 30.9977147,20 L11.6005553,20 C11.6013745,19.9684502 11.6017846,19.9368928 11.6017846,19.9053333 C11.6024615,17.9913333 11.0284308,16.846 9.25692308,15.61 C8.64972308,15.1873333 7.49083077,14.1593333 7.49083077,13.5546667 C7.49083077,12.8466667 7.69593846,12.4973333 8.77833846,11.6646667 C9.88713846,10.8106667 10.6730462,9.41133333 10.6730462,8.014 C10.6730462,6.35266667 9.92030769,5.33333333 8.5096,4 L10.6378462,4 L12.1392615,3.33333333 L5.42892308,3.33333333 C3.10626433,3.33333333 0.890091439,4.66886777 1.90680804e-12,6.47367287 Z M2.32280861e-12,10.1425798 L2.32280861e-12,17.5253442 C1.18521744,16.6222378 2.84918418,16.0256631 4.73304615,16.026 C5.13852308,16.026 5.51150769,16.0153333 5.89532308,16.0153333 C5.38627692,15.526 4.98283077,14.9273333 4.98283077,14.1886667 C4.98283077,13.7506667 5.12430769,13.3293333 5.32332308,12.956 C5.12024615,12.9693333 4.91378462,12.9746667 4.70123077,12.9746667 C2.44893951,12.9746667 0.743800859,11.8142898 2.36477504e-14,10.1425798 Z M19.8846154,9.95833333 L19.8846154,7.66666667 L19.0384615,7.66666667 L19.0384615,9.95833333 L16.9230769,9.95833333 L16.9230769,10.875 L19.0384615,10.875 L19.0384615,13.1666667 L19.8846154,13.1666667 L19.8846154,10.875 L22,10.875 L22,9.95833333 L19.8846154,9.95833333 Z M0.639243937,19.4666059 C1.06845049,17.8602419 3.1483745,16.6156686 5.44178462,16.64 C6.04289231,16.6466667 6.60270769,16.7413333 7.1104,16.9033333 C8.50892308,17.862 9.51212308,18.4033333 9.79643077,19.4933333 C9.83486476,19.6586853 9.86158688,19.8281301 9.8726457,20 L2.00275701,20 C1.47662519,20 0.997092039,19.7975524 0.639243937,19.4666059 Z M5.67193846,12.2986667 C3.9424,12.248 2.30018462,10.394 2.00166154,8.15933333 C1.70381538,5.92266667 2.86270769,4.21133333 4.59021538,4.262 C6.31907692,4.314 7.96196923,6.10733333 8.26116923,8.34333333 C8.55969231,10.58 7.39944615,12.3493333 5.67193846,12.2986667 Z M27.133774,14.5 L25.4619591,14.5 L25.4619591,8.29492188 C24.8511388,8.85742469 24.1312541,9.27343615 23.3022837,9.54296875 L23.3022837,8.04882813 C23.7385839,7.90820242 24.2125575,7.64160353 24.7242187,7.24902344 C25.23588,6.85644335 25.5868981,6.39844012 25.7772837,5.875 L27.133774,5.875 L27.133774,14.5 Z",
		svgCircPath:'M2.32280861e-12,6.47367287 L2.32280861e-12,1.99079514 C2.32280861e-12,0.898212381 0.896453677,0 2.00228533,0 L30.9977147,0 C32.1002151,0 33,0.891309342 33,1.99079514 L33,18.0092049 C33,19.1017876 32.1035463,20 30.9977147,20 L11.6005553,20 C11.6013745,19.9684502 11.6017846,19.9368928 11.6017846,19.9053333 C11.6024615,17.9913333 11.0284308,16.846 9.25692308,15.61 C8.64972308,15.1873333 7.49083077,14.1593333 7.49083077,13.5546667 C7.49083077,12.8466667 7.69593846,12.4973333 8.77833846,11.6646667 C9.88713846,10.8106667 10.6730462,9.41133333 10.6730462,8.014 C10.6730462,6.35266667 9.92030769,5.33333333 8.5096,4 L10.6378462,4 L12.1392615,3.33333333 L5.42892308,3.33333333 C3.10626433,3.33333333 0.890091439,4.66886777 1.90680804e-12,6.47367287 Z M2.32280861e-12,10.1425798 L2.32280861e-12,17.5253442 C1.18521744,16.6222378 2.84918418,16.0256631 4.73304615,16.026 C5.13852308,16.026 5.51150769,16.0153333 5.89532308,16.0153333 C5.38627692,15.526 4.98283077,14.9273333 4.98283077,14.1886667 C4.98283077,13.7506667 5.12430769,13.3293333 5.32332308,12.956 C5.12024615,12.9693333 4.91378462,12.9746667 4.70123077,12.9746667 C2.44893951,12.9746667 0.743800859,11.8142898 2.36477504e-14,10.1425798 Z M19.8846154,9.95833333 L19.8846154,7.66666667 L19.0384615,7.66666667 L19.0384615,9.95833333 L16.9230769,9.95833333 L16.9230769,10.875 L19.0384615,10.875 L19.0384615,13.1666667 L19.8846154,13.1666667 L19.8846154,10.875 L22,10.875 L22,9.95833333 L19.8846154,9.95833333 Z M0.639243937,19.4666059 C1.06845049,17.8602419 3.1483745,16.6156686 5.44178462,16.64 C6.04289231,16.6466667 6.60270769,16.7413333 7.1104,16.9033333 C8.50892308,17.862 9.51212308,18.4033333 9.79643077,19.4933333 C9.83486476,19.6586853 9.86158688,19.8281301 9.8726457,20 L2.00275701,20 C1.47662519,20 0.997092039,19.7975524 0.639243937,19.4666059 Z M5.67193846,12.2986667 C3.9424,12.248 2.30018462,10.394 2.00166154,8.15933333 C1.70381538,5.92266667 2.86270769,4.21133333 4.59021538,4.262 C6.31907692,4.314 7.96196923,6.10733333 8.26116923,8.34333333 C8.55969231,10.58 7.39944615,12.3493333 5.67193846,12.2986667 Z M27.133774,14.5 L25.4619591,14.5 L25.4619591,8.29492188 C24.8511388,8.85742469 24.1312541,9.27343615 23.3022837,9.54296875 L23.3022837,8.04882813 C23.7385839,7.90820242 24.2125575,7.64160353 24.7242187,7.24902344 C25.23588,6.85644335 25.5868981,6.39844012 25.7772837,5.875 L27.133774,5.875 L27.133774,14.5 Z'    
	},
	'[pinterest]': {
		filename: "pinterest@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M10.116,2.05266667 C5.583,2.05266667 1.90766667,5.727 1.90766667,10.261 C1.90766667,13.6216667 3.92866667,16.509 6.82066667,17.7786667 C6.79766667,17.205 6.81666667,16.5176667 6.96366667,15.894 C7.12133333,15.2273333 8.01966667,11.4213333 8.01966667,11.4213333 C8.01966667,11.4213333 7.75733333,10.8973333 7.75733333,10.1226667 C7.75733333,8.90666667 8.46233333,7.99833333 9.34033333,7.99833333 C10.087,7.99833333 10.4476667,8.559 10.4476667,9.23 C10.4476667,9.98066667 9.96866667,11.103 9.72266667,12.1426667 C9.51733333,13.0136667 10.1593333,13.724 11.0183333,13.724 C12.5733333,13.724 13.621,11.7266667 13.621,9.36 C13.621,7.561 12.4093333,6.21433333 10.2056667,6.21433333 C7.71566667,6.21433333 6.16466667,8.071 6.16466667,10.145 C6.16466667,10.8603333 6.37566667,11.3643333 6.706,11.755 C6.85766667,11.934 6.879,12.0063333 6.824,12.212 C6.78466667,12.363 6.69433333,12.727 6.657,12.871 C6.60233333,13.0793333 6.434,13.1536667 6.246,13.0766667 C5.09933333,12.6086667 4.565,11.3526667 4.565,9.94066667 C4.565,7.60933333 6.53133333,4.81333333 10.4313333,4.81333333 C13.5646667,4.81333333 15.6273333,7.08133333 15.6273333,9.51566667 C15.6273333,12.735 13.8376667,15.1406667 11.199,15.1406667 C10.3126667,15.1406667 9.479,14.6613333 9.19366667,14.118 C9.19366667,14.118 8.717,16.0093333 8.61633333,16.374 C8.44233333,17.0073333 8.10133333,17.6396667 7.79,18.1323333 C8.52833333,18.3503333 9.308,18.469 10.1163333,18.469 C14.649,18.469 18.324,14.7946667 18.324,10.2613333 C18.3236667,5.727 14.6483333,2.05266667 10.116,2.05266667 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M10.116,2.05266667 C5.583,2.05266667 1.90766667,5.727 1.90766667,10.261 C1.90766667,13.6216667 3.92866667,16.509 6.82066667,17.7786667 C6.79766667,17.205 6.81666667,16.5176667 6.96366667,15.894 C7.12133333,15.2273333 8.01966667,11.4213333 8.01966667,11.4213333 C8.01966667,11.4213333 7.75733333,10.8973333 7.75733333,10.1226667 C7.75733333,8.90666667 8.46233333,7.99833333 9.34033333,7.99833333 C10.087,7.99833333 10.4476667,8.559 10.4476667,9.23 C10.4476667,9.98066667 9.96866667,11.103 9.72266667,12.1426667 C9.51733333,13.0136667 10.1593333,13.724 11.0183333,13.724 C12.5733333,13.724 13.621,11.7266667 13.621,9.36 C13.621,7.561 12.4093333,6.21433333 10.2056667,6.21433333 C7.71566667,6.21433333 6.16466667,8.071 6.16466667,10.145 C6.16466667,10.8603333 6.37566667,11.3643333 6.706,11.755 C6.85766667,11.934 6.879,12.0063333 6.824,12.212 C6.78466667,12.363 6.69433333,12.727 6.657,12.871 C6.60233333,13.0793333 6.434,13.1536667 6.246,13.0766667 C5.09933333,12.6086667 4.565,11.3526667 4.565,9.94066667 C4.565,7.60933333 6.53133333,4.81333333 10.4313333,4.81333333 C13.5646667,4.81333333 15.6273333,7.08133333 15.6273333,9.51566667 C15.6273333,12.735 13.8376667,15.1406667 11.199,15.1406667 C10.3126667,15.1406667 9.479,14.6613333 9.19366667,14.118 C9.19366667,14.118 8.717,16.0093333 8.61633333,16.374 C8.44233333,17.0073333 8.10133333,17.6396667 7.79,18.1323333 C8.52833333,18.3503333 9.308,18.469 10.1163333,18.469 C14.649,18.469 18.324,14.7946667 18.324,10.2613333 C18.3236667,5.727 14.6483333,2.05266667 10.116,2.05266667 Z'    
	},
	'[plus one]': {
		filename: "plus1@2x.png",
		width: 33,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 3,
		svgRectPath: "M2.32280861e-12,6.47367287 L2.32280861e-12,1.99079514 C2.32280861e-12,0.898212381 0.896453677,0 2.00228533,0 L30.9977147,0 C32.1002151,0 33,0.891309342 33,1.99079514 L33,18.0092049 C33,19.1017876 32.1035463,20 30.9977147,20 L11.6005553,20 C11.6013745,19.9684502 11.6017846,19.9368928 11.6017846,19.9053333 C11.6024615,17.9913333 11.0284308,16.846 9.25692308,15.61 C8.64972308,15.1873333 7.49083077,14.1593333 7.49083077,13.5546667 C7.49083077,12.8466667 7.69593846,12.4973333 8.77833846,11.6646667 C9.88713846,10.8106667 10.6730462,9.41133333 10.6730462,8.014 C10.6730462,6.35266667 9.92030769,5.33333333 8.5096,4 L10.6378462,4 L12.1392615,3.33333333 L5.42892308,3.33333333 C3.10626433,3.33333333 0.890091439,4.66886777 1.90680804e-12,6.47367287 Z M2.32280861e-12,10.1425798 L2.32280861e-12,17.5253442 C1.18521744,16.6222378 2.84918418,16.0256631 4.73304615,16.026 C5.13852308,16.026 5.51150769,16.0153333 5.89532308,16.0153333 C5.38627692,15.526 4.98283077,14.9273333 4.98283077,14.1886667 C4.98283077,13.7506667 5.12430769,13.3293333 5.32332308,12.956 C5.12024615,12.9693333 4.91378462,12.9746667 4.70123077,12.9746667 C2.44893951,12.9746667 0.743800859,11.8142898 2.36477504e-14,10.1425798 Z M19.8846154,9.95833333 L19.8846154,7.66666667 L19.0384615,7.66666667 L19.0384615,9.95833333 L16.9230769,9.95833333 L16.9230769,10.875 L19.0384615,10.875 L19.0384615,13.1666667 L19.8846154,13.1666667 L19.8846154,10.875 L22,10.875 L22,9.95833333 L19.8846154,9.95833333 Z M0.639243937,19.4666059 C1.06845049,17.8602419 3.1483745,16.6156686 5.44178462,16.64 C6.04289231,16.6466667 6.60270769,16.7413333 7.1104,16.9033333 C8.50892308,17.862 9.51212308,18.4033333 9.79643077,19.4933333 C9.83486476,19.6586853 9.86158688,19.8281301 9.8726457,20 L2.00275701,20 C1.47662519,20 0.997092039,19.7975524 0.639243937,19.4666059 Z M5.67193846,12.2986667 C3.9424,12.248 2.30018462,10.394 2.00166154,8.15933333 C1.70381538,5.92266667 2.86270769,4.21133333 4.59021538,4.262 C6.31907692,4.314 7.96196923,6.10733333 8.26116923,8.34333333 C8.55969231,10.58 7.39944615,12.3493333 5.67193846,12.2986667 Z M27.133774,14.5 L25.4619591,14.5 L25.4619591,8.29492188 C24.8511388,8.85742469 24.1312541,9.27343615 23.3022837,9.54296875 L23.3022837,8.04882813 C23.7385839,7.90820242 24.2125575,7.64160353 24.7242187,7.24902344 C25.23588,6.85644335 25.5868981,6.39844012 25.7772837,5.875 L27.133774,5.875 L27.133774,14.5 Z",
		svgCircPath:'M2.32280861e-12,6.47367287 L2.32280861e-12,1.99079514 C2.32280861e-12,0.898212381 0.896453677,0 2.00228533,0 L30.9977147,0 C32.1002151,0 33,0.891309342 33,1.99079514 L33,18.0092049 C33,19.1017876 32.1035463,20 30.9977147,20 L11.6005553,20 C11.6013745,19.9684502 11.6017846,19.9368928 11.6017846,19.9053333 C11.6024615,17.9913333 11.0284308,16.846 9.25692308,15.61 C8.64972308,15.1873333 7.49083077,14.1593333 7.49083077,13.5546667 C7.49083077,12.8466667 7.69593846,12.4973333 8.77833846,11.6646667 C9.88713846,10.8106667 10.6730462,9.41133333 10.6730462,8.014 C10.6730462,6.35266667 9.92030769,5.33333333 8.5096,4 L10.6378462,4 L12.1392615,3.33333333 L5.42892308,3.33333333 C3.10626433,3.33333333 0.890091439,4.66886777 1.90680804e-12,6.47367287 Z M2.32280861e-12,10.1425798 L2.32280861e-12,17.5253442 C1.18521744,16.6222378 2.84918418,16.0256631 4.73304615,16.026 C5.13852308,16.026 5.51150769,16.0153333 5.89532308,16.0153333 C5.38627692,15.526 4.98283077,14.9273333 4.98283077,14.1886667 C4.98283077,13.7506667 5.12430769,13.3293333 5.32332308,12.956 C5.12024615,12.9693333 4.91378462,12.9746667 4.70123077,12.9746667 C2.44893951,12.9746667 0.743800859,11.8142898 2.36477504e-14,10.1425798 Z M19.8846154,9.95833333 L19.8846154,7.66666667 L19.0384615,7.66666667 L19.0384615,9.95833333 L16.9230769,9.95833333 L16.9230769,10.875 L19.0384615,10.875 L19.0384615,13.1666667 L19.8846154,13.1666667 L19.8846154,10.875 L22,10.875 L22,9.95833333 L19.8846154,9.95833333 Z M0.639243937,19.4666059 C1.06845049,17.8602419 3.1483745,16.6156686 5.44178462,16.64 C6.04289231,16.6466667 6.60270769,16.7413333 7.1104,16.9033333 C8.50892308,17.862 9.51212308,18.4033333 9.79643077,19.4933333 C9.83486476,19.6586853 9.86158688,19.8281301 9.8726457,20 L2.00275701,20 C1.47662519,20 0.997092039,19.7975524 0.639243937,19.4666059 Z M5.67193846,12.2986667 C3.9424,12.248 2.30018462,10.394 2.00166154,8.15933333 C1.70381538,5.92266667 2.86270769,4.21133333 4.59021538,4.262 C6.31907692,4.314 7.96196923,6.10733333 8.26116923,8.34333333 C8.55969231,10.58 7.39944615,12.3493333 5.67193846,12.2986667 Z M27.133774,14.5 L25.4619591,14.5 L25.4619591,8.29492188 C24.8511388,8.85742469 24.1312541,9.27343615 23.3022837,9.54296875 L23.3022837,8.04882813 C23.7385839,7.90820242 24.2125575,7.64160353 24.7242187,7.24902344 C25.23588,6.85644335 25.5868981,6.39844012 25.7772837,5.875 L27.133774,5.875 L27.133774,14.5 Z'    
	},
	'[reddit]': {
		filename: "reddit@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M18.7015504,9.80620155 C18.7015504,8.73255814 17.8410853,7.86046512 16.7829457,7.86046512 C16.2790698,7.86046512 15.8255814,8.05426357 15.4806202,8.37596899 C14.1937984,7.46899225 12.4418605,6.88372093 10.4922481,6.79844961 L11.3953488,3.78682171 L14.0930233,4.3255814 C14.1007752,5.28294574 14.872093,6.05813953 15.8178295,6.05813953 C16.7713178,6.05813953 17.5426357,5.2751938 17.5426357,4.31007752 C17.5426357,3.34496124 16.7713178,2.55813953 15.8178295,2.55813953 C15.0968992,2.55813953 14.4806202,3.00775194 14.2209302,3.64341085 L10.9186047,2.98449612 L9.77906977,6.79069767 L9.50387597,6.79844961 C7.55426357,6.88372093 5.80232558,7.47286822 4.51550388,8.37596899 C4.1744186,8.05426357 3.71705426,7.86046512 3.21317829,7.86046512 C2.15503876,7.86046512 1.29457364,8.73255814 1.29457364,9.80620155 C1.29457364,10.5658915 1.72093023,11.2209302 2.34496124,11.5426357 C2.31395349,11.7325581 2.29844961,11.9224806 2.29844961,12.1162791 C2.30620155,15.0542636 5.75193798,17.4418605 10,17.4418605 C14.248062,17.4418605 17.6937984,15.0542636 17.6937984,12.1124031 C17.6937984,11.9186047 17.6782946,11.7286822 17.6511628,11.5387597 C18.2751938,11.2170543 18.7015504,10.5620155 18.7015504,9.80620155 Z M1.98449612,9.80620155 C1.98449612,9.11627907 2.53875969,8.55813953 3.21705426,8.55813953 C3.49612403,8.55813953 3.75581395,8.65503876 3.96124031,8.81395349 C3.29069767,9.40310078 2.79457364,10.0930233 2.52713178,10.8449612 C2.20155039,10.6162791 1.98449612,10.2364341 1.98449612,9.80620155 Z M15.0542636,15.3062016 C13.7131783,16.2325581 11.9186047,16.744186 10,16.744186 C8.08139535,16.744186 6.28682171,16.2325581 4.94573643,15.3062016 C3.68604651,14.4341085 2.99224806,13.2984496 2.99224806,12.1124031 C2.99224806,11.9883721 3,11.8604651 3.01550388,11.7364341 C3.04263566,11.503876 3.10077519,11.2751938 3.18217054,11.0503876 C3.39922481,10.4457364 3.80232558,9.87596899 4.37209302,9.36821705 C4.54263566,9.21705426 4.72868217,9.06976744 4.93023256,8.93023256 C4.93410853,8.92635659 4.94186047,8.92248062 4.94573643,8.91860465 C6.28682171,7.99224806 8.08139535,7.48062016 10,7.48062016 C11.9186047,7.48062016 13.7131783,7.99224806 15.0542636,8.91860465 C15.0581395,8.92248062 15.0658915,8.92635659 15.0697674,8.93023256 C15.2713178,9.06976744 15.4573643,9.21705426 15.627907,9.36821705 C16.1976744,9.87596899 16.6007752,10.4457364 16.8178295,11.0503876 C16.8992248,11.2751938 16.9534884,11.503876 16.9844961,11.7364341 C17,11.8604651 17.0077519,11.9844961 17.0077519,12.1124031 C17.0077519,13.2984496 16.3139535,14.4341085 15.0542636,15.3062016 Z M15.8178295,3.25193798 C16.3914729,3.25193798 16.8565891,3.7248062 16.8565891,4.30620155 C16.8565891,4.8875969 16.3914729,5.36046512 15.8178295,5.36046512 C15.244186,5.36046512 14.7790698,4.8875969 14.7790698,4.30620155 C14.7790698,3.7248062 15.244186,3.25193798 15.8178295,3.25193798 Z M17.4728682,10.8410853 C17.2054264,10.0891473 16.7093023,9.39922481 16.0387597,8.81007752 C16.244186,8.65116279 16.503876,8.55426357 16.7829457,8.55426357 C17.4612403,8.55426357 18.0155039,9.11627907 18.0155039,9.80232558 C18.0155039,10.2364341 17.7984496,10.6162791 17.4728682,10.8410853 Z M12.5891473,12.503876 C13.2698704,12.503876 13.8217054,11.9520409 13.8217054,11.2713178 C13.8217054,10.5905948 13.2698704,10.0387597 12.5891473,10.0387597 C11.9084242,10.0387597 11.3565891,10.5905948 11.3565891,11.2713178 C11.3565891,11.9520409 11.9084242,12.503876 12.5891473,12.503876 Z M7.47286822,12.503876 C8.15359128,12.503876 8.70542636,11.9520409 8.70542636,11.2713178 C8.70542636,10.5905948 8.15359128,10.0387597 7.47286822,10.0387597 C6.79214515,10.0387597 6.24031008,10.5905948 6.24031008,11.2713178 C6.24031008,11.9520409 6.79214515,12.503876 7.47286822,12.503876 Z M12.5,13.9496124 C12.4922481,13.9573643 11.5620155,14.8875969 10,14.8953488 C8.41472868,14.8875969 7.50387597,13.9573643 7.49612403,13.9496124 L7.00775194,14.4302326 C7.05426357,14.4767442 8.15503876,15.5736434 10,15.5813953 C11.8449612,15.5736434 12.9418605,14.4767442 12.9883721,14.4302326 L12.5,13.9496124 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M17.7347115,10.3200443 C17.7347115,9.3230897 16.9698536,8.51328904 16.0292851,8.51328904 C15.5813953,8.51328904 15.1782946,8.69324474 14.8716624,8.99197121 C13.7278208,8.14977852 12.1705426,7.60631229 10.4375538,7.52713178 L11.2403101,4.73062016 L13.6382429,5.23089701 C13.6451335,6.11987818 14.3307494,6.839701 15.171404,6.839701 C16.0189492,6.839701 16.704565,6.11267996 16.704565,5.21650055 C16.704565,4.32032115 16.0189492,3.589701 15.171404,3.589701 C14.5305771,3.589701 13.9827735,4.00719823 13.751938,4.59745293 L10.8165375,3.98560354 L9.80361757,7.51993355 L9.55900086,7.52713178 C7.82601206,7.60631229 6.26873385,8.15337763 5.12489233,8.99197121 C4.82170543,8.69324474 4.41515935,8.51328904 3.9672696,8.51328904 C3.02670112,8.51328904 2.26184324,9.3230897 2.26184324,10.3200443 C2.26184324,11.0254707 2.64082687,11.6337209 3.1955211,11.9324474 C3.16795866,12.108804 3.15417743,12.2851606 3.15417743,12.4651163 C3.16106804,15.1932447 6.22394488,17.410299 10,17.410299 C13.7760551,17.410299 16.838932,15.1932447 16.838932,12.4615172 C16.838932,12.2815615 16.8251507,12.1052049 16.8010336,11.9288483 C17.3557278,11.6301218 17.7347115,11.0218715 17.7347115,10.3200443 Z M2.87510767,10.3200443 C2.87510767,9.67940199 3.36778639,9.16112957 3.9707149,9.16112957 C4.21877692,9.16112957 4.4496124,9.25110742 4.63221361,9.3986711 C4.03617571,9.94573643 3.59517657,10.5863787 3.35745047,11.2846069 C3.06804479,11.0722591 2.87510767,10.719546 2.87510767,10.3200443 Z M14.4926787,15.4271872 C13.3006029,16.2873754 11.7054264,16.7624585 10,16.7624585 C8.29457364,16.7624585 6.69939707,16.2873754 5.50732127,15.4271872 C4.3875969,14.6173865 3.77088717,13.5628461 3.77088717,12.4615172 C3.77088717,12.3463455 3.77777778,12.2275748 3.791559,12.1124031 C3.81567614,11.8964563 3.86735573,11.6841085 3.93970715,11.4753599 C4.13264427,10.9138981 4.49095607,10.3848283 4.99741602,9.91334441 C5.14900947,9.77297896 5.31438415,9.63621262 5.49354005,9.50664452 C5.49698536,9.5030454 5.50387597,9.49944629 5.50732127,9.49584718 C6.69939707,8.63565891 8.29457364,8.16057586 10,8.16057586 C11.7054264,8.16057586 13.3006029,8.63565891 14.4926787,9.49584718 C14.496124,9.49944629 14.5030146,9.5030454 14.5064599,9.50664452 C14.6856158,9.63621262 14.8509905,9.77297896 15.002584,9.91334441 C15.5090439,10.3848283 15.8673557,10.9138981 16.0602929,11.4753599 C16.1326443,11.6841085 16.1808786,11.8964563 16.208441,12.1124031 C16.2222222,12.2275748 16.2291128,12.3427464 16.2291128,12.4615172 C16.2291128,13.5628461 15.6124031,14.6173865 14.4926787,15.4271872 Z M12.3014643,12.8250277 C12.9065514,12.8250277 13.3970715,12.3126094 13.3970715,11.6805094 C13.3970715,11.0484094 12.9065514,10.5359911 12.3014643,10.5359911 C11.6963771,10.5359911 11.205857,11.0484094 11.205857,11.6805094 C11.205857,12.3126094 11.6963771,12.8250277 12.3014643,12.8250277 Z M7.75366064,12.8250277 C8.35874781,12.8250277 8.84926787,12.3126094 8.84926787,11.6805094 C8.84926787,11.0484094 8.35874781,10.5359911 7.75366064,10.5359911 C7.14857347,10.5359911 6.6580534,11.0484094 6.6580534,11.6805094 C6.6580534,12.3126094 7.14857347,12.8250277 7.75366064,12.8250277 Z M12.2222222,14.1674972 C12.2153316,14.1746955 11.3884582,15.0384828 10,15.0456811 C8.59086994,15.0384828 7.78122308,14.1746955 7.77433247,14.1674972 L7.34022394,14.6137874 C7.38156761,14.6569767 8.36003445,15.675526 10,15.6827243 C11.6399655,15.675526 12.6149871,14.6569767 12.6563307,14.6137874 L12.2222222,14.1674972 Z M15.171404,4.23394241 C15.6813092,4.23394241 16.0947459,4.67303433 16.0947459,5.21290144 C16.0947459,5.75276855 15.6813092,6.19186047 15.171404,6.19186047 C14.6614987,6.19186047 14.248062,5.75276855 14.248062,5.21290144 C14.248062,4.67303433 14.6614987,4.23394241 15.171404,4.23394241 Z M16.6425495,11.2810078 C16.4048234,10.5827796 15.9638243,9.94213732 15.3677864,9.39507198 C15.5503876,9.24750831 15.7812231,9.15753045 16.0292851,9.15753045 C16.6322136,9.15753045 17.1248923,9.67940199 17.1248923,10.3164452 C17.1248923,10.719546 16.9319552,11.0722591 16.6425495,11.2810078 Z'    
	},
	'[rss]': {
		filename: "rss@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M2.25090909,10.3287879 C4.12666667,10.3287879 5.89,11.0615152 7.21515152,12.3942424 C8.54272727,13.7269697 9.27363636,15.5021212 9.27363636,17.3918182 L12.1642424,17.3918182 C12.1642424,11.9030303 7.7169697,7.43787879 2.25090909,7.43787879 L2.25090909,10.3287879 L2.25090909,10.3287879 Z M2.25545455,5.20424242 C8.94060606,5.20424242 14.379697,10.6730303 14.379697,17.3954545 L17.270303,17.3954545 C17.270303,9.07878788 10.5342424,2.31363636 2.25545455,2.31363636 L2.25545455,5.20424242 L2.25545455,5.20424242 Z M6.25272727,15.3760606 C6.25272727,16.4815152 5.35606061,17.3781818 4.25060606,17.3781818 C3.14515152,17.3781818 2.24848485,16.4818182 2.24848485,15.3760606 C2.24848485,14.27 3.14484848,13.3739394 4.25030303,13.3739394 C5.35575758,13.3739394 6.25272727,14.27 6.25272727,15.3760606 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M5.20072727,9.6630303 C6.70133333,9.6630303 8.112,10.2492121 9.17212121,11.3153939 C10.2341818,12.3815758 10.8189091,13.801697 10.8189091,15.3134545 L13.1313939,15.3134545 C13.1313939,10.9224242 9.57357576,7.35030303 5.20072727,7.35030303 L5.20072727,9.6630303 L5.20072727,9.6630303 Z M5.20436364,5.56339394 C10.5524848,5.56339394 14.9037576,9.93842424 14.9037576,15.3163636 L17.2162424,15.3163636 C17.2162424,8.6630303 11.8273939,3.25090909 5.20436364,3.25090909 L5.20436364,5.56339394 L5.20436364,5.56339394 Z M8.40218182,13.7008485 C8.40218182,14.5852121 7.68484848,15.3025455 6.80048485,15.3025455 C5.91612121,15.3025455 5.19878788,14.5854545 5.19878788,13.7008485 C5.19878788,12.816 5.91587879,12.0991515 6.80024242,12.0991515 C7.68460606,12.0991515 8.40218182,12.816 8.40218182,13.7008485 Z'    
	},
	'[tumblr]': {
		filename: "tumblr@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M8.525,2.1117628 L10.775,2.1117628 L10.775,5.7717628 L14.435,5.7717628 L14.435,8.5980128 L10.775,8.5980128 L10.775,12.6555128 C10.775,13.573652 10.7644516,14.1040964 10.86125,14.3642628 C10.9580484,14.6231424 11.2000464,14.8917564 11.46375,15.0467628 C11.8149264,15.2570828 12.2141308,15.3617628 12.665,15.3617628 C13.4664024,15.3617628 14.2635308,15.1011668 15.05625,14.5805128 L15.05625,17.0767628 C14.3809108,17.3951364 13.7683104,17.6194132 13.22,17.7467628 C12.671046,17.8741124 12.0786408,17.9392628 11.44125,17.9392628 C10.7176728,17.9392628 10.290386,17.8472112 9.735,17.6655128 C9.1786492,17.4815636 8.7045184,17.220324 8.3125,16.8842628 C7.9185528,16.5456284 7.64679,16.1859536 7.495,15.8055128 C7.3428876,15.4241072 7.2675,14.87159 7.2675,14.1480128 L7.2675,8.5980128 L5.1175,8.5980128 L5.1175,6.3555128 C5.7391332,6.153876 6.4587424,5.8649164 6.90125,5.4880128 C7.3456872,5.1098232 7.7024376,4.6570284 7.97,4.1280128 C8.2394924,3.6002836 8.4236992,2.9276364 8.525,2.1117628 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M8.525,2.1117628 L10.775,2.1117628 L10.775,5.7717628 L14.435,5.7717628 L14.435,8.5980128 L10.775,8.5980128 L10.775,12.6555128 C10.775,13.573652 10.7644516,14.1040964 10.86125,14.3642628 C10.9580484,14.6231424 11.2000464,14.8917564 11.46375,15.0467628 C11.8149264,15.2570828 12.2141308,15.3617628 12.665,15.3617628 C13.4664024,15.3617628 14.2635308,15.1011668 15.05625,14.5805128 L15.05625,17.0767628 C14.3809108,17.3951364 13.7683104,17.6194132 13.22,17.7467628 C12.671046,17.8741124 12.0786408,17.9392628 11.44125,17.9392628 C10.7176728,17.9392628 10.290386,17.8472112 9.735,17.6655128 C9.1786492,17.4815636 8.7045184,17.220324 8.3125,16.8842628 C7.9185528,16.5456284 7.64679,16.1859536 7.495,15.8055128 C7.3428876,15.4241072 7.2675,14.87159 7.2675,14.1480128 L7.2675,8.5980128 L5.1175,8.5980128 L5.1175,6.3555128 C5.7391332,6.153876 6.4587424,5.8649164 6.90125,5.4880128 C7.3456872,5.1098232 7.7024376,4.6570284 7.97,4.1280128 C8.2394924,3.6002836 8.4236992,2.9276364 8.525,2.1117628 Z'    
	},
	'[twitter]': {
		filename: "twitter@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M14.76875,6.580625 C15.3,6.269375 15.70625,5.775 15.8975,5.18625 C15.4025,5.474375 14.85375,5.684375 14.269375,5.7975 C13.801875,5.306875 13.135625,5 12.39875,5 C10.9825,5 9.83625,6.129375 9.83625,7.52375 C9.83625,7.72 9.85875,7.914375 9.90125,8.1 C7.771875,7.9925 5.883125,6.988125 4.61875,5.461875 C4.39875,5.835 4.27125,6.268125 4.27125,6.731875 C4.27125,7.60625 4.725,8.37875 5.41125,8.831875 C4.991875,8.818125 4.59625,8.705 4.25125,8.515625 C4.250625,8.52625 4.250625,8.536875 4.250625,8.548125 C4.250625,9.77 5.134375,10.79125 6.306875,11.023125 C6.0925,11.079375 5.86625,11.111875 5.63125,11.111875 C5.46625,11.111875 5.30625,11.096875 5.15,11.066875 C5.475,12.069375 6.42125,12.79875 7.5425,12.82 C6.66875,13.49625 5.5625,13.9 4.361875,13.9 C4.155625,13.9 3.950625,13.88875 3.75,13.865 C4.88375,14.580625 6.231875,14.998125 7.679375,14.998125 C12.3925,14.998125 14.970625,11.151875 14.970625,7.81625 C14.970625,7.708125 14.9675,7.5975 14.963125,7.490625 C15.463125,7.13375 15.89875,6.689375 16.241875,6.18375 C15.781875,6.385 15.28875,6.519375 14.76875,6.580625 Z",
		svgCircPath:'M10,0 C4.4771525,0 8.8817842e-16,4.47593818 8.8817842e-16,10 C8.8817842e-16,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M15.76875,6.580625 C16.3,6.269375 16.70625,5.775 16.8975,5.18625 C16.4025,5.474375 15.85375,5.684375 15.269375,5.7975 C14.801875,5.306875 14.135625,5 13.39875,5 C11.9825,5 10.83625,6.129375 10.83625,7.52375 C10.83625,7.72 10.85875,7.914375 10.90125,8.1 C8.771875,7.9925 6.883125,6.988125 5.61875,5.461875 C5.39875,5.835 5.27125,6.268125 5.27125,6.731875 C5.27125,7.60625 5.725,8.37875 6.41125,8.831875 C5.991875,8.818125 5.59625,8.705 5.25125,8.515625 C5.250625,8.52625 5.250625,8.536875 5.250625,8.548125 C5.250625,9.77 6.134375,10.79125 7.306875,11.023125 C7.0925,11.079375 6.86625,11.111875 6.63125,11.111875 C6.46625,11.111875 6.30625,11.096875 6.15,11.066875 C6.475,12.069375 7.42125,12.79875 8.5425,12.82 C7.66875,13.49625 6.5625,13.9 5.361875,13.9 C5.155625,13.9 4.950625,13.88875 4.75,13.865 C5.88375,14.580625 7.231875,14.998125 8.679375,14.998125 C13.3925,14.998125 15.970625,11.151875 15.970625,7.81625 C15.970625,7.708125 15.9675,7.5975 15.963125,7.490625 C16.463125,7.13375 16.89875,6.689375 17.241875,6.18375 C16.781875,6.385 16.28875,6.519375 15.76875,6.580625 Z'    
	},
	'[vimeo]': {
		filename: "vimeo@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M15.44875,3.06375 C17.0146248,3.03195936 18.3067688,4.0521372 17.88875,6.4075 C16.9966544,11.4329184 12.0102292,15.6888172 10.51125,16.66125 C9.0113028,17.634332 7.6433952,16.2723624 7.1475,15.2425 C6.5793332,14.0680956 4.8783864,7.7046908 4.4325,7.1775 C3.9866132,6.6506304 2.64875,7.705 2.64875,7.705 L2,6.85375 C2,6.85375 4.7156772,3.6105564 6.7825,3.205 C8.9738612,2.774922 8.9699856,6.5694196 9.4975,8.67625 C10.0072684,10.7140348 10.3500808,11.88 10.795,11.88 C11.2405632,11.88 12.0916468,10.743176 13.02375,9.00125 C13.9571436,7.2577112 12.9835536,5.717142 11.16,6.8125 C11.547368,4.4867496 13.674092,3.0997794 15.44875,3.06375 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M14.7676563,4.05919643 C16.1377967,4.02967655 17.2684227,4.97698454 16.9026563,7.16410714 C16.1220726,11.8305671 11.7589506,15.7824731 10.4473438,16.6854464 C9.13488995,17.5890226 7.9379708,16.3243365 7.5040625,15.3680357 C7.00691655,14.2775173 5.5185881,8.36864146 5.1284375,7.87910714 C4.73828655,7.38987109 3.56765625,8.36892857 3.56765625,8.36892857 L3,7.57848214 C3,7.57848214 5.37621755,4.56694523 7.1846875,4.19035714 C9.10212855,3.790999 9.0987374,7.31446106 9.5603125,9.27080357 C10.0063599,11.1630323 10.3063207,12.2457143 10.695625,12.2457143 C11.0854928,12.2457143 11.830191,11.190092 12.6457813,9.57258929 C13.4625007,7.95358897 12.6106094,6.52306043 11.015,7.54017857 C11.353947,5.3805532 13.2148305,4.0926523 14.7676563,4.05919643 Z'    
	},
	'[wordpress]': {
		filename: "wordpress@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M10,2 C5.589,2 2,5.589 2,10 C2,14.411 5.589,18.0005 10,18.0005 C14.411,18.0005 18,14.411 18,10 C18,5.589 14.411,2 10,2 Z M2.8075,10 C2.8075,8.957 3.031,7.9675 3.4305,7.073 L6.861,16.473 C4.462,15.3075 2.8075,12.847 2.8075,10 Z M10,17.193 C9.294,17.193 8.6125,17.09 7.9685,16.9005 L10.1265,10.6295 L12.3375,16.6865 C12.352,16.7215 12.3695,16.7545 12.389,16.785 C11.641,17.049 10.838,17.193 10,17.193 Z M10.991,6.6275 C11.424,6.605 11.814,6.5595 11.814,6.5595 C12.2015,6.5135 12.156,5.944 11.768,5.9665 C11.768,5.9665 10.6035,6.058 9.851,6.058 C9.144,6.058 7.9565,5.9665 7.9565,5.9665 C7.569,5.9435 7.5235,6.536 7.911,6.5595 C7.911,6.5595 8.278,6.605 8.6655,6.6275 L9.786,9.6985 L8.212,14.419 L5.5935,6.6275 C6.027,6.605 6.4165,6.5595 6.4165,6.5595 C6.803,6.5135 6.7585,5.944 6.3705,5.9665 C6.3705,5.9665 5.2055,6.058 4.453,6.058 C4.318,6.058 4.159,6.055 3.99,6.049 C5.277,4.0965 7.4875,2.8075 10,2.8075 C11.8725,2.8075 13.5775,3.523 14.8575,4.696 C14.8265,4.6935 14.796,4.6895 14.764,4.6895 C14.0575,4.6895 13.556,5.305 13.556,5.9665 C13.556,6.5595 13.898,7.0605 14.2625,7.6535 C14.536,8.132 14.856,8.7475 14.856,9.6375 C14.856,10.2525 14.619,10.967 14.3085,11.9625 L13.5905,14.359 L10.991,6.6275 Z M16.3115,6.5495 C16.873,7.5745 17.1925,8.7495 17.1925,10 C17.1925,12.654 15.7545,14.97 13.6165,16.2175 L15.8135,9.8655 C16.2235,8.8395 16.3605,8.019 16.3605,7.29 C16.36,7.0245 16.343,6.779 16.3115,6.5495 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M10,2 C5.589,2 2,5.589 2,10 C2,14.411 5.589,18.0005 10,18.0005 C14.411,18.0005 18,14.411 18,10 C18,5.589 14.411,2 10,2 Z M2.8075,10 C2.8075,8.957 3.031,7.9675 3.4305,7.073 L6.861,16.473 C4.462,15.3075 2.8075,12.847 2.8075,10 Z M10,17.193 C9.294,17.193 8.6125,17.09 7.9685,16.9005 L10.1265,10.6295 L12.3375,16.6865 C12.352,16.7215 12.3695,16.7545 12.389,16.785 C11.641,17.049 10.838,17.193 10,17.193 Z M10.991,6.6275 C11.424,6.605 11.814,6.5595 11.814,6.5595 C12.2015,6.5135 12.156,5.944 11.768,5.9665 C11.768,5.9665 10.6035,6.058 9.851,6.058 C9.144,6.058 7.9565,5.9665 7.9565,5.9665 C7.569,5.9435 7.5235,6.536 7.911,6.5595 C7.911,6.5595 8.278,6.605 8.6655,6.6275 L9.786,9.6985 L8.212,14.419 L5.5935,6.6275 C6.027,6.605 6.4165,6.5595 6.4165,6.5595 C6.803,6.5135 6.7585,5.944 6.3705,5.9665 C6.3705,5.9665 5.2055,6.058 4.453,6.058 C4.318,6.058 4.159,6.055 3.99,6.049 C5.277,4.0965 7.4875,2.8075 10,2.8075 C11.8725,2.8075 13.5775,3.523 14.8575,4.696 C14.8265,4.6935 14.796,4.6895 14.764,4.6895 C14.0575,4.6895 13.556,5.305 13.556,5.9665 C13.556,6.5595 13.898,7.0605 14.2625,7.6535 C14.536,8.132 14.856,8.7475 14.856,9.6375 C14.856,10.2525 14.619,10.967 14.3085,11.9625 L13.5905,14.359 L10.991,6.6275 Z M16.3115,6.5495 C16.873,7.5745 17.1925,8.7495 17.1925,10 C17.1925,12.654 15.7545,14.97 13.6165,16.2175 L15.8135,9.8655 C16.2235,8.8395 16.3605,8.019 16.3605,7.29 C16.36,7.0245 16.343,6.779 16.3115,6.5495 Z'    
	},
	'[yelp]': {
		filename: "yelp@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M11.4955523,12.4188154 C11.2246493,12.6917251 11.4539135,13.1888823 11.4539135,13.1888823 L13.4932111,16.5942335 C13.4932111,16.5942335 13.8278265,17.0432302 14.1182948,17.0432302 C14.4097663,17.0432302 14.6977262,16.8039325 14.6977262,16.8039325 L16.3101008,14.4987486 C16.3101008,14.4987486 16.4726426,14.2082803 16.4761543,13.9534308 C16.4821744,13.5912235 15.9358533,13.4918924 15.9358533,13.4918924 L12.1186292,12.2663071 C12.1186292,12.2663071 11.7448834,12.1674776 11.4955523,12.4188154 Z M11.3024085,10.702093 C11.4980607,11.0331967 12.036355,10.9368756 12.036355,10.9368756 L15.8450506,9.82366495 C15.8450506,9.82366495 16.3642814,9.61246091 16.4385289,9.33152447 C16.5112714,9.04958469 16.3527429,8.71045426 16.3527429,8.71045426 L14.532676,6.56680873 C14.532676,6.56680873 14.3751509,6.29540408 14.047559,6.26831378 C13.6868566,6.23721008 13.4646158,6.6741666 13.4646158,6.6741666 L11.3124419,10.0609559 C11.3124419,10.0604543 11.1223081,10.397578 11.3024085,10.702093 Z M9.50291014,9.38169169 C9.95140514,9.27132382 10.0226426,8.61965156 10.0226426,8.61965156 L9.99204058,3.1970763 C9.99204058,3.1970763 9.92431484,2.52834721 9.62381314,2.34724352 C9.15274293,2.06129034 9.01277636,2.21078869 8.87782654,2.23035391 L5.71578641,3.40577195 C5.71578641,3.40577195 5.40575297,3.50811308 5.24471614,3.7664743 C5.01444862,4.13269504 5.47849545,4.66898265 5.47849545,4.66898265 L8.76545197,9.14891578 C8.76545197,9.14841413 9.09003388,9.48353117 9.50291014,9.38169169 Z M8.72230814,11.5760061 C8.73334493,11.1581131 8.22013423,10.9067753 8.22013423,10.9067753 L4.8213048,9.18955121 C4.8213048,9.18955121 4.31762588,8.98185891 4.0728098,9.12684221 C3.88568606,9.23771178 3.71963254,9.4373773 3.70357906,9.6149693 L3.48234158,12.3400529 C3.48234158,12.3400529 3.44923123,12.8121265 3.57163923,13.0268422 C3.74521784,13.3313573 4.31511749,13.1196516 4.31511749,13.1196516 L8.28284327,12.2427285 C8.43685662,12.1383806 8.70725797,12.1293506 8.72230814,11.5760061 Z M9.70859575,13.0469091 C9.36796032,12.8718255 8.9601008,13.2345345 8.9601008,13.2345345 L6.30324458,16.1592837 C6.30324458,16.1592837 5.97163923,16.6062736 6.05592019,16.8806883 C6.13518441,17.1380462 6.26662254,17.2664743 6.45274293,17.3562736 L9.12113758,18.1985813 C9.12113758,18.1985813 9.44471614,18.2658054 9.68953223,18.194568 C10.0371911,18.0942335 9.97297701,17.5494174 9.97297701,17.5494174 L10.0331777,13.5892168 C10.0336794,13.5897185 10.0206359,13.2079459 9.70859575,13.0469091 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M11.4955523,12.4188154 C11.2246493,12.6917251 11.4539135,13.1888823 11.4539135,13.1888823 L13.4932111,16.5942335 C13.4932111,16.5942335 13.8278265,17.0432302 14.1182948,17.0432302 C14.4097663,17.0432302 14.6977262,16.8039325 14.6977262,16.8039325 L16.3101008,14.4987486 C16.3101008,14.4987486 16.4726426,14.2082803 16.4761543,13.9534308 C16.4821744,13.5912235 15.9358533,13.4918924 15.9358533,13.4918924 L12.1186292,12.2663071 C12.1186292,12.2663071 11.7448834,12.1674776 11.4955523,12.4188154 Z M11.3024085,10.702093 C11.4980607,11.0331967 12.036355,10.9368756 12.036355,10.9368756 L15.8450506,9.82366495 C15.8450506,9.82366495 16.3642814,9.61246091 16.4385289,9.33152447 C16.5112714,9.04958469 16.3527429,8.71045426 16.3527429,8.71045426 L14.532676,6.56680873 C14.532676,6.56680873 14.3751509,6.29540408 14.047559,6.26831378 C13.6868566,6.23721008 13.4646158,6.6741666 13.4646158,6.6741666 L11.3124419,10.0609559 C11.3124419,10.0604543 11.1223081,10.397578 11.3024085,10.702093 Z M9.50291014,9.38169169 C9.95140514,9.27132382 10.0226426,8.61965156 10.0226426,8.61965156 L9.99204058,3.1970763 C9.99204058,3.1970763 9.92431484,2.52834721 9.62381314,2.34724352 C9.15274293,2.06129034 9.01277636,2.21078869 8.87782654,2.23035391 L5.71578641,3.40577195 C5.71578641,3.40577195 5.40575297,3.50811308 5.24471614,3.7664743 C5.01444862,4.13269504 5.47849545,4.66898265 5.47849545,4.66898265 L8.76545197,9.14891578 C8.76545197,9.14841413 9.09003388,9.48353117 9.50291014,9.38169169 Z M8.72230814,11.5760061 C8.73334493,11.1581131 8.22013423,10.9067753 8.22013423,10.9067753 L4.8213048,9.18955121 C4.8213048,9.18955121 4.31762588,8.98185891 4.0728098,9.12684221 C3.88568606,9.23771178 3.71963254,9.4373773 3.70357906,9.6149693 L3.48234158,12.3400529 C3.48234158,12.3400529 3.44923123,12.8121265 3.57163923,13.0268422 C3.74521784,13.3313573 4.31511749,13.1196516 4.31511749,13.1196516 L8.28284327,12.2427285 C8.43685662,12.1383806 8.70725797,12.1293506 8.72230814,11.5760061 Z M9.70859575,13.0469091 C9.36796032,12.8718255 8.9601008,13.2345345 8.9601008,13.2345345 L6.30324458,16.1592837 C6.30324458,16.1592837 5.97163923,16.6062736 6.05592019,16.8806883 C6.13518441,17.1380462 6.26662254,17.2664743 6.45274293,17.3562736 L9.12113758,18.1985813 C9.12113758,18.1985813 9.44471614,18.2658054 9.68953223,18.194568 C10.0371911,18.0942335 9.97297701,17.5494174 9.97297701,17.5494174 L10.0331777,13.5892168 C10.0336794,13.5897185 10.0206359,13.2079459 9.70859575,13.0469091 Z'    
	},
	'[youtube]': {
		filename: "youtube@2x.png",
		width: 20,
		height: 20,
		bgRectRadius: 3,
		bgCircRadius: 10,
		svgRectPath: "M1.99079514,0 C0.891309342,0 0,0.898212381 0,1.99079514 L0,18.0092049 C0,19.1086907 0.898212381,20 1.99079514,20 L18.0092049,20 C19.1086907,20 20,19.1017876 20,18.0092049 L20,1.99079514 C20,0.891309342 19.1017876,0 18.0092049,0 L1.99079514,0 Z M5.78125,2.0725 L6.7225,2.0725 L7.35875,4.41875 L7.96875,2.0725 L8.87375,2.0725 L7.7975,5.6275 L7.7975,8.04875 L6.9025,8.04875 L6.9025,5.6275 C6.8213916,5.1989312 6.6419944,4.5710256 6.355,3.7375 C6.1662504,3.18303336 5.9698048,2.62682056 5.78125,2.0725 Z M10.0725,3.54125 C10.4768728,3.54125 10.791782,3.6929304 11.015,3.9975 C11.1841784,4.2225192 11.265,4.5715128 11.265,5.0475 L11.265,6.60625 C11.265,7.0795596 11.1841784,7.4309216 11.015,7.65375 C10.791782,7.9574432 10.4768728,8.11 10.0725,8.11 C9.6705616,8.11 9.356822,7.9574432 9.13375,7.65375 C8.9620888,7.4309216 8.88125,7.0795596 8.88125,6.60625 L8.88125,5.0475 C8.88125,4.571464 8.9620888,4.2225192 9.13375,3.9975 C9.3567732,3.6929304 9.6705128,3.54125 10.0725,3.54125 Z M11.92875,3.595 L12.73375,3.595 L12.73375,6.87375 C12.73375,7.0628404 12.7340132,7.1611132 12.74375,7.1875 C12.7615684,7.312424 12.8241772,7.37625 12.9325,7.37625 C13.09384,7.37625 13.2637308,7.2514708 13.4425,6.99875 L13.4425,3.595 L14.24875,3.595 L14.24875,8.04875 L13.4425,8.04875 L13.4425,7.5625 C13.1213292,7.9307 12.814346,8.11 12.52,8.11 C12.2602688,8.11 12.0817252,8.0043048 12.00125,7.77875 C11.9567036,7.643748 11.92875,7.4306052 11.92875,7.11625 L11.92875,3.595 Z M9.74875,8.7775 L10.05375,8.7775 L10.35875,8.7775 C11.909056,8.7775 13.4649004,8.7894916 15.0025,8.96125 C15.6942568,9.0385608 16.2684164,9.5572408 16.43,10.26 C16.6599852,11.260854 16.65875,12.3520948 16.65875,13.3825 L16.65875,13.42625 C16.6586528,14.4438512 16.6542232,15.5195144 16.4275,16.50625 C16.2658676,17.2089608 15.6905552,17.727738 14.99875,17.805 C13.459544,17.9770508 11.90326,17.9875 10.35125,17.9875 C10.2512524,17.9875 10.1512476,17.9875972 10.05125,17.9875 C9.9513984,17.9875972 9.8511992,17.9875 9.75125,17.9875 C8.1991912,17.9875 6.6430532,17.9770508 5.10375,17.805 C4.4119448,17.727738 3.8366322,17.2089608 3.675,16.50625 C3.45046756,15.5292028 3.44509736,14.466192 3.445,13.4575 L3.445,13.3825 C3.445,12.3520948 3.44751488,11.260854 3.6775,10.26 C3.8391322,9.5572408 4.4144448,9.0385608 5.10625,8.96125 C6.643752,8.7894428 8.1984928,8.7775 9.74875,8.7775 Z M10.0725,4.2675 C9.8123304,4.2675 9.6875,4.472984 9.6875,4.885 L9.6875,6.75875 C9.6875,7.1708636 9.8123304,7.37625 10.0725,7.37625 C10.3326696,7.37625 10.4575,7.1708636 10.4575,6.75875 L10.4575,4.885 C10.4575,4.472984 10.332718,4.2675 10.0725,4.2675 Z M4.43,10.42125 L4.43,11.25375 L5.37,11.25375 L5.37,16.33625 L6.25875,16.33625 L6.25875,11.25375 L7.215,11.25375 L7.215,10.42125 L4.43,10.42125 Z M10.31875,10.42125 L10.31875,16.33625 L11.1175,16.33625 L11.1175,15.90875 C11.3842904,16.2388788 11.6586212,16.39625 11.9425,16.39625 C12.2603604,16.39625 12.4728944,16.2288472 12.58,15.90125 C12.6328712,15.7143992 12.66125,15.420378 12.66125,15.0125 L12.66125,13.25875 C12.66125,12.8417196 12.63292,12.5498572 12.58,12.3725 C12.4728944,12.0424684 12.2603604,11.875 11.9425,11.875 C11.6488356,11.875 11.3753324,12.0351752 11.1175,12.3525 L11.1175,10.42125 L10.31875,10.42125 Z M11.515,12.59375 C11.745326,12.59375 11.8625,12.7968588 11.8625,13.195 L11.8625,15.07625 C11.8625,15.4743912 11.745326,15.67 11.515,15.67 C11.383698,15.67 11.2511388,15.6072428 11.1175,15.47375 L11.1175,12.7875 C11.2511388,12.65576 11.3837468,12.59375 11.515,12.59375 Z M14.485,11.875 C14.0774628,11.875 13.7597088,12.0258516 13.52875,12.3275 C13.3591824,12.5503772 13.2825,12.8940272 13.2825,13.365 L13.2825,14.90875 C13.2825,15.3770452 13.369036,15.7244596 13.53875,15.945 C13.76966,16.2460644 14.087288,16.39625 14.505,16.39625 C14.9220304,16.39625 15.2505148,16.238704 15.47125,15.91875 C15.5685216,15.7775164 15.6308696,15.6173572 15.6575,15.44 C15.6649972,15.3603524 15.67375,15.1831088 15.67375,14.92625 L15.67375,14.80875 L14.86,14.80875 C14.86,15.1290448 14.849754,15.306476 14.8425,15.35 C14.7968828,15.563676 14.6818796,15.67125 14.485,15.67125 C14.2106636,15.67125 14.0775,15.466628 14.0775,15.05875 L14.0775,14.2775 L15.67375,14.2775 L15.67375,13.365 C15.67375,12.8940272 15.5947308,12.5503772 15.4275,12.3275 C15.203844,12.0258516 14.885624,11.875 14.485,11.875 Z M14.47875,12.59375 C14.7431064,12.59375 14.8762988,12.7973656 14.87625,13.205 L14.87625,13.6125 L14.0775,13.6125 L14.0775,13.205 C14.0775,12.7974144 14.2116672,12.59375 14.47875,12.59375 Z M7.33125,11.92875 L7.33125,15.41375 C7.33125,15.7247948 7.3577748,15.9352572 7.40125,16.06875 C7.4811412,16.2918708 7.6590016,16.39625 7.91625,16.39625 C8.2098168,16.39625 8.5113276,16.2191108 8.82875,15.855 L8.82875,16.33625 L9.6275,16.33625 L9.6275,11.92875 L8.82875,11.92875 L8.82875,15.2975 C8.65149,15.5476404 8.4840192,15.67 8.32375,15.67 C8.2170336,15.67 8.1556752,15.6074572 8.13625,15.48375 C8.12885,15.4573632 8.12875,15.3608928 8.12875,15.17375 L8.12875,11.92875 L7.33125,11.92875 Z",
		svgCircPath:'M10,0 C4.4771525,0 0,4.47593818 0,10 C0,15.5228475 4.47593818,20 10,20 C15.5228475,20 20,15.5240618 20,10 C20,4.4771525 15.5240618,0 10,0 Z M6.38392857,3.0634375 L7.19071429,3.0634375 L7.73607143,5.11640625 L8.25892857,3.0634375 L9.03464286,3.0634375 L8.11214286,6.1740625 L8.11214286,8.29265625 L7.345,8.29265625 L7.345,6.1740625 C7.27547851,5.7990648 7.12170949,5.2496474 6.87571429,4.5203125 C6.71392891,4.03515419 6.54554697,3.54846799 6.38392857,3.0634375 Z M10.0621429,4.34859375 C10.4087481,4.34859375 10.6786703,4.4813141 10.87,4.7478125 C11.0150101,4.9447043 11.0842857,5.2500737 11.0842857,5.6665625 L11.0842857,7.03046875 C11.0842857,7.44461465 11.0150101,7.7520564 10.87,7.94703125 C10.6786703,8.2127628 10.4087481,8.34625 10.0621429,8.34625 C9.71762423,8.34625 9.44870457,8.2127628 9.2575,7.94703125 C9.11036183,7.7520564 9.04107143,7.44461465 9.04107143,7.03046875 L9.04107143,5.6665625 C9.04107143,5.250031 9.11036183,4.9447043 9.2575,4.7478125 C9.44866274,4.4813141 9.7175824,4.34859375 10.0621429,4.34859375 Z M11.6532143,4.395625 L12.3432143,4.395625 L12.3432143,7.26453125 C12.3432143,7.42998535 12.3434399,7.51597405 12.3517857,7.5390625 C12.3670586,7.648371 12.4207233,7.70421875 12.5135714,7.70421875 C12.6518629,7.70421875 12.7974835,7.59503695 12.9507143,7.37390625 L12.9507143,4.395625 L13.6417857,4.395625 L13.6417857,8.29265625 L12.9507143,8.29265625 L12.9507143,7.8671875 C12.675425,8.1893625 12.4122966,8.34625 12.16,8.34625 C11.9373733,8.34625 11.7843359,8.2537667 11.7153571,8.05640625 C11.6771745,7.9382795 11.6532143,7.75177955 11.6532143,7.47671875 L11.6532143,4.395625 Z M9.78464286,8.9303125 L10.0460714,8.9303125 L10.3075,8.9303125 C11.6363337,8.9303125 12.9699146,8.94080515 14.2878571,9.09109375 C14.8807915,9.1587407 15.3729283,9.6125857 15.5114286,10.2275 C15.7085587,11.1032473 15.7075,12.058083 15.7075,12.9596875 L15.7075,12.9979688 C15.7074167,13.8883698 15.7036199,14.8295751 15.5092857,15.6929688 C15.3707437,16.3078407 14.8776187,16.7617708 14.2846429,16.829375 C12.9653234,16.9799195 11.6313657,16.9890625 10.3010714,16.9890625 C10.2153592,16.9890625 10.1296408,16.9891476 10.0439286,16.9890625 C9.95834149,16.9891476 9.87245646,16.9890625 9.78678571,16.9890625 C8.4564496,16.9890625 7.12261703,16.9799195 5.80321429,16.829375 C5.2102384,16.7617708 4.71711331,16.3078407 4.57857143,15.6929688 C4.38611505,14.8380525 4.38151202,13.907918 4.38142857,13.0253125 L4.38142857,12.9596875 C4.38142857,12.058083 4.38358418,11.1032473 4.58071429,10.2275 C4.71925617,9.6125857 5.21238126,9.1587407 5.80535714,9.09109375 C7.123216,8.94076245 8.45585097,8.9303125 9.78464286,8.9303125 Z M10.0725,4.9840625 C9.8123304,4.9840625 9.6875,5.163861 9.6875,5.524375 L9.6875,7.16390625 C9.6875,7.52450565 9.8123304,7.70421875 10.0725,7.70421875 C10.3326696,7.70421875 10.4575,7.52450565 10.4575,7.16390625 L10.4575,5.524375 C10.4575,5.163861 10.332718,4.9840625 10.0725,4.9840625 Z M5.22571429,10.3685938 L5.22571429,11.0970313 L6.03142857,11.0970313 L6.03142857,15.5442188 L6.79321429,15.5442188 L6.79321429,11.0970313 L7.61285714,11.0970313 L7.61285714,10.3685938 L5.22571429,10.3685938 Z M10.2732143,10.3685938 L10.2732143,15.5442188 L10.9578571,15.5442188 L10.9578571,15.1701563 C11.1865346,15.459019 11.4216753,15.5967188 11.665,15.5967188 C11.9374518,15.5967188 12.1196238,15.4502413 12.2114286,15.1635938 C12.2567467,15.0000993 12.2810714,14.7428308 12.2810714,14.3859375 L12.2810714,12.8514063 C12.2810714,12.4865047 12.2567886,12.2311251 12.2114286,12.0759375 C12.1196238,11.7871599 11.9374518,11.640625 11.665,11.640625 C11.4132877,11.640625 11.1788563,11.7807783 10.9578571,12.0584375 L10.9578571,10.3685938 L10.2732143,10.3685938 Z M11.2985714,12.2695313 C11.4959937,12.2695313 11.5964286,12.4472515 11.5964286,12.795625 L11.5964286,14.4417188 C11.5964286,14.7900923 11.4959937,14.96125 11.2985714,14.96125 C11.1860269,14.96125 11.0724047,14.9063375 10.9578571,14.7895313 L10.9578571,12.4390625 C11.0724047,12.32379 11.1860687,12.2695313 11.2985714,12.2695313 Z M13.8442857,11.640625 C13.4949681,11.640625 13.2226075,11.7726202 13.0246429,12.0365625 C12.8792992,12.2315801 12.8135714,12.5322738 12.8135714,12.944375 L12.8135714,14.2951563 C12.8135714,14.7049146 12.8877451,15.0089022 13.0332143,15.201875 C13.2311371,15.4653064 13.5033897,15.5967188 13.8614286,15.5967188 C14.2188832,15.5967188 14.5004413,15.458866 14.6896429,15.1789063 C14.7730185,15.0553269 14.8264597,14.9151876 14.8492857,14.76 C14.8557119,14.6903084 14.8632143,14.5352202 14.8632143,14.3104688 L14.8632143,14.2076563 L14.1657143,14.2076563 C14.1657143,14.4879142 14.156932,14.6431665 14.1507143,14.68125 C14.1116138,14.8682165 14.0130397,14.9623438 13.8442857,14.9623438 C13.6091402,14.9623438 13.495,14.7832995 13.495,14.4264063 L13.495,13.7428125 L14.8632143,13.7428125 L14.8632143,12.944375 C14.8632143,12.5322738 14.7954835,12.2315801 14.6521429,12.0365625 C14.4604377,11.7726202 14.1876777,11.640625 13.8442857,11.640625 Z M13.8389286,12.2695313 C14.0655198,12.2695313 14.1796847,12.4476949 14.1796429,12.804375 L14.1796429,13.1609375 L13.495,13.1609375 L13.495,12.804375 C13.495,12.4477376 13.6100005,12.2695313 13.8389286,12.2695313 Z M7.7125,11.6876563 L7.7125,14.7370313 C7.7125,15.0091955 7.73523554,15.1933501 7.7725,15.3101563 C7.84097817,15.505387 7.99342994,15.5967188 8.21392857,15.5967188 C8.46555726,15.5967188 8.72399509,15.441722 8.99607143,15.123125 L8.99607143,15.5442188 L9.68071429,15.5442188 L9.68071429,11.6876563 L8.99607143,11.6876563 L8.99607143,14.6353125 C8.84413429,14.8541854 8.70058789,14.96125 8.56321429,14.96125 C8.47174309,14.96125 8.41915017,14.9065251 8.4025,14.7982813 C8.39615714,14.7751928 8.39607143,14.6907812 8.39607143,14.5270313 L8.39607143,11.6876563 L7.7125,11.6876563 Z'  
	}
};


function Accordion(vars) {

	vars = vars || {};

	var self = vars.self || new Sprite(vars),
		children = [],
		tile,
		_timer;

	self.gap = vars.gap || 1;
	self.axis = vars.axis || 'y';
	self.align = vars.align || 'left';
	self.wrap = vars.wrap || false;
	self.perpLength = vars.perpLength || self.width;
	self.expand = 'auto';  /*auto, single, all*/
	self.toggle = vars.toggle || true;
	self.updateSpeed = vars.updateSpeed || 0.35;
	self.animate = vars.animate || true;

	self.addEventListener(SELECT_ACCORDION_ITEM, self.select);

	self.addItem = function(container, title, content, isOpen) {
		if(self.expand === 'all') {
			isOpen = true;
		}
		var item = {container:container, title:title, content:content, isOpen:isOpen||false};
		title.addEventListener(CLICK, self.select);
		children.push(item);
		title.accordionItem = item;
		self.addChild(container);
	};

	self.select = function(e) {
		var i = children.length;
		while(i--) {
			if(children[i] === this.accordionItem) {

				if(self.toggle) {
					toggleItem(this.accordionItem);
				} else if(!this.accordionItem.isOpen) {
					self.openItem(this.accordionItem);
				}
				self.dispatchEvent(ACCORDION_SELECT, this.accordionItem);
			} else if(self.expand === 'single') {
				self.closeItem(children[i]);
			}
		}
		self.layout();
	};

	function toggleItem(item) {
		if(item.isOpen) {
			self.closeItem(item);
		} else {
			self.openItem(item);
		}
	}

	self.closeItem = function(item) {
		if(self.expand !== 'all') {
			item.isOpen = false;
			if(item.content) {
				item.content.overflow = 'hidden';
				if(self.animate) {
					Tween(item.content, self.updateSpeed, {height:0});
				} else {
					item.content.height = 0;
				}
			}

			item.container.height = item.title.height;
		}
	};

	self.openItem = function(item) {
		item.isOpen = true;
		if(item.content) {
			if(self.animate) {
				Tween(item.content, self.updateSpeed, {height:item.contentHeight,onComplete:function(){
					item.content.overflow = 'visible';
				}});
			} else {
				item.content.height = item.contentHeight;
				item.content.overflow = 'visible';
			}
		}
		item.container.height = item.title.height + item.contentHeight;
	};

	function updateTile() {
		tile = new Tile();
		tile.gap = self.gap;
		tile.axis = self.axis;
		tile.align = self.align;
		tile.wrap = self.wrap;
		tile.perpLength = 0;
	}

	self.layout = function() {

		updateTile();

		var i,
			openSub,
			length = children.length,
			gapComp = (-self.gap * 2);

		tile.perpLength = 0;

		for(i = 0; i < length; i++) {
			if(!children[i].contentHeight) {
				children[i].contentHeight = children[i].content ? children[i].content.height : 0;
			}
			if(children[i].content && !children[i].isOpen) {
				children[i].content.height = 0;
				children[i].content.overflow = 'hidden';
			}

			var width = children[i].title.width;
			var height = children[i].isOpen ? children[i].title.height + children[i].contentHeight : children[i].title.height;
			if(children[i].content && children[i].isOpen) openSub = children[i];
			children[i].container.width = width;
			children[i].container.height = height;
			if(self.axis === 'x') {
				tile.perpLength = height > tile.perpLength ? height : tile.perpLength;
			} else {
				tile.perpLength = width > tile.perpLength ? width : tile.perpLength;
			}

			tile.addItem(width, height);
		}

		tile.layoutItems();

		var gapX = self.axis === 'x' ? self.gap + gapComp : 0,
			gapY = self.axis === 'x' ? 0 : self.gap + gapComp;

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			children[i].container.x = position.x + gapX;
			if(self.updateSpeed !== 0) {
				Tween(children[i].container, self.updateSpeed, {y:position.y + gapY});
			} else {
				if(_timer) clearInterval(_timer);
				children[i].container.y = position.y + gapY;
			}
		}

		var bounds = tile.getBounds();
		var boundsWidth = self.axis === 'x' ? bounds.width - self.gap : tile.perpLength;
		var boundsHeight = bounds.height + self.gap + gapComp;

		self.width = boundsWidth; 
		self.height = boundsHeight;
		self.dispatchEvent(ACCORDION_SIZE_CHANGE, {width:boundsWidth, height:boundsHeight});
	};

	return self;

}

function Align(obj, duration, vars) {
	var align = new AlignEngine({hRange:vars.hRange, vRange:vars.vRange, hAlign:vars.hAlign, vAlign:vars.vAlign, width:vars.width || obj.width, height:vars.height || obj.height, hOffset:vars.hOffset, vOffset:vars.vOffset});
	var hOrigin = vars.hOrigin || 0;
	var vOrigin = vars.vOrigin || 0;
	var tweenVars = {
		x:Mth.round(align.x + hOrigin),
		y:Mth.round(align.y + vOrigin),
		onComplete:vars.onComplete,
		onCompleteParams:vars.onCompleteParams,
		onCompleteScope:vars.onCompleteScope,
		onUpdate:vars.onUpdate,
		onUpdateParams:vars.onUpdateParams,
		onUpdateScope:vars.onUpdateScope,
		onInit:vars.onInit,
		onInitScope:vars.onInitScope,
		onInitParams:vars.onInitParams
	}

	Tween(obj, duration, tweenVars);
}

function AlignEngine(vars) {

	vars = vars || {};

	var _x,
		_y,
		_hRange = vars.hRange || 0,
		_vRange = vars.vRange || 0,
		_width = vars.width || 0,
		_height = vars.height || 0,
		_hAlign = vars.hAlign || 'left',
		_vAlign = vars.vAlign || 'top',
		_hOffset = vars.hOffset || 0,
		_vOffset = vars.vOffset || 0;

	return {
		set hRange(value) {
			_hRange = value;
		},
		set vRange(value) {
			_vRange = value;
		},
		set width(value) {
			_width = value;
		},
		set height(value) {
			_height = value;
		},
		set hAlign(value) {
			_hAlign = value;
		},
		set vAlign(value) {
			_vAlign = value;
		},
		set hOffset(value) {
			_hOffset = value;
		},
		set vOffset(value) {
			_vOffset = value;
		},
		get x() {
			if(_hAlign === 'center') {
				return ((_hRange - _width) * 0.5) + _hOffset;
			} else if(_hAlign === 'right') {
				return  _hRange - _width - _hOffset;
			}
			return _hOffset;
		},
		get y() {
			if(_vAlign === 'center' || _vAlign === 'middle') {
				return ((_vRange - _height) * 0.5) + _vOffset;
			} else if(_vAlign === 'bottom') {
				return (_vRange - _height) - _vOffset;
			}
			return _vOffset;
		}
	};
}

function Cursor(vars) {

	var self = new Sprite({events:new EventSandbox()}),
		svg,
		iconLeft,
		iconCenter,
		iconRight,
		visible = false,
		zoneWidth = 0,
		adminView,
		numAdminViews = 0,
		cursorIcon = {
			left: {
				'arrow1':svgPaths.arrow1Left,
				'arrow2':svgPaths.arrow2Left,
				'plus1':svgPaths.plus1Left,
				'plus2':svgPaths.plus2Left,
				'none':''
			},
			right: {
				'arrow1':svgPaths.arrow1Right,
				'arrow2':svgPaths.arrow2Right,
				'plus1':svgPaths.plus1Right,
				'plus2':svgPaths.plus2Right,
				'none':''
			}
		},
		axis = 'y',
		thumbs = false,
		cursorUpdateTimer;

	self.enabled = true;
	self.zIndex = 999;
	self.alpha = 0;
	self.display = 'none';

	self.addEventListener('cursorAxisUpdate', cursorAxisUpdate);
	self.addEventListener('cursorThumbsUpdate', cursorThumbsUpdate);

	function cursorAxisUpdate(e) {
		axis = e;
	}

	function cursorThumbsUpdate(e) {
		if(LAYOUT_MODEL.cursorIconStyle === 'none') {
			thumbs = false;
		} else {
			thumbs = e;
		}
	}

	function init() {

		svg = new Svg();
		svg.left = -20;
		svg.top = -20;
		svg.width = 40;
		svg.height = 40;
		self.addChild(svg);
		svg.element.style['pointer-events'] = 'none';

		iconLeft = new Path();
		iconLeft.id = 'icon';
		iconLeft.d = cursorIcon.left[LAYOUT_MODEL.cursorIconStyle];
		iconLeft.fill = LAYOUT_MODEL.cursorColor;
		svg.addChild(iconLeft);
		iconLeft.element.style['pointer-events'] = 'none';

		iconCenter = new Path();
		iconCenter.id = 'icon';
		iconCenter.d = svgPaths.cursorThumbs;
		iconCenter.fill = LAYOUT_MODEL.cursorColor;
		svg.addChild(iconCenter);
		iconCenter.element.style['pointer-events'] = 'none';

		iconRight = new Path();
		iconRight.id = 'icon';
		iconRight.d = cursorIcon.right[LAYOUT_MODEL.cursorIconStyle];
		iconRight.fill = LAYOUT_MODEL.cursorColor;
		svg.addChild(iconRight);
		iconRight.element.style['pointer-events'] = 'none';

		self.iconLeft = iconLeft;
		self.iconCenter = iconCenter;
		self.iconRight = iconRight;
		self.svg = svg;

		vars.parentView.addChild(self);

		stage.addEventListener(MOUSE_MOVE, cursorMouseMove);
	}

	function cursorMouseMove(e) {

		if(e.target !== svg.element && e.target !== iconLeft.element && e.target !== iconCenter.element && e.target !== iconRight.element) {

			var x = getX(e),
				y = getY(e),
				maskX = STATE.mediaView.x(),
				maskY = STATE.mediaView.y(),
				maskWidth = STATE.mediaView.width(),
				maskHeight = STATE.mediaView.height();

			self.transition = 0;
			self.translateX = x - 2;
			self.translateY = y - 2;

			if(e.target.navigationCursor && self.enabled) {
				show(e);
			} else {
				hide();
			}

			var zoneWidth = thumbs ? maskWidth * 0.333 : maskWidth * 0.5,
				zoneHeight = thumbs ? maskHeight * 0.333 : maskHeight * 0.5,
				zone = axis === 'x' ? zoneWidth : zoneHeight,
				local = axis === 'x' ? x - maskX : y - maskY,
				zone1 = zone,
				zone2 = zone * 2;

			if(LAYOUT_MODEL.cursorColor !== self.iconLeft.fill) {
				self.iconLeft.fill = LAYOUT_MODEL.cursorColor;
				self.iconCenter.fill = LAYOUT_MODEL.cursorColor;
				self.iconRight.fill = LAYOUT_MODEL.cursorColor;
			}

			if(local < zone1) {
				self.iconLeft.alpha = 1;
				self.iconCenter.alpha = 0;
				self.iconRight.alpha = 0;
				self.svg.rotate = axis === 'x' ? 0 : 90;
				self.type = 'prev';
			} else if(thumbs && local > zone1 && local < zone2) {
				self.iconLeft.alpha = 0;
				self.iconCenter.alpha = 1;
				self.iconRight.alpha = 0;
				self.svg.rotate = 0;
				self.type = 'thumbs';
			} else if(!thumbs || local > zone2) {
				self.iconLeft.alpha = 0;
				self.iconCenter.alpha = 0;
				self.iconRight.alpha = 1;
				self.svg.rotate = axis === 'x' ? 0 : 90;
				self.type = 'next';
			}
		}

		clearTimeout(cursorUpdateTimer);
		cursorUpdateTimer = setTimeout(function() {
			noShow();
		}, 5000);
	}

	function click(e) {
		if(e.target.navigationCursor && self.enabled) {
			if(self.type === 'thumbs') {
				vars.events.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, self.type);
			} else {
				vars.events.dispatchEvent(NAVBAR_NAV_CLICK, {navDir:self.type});
			}
		}
	}

	function show(e) {
		visible = true;
		self.display = 'block';
		self.alpha = 0.85;
		if(LAYOUT_MODEL.cursorIconStyle !== 'none') {
			e.target.style.cursor = 'none';
			self.iconLeft.cursor = 'none';
			self.iconCenter.cursor = 'none';
			self.iconRight.cursor = 'none';
			self.svg.cursor = 'none';
			self.cursor = 'none';
		}
		stage.element.addEventListener(CLICK, click);
		stage.element.addEventListener('contextmenu', disable);
		stage.element.addEventListener('dragstart', disable);
	}

	function hide() {
		if(visible) {
			visible = false;
			self.alpha = 0;
			self.display = 'none';
		}
		stage.element.removeEventListener(CLICK, click);
		stage.element.removeEventListener('contextmenu', disable);
		stage.element.removeEventListener('dragstart', disable);
	};

	function noShow() {
		visible = false;
		self.alpha = 0;
		self.display = 'none';
		stage.element.addEventListener(CLICK, click);
		stage.element.addEventListener('contextmenu', disable);
		stage.element.addEventListener('dragstart', disable);
	}

	function disable(e) {
		e.preventDefault();
	}

	init.call(self);
	return self;
}

function Tooltip(vars) {

	var v = vars || {},
		self = this,

		container = new Sprite(),
		box = new Sprite(),
		arw = new Sprite(),
		txt = new Sprite(),

		alpha = 0,
		color = v.backgroundColor || 'rgba(0,0,0,0.7)',
		arwColor = color,
		fontColor = v.fontColor || '#FFFFFF',
		fontFamily = v.fontFamily || 'Helvetica Neue, Arial, sans-serif',
		fontSize = v.fontSize|| 11,
		corRadius = v.cornerRadius || 4,
		border = v.border || 'none',
		gap = v.gap || 12,
		padding = v.padding || 4,
		shadow = v.shadow || true,

		xPerc = 0,
		yAxis = 80,
		tipOffset = 0,
		containerAboveOffset = 0,
		containerBelowOffset = 0,

		delay = vars.delay || 350,
		delayTimer,

		debug = false;

	self.isShowing = false;

	if(debug) {
		arwColor = '#000000';
		arw.backgroundColor = '#FFFFFF';
		txt.fontColor = '#000000';
		txt.backgroundColor = '#000000';
		container.backgroundColor = '#000000';
	}

	txt.x = padding;
	txt.y = padding;
	txt.width = vars.width || 100;
	txt.textAlign = 'center';
	txt.fontColor = fontColor;
	txt.fontFamily = 'Helvetica Neue';
	txt.fontSize = fontSize;
	/*txt.wordWrap = 'break-word';*/

	box.x = gap;
	box.y = gap;
	box.borderRadius = corRadius;
	box.border = border;
	box.backgroundColor = color;
	if(shadow) {
		box.element.style.boxShadow = '0px 1px 3px rgba(0,0,0, 0.5)';
	}

	container.alpha = alpha;
	container.overflow = 'hidden';

	arw.w = 8;
	arw.point = arw.w * 0.5;
	arw.h = 6;
	arw.borderRight = arw.point + 'px solid transparent';
	arw.borderLeft = arw.point + 'px solid transparent';

	box.addChild(txt);
	container.addChild(box);
	container.addChild(arw);

	function update(e) {
		txt.text = e.target.tooltip;
		txt.alpha = 1;
		box.width = txt.element.offsetWidth + (padding * 2);
		box.height = txt.element.offsetHeight + (padding * 2);
		container.width = box.width + (gap * 2);
		container.height = box.height + (gap * 2);
		containerAboveOffset = tipOffset + container.height + (gap * 0.5);
		containerBelowOffset = tipOffset + gap;
	}

	function setXPos(e) {
		xPerc = e.pageX / window.innerWidth;
		var tipX = Math.round(container.width * xPerc);
		if((tipX - arw.point - corRadius) < gap) {
			arw.x = corRadius + gap;
			container.x = e.pageX - (gap + arw.point + corRadius);
		} else if((tipX + gap + arw.point + corRadius) > container.width) {
			arw.x = (container.width - (gap + arw.width + corRadius));
			container.x = (e.pageX - container.width) + gap + arw.point + corRadius;
		} else {
			arw.x = tipX - (gap - arw.width);
			container.x = e.pageX - tipX;
		}
	}

	function setYPos(e) {
		if(e.pageY < yAxis) {
			arw.borderTop = arw.h + 'px solid transparent';
			arw.borderBottom = arw.h + 'px solid ' + arwColor;
			container.y = e.pageY + containerBelowOffset;
			arw.y = box.y - arw.height;
		} else {
			arw.borderBottom = arw.h + 'px solid transparent';
			arw.borderTop = arw.h + 'px solid ' + arwColor;
			container.y = e.pageY - containerAboveOffset;
			arw.y = box.height + gap;
		}
	}

	function move(e) {
		container.transition = 0;
		setXPos(e);
		setYPos(e);
	}

	self.show = function(e) {
		if(e.target.tooltip) {
			container.transition = 0;
			e.target.addEventListener(MOUSE_MOVE, move);
			e.target.addEventListener(MOUSE_OUT, hide);
			container.zIndex = 1000;
			delayTimer = setTimeout(function() {
				Tween(container, 0.35, {alpha: 1});
			}, delay);
			update(e);
			self.isShowing = true;
		}
	};

	function hide(e) {
		if(delayTimer) clearTimeout(delayTimer);
		e.target.removeEventListener(MOUSE_MOVE, move);
		e.target.removeEventListener(MOUSE_OUT, hide);
		container.transition = 0;
		container.alpha = 0;
		container.width = 0;
		container.height = 0;
		container.zIndex = 0;
		self.isShowing = false;
	}

	stage.addChild(container);

}


var Docks = {

	arr: [],

	register: function(dock) {
		this.arr.push(dock);
	},

	unRegister: function(dock) {
		var i = this.arr.length;
		while(i--) {
			if(dock === this.arr[i]) {
				this.arr.splice(i, 1);
			}
		}
	},

	resize: function() {
		if(this.arr.length > 0) {
			var i = this.arr.length;
			while(i--) {
				this.arr[i].resize();
			}
		}
	}
};

function Dock(obj, mask, vars) {

	var self = this;

	self.side = vars.side || 'left';
	self.align = vars.align || 'center';
	self.margin = vars.margin || 0;
	self.pOffset = vars.pOffset || 0;
	self.reveal = vars.reveal || 0;
	self.updateSpeed = vars.updateSpeed || 0;

	var axis = self.side === 'top' || self.side === 'bottom' ? 'y' : 'x',
		pAxis = axis === 'x' ? 'y' : 'x',
		dim = axis === 'x' ? 'width' : 'height',
		pDim = axis === 'x' ? 'height' : 'width';

	self.show = function(updateSpeed) {
		updateSpeed = !isNaN(updateSpeed) ? updateSpeed : UPDATE_SPEED;
		var tweenVars = {};
		tweenVars['translate' + axis.toUpperCase()] = showAxis();
		if(updateSpeed === 0) {
			obj['translate' + axis.toUpperCase()] = showAxis();
		} else {
			Tween(obj, updateSpeed, tweenVars);
		}
		toggle.state = true;
	};

	self.hide = function(updateSpeed) {
		updateSpeed = !isNaN(updateSpeed) ? updateSpeed : UPDATE_SPEED;
		var tweenVars = {};
		tweenVars['translate' + axis.toUpperCase()] = hideAxis();
		if(updateSpeed === 0) {
			obj['translate' + axis.toUpperCase()] = hideAxis();
		} else {
			Tween(obj, updateSpeed, tweenVars);
		}
		toggle.state = false;
	};

	self.toggle = function() {
		toggle.flip();
	};

	self.toggleState = function() {
		return toggle.state;
	};

	self.resize = function(updateSpeed) {
		axis = self.side === 'top' || self.side === 'bottom' ? 'y' : 'x',
		pAxis = axis === 'x' ? 'y' : 'x',
		dim = axis === 'x' ? 'width' : 'height',
		pDim = axis === 'x' ? 'height' : 'width';

		updateSpeed = !isNaN(updateSpeed) ? updateSpeed : UPDATE_SPEED;
		var tweenVars = {};
		tweenVars['translate' + axis.toUpperCase()] = toggle.state ? Mth.round(showAxis()) : Mth.round(hideAxis());
		tweenVars['translate' + pAxis.toUpperCase()] = Mth.round(perpAxis());
		if(updateSpeed === 0) {
			obj['translate' + axis.toUpperCase()] = toggle.state ? Mth.round(showAxis()) : Mth.round(hideAxis());
			obj['translate' + pAxis.toUpperCase()] = Mth.round(perpAxis());
		} else {
			Tween(obj, updateSpeed, tweenVars);
		}
	};

	function showAxis() {
		if(self.side === 'left' || self.side === 'top') {
			return self.margin;
		}
		return mask[dim] - obj._private[dim] - self.margin;
	}

	function hideAxis() {
		if(self.side === 'left' || self.side === 'top') {
			if(USER_AGENT === MOBILE) {
				return - mask[dim] + self.reveal;
			}
			return - obj._private[dim] + self.reveal;
		}
		return mask[dim] - self.reveal;
	}

	function perpAxis() {
		switch(self.align) {
			case 'top':
			case 'left':
				return self.pOffset;
			case 'right':
			case 'bottom':
				return mask[pDim] - obj._private[pDim] - self.pOffset;
		}
		return ((mask[pDim] - obj._private[pDim]) * 0.5) + self.pOffset;
	}

	var toggle = new Toggle({
		target: this,
		on: this.show,
		off: this.hide
	});

	toggle.state = true;
	Docks.register(this);

	self.resize(0);
}

function Drag(vars) {

	var _dragZone = vars.dragZone || false,
		_dragElements = vars.dragElements || false,
		_events = new EventSandbox(),
		_threshold = vars.threshold || 20,
		_thresholdMet = false;

	var self = {
		listeners: _events.listeners,
		dispatchEvent: _events.dispatchEvent,
		addEventListener: _events.addEventListener,
		removeEventListener: _events.removeEventListener,
		set dragZone(value) {
			_dragZone = value;
			if(_dragElements) {
				self.item = vars.item;
				_dragZone.addEventListener(MOUSE_DOWN, dragStart);
				_dragZone.addEventListener(TOUCH_START, dragStart);
			} else {
				throw 'you must define the dragElement before the dragZone';
			}
		},
		get dragZone() {
			return _dragZone;
		},
		set dragElements(value) {
			_dragElements = value;
		},
		get dragElements() {
			return _dragElements;
		},
		set threshold(value) {
			_threshold = value;
		},
		get threshold() {
			return _thresholdMet;
		}
	};

	if(_dragElements) {
		_dragZone.addEventListener(MOUSE_DOWN, dragStart);
		_dragZone.addEventListener(TOUCH_START, dragStart);
	} else {
		throw 'you must define a dragElement';
	}

	function dragStart(e) {
		stage.dragElements = _dragElements;
		var i = stage.dragElements.length;
		while(i--) {
			stage.dragElements[i].transition = 0;
			stage.dragElements[i].cancel = false;
			stage.dragElements[i].startX = stage.dragElements[i].x;
			stage.dragElements[i].startY = stage.dragElements[i].y;
			stage.dragElements[i].mouseOffsetX = stage.dragElements[i].parent.globalToLocal({x:getX(e), y:getY(e)}).x - stage.dragElements[i].x;
			stage.dragElements[i].mouseOffsetY = stage.dragElements[i].parent.globalToLocal({x:getX(e), y:getY(e)}).y - stage.dragElements[i].y;

		}
		stage.addEventListener(MOUSE_UP, dragStop);
		stage.addEventListener(TOUCH_END, dragStop);
		stage.addEventListener(MOUSE_MOVE, dragMove);
		stage.addEventListener(TOUCH_MOVE, dragMove);
		stage.addEventListener(TOUCH_CANCEL, dragCancel);
		stage.addEventListener(KEY_DOWN, escapeCheck);
		self.dispatchEvent(DRAG_START, e);
	}

	function dragMove(e) {
		var i = stage.dragElements.length;
		while(i--) {
			stage.dragElements[i].dragging = true;
			if(!stage.dragElements[i].cancel) {
				stage.dragElements[i].alpha = 0.98;
				stage.dragElements[i].x = stage.dragElements[i].parent.globalToLocal({x:getX(e), y:getY(e)}).x - stage.dragElements[i].mouseOffsetX;
				stage.dragElements[i].y = stage.dragElements[i].parent.globalToLocal({x:getX(e), y:getY(e)}).y - stage.dragElements[i].mouseOffsetY;
				stage.dragElements[i].deltaX = stage.dragElements[i].x - stage.dragElements[i].startX;
				stage.dragElements[i].deltaY = stage.dragElements[i].y - stage.dragElements[i].startY;
				_thresholdMet = (Mth.abs(stage.dragElements[i].deltaX) > _threshold || Mth.abs(stage.dragElements[i].deltaY) > _threshold);
			}
		}
		self.dispatchEvent(DRAG_MOVE, e);
	}

	function dragStop(e) {
		stage.removeEventListener(MOUSE_MOVE, dragMove);
		stage.removeEventListener(TOUCH_MOVE, dragMove);
		stage.removeEventListener(MOUSE_UP, dragStop);
		stage.removeEventListener(TOUCH_END, dragStop);
		stage.removeEventListener(TOUCH_CANCEL, dragCancel);
		stage.removeEventListener(KEY_DOWN, escapeCheck);
		var i = stage.dragElements.length;
		while(i--) {
			stage.dragElements[i].dragging = false;
			stage.dragElements[i].alpha = 1;
		}
		self.dispatchEvent(DRAG_STOP, e);
	}

	function escapeCheck(e) {
		if(keyCode[e.keyCode] === ESCAPE) {
			dragCancel(e);
		}
	}

	function dragCancel(e) {
		stage.removeEventListener(MOUSE_MOVE, dragMove);
		stage.removeEventListener(TOUCH_MOVE, dragMove);
		stage.removeEventListener(MOUSE_UP, dragStop);
		stage.removeEventListener(TOUCH_END, dragStop);
		stage.removeEventListener(TOUCH_CANCEL, dragCancel);
		stage.removeEventListener(KEY_DOWN, escapeCheck);
		var i = stage.dragElements.length;
		while(i--) {
			stage.dragElements[i].dragging = false;
			stage.dragElements[i].alpha = 1;
		}
		self.dispatchEvent(DRAG_CANCEL, e);
	}

	return self;
}

function Fullscreen(vars) {

	var self = this;
	self.dxFullscreen = 0;

	vars.events.addEventListener(FULLSCREEN_TOGGLE, toggle);
	vars.events.addEventListener(FULLSCREEN_TOGGLE_ELEMENT, toggleElement);

	document.addEventListener('webkitfullscreenchange', change, false);
	document.addEventListener('mozfullscreenchange', change, false);

	function toggle(event) {
		if (isNotFullscreen()) {
			enterFullscreen(document.body);
		} else {
			exitFullscreen();
		}
	}

	function enterFullscreen (element) {
		self.dxFullscreen = 1;
		if (element.requestFullScreen) {
			element.requestFullScreen();
		} else if (element.mozRequestFullScreen) {
			element.mozRequestFullScreen();
		} else if (element.webkitRequestFullScreen) {
			element.webkitRequestFullScreen();
			element.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
		}
	}

	function exitFullscreen() {
		self.dxFullscreen = 0;
		if (document.cancelFullScreen) {
			document.cancelFullScreen();
		} else if (document.mozCancelFullScreen) {
			document.mozCancelFullScreen();
		} else if (document.webkitCancelFullScreen) {
			document.webkitCancelFullScreen();
		}
	}

	function toggleElement(e) {
		var element = e.fullscreenTarget;
		if (isFullscreen()) {
			exitFullscreen();
		} else {
			enterFullscreen(element);
			/*TO DO show vid controls for FIREFOX
			element.setAttribute("controls", "true");*/
		}
	}

	function change(event) {
		setTimeout(function () {
			self.dxFullscreen = document.isFullScreen | document.mozFullScreen | document.webkitIsFullScreen;
			vars.events.dispatchEvent(RESIZE_END);
		}, 500);
	}

	function isNotFullscreen() {
		return !document.fullscreenElement && !document.mozFullScreenElement && !document.webkitFullscreenElement;
	}
}

function LazyLoader(obj, mask, vars) {

	vars = vars || {};

	var index = 0,
		axisX = 'offsetLeft',
		axisY = 'offsetTop';

	if(vars.property && vars.property === 'translate') {
		axisX = 'translateX';
		axisY = 'translateY';
	}

	var type = vars.type || 'default',
		threshold = 1.5,
		loadBoundary = {
			get x() { return mask.x - ((mask.width * threshold) * 0.5) },
			get y() { return mask.y - ((mask.height * threshold) * 0.5) },
			get width() { return mask.width + (mask.width * threshold) },
			get height() { return mask.height + (mask.height * threshold) }
		},
		isWithinBounds = {
			fade: function(child, i) {
				return i >= index - Math.round(threshold * 0.5) && i <= index + Math.round(threshold * 0.5);
			},
			default: function(child) {
				return obj[axisX] + child.x >= loadBoundary.x &&
					obj[axisX] + child.x <= loadBoundary.width &&
					obj[axisY] + child.y >= loadBoundary.y &&
					obj[axisY] + child.y <= loadBoundary.height;
			}
		};

	function loadProcessor() {
		var i = 0,
			l = obj.children.length;
		for(; i < l; i++) {
			var child = obj.children[i];
			var inBounds = isWithinBounds[type](child, i);
			if(inBounds && !child.loaded) {
				child.load();
			}
		}
	}

	this.update = function update(value) {
		if(value) index = value;
		loadProcessor();
	};

}

var Overlay = (function() {

	function Overlay(content, vars) {

		var self = this;

		var background = new Sprite(),
			parentView = vars.parentView || stage;

		background.alpha = 0;
		background.zIndex = 500;
		background.display = 'none';
		background.backgroundColor = toRgba(vars.backgroundColor || parentView.backgroundColor, vars.alpha || 0.85);

		this.parentView = parentView;
		this.background = background;
		this.content = content;
		this.onClose = vars.onClose;
		this.onOpen = vars.onOpen;
		this.openDuration = vars.openDuration || UPDATE_SPEED;
		this.closeDuration = vars.closeDuration || UPDATE_SPEED;
		this.userOverride = vars.userOverride;
		this.blurLayers = vars.blurLayers;
		this.updateSpeed = 0;

		parentView.addEventListener(RESIZE, this.overlayResize.bind(this));

		this.background.width = this.parentView.width;
		this.background.height = this.parentView.height;

		parentView.addChild(background);
		background.addChild(content);

		if(this.userOverride) {
			background.element.addEventListener(CLICK, function(e) {
				if(self.background.element === e.target) self.close.apply(self, [e]);
			});
			stage.addEventListener(KEY_DOWN, this.keyDown.bind(this));
		}
	}

	Overlay.prototype = {
		open:function() {
			this.background.display = 'block';
			if(this.onOpen) this.onOpen();
			Tween(this.background, this.openDuration, {alpha:1});
			if(this.blurLayers) {
				var i = this.blurLayers.length;
				while(i--) {
					this.blurLayers[i].element.style.webkitFilter = 'blur(3px)';
					this.blurLayers[i].element.style.filter = 'blur(3px)';
				}
			}
		},
		overlayResize:function() {
			this.background.width = this.parentView.width;
			this.background.height = this.parentView.height;
			Align(this.content, this.updateSpeed, {
				hRange:this.parentView.width,
				vRange:this.parentView.height,
				hAlign:'center',
				vAlign:'center'
			});
			this.updateSpeed = UPDATE_SPEED;
		},
		keyDown:function(e) {
			if(e.keyCode === keyName.ESCAPE) this.close();
		},
		close:function(e) {
			Tween(this.background, this.closeDuration, {alpha:0, onComplete:this.onComplete.bind(this)});
			if(this.blurLayers) {
				var i = this.blurLayers.length;
				while(i--) {
					this.blurLayers[i].element.style.webkitFilter = '';
					this.blurLayers[i].element.style.filter = '';
				}
			}
		},
		onComplete:function() {
			this.background.display = 'none';
			if(this.onClose) this.onClose();
		},
		destroy:function(){
			this.background.removeChild(this.content);
			this.parentView.removeChild(this.background);
			this.parentView.removeEventListener(RESIZE, this.overlayResize.bind(this));
			if(this.userOverride) {
				this.background.removeEventListener(CLICK, this.close.bind(this));
				stage.removeEventListener(KEY_DOWN, this.keyDown.bind(this));
			}
		}
	};

	return Overlay;

})();

function alert(message, vars) {

	vars = vars || {};

	var container = new Sprite();
	container.backgroundColor = vars.backgroundColor || theme.bgColorLight;
	container.width = 250;
	container.height = 150;
	container.borderRadius = 4;
	container.overflow = 'hidden';
	container.boxShadow = theme.shadowDark;

	container.addEventListener(CLICK, function(e){
		e.stopPropagation();
	});

	var textField = new Sprite();
	textField.x = 25;
	textField.y = 20;
	textField.fontColor = vars.fontColor || theme.fontColor;
	textField.fontFamily = 'Helvetica Neue, Arial, sans-serif';
	textField.fontSize = 15.5;
	textField.selectable = true;
	textField.text = message;
	textField.textAlign = 'center';

	var okay = new Sprite({type:'button'});

	okay.width = 65;
	okay.height = 40;
	okay.text = 'OK';
	okay.outline = 'none';
	okay.border = 'none';
	okay.fontWeight = 'bold';
	okay.fontSize = theme.fontSize;
	okay.fontColor = theme.fontColor;
	okay.fontFamily = 'Helvetica Neue, Arial, sans-serif';
	okay.backgroundColor = theme.bgColor;

	container.addChild(okay);

	container.addChild(textField);

	var blurLayers = [];

	if(dx && exists(dx, 'site.siteView')) {
		blurLayers = [exists(dx, 'site.siteView')];
	}

	if(dx && exists(dx, 'admin.adminView')) {
		blurLayers = [dx.site.siteView, dx.admin.adminView];
	}

	var overlay = new Overlay(container, {userOverride:vars.userOverride||true, backgroundColor:vars.backgroundColor||'#000000', alpha:vars.alpha||0.5, blurLayers:vars.blurLayers||blurLayers});
	overlay.open();

	okay.addEventListener(MOUSE_OVER, over);
	okay.addEventListener(MOUSE_OUT, out);
	okay.addEventListener(FOCUS, over);
	okay.addEventListener(BLUR, out);

	function over(e) {
		Tween(this, 0.2, {backgroundColor:theme.bgColorLighter, fontColor:theme.fontColorSelected});
	}

	function out(e) {
		Tween(this, 0.2, {backgroundColor:theme.bgColor, fontColor:theme.fontColor});
	}

	okay.addEventListener(CLICK, function(e){
		if(vars.onClose) vars.onClose();
		overlay.close();
	});

	container.width = textField.width + 50;
	textField.width = container.width - 50;
	container.height = textField.height + okay.height + 50;
	okay.width = container.width;
	okay.y = container.height - okay.height - 0;

	overlay.overlayResize();
	okay.focus();

	return overlay;
}

function confirm(message, vars) {

	vars = vars || {};

	var container = new Sprite();
	container.backgroundColor = vars.backgroundColor || theme.bgColorLight;
	container.width = vars.width || 250;
	container.height = 150;
	container.borderRadius = 5;
	container.overflow = 'hidden';
	container.boxShadow = theme.shadowDark;

	container.addEventListener(CLICK, function(e){
		e.stopPropagation();
	});

	var textField = new Sprite();
	textField.x = 25;
	textField.y = 23;
	textField.fontColor = vars.fontColor || theme.fontColor;
	textField.fontFamily = 'Helvetica Neue, Arial, sans-serif';
	textField.fontSize = 15.5;
	textField.selectable = true;
	textField.text = message;
	textField.textAlign = 'center';

	var cancel = new Sprite({type:'button'});
	cancel.width = 65;
	cancel.height = 40;
	cancel.text = 'CANCEL';
	cancel.outline = 'none';
	cancel.border = 'none';
	cancel.fontWeight = 'bold';
	cancel.fontSize = theme.fontSize;
	cancel.fontColor = theme.fontColor;
	cancel.fontFamily = 'Helvetica Neue, Arial, sans-serif';
	cancel.backgroundColor = theme.bgColor;
	container.addChild(cancel);

	var okay = new Sprite({type:'button'});
	okay.width = 65;
	okay.height = 40;
	okay.text = 'OK';
	okay.outline = 'none';
	okay.border = 'none';
	okay.fontWeight = 'bold';
	okay.fontSize = theme.fontSize;
	okay.fontColor = theme.fontColor;
	okay.fontFamily = 'Helvetica Neue, Arial, sans-serif';
	okay.backgroundColor = theme.bgColor;
	container.addChild(okay);

	container.addChild(textField);

	var blurLayers = [dx.site.siteView];

	if(dx && exists(dx, 'admin.adminView')) {
		blurLayers = [dx.site.siteView, dx.admin.adminView];
	}

	var overlay = new Overlay(container, {userOverride:true, backgroundColor:'#000000', alpha:0.5, blurLayers:blurLayers});
	overlay.open();

	cancel.addEventListener(MOUSE_OVER, over);
	cancel.addEventListener(MOUSE_OUT, out);
	okay.addEventListener(MOUSE_OVER, over);
	okay.addEventListener(MOUSE_OUT, out);
	cancel.addEventListener(FOCUS, focus);
	cancel.addEventListener(BLUR, blur);
	okay.addEventListener(FOCUS, focus);
	okay.addEventListener(BLUR, blur);

	function focus(e) {
		Tween(this, 0.2, {backgroundColor:theme.bgColorLighter, fontColor:theme.fontColorSelected});
	}

	function blur(e) {
		out.call(this);
	}

	function over(e) {
		if(stage.activeFocus) {
			out.call(stage.activeFocus);
			stage.activeFocus.blur();
		}
		Tween(this, 0.2, {backgroundColor:theme.bgColorLighter, fontColor:theme.fontColorSelected});
	}

	function out(e) {
		Tween(this, 0.2, {backgroundColor:theme.bgColor, fontColor:theme.fontColor});
	}

	cancel.addEventListener(CLICK, function(e){
		if(vars.onCancel) vars.onCancel();
		overlay.close();
	});

	okay.addEventListener(CLICK, function(e){
		if(vars.onConfirm) vars.onConfirm();
		overlay.close();
	});

	container.width = textField.width + 50;
	textField.width = container.width - 50;
	container.height = textField.height + cancel.height + okay.height + 50;
	cancel.width = container.width;
	cancel.y = container.height - cancel.height - okay.height;
	okay.width = container.width;
	okay.y = container.height - okay.height - 0;

	overlay.overlayResize();

	okay.focus();

	return overlay;
}

function password(vars) {

	var self = new Sprite({events:vars.events}),
		passWidth = 272,
		passHeight = 47,
		inputField,
		password,
		background,
		submit,
		overlay;

	self.updateSpeed = 0;

	self.addEventListener(CHILD_ADDED, function(child) {
	});

	function build() {
		self.width = passWidth;
		self.height = passHeight;

		background = new Sprite();
		background.backgroundColor = LAYOUT_MODEL.overlayColor;
		background.width = passWidth;
		background.height = passHeight;

		inputField = new Input();
		inputField.backgroundColor = LAYOUT_MODEL.contactFieldRectColor;
		inputField.fontFamily = LAYOUT_MODEL.contactFont;
		inputField.fontColor = LAYOUT_MODEL.contactFontColor;
		inputField.fontSize = 12;
		inputField.width = 170;
		inputField.height = 23;
		inputField.x = 10;
		inputField.y = (passHeight - inputField.height) * 0.5;
		inputField.paddingLeft = 3;
		inputField.addEventListener(FOCUS, onInputFieldFocus);
		inputField.addEventListener(BLUR, onInputFieldBlur);
		inputField.element.addEventListener(CLICK, function(e){e.stopPropagation();});
		inputField.element.tabIndex = 1;
		self.setMessage('PASSWORD');

		submit = new Button();
		submit.text = 'SUBMIT';
		submit.x = inputField.x + inputField.width + 10;
		submit.y = inputField.y;
		submit.height = 23;
		submit.width = 70;
		submit.fontSize = 12;
		submit.fontFamily = LAYOUT_MODEL.contactFont;
		submit.fontColor = LAYOUT_MODEL.contactFontColor;
		submit.backgroundColor = LAYOUT_MODEL.contactFieldRectColor;

		self.addChild(background);
		self.addChild(inputField);
		self.addChild(submit);

		var blurLayers = dx && exists(dx, 'admin.adminView') ? [dx.site.siteView, dx.admin.adminView] : [dx.site.siteView];
		
		overlay = new Overlay(self, {userOverride:true, backgroundColor:'#000000', alpha:0.5, blurLayers:blurLayers});
		self.open();

		overlay.overlayResize();
	};

	function onKeyUp(e) {
		if(e.keyCode === 13) {
			onSubmit(e);
		}
	}

	function onSubmit(e) {
		self.events.dispatchEvent('passwordViewAuthCheck', inputField.value);
	}

	function onInputFieldBlur(e) {
		if(inputField.value === "") {
			self.setMessage('PASSWORD');
		}
	}

	function onInputFieldFocus(e) {
		inputField.value = "";
	}

	self.updatePosition = function(e) {
		Tween(self, self.updateSpeed, {x:layoutCalcs.mediaView.x() + ((layoutCalcs.mediaView.width() - passWidth) * 0.5), y:layoutCalcs.mediaView.y() + (layoutCalcs.mediaView.height() - passHeight) * 0.5});
		self.updateSpeed = UPDATE_SPEED;
	};

	self.close = function () {
		stage.removeEventListener(KEY_UP, onKeyUp);
		submit.removeEventListener(CLICK, onSubmit);
		overlay.close();
	};

	self.setMessage = function(msg) {
		inputField.value = msg;
	};

	self.open = function() {
		overlay.open();
		setTimeout(function() {
			stage.addEventListener(KEY_UP, onKeyUp);
			submit.addEventListener(CLICK, onSubmit);
		}, 100);
	};

	build();

	return self;
}

function Resize(obj, duration, vars) {
	var resizeVars = vars;
	var scale = new ScaleEngine({type:vars.type, hRange:vars.hRange, vRange:vars.vRange, width:vars.width || obj.width, height:vars.height || obj.height});
	var align = new AlignEngine({hRange:vars.hRange, vRange:vars.vRange, hAlign:vars.hAlign, vAlign:vars.vAlign, width:scale.width, height:scale.height});
	var tweenVars = {
		x:Mth.round(align.x),
		y:Mth.round(align.y),
		width:scale.width,
		height:scale.height,
		onComplete:vars.onComplete,
		onCompleteParams:vars.onCompleteParams,
		onCompleteScope:vars.onCompleteScope,
		onUpdate:vars.onUpdate,
		onUpdateParams:vars.onUpdateParams,
		onUpdateScope:vars.onUpdateScope,
		onInit:vars.onInit,
		onInitScope:vars.onInitScope,
		onInitParams:vars.onInitParams
	}
	if(vars.onComplete) tweenVars.onComplete = vars.onComplete;
	Tween(obj, duration, tweenVars);
	return {scale:scale, align:align};
}

function RetinaResizeEngine(vars) {

	var width = vars.width,
		height = vars.height,
		scaleFactor = getScaleFactor(vars.filename);

	function getScaleFactor(str) {
		var matches = str.match(/[@]([0-9]*\.?[0-9]+)?[x]/i);
		if(matches) return Number(matches[1]);
		return 1;
	}

	return {width: Math.round(width / scaleFactor), height: Math.round(height / scaleFactor)};
}

function Scale(obj, duration, vars) {
	var scale = ScaleEngine({
		type:vars.type,
		hRange:vars.hRange,
		vRange:vars.vRange,
		width:vars.width || obj.width,
		height:vars.height || obj.height,
		disableOrientationCheck:vars.disableOrientationCheck || false
	});
	var tweenVars = {
		width:Mth.round(scale.width),
		height:Mth.round(scale.height),
		onComplete:vars.onComplete,
		onCompleteParams:vars.onCompleteParams,
		onCompleteScope:vars.onCompleteScope,
		onUpdate:vars.onUpdate,
		onUpdateParams:vars.onUpdateParams,
		onUpdateScope:vars.onUpdateScope,
		onInit:vars.onInit,
		onInitScope:vars.onInitScope,
		onInitParams:vars.onInitParams
	}
	if(vars.onComplete) tweenVars.onComplete = vars.onComplete;
	Tween(obj, duration, tweenVars);
	return scale;
}

function ScaleEngine(vars) {

	vars = vars || {};

	var _type = vars.type || 'fit',
		_disableOrientationCheck = vars.disableOrientationCheck || false,
		_hRange = vars.hRange || 0,
		_vRange = vars.vRange || 0,
		_width = vars.width || 0,
		_height = vars.height || 0,
		_ratio = -1,
		_rangeRatio = -1;

	function isCrop() {
		_rangeRatio = _hRange / _vRange;
		if(_type === 'fit' || _type === 'native') return _rangeRatio < _ratio;
		return _rangeRatio > _ratio;
	}

	function calc() {
		_ratio = _width / _height;
		orientationOverride();
		if(isCrop()) {
			_width = _hRange;
			_height = _hRange / _ratio;
		} else {
			_width = _vRange * _ratio;
			_height = _vRange;
		}
		if(vars.type === 'native') {
			if(vars.width < _hRange && vars.height < _vRange) {
				_width = vars.width;
				_height = vars.height;
			}
		}
	}

	function orientationOverride() {
		if(!orientationMatch(_width, _height, _hRange, _vRange) && !isSquare(_width, _height)) _type = 'fit';
	}

	function orientationMatch(width, height, maskWidth, maskHeight) {
		return isHorizontal(width, height) === isHorizontal(maskWidth, maskHeight);
	}

	function isHorizontal(width, height) {
		return width > height;
	}

	function isSquare(width, height) {
		return width === height;
	}

	return {
		set hRange(value) {
			_hRange = value;
		},
		set vRange(value) {
			_vRange = value;
		},
		set type(value) {
			_type = value;
		},
		get type() {
			return _type;
		},
		set width(value) {
			_width = value;
		},
		set height(value) {
			_height = value;
		},
		get width() {
			calc();
			return _width;
		},
		get height() {
			calc();
			return _height;
		}
	}
}

var Scrolls = {

	arr: [],

	focusTarget:null,

	register: function(scroll) {
		this.arr.push(scroll);
	},

	unRegister: function(scroll) {
		var i = this.arr.length;
		while(i--) {
			if(scroll === this.arr[i]) {
				this.arr.splice(i, 1);
			}
		}
	},

	resize: function() {
		if(this.arr.length > 0) {
			var i = this.arr.length;
			while(i--) {
				this.arr[i].resize();
			}
		}
	},

	setActive: function(scroll) {
		var i = this.arr.length;
		while(i--) {
			this.arr[i].active = (scroll === this.arr[i]);
		}
	},

	hitMask: function(x, y) {
		var i = this.arr.length;
		while(i--) {
			this.arr[i].active = this.arr[i].mask.hitTestPoint(x, y);
		}
	},

	hitScrollBar: function(x, y) {
		var i = this.arr.length;
		while(i--) {
			if(this.arr[i].bar && this.arr[i].bar.handle.hitTestAbs(x, y)) {
				return this.arr[i].bar.back.hitTestAbs(x, y);
			}
		}
		return false;
	},

	get ing() {
		var i = this.arr.length;
		while(i--) {
			if(this.arr[i].ing) {
				return this.arr[i].ing;
			}
		}
		return false;
	}

};

function Scroll(obj, mask, vars) {

	vars.events = vars.events || globalEvents;

	var _percent = 0,
		_position = 0,
		_scrollDist = 0,
		_scrolling = false,
		_scrollTimer,
		_startup = true;

	var scroll = {
		obj: obj,
		mask: mask,
		listeners: vars.events.listeners,
		dispatchEvent: vars.events.dispatchEvent,
		addEventListener: vars.events.addEventListener,
		removeEventListener: vars.events.removeEventListener,
		types: vars.types || ['bar','wheel','touch'],
		axis: vars.axis || 'y',
		align: vars.align || 'center',
		margin: vars.margin || 0,
		maxTime: vars.maxTime || 300,
		minTime: vars.minTime || 1,
		maxSpeed: vars.maxSpeed || 500,
		minSpeed: vars.minSpeed || 5,
		color: vars.color || '#00FF00',
		hover: vars.hover || '#FF0000',
		zIndex: vars.zIndex,
		side: vars.side || 'right',
		offsetX: vars.offsetX || 0,
		offsetY: vars.offsetY || 0,
		topPad:vars.topPad || 0,
		parent: vars.parent || mask.parent,
		width: vars.width || 7,
		property: vars.property,
		scrollTopCheck: vars.scrollTopCheck,
		get percent(){
			return _percent;
		},
		set percent(value){
			value = value < 0 ? 0 : value;
			value = value > 1 ? 1 : value;
			_percent = value;
		},
		get position(){
			return _position;
		},
		set position(value){
			_position = value;
		},
		get scrollDist(){
			return _scrollDist;
		},
		set scrollDist(value){
			_scrollDist = value;
		},
		get ing(){
			return _scrolling;
		},
		set ing(value){
			_scrolling = value;
		}
	};

	scroll.perpAxis = vars.axis === 'x' ? 'y' : 'x';
	scroll.dim = vars.axis === 'x' ? 'width' : 'height';
	scroll.perpDim = vars.axis === 'x' ? 'height' : 'width';

	scroll.alpha = !isNaN(vars.alpha) ? vars.alpha : 0.35;

	var scrollStart = false;
	var offsetDim = scroll.dim === 'width' ? 'offsetWidth' : 'offsetHeight';

	scroll.alignment = function() {
		switch(scroll.align) {
			case 'middle':
			case 'center':
				return 0.5;
			case 'right':
			case 'bottom':
				return 1;
			default:
				return 0;
		}
	};

	scroll.scrollTo = function(value) {
		if(scroll.bar) {
			scroll.bar.scrollTo(value, 0);
		}
	};

	function alignCaptionScroll(objSize, maskSize) {
		if(objSize > maskSize) {
			if(!scroll.alignSave) {
				scroll.alignSave = scroll.align;
				scroll.align = scroll.dim === 'width' ? 'left' : 'top';
				_percent = scroll.alignment();
			}
		} else {
			if(scroll.alignSave) {
				scroll.align = scroll.alignSave;
				delete scroll.alignSave;
			}
			_percent = scroll.alignment();
		}
	}

	function resetScrollPercent(objSize, maskSize) {
		if(objSize < maskSize) {	
			_percent = scroll.alignment();
		}
	}

	scroll.update = function(speed, accel, resize) {
		if(!scrollStart) {
			scrollStart = true;
			if(!resize) scroll.dispatchEvent('scrollStart');
		}

		var objDim = this.obj.element[offsetDim],
			maskDim = this.mask.element[offsetDim],
			objSize = scroll.margin + objDim + scroll.margin;
		
		_scrollDist = (this.margin + objDim + this.margin) - maskDim;

		if(scroll.captionScroll) {
			alignCaptionScroll(objSize, maskDim);
		} else {
			resetScrollPercent(objSize, maskDim);
		}

		_position = -(_scrollDist * _percent) + this.margin;
		var tweenVars = {};

		if(scroll.property === 'translate') {
			tweenVars['translate' + vars.axis.toUpperCase()] = Mth.round(_position);
			if(accel) this.obj['translate' + vars.axis.toUpperCase()] = _position + 0.1;
		} else {
			tweenVars[vars.axis] = Mth.round(_position);
			if(accel) this.obj[this.axis] = _position + 0.1;
		}
		tweenVars.ease = 'cubic-bezier(0.5, 0.5, 0.5, 0.8)';
		if(scroll.hvr) {
			tweenVars.onUpdate = function() {
				scroll.dispatchEvent(SCROLL);
			};
		}
		Tween(obj, speed, tweenVars);

		if(scroll.bar) {
			scroll.bar.moveHandle(speed);
		}

		clearTimeout(_scrollTimer);
		_scrollTimer = setTimeout(function(){
			if(!_startup) scroll.dispatchEvent('scrollStop');
			scrollStart = false;
			if(scroll.bar) {
				scroll.bar.resize();
			}
			_startup = false;
		}, 200);
	};

	scroll.resize = function(speed) {
		scroll.update(speed || 0, false, true);
		if(scroll.bar) {
			scroll.bar.resize();
		}
	};

	scroll.destroy = function() {
		if(scroll.bar) {
			scroll.bar.destroy();
		}
		if(scroll.wheel) {
			scroll.wheel.destroy();
		}
		if(scroll.hvr) {
			scroll.hvr.destroy();
		}
		if(scroll.touch) {
			scroll.touch.destroy();
		}
	};

	scroll.hide = function() {
		if(scroll.bar) {
			scroll.bar.hide();
			scroll.bar.checkVisible();
		}
	};

	scroll.show = function() {
		if(scroll.bar) {
			scroll.bar.show();
			scroll.bar.checkVisible();
		}
	};

	scroll.setAlpha = function(value) {
		if(scroll.bar) {
			scroll.bar.setAlpha(value);
		}
	};

	scroll.getBack = function() {
		if(scroll.bar) {
			return scroll.bar.getBack();
		}
		return null;
	};

	function buildBehaviors() {
		var i = vars.types.length;
		while(i--) {
			switch (vars.types[i]) {
				case 'bar':
					scroll.bar = new ScrollBar(scroll);
					break;
				case 'wheel':
					scroll.wheel = new ScrollWheel(scroll);
					break;
				case 'hover':
					scroll.hvr = new ScrollHover(scroll);
					break;
				case 'touch':
					scroll.touch = new ScrollTouch(scroll);
					break;
			}
		}
	}

	buildBehaviors();
	scroll.resize();
	scroll.update();
	Scrolls.register(scroll);

	return scroll;
}

function ScrollBar(scroll) {

	var obj = scroll.obj,
		mask = scroll.mask,
		moveDist = 0,
		startPoint = 0,
		visible = true;

	var back = this.back = new Sprite();
	back.alpha = 0;
	back.selectable = true;
	back.backgroundColor = scroll.color;
	if(scroll.zIndex) back.zIndex = scroll.zIndex;
	scroll.parent.addChild(back);

	var handle = this.handle = new Sprite();
	handle.alpha = 0;
	handle.backgroundColor = scroll.color;
	if(scroll.zIndex) handle.zIndex = scroll.zIndex;
	handle.selectable = false;
	handle.cursor = 'default';
	handle.style.pointerEvents = 'auto';
	scroll.parent.addChild(handle);

	handle.addEventListener(MOUSE_OVER, onMouseOver);
	handle.addEventListener(MOUSE_OUT, onMouseOut);
	handle.addEventListener(MOUSE_DOWN, onMouseDown);
	handle.addEventListener(TOUCH_START, onMouseDown);

	this.moveHandle = function(speed) {
		handle.transition = speed || 0;
		handle[scroll.axis] = ((back[scroll.dim] - handle[scroll.dim]) * scroll.percent) + back[scroll.axis];
	};

	this.resize = function() {
		back.transition = UPDATE_SPEED;
		handle.transition = UPDATE_SPEED;

		back[scroll.perpDim] = scroll.width;
		back[scroll.dim] = mask[scroll.dim];
		if(scroll.parent === mask) {
			back[scroll.axis] = getOffset();
		} else {
			back[scroll.axis] = mask[scroll.axis] + getOffset();
		}

		handle[scroll.perpDim] = scroll.width;

		if(scroll.side === 'left' || scroll.side === 'top') {
			back[scroll.perpAxis] = mask[scroll.perpAxis] - scroll.width + getPerpOffset();
			handle[scroll.perpAxis] = mask[scroll.perpAxis] - scroll.width + getPerpOffset();
		} else {
			back[scroll.perpAxis] = mask[scroll.perpAxis] + mask[scroll.perpDim] + getPerpOffset();
			handle[scroll.perpAxis] = mask[scroll.perpAxis] + mask[scroll.perpDim] + getPerpOffset();
		}

		this.moveHandle(UPDATE_SPEED);

		setTimeout(this.checkVisible, 0);
	};

	this.checkVisible = function() {
		back.style['transition'] = 'opacity 750ms';
		handle.style['transition'] = 'opacity 750ms';
		var offsetDim = 'offset' + scroll.dim[0].toUpperCase() + scroll.dim.substr(1),
			maskScrollDim = mask.element[offsetDim];
		var handleSize = (maskScrollDim / (obj.element[offsetDim] + (scroll.margin * 2))) * maskScrollDim;
		if(handleSize < back[scroll.dim] && visible) {
			back.display = 'block';
			back.alpha = scroll.alpha;
			handle.display = 'block';
			handle.alpha = 1;
			handle[scroll.dim] = handleSize;
		} else if(!isNaN(handleSize)) {
			back.alpha = 0;
			back.display = 'none';
			handle.alpha = 0;
			handle.display = 'none';
			handle[scroll.dim] = back[scroll.dim];
			this.scrollTo(0, 0);
		}
	};

	this.destroy = function() {
		scroll.parent.removeChild(handle);
		scroll.parent.removeChild(back);
		handle.removeEventListener(MOUSE_OVER, onMouseOver);
		handle.removeEventListener(MOUSE_OUT, onMouseOut);
		handle.removeEventListener(MOUSE_DOWN, onMouseDown);
		handle.removeEventListener(TOUCH_START, onMouseDown);
	};

	this.setAlpha = function(value) {
		handle.alpha = back.alpha = value;
	};

	this.getBack = function() {
		return back;
	};

	this.scrollTo = function(value) {
		/*scroll.percent = value;
		scroll.update(0);
		scroll.dispatchEvent(SCROLL);*/
	};

	this.hide = function() {
		visible = false;
	};

	this.show = function() {
		visible = true;
	};

	function onMouseOver(e) {
		Tween(handle, 0.35, {backgroundColor:scroll.hover});
	}

	function onMouseOut(e) {
		if(!scroll.ing) {
			Tween(handle, 0.35, {backgroundColor:scroll.color});
		}
	}

	function onMouseDown(e) {
		Tween(handle, 0.35, {backgroundColor:scroll.hover});
		startPoint = getPoint(e) - back[scroll.axis] - handle[scroll.axis];
		stage.addEventListener(MOUSE_UP, onMouseUp, false);
		stage.addEventListener(MOUSE_MOVE, onMouseMove, false);
		stage.addEventListener(TOUCH_END, onMouseUp, false);
		stage.addEventListener(TOUCH_MOVE, onMouseMove, false);
	}

	function onMouseMove(e) {
		if(scroll.ing === false) {
			scroll.ing = true;
			e.preventDefault();
		}
		moveDist = getPoint(e) - startPoint - back[scroll.axis];
		scroll.percent = (moveDist - back[scroll.axis]) / (back[scroll.dim] - handle[scroll.dim]);
		scroll.update(0);
		scroll.dispatchEvent(SCROLL);
	}

	function onMouseUp(event) {
		setTimeout(function(){
			scroll.ing = false;
		}, 10);
		Tween(handle, 0.35, {backgroundColor:scroll.color});
		stage.removeEventListener(MOUSE_MOVE, onMouseMove);
		stage.removeEventListener(MOUSE_UP, onMouseUp);
		stage.removeEventListener(TOUCH_END, onMouseUp, false);
		stage.removeEventListener(TOUCH_MOVE, onMouseMove, false);
	}

	function getPoint(e) {
		if(scroll.axis === 'x') {
			return getX(e);
		}
		return getY(e);
	}

	function getOffset() {
		if(scroll.axis === 'x') {
			return scroll.offsetX;
		}
		return scroll.offsetY;
	}

	function getPerpOffset() {
		if(scroll.axis === 'y') {
			return scroll.offsetX;
		}
		return scroll.offsetY;
	}

}

function ScrollTouch(scroll) {

	var startPoint = 0,
		startPercent = 0,
		moveDist = 0;

	scroll.mask.addEventListener(TOUCH_START, onStart);

	if(isAppleMobile() && scroll.scrollTopCheck) window.addEventListener('scroll', windowScrollTop);

	function windowScrollTop(e) {
		if(scroll.active && !scroll.ing) scroll.dispatchEvent('WINDOW_SCROLL_TOP');
	}

	function onStart(e) {
		Scrolls.setActive(scroll);
		startPoint = getPoint(e);
		startPercent = scroll.percent || 0;
		scroll.mask.addEventListener(TOUCH_END, onEnd);
		scroll.mask.addEventListener(TOUCH_MOVE, onMove);
	}

	function onMove(e) {
		if(scroll.ing === false) {
			scroll.ing = true;
			if(isAppleMobile()) window.scrollTo(0, 1);
			e.preventDefault();
		}
		moveDist = getPoint(e) - startPoint;
		scroll.percent = -(moveDist / (scroll.scrollDist)) + startPercent;
		scroll.percent = scroll.percent < 0 ? 0 : scroll.percent;
		scroll.percent = scroll.percent > 1 ? 1 : scroll.percent;
		scroll.update(0);
		scroll.dispatchEvent(SCROLL);
	}

	function getPoint(e) {
		if(scroll.axis === 'x') {
			return TOUCH_DEVICE ? event.touches[0].pageX : event.clientX;
		}
		return TOUCH_DEVICE ? event.touches[0].pageY : event.clientY;
	}

	function onEnd(e) {
		scroll.ing = false;
		scroll.mask.removeEventListener(TOUCH_END, onEnd);
		scroll.mask.removeEventListener(TOUCH_MOVE, onMove);
	}

	this.destroy = function() {
		if(startPoint) {
			scroll.ing = false;
			scroll.mask.removeEventListener(TOUCH_END, onEnd);
			scroll.mask.removeEventListener(TOUCH_MOVE, onMove);
		}
	};
}

function ScrollWheel(scroll) {
	var mask = scroll.mask,
		self = this,
		listenersAdded = false;

	scroll.active = false;

	mask.addEventListener(MOUSE_OVER, addWheelListener);
	mask.addEventListener(MOUSE_OUT, removeWheelListener);

	function addWheelListener() {
		listenersAdded = true;
		Scrolls.focusTarget = self;
		stage.addEventListener(WHEEL, onMouseWheel);
		stage.addEventListener(MOUSE_WHEEL, onMouseWheel);
	}

	function removeWheelListener() {
		listenersAdded = false;
		stage.removeEventListener(WHEEL, onMouseWheel);
		stage.removeEventListener(MOUSE_WHEEL, onMouseWheel);
	}

	function onMouseWheel(e) {
		if(scroll.active) {
			e.preventDefault();
			var delta = scroll.axis === 'x' ? e.deltaX : e.deltaY;
			update(delta);
		}
	}

	function update(delta) {
		delta = scroll.align === 'bottom' ? delta = -delta : delta;
		if(isNaN(scroll.percent)) scroll.percent = 0;
		var offsetDim = 'offset' + scroll.dim[0].toUpperCase() + scroll.dim.substr(1),
			_scrollDist = (scroll.margin + scroll.obj.element[offsetDim] + scroll.margin) - scroll.mask.element[offsetDim],
			newPosition = scroll.percent + (delta / _scrollDist);
		scroll.percent = newPosition < 0 ? 0 : newPosition;
		scroll.percent = newPosition > 1 ? 1 : newPosition;

		scroll.update(0);
		scroll.dispatchEvent(SCROLL);
	}

	this.destroy = function() {
		mask.removeEventListener(MOUSE_OVER, addWheelListener);
		if(listenersAdded) {
			removeWheelListener();
		}
	};
}

function ScrollHover(scroll) {
	var self = this,
		percent = 0,
		weightedTime = 0,
		num = 0,
		hoverTimer,
		hovering = false;

	self.enabled = true;

	self.destroy = remove;

	scroll.mask.addEventListener(MOUSE_OVER, add);

	function add() {
		scroll.mask.addEventListener(MOUSE_MOVE, update);
		stage.addEventListener(MOUSE_MOVE, hoverCheck);
	}

	function hoverCheck(e) {
		if(scroll.mask.hitTestPoint(getX(e), getY(e))) {
			hovering = true;
		} else if(hovering) {
			hovering = false;
			remove();
		}
	}

	function remove() {
		clearTimeout(hoverTimer);
		scroll.mask.removeEventListener(MOUSE_MOVE, update);
		stage.removeEventListener(MOUSE_MOVE, hoverCheck);
	}

	function update(e) {
		if(self.enabled) {
			hoverTimer = setTimeout(function() {
				var mousePoint = scroll.axis === 'x' ? e.mouseX : e.mouseY,
					offsetDim = 'offset' + scroll.dim[0].toUpperCase() + scroll.dim.substr(1);
				percent = mousePoint / scroll.mask.element[offsetDim];

				if(percent === 0 && mousePoint > scroll.mask.element[offsetDim] * 0.5) {
					percent = 0.98;
				} else if (percent === 0 && mousePoint < scroll.mask.element[offsetDim] * 0.5) {
					percent = 0.15;
				}
				scroll.percent = percent > 0.5 ? 1 : 0;

				var destination = scroll.position;
				var currentPosition = scroll.obj._private[scroll.axis];
				var distance = Math.abs(destination - currentPosition);

				var time = Math.abs(distance) / scroll.maxSpeed;
				weightedTime += (time - weightedTime) * 0.10;
				weightedTime += (ease() - weightedTime) * 0.10;
				scroll.update(weightedTime, true);
				scroll.dispatchEvent(SCROLL);

				if(!hovering) {
					var pos,
						tweenVars = {};

					if(scroll.axis === 'x') {
						pos = scroll.obj.element.offsetLeft;
					} else {
						pos = scroll.obj.element.offsetTop;
					}

					tweenVars[scroll.axis] = Mth.round(pos);
					Tween(scroll.obj, 1, tweenVars);
				}
			}, 50);
		}
	}

	function ease() {
		var half = percent < 0.5 ? percent * 2 : (percent * -2) + 2;
		return Math.round((Math.pow(half, 5) * scroll.maxSpeed) + scroll.minSpeed);
	}

	return self;

}

function Sort(vars) {

	var _events = new EventSandbox(),
		_dragElements,
		_disabled = false,
		_timer;

	var self = {
		isDragging:false,
		group:vars.group,
		zoneSize:vars.zoneSize||0.5,
		listeners:_events.listeners,
		dispatchEvent:_events.dispatchEvent,
		addEventListener:_events.addEventListener,
		removeEventListener:_events.removeEventListener,
		dragGroup:[],
		get disabled() {
			return _disabled;
		},
		set disabled(value) {
			_disabled = value;
		}
	};

	self.direction = '';
	self.startIndex = 0;

	function sort(e) {
		var i,
			mouse = {x:getX(e), y:getY(e)},
			length = self.group.length;
		for(i = 0; i < length; i++) {
			if(this.indexOf(self.group[i]) === -1 && self.group[i].hitTestAbs(mouse.x, mouse.y)) {
				dispatchReorder(getDragIndex(i), e);
				break;
			}
		}
	}

	function dispatchReorder(newPos, e) {
		if(newPos !== self.stopIndex) {
			self.sorted = true;
			self.dragGroup = getDragGroup(self.group);
			spliceDragGroup(newPos);
			e.group = self.group;
			e.stopIndex = self.stopIndex;
			self.dispatchEvent(REORDER_MOVE, e);
		}
	}

	function getDragIndex(i) {
		return self.group.indexOf(_dragElements[0]) < i ? i - (_dragElements.length - 1) : i;
	}

	function getDragGroup(arr) {
		var group = [];
		var i = arr.length;
		while(i--) {
			if(_dragElements && _dragElements.indexOf(arr[i]) > -1) {
				var item = arr.splice(i, 1)[0];
				group.push(item);
			}
		}
		return group;
	}

	function spliceDragGroup(to) {
		self.stopIndex = to;
		var insertPoint = to;
		var i = self.dragGroup.length;
		while(i--) {
			self.group.splice(insertPoint, 0, self.dragGroup[i]);
			insertPoint++;
		}
	}

	function dragStart(e) {
		_dragElements = this.dragElements;
		self.startIndex = this.dragElements[0].startIndex;
		self.dispatchEvent(REORDER_START, e);
		setZindex();
	}

	function dragMove(e) {
		var ths = this;
		self.isDragging = true;
		if(!_disabled) {
			if(_timer) clearTimeout(_timer);
			_timer = setTimeout(function(){
				sort.apply(ths.dragElements, [e]);
			}, 80);
		}
	}

	function dragStop(e) {
		if(self.isDragging && self.sorted) {
			self.direction = self.startIndex < self.stopIndex  ? 'forward' : 'backward';
			self.startIndex = self.startIndex;
			if(_dragElements) _dragElements[0].stopIndex = self.stopIndex;
			self.dispatchEvent(REORDER_STOP, {dragElements:_dragElements, stopIndex:self.stopIndex});
			self.isDragging = false;
			self.sorted = false;
			self.update();
		}
	}

	function setZindex() {
		var i = self.group.length;
		while(i--) {
			var item = self.group[i];
			if(_dragElements.indexOf(item) === -1) {
				item.zIndex = 2;
			} else {
				item.zIndex = 3;
			}
		}
	}

	self.update = function() {
		var i = self.group.length;
		while(i--) {
			var item = self.group[i];
			item.startIndex = i;
			if(item.drag && item.drag.dragElements) {
				item.drag.addEventListener(DRAG_START, dragStart);
				item.drag.addEventListener(DRAG_MOVE, dragMove);
				item.drag.addEventListener(DRAG_STOP, dragStop);
			}
		}
	};

	return self;
}

function Tile(vars) {

	vars = vars || {};

	var self = this,
		items = [],
		col,
		row,
		colHeights = [],
		rowWidths = [];

	self.axis = vars.axis || 'y';
	self.perpLength = vars.perpLength || 300;
	self.align = vars.align || 'left';
	self.wrap = vars.wrap || true;
	self.gap = vars.gap || 0;
	self.width = 0;
	self.height = 0;

	self.layoutItems = function() {

		col = 0;
		row = 0;
		colHeights = [];
		rowWidths = [];

		var i = 0,
			l = items.length,
			minCol,
			minRow;

		for(i; i < l; i++) {

			incrementGridArrays(i);

			if(!colHeights[col]) colHeights[col] = 0;
			if(!rowWidths[row]) rowWidths[row] = 0;

			minCol = self.axis === 'y' ? minIndex(col, colHeights) : col;
			minRow = self.axis === 'y' ? row : minIndex(row, rowWidths);

			if(minRow !== 0) colHeights[minCol] += self.gap;
			if(minCol !== 0) rowWidths[minRow] += self.gap;

			items[i].x = setX('x', items[i].width, minCol, minRow);
			items[i].y = setY('y', items[i].height, minCol, minRow);

			colHeights[minCol] += items[i].height;
			rowWidths[minRow] += items[i].width;

		}

		self.width = maxBound(rowWidths);
		self.height = maxBound(colHeights);
	};

	self.addItem = function(width, height) {
		items.push({width:width, height:height, x:0, y:0});
	};

	self.setSize = function(index, width, height) {
		items[index].width = width;
		items[index].height = height;
	};

	self.getPosition = function(index) {
		return items[index];
	};

	self.getBounds = function() {
		return {width:self.width, height:self.height};
	};

	function setX(axis, dim, minCol, minRow) {
		if(self.wrap) {
			return self.axis === 'y' ? minCol * (dim + self.gap) : rowWidths[minRow];
		} else {
			return alignPointNoWrap(axis, dim, rowWidths, minRow);
		}
	}

	function setY(axis, dim, minCol, minRow) {
		if(self.wrap) {
			return self.axis === 'y' ? colHeights[minCol] : minRow * (dim + self.gap);
		} else {
			return alignPointNoWrap(axis, dim, colHeights, minCol);
		}
	}

	function alignPointNoWrap(axis, dim, axisArr, index) {
		if((axis === 'x' && self.align === 'center') || (axis === 'y' && self.align === 'middle')) {
			return (self.perpLength - dim) * 0.5;
		} else if((axis === 'x' && self.align === 'right') || (axis === 'y' && self.align === 'bottom')) {
			return (self.perpLength - dim);
		} else {
			return axisArr[index];
		}
	}

	function incrementGridArrays(i) {
		if(self.axis === 'y') {
			if(!self.wrap || rowWidths[row] + items[i].width > self.perpLength) {
				row += 1;
			}
			if(self.wrap && rowWidths[row] + items[i].width < self.perpLength) {
				col += 1;
			} else {
				col = 0;
			}
		} else {
			if(!self.wrap || colHeights[col] + items[i].height > self.perpLength) {
				col += 1;
			}
			if(self.wrap && colHeights[col] + items[i].height < self.perpLength) {
				row += 1;
			} else {
				row = 0;
			}
		}
	}

	function minIndex(index, arr) {
		var i = arr.length,
			min = arr[0];
		while(i--) {
			if(arr[i] <= min) {
				min = arr[i];
				index = i;
			}
		}
		return index;
	}

	function maxBound(arr) {
		var i = arr.length,
			max = 0;
		while(i--) {
			if(arr[i] > max) max = arr[i];
		}
		return max;
	}
}

function Timer(callback, duration, vars) {

	var vars = vars || {},
	scope = vars.scope || arguments.callee.caller || this,
	count = vars.count || 1,
	params = vars.params || [],
	loop = vars.loop || false,
	paused = true,
	duration = (duration * 1000),
	iterations = 0,
	rAF,
	startTime;

	function step() {
		currentTime = performance.now();
		var elapsed = currentTime - startTime;
		if(durationIsComplete(elapsed) && !paused) onComplete();
	}

	function onComplete() {
		callback.apply(scope, params);
		startTime = performance.now();
		iterations++;
	}

	function durationIsComplete(elapsed) {
		/*4 ms padding to elapsed (-2ms over duration or 2ms from duration)*/
		var tolerance = 2,
			timeRemaining = duration - elapsed;
		/*check if timeRemaining meets duration threshold to return durationIsComplete true*/
		if(timeRemaining < tolerance && timeRemaining > -tolerance) {
			return true;
		/*check if timeRemaining over shot duration threshold*/
		} else if(timeRemaining < -tolerance) {
			/*console.log('timer missed by', timeRemaining);*/
			return true;
		}
		return false;
	}

	function loopCheck() {
		if(loop && !paused) {
			step();
			rAF = requestAnimationFrame(loopCheck);
		} else if(!loop) {
			if(iterations < count) {
				step();
				rAF = requestAnimationFrame(loopCheck);
			} else {
				destroy();
			}
		}
	}

	function destroy() {
		paused = true;
		cancelAnimationFrame(rAF);
		callback = undefined;
		duration = undefined;
	}

	function start() {
		paused = false;
		startTime = performance.now();
		rAF = requestAnimationFrame(loopCheck);
	}

	return {
		start: start,
		resume: start,
		pause: function pause() { paused = true },
		set duration(value) {
			duration = (value * 1000);
		},
		get duration() {
			return duration;
		},
		destroy: destroy
	}
}

function Toggle(vars) {

	this.state = vars.state || false;
	this.target = vars.target;
	this.onCb = vars.on;
	this.offCb = vars.off;

	this.on = function() {
		this.onCb.call(this.target);
		this.state = true;
	};

	this.off = function() {
		this.offCb.call(this.target);
		this.state = false;
	};

	this.flip = function() {
		if(this.state) {
			this.off();
		} else {
			this.on();
		}
	};
}

function Tooltip(vars) {

	var v = vars || {},
		self = this,

		container = new Sprite(),
		box = new Sprite(),
		arw = new Sprite(),
		txt = new Sprite(),

		alpha = 0,
		color = v.backgroundColor || 'rgba(0,0,0,0.7)',
		arwColor = color,
		fontColor = v.fontColor || '#FFFFFF',
		fontFamily = v.fontFamily || 'Helvetica Neue, Arial, sans-serif',
		fontSize = v.fontSize|| 11,
		corRadius = v.cornerRadius || 4,
		border = v.border || 'none',
		gap = v.gap || 12,
		padding = v.padding || 4,
		shadow = v.shadow || true,

		xPerc = 0,
		yAxis = 80,
		tipOffset = 0,
		containerAboveOffset = 0,
		containerBelowOffset = 0,

		delay = vars.delay || 350,
		delayTimer,

		debug = false;

	self.isShowing = false;

	if(debug) {
		arwColor = '#000000';
		arw.backgroundColor = '#FFFFFF';
		txt.fontColor = '#000000';
		txt.backgroundColor = '#000000';
		container.backgroundColor = '#000000';
	}

	txt.x = padding;
	txt.y = padding;
	txt.width = vars.width || 100;
	txt.textAlign = 'center';
	txt.fontColor = fontColor;
	txt.fontFamily = 'Helvetica Neue';
	txt.fontSize = fontSize;
	/*txt.wordWrap = 'break-word';*/

	box.x = gap;
	box.y = gap;
	box.borderRadius = corRadius;
	box.border = border;
	box.backgroundColor = color;
	if(shadow) {
		box.element.style.boxShadow = '0px 1px 3px rgba(0,0,0, 0.5)';
	}

	container.alpha = alpha;
	container.overflow = 'hidden';

	arw.w = 8;
	arw.point = arw.w * 0.5;
	arw.h = 6;
	arw.borderRight = arw.point + 'px solid transparent';
	arw.borderLeft = arw.point + 'px solid transparent';

	box.addChild(txt);
	container.addChild(box);
	container.addChild(arw);

	function update(e) {
		txt.text = e.target.tooltip;
		txt.alpha = 1;
		box.width = txt.element.offsetWidth + (padding * 2);
		box.height = txt.element.offsetHeight + (padding * 2);
		container.width = box.width + (gap * 2);
		container.height = box.height + (gap * 2);
		containerAboveOffset = tipOffset + container.height + (gap * 0.5);
		containerBelowOffset = tipOffset + gap;
	}

	function setXPos(e) {
		xPerc = e.pageX / window.innerWidth;
		var tipX = Math.round(container.width * xPerc);
		if((tipX - arw.point - corRadius) < gap) {
			arw.x = corRadius + gap;
			container.x = e.pageX - (gap + arw.point + corRadius);
		} else if((tipX + gap + arw.point + corRadius) > container.width) {
			arw.x = (container.width - (gap + arw.width + corRadius));
			container.x = (e.pageX - container.width) + gap + arw.point + corRadius;
		} else {
			arw.x = tipX - (gap - arw.width);
			container.x = e.pageX - tipX;
		}
	}

	function setYPos(e) {
		if(e.pageY < yAxis) {
			arw.borderTop = arw.h + 'px solid transparent';
			arw.borderBottom = arw.h + 'px solid ' + arwColor;
			container.y = e.pageY + containerBelowOffset;
			arw.y = box.y - arw.height;
		} else {
			arw.borderBottom = arw.h + 'px solid transparent';
			arw.borderTop = arw.h + 'px solid ' + arwColor;
			container.y = e.pageY - containerAboveOffset;
			arw.y = box.height + gap;
		}
	}

	function move(e) {
		container.transition = 0;
		setXPos(e);
		setYPos(e);
	}

	self.show = function(e) {
		if(e.target.tooltip) {
			container.transition = 0;
			e.target.addEventListener(MOUSE_MOVE, move);
			e.target.addEventListener(MOUSE_OUT, hide);
			container.zIndex = 1000;
			delayTimer = setTimeout(function() {
				Tween(container, 0.35, {alpha: 1});
			}, delay);
			update(e);
			self.isShowing = true;
		}
	};

	function hide(e) {
		if(delayTimer) clearTimeout(delayTimer);
		e.target.removeEventListener(MOUSE_MOVE, move);
		e.target.removeEventListener(MOUSE_OUT, hide);
		container.transition = 0;
		container.alpha = 0;
		container.width = 0;
		container.height = 0;
		container.zIndex = 0;
		self.isShowing = false;
	}

	stage.addChild(container);

}


function TouchNav(vars) {

	var self = this,
		moveDistanceX = 0,
		originTouchX = 0,
		originTouchY = 0,
		touchStartPointX = 0,
		touchStartPointY = 0,
		quantize = 0,
		swipeDirection,
		touchMoves = 0,
		lastPageX = 0,
		lastPageY = 0,
		touchTimeStart,
		touchTimeEnd,
		isMove = false,
		container = vars.mediaViewContainer;

	self.startdrag = false;

	container.addEventListener(TOUCH_START, touchStart);
	container.addEventListener(TOUCH_MOVE, touchMove, false);
	container.addEventListener(TOUCH_END, touchEnd, false);
	container.addEventListener(TOUCH_CANCEL, touchEnd, false);

	function touchStart(e) {
		if(e.touches.length === 1 && stage.zoom <= 1) {
			self.startdrag = true;
			originTouchX = e.touches[0].pageX;
			originTouchY = e.touches[0].pageY;
			touchStartPointX = e.touches[0].pageX - container.translateX;
			touchStartPointY = e.touches[0].pageY - container.translateY;
			startDeltaX = 0;
			startDeltaY = 0;
			touchTimeStart = new Date().getTime();
			vars.events.dispatchEvent(TOUCH_NAVIGATION_START);
		}
	}

	function touchMove(e) {
		if(self.startdrag) {
			e.preventDefault();

			var pageX = e.touches[0].pageX,
				pageY = e.touches[0].pageY;

			touchMoves++;

			if(touchMoves < 20) {
				swipeDirection = getSwipeDirection(pageX, pageY);
			} else if(quantize === 2) {
				swipeDirection = getSwipeDirection(pageX, pageY);
				quantize = 0;
			} else {
				quantize++;
			}

			if(isSwipe(swipeDirection) && (!isMove || self.swipeDirection !== swipeDirection)) {
				isMove = true;
			}
			self.swipeDirection = swipeDirection;
			var navDir = self.swipeDirection === 'left' ? 'next' : 'prev';
			vars.events.dispatchEvent(TOUCH_NAVIGATION_MOVE, navDir);

			if(isSwipe(swipeDirection)) {
				container.transition = 0;
				container.translateX = pageX - touchStartPointX;
			}
		}
	}

	function isSwipe(dir) {
		return (dir === 'left' || dir === 'right');
	}

	function getSwipeDirection(pageX, pageY) {
		/*var deltaX = pageX - lastPageX,
			deltaY = pageY - lastPageY;*/
		var deltaX = pageX - originTouchX,
			deltaY = pageY - originTouchY;
		lastPageX = pageX;
		lastPageY = pageY;
		moveDistanceX = deltaX;
		if(Mth.abs(deltaX) >= Mth.abs(deltaY)) {
			return deltaX > 0 ? 'right' : 'left';
		} else if(Mth.abs(deltaX) < Mth.abs(deltaY)) {
			return deltaY > 0 ? 'down' : 'up';
		}
		return false;
	}

	function touchEnd(e) {
		touchTimeEnd = new Date().getTime();
		var flick = flickSpeed(touchTimeStart, touchTimeEnd, e.pageX - originTouchX);
		vars.events.dispatchEvent(TOUCH_NAVIGATION_END, {
			flickSpeed: flick,
			isMove:isMove,
			swipeDirection:self.swipeDirection
		});
		self.startdrag = false;
		self.swipeDirection = false;
		isMove = false;
		sectionEnd = false;
		touchMoves = 0;
	}

	function flickSpeed(start, end, moveDist) {
		var slowest = 0.8,
			fastest = 0.05,
			flickSpeed = ((end - start) / Math.abs(moveDist));
		if(flickSpeed > slowest) flickSpeed = slowest;
		if(flickSpeed < fastest) flickSpeed = fastest;
		return flickSpeed * 0.40;
	}

	function getTouchMoveThreshold() {
		return Math.round(layoutCalcs.mediaView.width() * 0.02);
	}

	self.destroy = function() {
		container.removeEventListener(TOUCH_START, touchStart);
		container.removeEventListener(TOUCH_MOVE, touchMove, false);
		container.removeEventListener(TOUCH_END, touchEnd, false);
		container.removeEventListener(TOUCH_CANCEL, touchEnd, false);
	};
}

function Transition() {

}

function Popup(vars, info) {

	var self = new ViewProxy({events:vars.events}),
		blocker = new Sprite(),
		updateSpeed = 0.35;
	self.overflow = 'hidden';

	self.events.addEventListener(RESIZE_END, function(e) {
		self.resize();
	});

	init();

	self.resize = function() {
		Tween(blocker, updateSpeed, {width:stage.width, height:stage.height});
		centerDiv(Popup.plusDiv, updateSpeed);
		centerDiv(Popup.likeDiv, updateSpeed);
	};

	function init() {
		buildBlocker();
		self.zIndex = 1000;
		setTimeout(function() {
			if(info.label.indexOf('like') > -1) {
				buildLike();
			} else {
				buildPlusOne();
			}
		}, updateSpeed * 1000);
	}

	function buildPlusOne() {
		buildPlusOneDiv();
		injectPlusOneScript();
	}

	function buildLike() {
		buildLikeDiv();
		injectLikeScript();
	}

	function injectLikeScript() {
		if(!document.getElementById('likesrc')) {
			var fileref = document.createElement('script');
			fileref.setAttribute('id', 'likesrc');
			fileref.setAttribute("type", "text/javascript");
			fileref.setAttribute("src", 'http://connect.facebook.net/en_US/all.js#xfbml=1');
			document.getElementsByTagName("head")[0].appendChild(fileref);
		}
	}

	function injectPlusOneScript() {
		if(!document.getElementById('plus1src')) {
			var fileref = document.createElement('script');
			fileref.setAttribute('id', 'plus1src');
			fileref.setAttribute("type", "text/javascript");
			fileref.setAttribute("src", 'https://apis.google.com/js/plusone.js');
			document.getElementsByTagName("head")[0].appendChild(fileref);
		}
	}

	function buildPlusOneDiv() {
		if(!Popup.plusDiv) {
			var plusDiv = makeDiv('plus1', 100, 40);
			plusDiv.overflow = 'hidden';
			plusDiv.text = "<div class='g-plusone' data-href='" + info.path + "' size='medium'></div>";
			var closeButton = makeCloseButton();
			closeButton.x = plusDiv.width - 2;
			closeButton.y = 2;
			plusDiv.addChild(closeButton);
			stage.addChild(plusDiv);
			Popup.plusDiv = plusDiv;
			Popup.plusClose = closeButton;
		} else {
			Popup.plusDiv.alpha = 0;
			Popup.plusDiv.display = "block";
			centerDiv(Popup.plusDiv, 0);
			Popup.plusDiv.alpha = 1;
		}
		Popup.plusClose.addEventListener(CLICK, close);
	}

	function buildLikeDiv() {
		if(!Popup.likeDiv) {
			var likeDiv = makeDiv('like', 320, 40);
			likeDiv.overflow = 'visible';
			likeDiv.text = "<div id='fb-root'></div><fb:like send='true' width='250' show_faces='false'></fb:like>";
			var closeButton = makeCloseButton();
			closeButton.x = likeDiv.width - 2;
			closeButton.y = 2;
			likeDiv.addChild(closeButton);
			stage.addChild(likeDiv);
			Popup.likeDiv = likeDiv;
			Popup.likeClose = closeButton;
		} else {
			Popup.likeDiv.alpha = 0;
			Popup.likeDiv.display = "block";
			centerDiv(Popup.likeDiv, 0);
			Popup.likeDiv.alpha = 1;
		}
		Popup.likeClose.addEventListener(CLICK, close);
	}

	function buildBlocker() {
		blocker.backgroundColor = toRgba('#000000', 0.65);
		blocker.width = stage.width;
		blocker.alpha = 0;
		blocker.addEventListener(CLICK, close);
		self.addChild(blocker);
		blocker.height = stage.height;
		stage.addChild(self);
		Tween(blocker, updateSpeed, {alpha:1});
	}

	function makeDiv(name, width, height) {
		var div = new Sprite();
		div.element.setAttribute('id', name);
		div.backgroundColor = toRgba('#FFFFFF', 0.85);
		div.x = (stage.width - width) * 0.5;
		div.y = (stage.height - height) * 0.5;
		div.width = width;
		div.height = height;
		div.paddingTop = 20;
		div.paddingBottom = 2;
		div.paddingLeft = 15;
		div.zIndex = 2000;
		return div;
	}

	function makeCloseButton() {
		var button = new Svg();
		button.width = 14;
		button.height = 14;
		button.rotate = 0;
		var icon = new Path();
		icon.id = 'icon';
		icon.d = svgPaths.close;
		icon.strokeWidth = 2;
		icon.fill = 'none';
		icon.stroke = '#555';
		button.addChild(icon);

		return button;
	}

	function centerDiv(div, speed) {
		if(div && div.style.display === 'block') {
			var centerX = (stage.width - div.width) * 0.5;
			var centerY = (stage.height - div.height) * 0.5;
			Tween(div, speed, {x:centerX, y:centerY});
		}
	}

	function close(e) {
		e.target.removeEventListener(CLICK, close);
		Tween(blocker, updateSpeed, {alpha:0, onComplete:function() {
			stage.removeChild(self);
		}});
		if(Popup.plusDiv) Popup.plusDiv.display = "none";
		if(Popup.likeDiv) Popup.likeDiv.display = "none";;
	}

	return self;

}

function Tween(target, duration, vars) {

	if(this === window) {
	    return new Tween(target, duration, vars);
	}

	var delay = vars.delay || 0,
		rAF;

	function init() {
		if(vars.onInit) onInit();
		setTimeout(complete, duration * 1000);
		if(vars.onUpdate) rAF = requestAnimationFrame(update);
		setTransition(duration);
		var i; for(i in vars) {
			if(!/delay|ease|overwrite|css|onComplete|onCompleteScope|onCompleteParams|onUpdate|onUpdateScope|onUpdateParams|onInit|onInitScope|onInitParams/.test(i)) {
				setStyle(i, vars[i]);
			}
		}
	}

	function onInit() {
		vars.onInit.apply(vars.onInitScope || target, vars.onInitParams || [false]);
	}

	function update() {
		if(rAF) rAF = requestAnimationFrame(update);
		vars.onUpdate.apply(vars.onUpdateScope || target, vars.onUpdateParams || [false]);
	}

	function complete(e) {
		if(rAF) cancelAnimationFrame(rAF);
		if(vars.onComplete) vars.onComplete.apply(vars.onCompleteScope || target, vars.onCompleteParams || [false]);
		vars = {};
	}

	function setTransition(value) {
		if(value) {
			value = 'all ' + value + 's';
			if(vars.ease) value += ' ' + vars.ease;
		} else {
			value = '';
		}
		if(target.style) {
			target.style.WebkitTransition = value;
			target.style.MozTransition = value;
			target.style.OTransition = value;
			target.style.transition = value;
		}
	}

	function setStyle(style, value) {
		if(target.element) {
			target[style] = value;
		} else if(target.style) {
			target.style[style] = value;
		}
	}

	this.destroy = function() {
		delete vars.onComplete;
	};

	setTimeout(init, delay * 1000);
}

Tween.defer = function(target, duration, vars) {
	setTimeout(function(){
		Tween(target, duration, vars);
	}, 0);
};

function Bitmap(vars) {
	vars = vars || {};
	vars.type = 'img';
	vars.className = 'Bitmap';
	return new Sprite(vars);
}

function Button(vars) {
	vars = vars || {};
	vars.type = 'button';
	vars.className = 'Button';
	return new Sprite(vars);
}

function ControllerProxy(vars) {

	var proxy = vars || {};

	proxy.events = proxy.events || new EventSandbox();

	var template = {
		listeners: proxy.events.listeners,
		dispatchEvent: proxy.events.dispatchEvent,
		addEventListener: proxy.events.addEventListener,
		removeEventListener: proxy.events.removeEventListener
	};

	var i;

	for(i in template) {
		proxy[i] = template[i];
	}

	return proxy;
}

function EventSandbox() {

	var _logAll = false;

	function findInArray(needle, haystack) {
		var i = haystack.length;
		while(i--) {
			if(needle.callback === haystack[i].callback && needle.target === haystack[i].target) {
				return true;
			}
		}
		return false;
	}

	return {
		listeners: {},
		addEventListener: function(type, callback) {
			if(!this.listeners[type]) this.listeners[type] = [];
			var newListener = {type:type, callback:callback, target:this};
			if(!findInArray(newListener, this.listeners[type])) {
				this.listeners[type].push(newListener);
			}

		},
		removeEventListener: function(type, callback) {
			if(!this.listeners[type]) {
				/*console.error('removeEventListener: type not registered');*/
			}
			if(!callback || typeof callback !== 'function') {
				delete this.listeners[type];
			} else if(this.listeners[type]) {
				var i = 0,
					l = this.listeners[type].length;
				for(;i < l; i ++) {
					if(this.listeners[type][i] && this.listeners[type][i].callback === callback && this.listeners[type][i].target === this) {
						this.listeners[type].splice(i, 1);
					}
				}
			}
		},
		removeAllListeners: function(target) {
			var i;
			for(i in this.listeners) {
				var j = 0,
				l = this.listeners[i].length;
				for(;j < l; j++) {
					if(this.listeners[i][j] && this.listeners[i][j].target === target) {
						this.listeners[i].splice(j, 1);
					}
				}
			}
		},
		dispatchEvent: function(type, data) {
			if(this.listeners[type]) {
				for(var i = 0, l = this.listeners[type].length; i < l; i ++) {
					if(this.listeners[type][i] && !this.listeners[type][i].callback) {
						console.warn('VALID CALLBACK NOT FOUND ON LISTENER: ', this.listeners[type][i]);
						break;
					}
					if(this.listeners[type][i] && this.listeners[type][i].target === this) {
						if(_logAll) console.log(this.listeners[type][i]);
						this.listeners[type][i].callback.apply(this.listeners[type][i].target, [data]);
					}
				}
			}
		},
		set logAll(value) { _logAll = value; }
	}
}

var globalEvents = new EventSandbox();

function Input(vars) {
	vars = vars || {};
	vars.type = 'input';
	vars.className = 'Input';
	var input = new Sprite(vars);
	input.borderRadius = 0;
	input.style['-webkit-appearance'] = 'none';
	input.element.addEventListener('focus', function() {
		if(BROWSER_NAME === 'Safari') document.webkitCancelFullScreen();
		stage.disableKeyNavigation = true;
		stage.activeFocus = input;
	});
	input.element.addEventListener('blur', function() {
		stage.disableKeyNavigation = false;
	});
	return input;
}

function LoadingIndicator(vars) {

	vars = vars || {};

	var _type = vars.type || 'spinner',
		_alpha = vars.alpha || 0.75,
		_color = vars.color || '#FFFFFF';

	var self = new Sprite();
	self.width = 24;
	self.height = 24;
	self.alpha = _alpha;
	self.overflow = 'hidden';

	var png = new Bitmap();
	png.width = 24;
	png.height = 288;
	if(_color === '#FFFFFF') {
		png.src = REWRITE_BASE + ICONS + 'loader1.png';
	} else {
		png.src = REWRITE_BASE + ICONS + 'loader2.png';
	}
	self.addChild(png);

	function move() {
		if(_interval) {
			if(png.y > -264) {
				png.y -= 24;
			} else {
				png.y = 0;
			}
		}
	}

	var _interval = setInterval(move, 80);

	self.removeLoader = function() {
		clearInterval(_interval);
	};

	return self;
}

var Sprite = (function() {

	var pixelValues = [ 'backgroundPositionX', 'backgroundPositionY', 'backgroundRepeatX', 'backgroundRepeatY', 'baselineShift', 'borderBottomLeftRadius', 'borderBottomRightRadius', 'borderBottomWidth', 'borderImageWidth', 'borderLeftWidth', 'borderRadius', 'borderRightWidth', 'borderSpacing', 'borderTopLeftRadius', 'borderTopRightRadius', 'borderTopWidth', 'borderWidth', 'bottom', 'fontSize', 'height', 'left', 'letterSpacing', 'lineHeight', 'margin', 'marginBottom', 'marginLeft', 'marginRight', 'marginTop', 'maxHeight', 'maxWidth', 'minHeight', 'minWidth', 'outlineOffset', 'outlineWidth', 'overflowX', 'overflowY', 'padding', 'paddingBottom', 'paddingLeft', 'paddingRight', 'paddingTop', 'right', 'strokeWidth', 'textIndent', 'textLineThroughWidth', 'textOverlineWidth', 'textUnderlineWidth', 'top', 'width', 'wordSpacing' ];

	function Sprite(_vars) {
		this.vars = {};
		var i;
		for(i in _vars) this.vars[i] = _vars[i];
		var el = document.createElement(this.vars.type || 'div');
		el.proxy = this;
		this._private = {};
		if(this.vars.id) this.id = this.vars.id;
		this.element = el;
		this.type = this.vars.type;
		this.children = [];
		this.style = el.style;
		this.name = 'Sprite';
		this.events = this.vars.events || globalEvents;
		this.listeners = this.events.listeners;
		if(!this.vars.selectable) this.selectable = false;
		this.style.position = 'absolute';
		this.style.display = 'block';
	}

	var properties = ["backfaceVisibility", "background", "backgroundAttachment", "backgroundBlendMode", "backgroundClip", "backgroundColor", "backgroundImage", "backgroundOrigin", "backgroundPosition", "backgroundPositionX", "backgroundPositionY", "backgroundRepeat", "backgroundRepeatX", "backgroundRepeatY", "backgroundSize", "border", "borderBottom", "borderBottomColor", "borderBottomLeftRadius", "borderBottomRightRadius", "borderBottomStyle", "borderBottomWidth", "borderCollapse", "borderColor", "borderImage", "borderImageOutset", "borderImageRepeat", "borderImageSlice", "borderImageSource", "borderImageWidth", "borderLeft", "borderLeftColor", "borderLeftStyle", "borderLeftWidth", "borderRadius", "borderRight", "borderRightColor", "borderRightStyle", "borderRightWidth", "borderSpacing", "borderStyle", "borderTop", "borderTopColor", "borderTopLeftRadius", "borderTopRightRadius", "borderTopStyle", "borderTopWidth", "borderWidth", "bottom", "boxShadow", "boxSizing", "bufferedRendering", "clear", "color", "content", "cursor", "direction", "display", "float", "font", "fontFamily", "fontKerning", "fontSize", "fontStretch", "fontStyle", "fontVariant", "fontWeight", "height", "imageRendering", "left", "letterSpacing", "lineHeight", "listStyle", "listStyleImage", "listStylePosition", "listStyleType", "margin", "marginBottom", "marginLeft", "marginRight", "marginTop", "mask", "maskType", "maxHeight", "maxWidth", "maxZoom", "minHeight", "minWidth", "minZoom", "opacity", "order", "orientation", "outline", "outlineColor", "outlineOffset", "outlineStyle", "outlineWidth", "overflow", "overflowWrap", "overflowX", "overflowY", "padding", "paddingBottom", "paddingLeft", "paddingRight", "paddingTop", "page", "pageBreakAfter", "paintOrder", "pointerEvents", "position", "resize", "right", "size", "src", "stroke", "strokeDasharray", "strokeDashoffset", "strokeLinecap", "strokeLinejoin", "strokeMiterlimit", "strokeOpacity", "strokeWidth", "tabSize", "tableLayout", "textAlign", "textAnchor", "textDecoration", "textIndent", "textLineThroughColor", "textLineThroughMode", "textLineThroughStyle", "textLineThroughWidth", "textOverflow", "textOverlineColor", "textOverlineMode", "textOverlineStyle", "textOverlineWidth", "textRendering", "textShadow", "textTransform", "textUnderlineColor", "textUnderlineMode", "textUnderlineStyle", "textUnderlineWidth", "top", "transform", "transformOrigin", "transformStyle", "transition", "transitionDelay", "transitionDuration", "transitionProperty", "transitionTimingFunction", "userZoom", "verticalAlign", "visibility", "webkitBackfaceVisibility", "webkitBoxShadow", "webkitFilter", "webkitFontSmoothing", "webkitHighlight", "webkitTransformStyle", "webkitTransition", "webkitTransitionDelay", "webkitTransitionDuration", "webkitTransitionProperty", "webkitTransitionTimingFunction", "webkitUserDrag", "webkitUserModify", "webkitUserSelect", "whiteSpace", "width", "wordBreak", "wordSpacing", "wordWrap", "zIndex", "zoom"];

	(function defineProperties (properties){

		Sprite.prototype.dispatchEvent = function(type, data) {
			this.events.dispatchEvent.apply(this, [type, data]);
		};

		Sprite.prototype.addEventListener = function(type, callback) {
			var sprite = this;
			var l = ELEMENT_EVENTS.length;
			while(l--) {
				if(type === ELEMENT_EVENTS[l]) {
					this.element.addEventListener(type, this.event, false);
				}
			}
			this.events.addEventListener.apply(this, [type, callback]);
		};

		Sprite.prototype.removeEventListener = function(type, callback) {
			var sprite = this;
			var l = ELEMENT_EVENTS.length;
			while(l--) {
				if(type === ELEMENT_EVENTS[l]) {
					this.element.removeEventListener(type, this.event, false);
				}
			}
			this.events.removeEventListener.apply(this, [type, callback]);
		};

		Sprite.prototype.removeAllListeners = function() {
			this.events.removeAllListeners.call(this);
		};

		Sprite.prototype.addChild = function(child) {
			this.element.appendChild(child.element);
			child.parent = this;
			this.children.push(child);
			child.dispatchEvent(CHILD_ADDED, child);
		};

		Sprite.prototype.removeChild = function(child) {
			if(child) {
				if(child.events) child.events.removeAllListeners(child);
				if(child.removeLoader) child.removeLoader();
				if(child.element.parentNode) {
					child.element.parentNode.removeChild(child.element);
				}
				var i = this.children.length;
				while(i--) {
					if(this.children[i] === child) {
						this.children.splice(i, 1);
					}
				}
				child = null;
			}
		};

		Sprite.prototype.removeChildren = function(parent) {
			if(parent && parent.children && parent.children.length > 0) {
				var i = parent.children.length;
				while(i--) {
					this.removeChildren(parent.children[i]);
					parent.removeChild(parent.children[i]);
				}
			}
		};

		Sprite.prototype.childAdded = function(child) {
			var i = this.children.length;
			while(i--) {
				if(this.children[i].topParentName === 'Stage' && this.children[i] === child && this.children[i].dispatchEvent) {
					this.children[i].dispatchEvent(CHILD_ADDED, this.children[i]);
				}
			}
		};

		Sprite.prototype.moveToTop = function(child) {
			var highestZ = 0;
			var i = this.children.length;
			while(i--) {
				if(this.children[i].zIndex >= highestZ && !this.children[i] === child) {
					highestZ = this.children[i].zIndex + 1;
				} else {
					this.children[i].zIndex--;
				}
			}
			child.zIndex = highestZ;
		};

		Sprite.prototype.event = function(e) {
			if(!this.proxy._private.selectable && !TOUCH_DEVICE && this.proxy.vars.type !== 'input' && this.proxy.vars.type !== 'textarea' && this.proxy.vars.type !== 'button') {
				e.preventDefault();
			}

			var event = {
				type: e.type,
				target:this.proxy,
				currentTarget:this.proxy,
				keyCode: e.which,
				pageX:e.pageX,
				pageY:e.pageY,
				clientX:e.clientX,
				clientY:e.clientY,
				offsetX:e.offsetX || e.layerX,
				offsetY:e.offsetY || e.layerY,
				mouseX: e.clientX - this.proxy.stageX,
				mouseY: e.clientY - this.proxy.stageY,
				preventDefault: function() {
					e.preventDefault();
				},
				stopPropagation: function() {
					e.stopPropagation();
				},
				dataTransfer: e.dataTransfer
			};

			if(e.touches) event.touches = e.touches;
			this.proxy.dispatchEvent(e.type, event);
		};

		Sprite.prototype.hitTestPoint = function(xPoint, yPoint) {
			if(!this._private.width) this._private.width = this.element.offsetWidth || this.element.scrollWidth || 0;
			return this.style.display !== 'none' && xPoint >= this.stageX && xPoint <= this.stageX + this._private.width && yPoint >= this.stageY && yPoint <= this.stageY + this._private.height;
		};

		Sprite.prototype.hitTestAbs = function(xPoint, yPoint) {
			return this.style.display !== 'none' && xPoint >= this.absX && xPoint <= this.absX + this._private.width && yPoint >= this.absY && yPoint <= this.absY + this._private.height;
		};

		Sprite.prototype.globalToLocal = function(point) {
			return {x:point.x - this.stageX, y:point.y - this.stageY};
		};

		Sprite.prototype.localToGlobal = function(point) {
			return {x:point.x + this.stageX, y:point.y + this.stageY};
		};

		Sprite.prototype.focus = function() {
			stage.activeFocus = this;
			if(this.vars.type === 'input' || this.vars.type === 'textarea' || this.vars.type === 'button') this.element.focus();
		};

		Sprite.prototype.blur = function() {
			if(this.vars.type === 'input' || this.vars.type === 'textarea' || this.vars.type === 'button') this.element.blur();
		};

		Sprite.prototype.getClass = function() {
			return this.element.className;
		};

		Sprite.prototype.setClass = function(value) {
			return this.element.setAttribute('class', value);
		};

    	properties.forEach (function(prop) {
    		if(!/width|height|fontSize|src|transition/.test(prop)) {
				Object.defineProperty (Sprite.prototype, prop, {
					get: function () { return this._private[prop] ; },
					set: function (value) {
			        	this._private[prop] = value;
						this.element.style[prop] = pixelValues.indexOf(prop) > -1 ? value + 'px' : value;
			        }
				});
			}
		});

		Object.defineProperty(Sprite.prototype, 'offsetLeft', {
			get:function() {
				return this.element.offsetLeft;
			}
		});

		Object.defineProperty(Sprite.prototype, 'offsetTop', {
			get:function() {
				return this.element.offsetTop;
			}
		});

		Object.defineProperty(Sprite.prototype, 'value', {
			get:function() {
				return this.element.value;
			},
			set:function(val) {
				this.element.value = val;
			}
		});

		Object.defineProperty (Sprite.prototype, 'topParentName', {
			get: function() {
				if(this.parent) {
					return this.parent.topParentName;
				}
				return this.topParentName;
			}
		});

		Object.defineProperty (Sprite.prototype, 'stageX', {
			get: function() {
				if(this.parent) {
					var x = this.x > 0 ? this.x : this.translateX;
					return this.parent.stageX + (x || 0);
				}
				return this.x;
			}
		});

		Object.defineProperty (Sprite.prototype, 'stageY', {
			get: function() {
				if(this.parent) {
					var y = this.y > 0 ? this.y : this.translateY;
					return this.parent.stageY + (y || 0);
				}
				return this.y;
			}
		});

		Object.defineProperty (Sprite.prototype, 'absX', {
			get: function() {
				var x = 0;
				var el = this.element;
				if (el.offsetParent) {
					do { x += el.offsetLeft; } while (el = el.offsetParent);
				}
				return x;
			}
		});

		Object.defineProperty (Sprite.prototype, 'absY', {
			get: function() {
				var y = 0;
				var el = this.element;
				if (el.offsetParent) {
					do { y += el.offsetTop; } while (el = el.offsetParent);
				}
				return y;
			}
		});

		Object.defineProperty (Sprite.prototype, 'src', {
			get: function() {
				return this._private.src;
			},
			set: function(value) {
				if(value) {
					this._private.src = value;
					this.element.src = value;
				} else {
					stack(value);
				}
			}
		});

		Object.defineProperty (Sprite.prototype, 'text', {
			get: function() {
				return this._private.text;
			},
			set: function(value) {
				this._private.text = value;
				this.element.innerHTML = value;
			}
		});

		Object.defineProperty (Sprite.prototype, 'textAlignVertical', {
			get: function() {
				return this._private.textAlignVertical;
			},
			set: function(value) {
				this._private.textAlignVertical = value;
				if(value === 'middle' || value === 'bottom') {
					this.style.position = 'relative';
					this.style.display = 'table-cell';
				}
				this.style.verticalAlign = value;
			}
		});

		Object.defineProperty (Sprite.prototype, 'textWrap', {
			get: function() {
				return this._private.textWrap;
			},
			set: function(value) {
				this._private.textWrap = value;
				this.style.whiteSpace = value ? 'normal' : 'nowrap';
			}
		});

		Object.defineProperty (Sprite.prototype, 'fontColor', {
			get: function() {
				return this._private.fontColor;
			},
			set: function(value) {
				this._private.fontColor = value;
				this.style.color = value;
			}
		});

		Object.defineProperty (Sprite.prototype, 'selectable', {
			get: function() {
				console.log('selectable', this);
				return this._private.selectable;
			},
			set: function(value) {
				this._private.selectable = value;
				if(!this._private.selectable && this.vars.type !== 'input' && this.vars.type !== 'textarea') {
					this.style.cursor = 'default';
					this.style['-webkit-touch-callout'] = 'none';
					this.style['-webkit-user-select'] = 'none';
					this.style['-khtml-user-select'] = 'none';
					this.style.MozUserSelect = 'none';
					this.style['-ms-touch-callout'] = 'none';
					this.style['user-select'] = 'none';
				} else {
					this.style.cursor = 'auto';
					this.style['-webkit-touch-callout'] = 'auto';
					this.style['-webkit-user-select'] = 'auto';
					this.style['-khtml-user-select'] = 'auto';
					this.style.MozUserSelect = 'text';
					this.style['-ms-touch-callout'] = 'auto';
					this.style['user-select'] = 'auto';
				}
			}
		});

		Object.defineProperty (Sprite.prototype, 'alpha', {
			get: function() {
				return this._private.opacity;
			},
			set: function(value) {
				this._private.opacity = value;
				this.style.opacity = value;
			}
		});

		Object.defineProperty (Sprite.prototype, 'x', {
			get: function() {
				return this._private.x || 0;
			},
			set: function(value) {
				this._private.x = value;
				this.style.left = value + 'px';
			}
		});

		Object.defineProperty (Sprite.prototype, 'y', {
			get: function() {
				return this._private.y || 0;
			},
			set: function(value) {
				this._private.y = value;
				this.style.top = value + 'px';
			}
		});

		Object.defineProperty (Sprite.prototype, 'translate', {
			get: function() {
				return this._private.translate;
			},
			set: function(value) {
				this._private.translate = value;
				this._private.translateX = value[0];
				this._private.translateY = value[1];
				this.style['-webkit-transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
				this.style['-ms-transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
				this.style['transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
			}
		});

		Object.defineProperty (Sprite.prototype, 'translateX', {
			get: function() {
				if(this._private.translateX) {
					return this._private.translateX;
				} else {
					var matrix = new TransformMatrix(this.element);
					return Number(matrix.x) || 0;
				}
			},
			set: function(value) {
				this._private.translateX = value;
				this._private.translateY = this._private.translateY || 0;
				this.style['-webkit-transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
				this.style['-ms-transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
				this.style['transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
			}
		});

		Object.defineProperty (Sprite.prototype, 'translateY', {
			get: function() {
				if(this._private.translateY) {
					return this._private.translateY;
				} else {
					var matrix = new TransformMatrix(this.element);
					return Number(matrix.y) || 0;
				}
			},
			set: function(value) {
				this._private.translateY = value;
				this._private.translateX = this._private.translateX || 0;
				this.style['-webkit-transform'] = 'translate(' + this._private.translateX + 'px,' +this._private.translateY + 'px)';
				this.style['-ms-transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
				this.style['transform'] = 'translate(' + this._private.translateX + 'px,' + this._private.translateY + 'px)';
			}
		});

		Object.defineProperty (Sprite.prototype, 'translateZ', {
			get: function() {
				return this._private.translateZ;
			},
			set: function(value) {
				this._private.translateZ = value;
				this.style['-webkit-transform'] = 'translateZ(' + value + 'px)';
				this.style['-ms-transform'] = 'translateZ(' + value + 'px)';
				this.style['transform'] = 'translateZ(' + value + 'px)';
			}
		});

		Object.defineProperty (Sprite.prototype, 'rotate', {
			get: function() {
				return this._private.rotate;
			},
			set: function(value) {
				this._private.rotate = value;
				this.style['-webkit-transform'] = 'rotate('+value+'deg)';
				this.style['-moz-transform'] = 'rotate('+value+'deg)';
				this.style['-o-transform'] = 'rotate('+value+'deg)';
				this.style.transform = 'rotate('+value+'deg)';
			}
		});

		Object.defineProperty (Sprite.prototype, 'width', {
			get: function() {
	 			this._private.width = this._private.width || this.element.offsetWidth || 0;
				return this._private.width;
			},
			set: function(value) {
				if(value < 0) value = 0;
				this._private.width = value;
				this.style.width = value + 'px';
			}
		});

		Object.defineProperty (Sprite.prototype, 'height', {
			get: function() {
	 			this._private.height = this._private.height || this.element.offsetHeight || 0;
				return this._private.height;
			},
			set: function(value) {
				if(value < 0) value = 0;
				this._private.height = value;
				this.style.height = value + 'px';
			}
		});

		Object.defineProperty (Sprite.prototype, 'numChildren', {
			get: function() {
				return this.children.length;
			}
		});

		Object.defineProperty (Sprite.prototype, 'fontSize', {
			get: function() {
	 			return this._private.fontSize;
			},
			set: function(value) {
				this._private.fontSize = value;
				if(isNaN(value) && value.search('%') > -1) {
					this.style.fontSize = value;
				} else if(isNaN(value) && value.search('px') > -1) {
					this.style.fontSize = value;
				} else if(!isNaN(value)) {
					this.style.fontSize = value + 'px';
				} else {
					this.style.fontSize = value;
				}
			}
		});

		Object.defineProperty (Sprite.prototype, 'transition', {
			get: function() {
	 			return this._private.transition;
			},
			set: function(value) {
				this._private.transition = value;
				value = value === 0 ? 'none' : 'all ' + value + 's cubic-bezier(1, 0, 0.3, 1)';
				this.style.WebkitTransition = value;
				this.style.MozTransition = value;
				this.style.OTransition = value;
				this.style.transition = value;
			}
		});

	})(properties);

	return Sprite;

})();


function Stage() {

	var _selectable = false,
		_zoom = 1,
		_private = {};

	var name = 'Stage';

	var stage = {

		children: [],
		dragElements: [],
		activeFocus:undefined,
		element:document.body,
		listeners: globalEvents.listeners,
		dispatchEvent: globalEvents.dispatchEvent,
		addEventListener: globalEvents.addEventListener,
		removeEventListener: globalEvents.removeEventListener,

		addChild: function(child) {
			if(!child.element.parentNode) {
				document.body.appendChild(child.element);
			}
			child.parent = this;
			this.children.push(child);
			child.dispatchEvent(CHILD_ADDED, child);
		},

		get topParentName() {
			return name;
		},

		addChildAt: function(child, index) {

		},

		removeChild: function(child) {
			if(child.events) child.events.removeAllListeners(child);
			if(child.removeLoader) child.removeLoader();
			if(child.element.parentNode) {
				document.body.removeChild(child.element);
			}
			var i = this.children.length;
			while(i--) {
				if(this.children[i] === child) {
					this.children.splice(i, 1);
				}
			}
			child = null;
		},

		removeChildren: function(parent) {
			if(parent && parent.children && parent.children.length > 0) {
				var i = parent.children.length;
				while(i--) {
					this.removeChildren(parent.children[i]);
					parent.removeChild(parent.children[i]);
				}
			}
		},

		moveToTop: function(child) {
			var highestZ = 0;
			var i = this.children.length;
			while(i--) {
				if(this.children[i].zIndex >= highestZ && !this.children[i] === child) {
					highestZ = this.children[i].zIndex + 1;
				} else {
					this.children[i].zIndex--;
				}
			}
			child.zIndex = highestZ;
		},

		domContentLoaded: function() {
			stage.element = document.body;
			if(!_selectable) {
				document.body.style.overflow = 'hidden';
			}
			document.body.style.margin = 0;
			document.body.style.padding = 0;
			stage.dispatchEvent(LOAD, stage);
		},

		documentReadyListener: function() {
			var allFonts = [LAYOUT_MODEL.captionFont, LAYOUT_MODEL.contactFont, LAYOUT_MODEL.contactTitleFont, LAYOUT_MODEL.copyrightFont, LAYOUT_MODEL.introFont, LAYOUT_MODEL.logoFont, LAYOUT_MODEL.menuFont, LAYOUT_MODEL.navbarFont, LAYOUT_MODEL.pageTextFont, LAYOUT_MODEL.pageTitleFont, LAYOUT_MODEL.thumbnailTitleFont];
			var fontArr = [],
				i = allFonts.length;
			while(i--) uniquePush(fontArr, allFonts[i]);
			removeSysFonts(fontArr);

			WebFontConfig = {
				custom: {
					families: fontArr
				},
				loading: function() {
				},
				fontloading: function(fontFamily, fontDescription) {
				},
				fontactive: function(fontFamily, fontDescription) {
				},
				fontinactive: function(fontFamily, fontDescription) {
				},
				active: function() {
					stage.domContentLoaded();
					stage.style = document.body.style;
					stage.element = document.body;
				},
				inactive: function() {
					stage.domContentLoaded();
					stage.style = document.body.style;
					stage.element = document.body;
				}
			};

			(function() {
				var wf = document.createElement('script');
				wf.src = REWRITE_BASE + 'dx/js/shared/libs/webfontloader.js';
				wf.type = 'text/javascript';
				wf.async = 'true';
				var s = document.getElementsByTagName('script')[0];
				s.parentNode.insertBefore(wf, s);
			})();
		},

		globalToLocal: function (point) {
			return {x:point.x, y:point.y};
		},

		localToGlobal: function (point) {
			return {x:point.x, y:point.y};
		},

		event: function(e) {

			var event = {
				type:e.type,
				target:e.target,
				currentTarget:e.target,
				x:e.x,
				y:e.y,
				keyCode:e.which,
				pageX:e.pageX,
				pageY:e.pageY,
				screenX:e.screenX,
				screenY:e.screenY,
				clientX:e.clientX,
				clientY:e.clientY,
				mouseX:e.clientX - stage.stageX,
				mouseY:e.clientY - stage.stageY,
				deltaX:e.deltaX || -e.wheelDeltaX || 0,
				deltaY:e.deltaY || -e.wheelDeltaY || 0,
				preventDefault: function() {
					e.preventDefault();
				},
				stopPropagation: function() {
					e.stopPropagation();
				},
				dataTransfer: e.dataTransfer
			};

			if(BROWSER_NAME === 'Firefox') {
				event.deltaX = e.deltaX * 5;
				event.deltaY = e.deltaY * 5;
			}

			if(e.touches) event.touches = e.touches;

			if(e.type === WHEEL || e.type === MOUSE_WHEEL) {
				event.type = MOUSE_WHEEL;
				/*event.preventDefault(); was for FF scrolling */
			}

			if(e.type === RESIZE || e.type === GESTURE_CHANGE || e.type === GESTURE_END || e.type === ORIENTATION_CHANGE) {
				_zoom = document.documentElement.clientWidth / window.innerWidth;
			}

			if(Scrolls && e.clientX && e.clientY) {
				Scrolls.hitMask(e.clientX, e.clientY);
			}

			stage.dispatchEvent(e.type, event);
		},

		get getChildren() {
			return children;
		},
		get images() {
			return document.images;
		},
		get forms() {
			return document.forms;
		},
		get links() {
			return document.links;
		},
		get anchors() {
			return document.anchors;
		},
		get scripts() {
			return document.scripts;
		},
		get plugins() {
			return document.plugins;
		},
		get embeds() {
			return document.embeds;
		},
		get width() {
			return window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName('body')[0].clientWidth;
		},
		get height() {
			return window.innerHeight || document.documentElement.clientHeight|| document.getElementsByTagName('body')[0].clientHeight;
		},
		get stageX() {
			return 0;
		},
		get stageY() {
			return 0;
		},
		get selectable() {
			return _selectable;
		},
		set selectable(value) {
			_selectable = value;
		},
		get zoom() {
			return _zoom;
		},
		set zoom(value) {
			_zoom = value;
		},
		get backgroundColor() {
			return _private.backgroundColor || document.body.style.backgroundColor;
		},
		set backgroundColor(value) {
			_private.backgroundColor = value;
			document.body.style.backgroundColor = value;
		},

		get transition() {
			return _private.transition;
		},
		set transition(value) {
			_private.transition = value;
			value = value === 0 ? 'none' : 'all ' + value + 's';
			document.body.style.WebkitTransition = value;
			document.body.style.MozTransition = value;
			document.body.style.OTransition = value;
			document.body.style.transition = value;
		},

		get disableKeyNavigation() {
			return _private.disableKeyNavigation;
		},
		set disableKeyNavigation(value) {
			_private.disableKeyNavigation = value;
		},

		focus: function() {
			stage.activeFocus = stage;
		},
		blur: function() {}
	};

	stage.proxy = stage;

	window.addEventListener(TOUCH_START, stage.event, false);
	window.addEventListener(TOUCH_MOVE, stage.event, false);
	window.addEventListener(TOUCH_END, stage.event, false);
	window.addEventListener(TOUCH_CANCEL, stage.event, false);
	window.addEventListener(MOUSE_OVER, stage.event, false);
	window.addEventListener(MOUSE_DOWN, stage.event, false);
	window.addEventListener(MOUSE_MOVE, stage.event, false);
	window.addEventListener(MOUSE_UP, stage.event, false);
	window.addEventListener(MOUSE_OUT, stage.event, false);
	window.addEventListener(CLICK, stage.event, false);
	window.addEventListener(RESIZE, stage.event, false);
	window.addEventListener(ORIENTATION_CHANGE, stage.event, false);
	window.addEventListener(SCROLL, stage.event, false);
	window.addEventListener(GESTURE_START, stage.event, false);
	window.addEventListener(GESTURE_CHANGE, stage.event, false);
	window.addEventListener(GESTURE_END, stage.event, false);
	window.addEventListener(KEY_UP, stage.event, false);
	window.addEventListener(KEY_DOWN, stage.event, false);

	var resizeTimer, rotateTimer;

	window.addEventListener(RESIZE, function(e) {
		clearTimeout(resizeTimer);
		resizeTimer = setTimeout(function() {
			stage.dispatchEvent(RESIZE_END, e);
		}, 200);
	}, false);

	window.addEventListener(ORIENTATION_CHANGE, function(e) {
		stage.dispatchEvent(ORIENTATION_CHANGE, e);
	}, false);

	window.addEventListener(WHEEL, stage.event, false);
	window.addEventListener(MOUSE_WHEEL, stage.event, false);

	stage.documentReadyListener();

	return stage;
}

var stage = Stage.call(Stage);

function addChild(child) {
	stage.addChild(child);
}

var svgPaths = {
	navArrowRight:{
		default:'M1.4,11.984l4.244-4.242L1.4,3.5',
		thin:''
	},
	navArrowLeft:{
		default:'M6.644,3.5L2.4,7.742l4.244,4.242',
		thin:''
	},
	navArrowUp:{
		default:'m 1.4562498,8.21905 5.1000001,-5.4 5.7000001,5.4',
		thin:''
	},
	navArrowDown:{
		default:'m 1.4562498,1.44405 5.1000001,5.4 5.7000001,-5.4',
		thin:''
	},
	navFullscreen:{
		default:'M0,0h15v9H0V0z M2,2v5h11V2H2z',
		thin:'M1.5,1.5 L12.5,1.5 L12.5,7.5 L1.5,7.5 L1.5,1.5 z'
	},
	navEmail:{
		default:'M15,12V3h-0.93v1h-0.945v1h-0.93v1h-0.932v1h-0.951v1H9.375v0.992H8.438v1.001H6.562V8.991H5.625V8H4.688V7H3.742V6h-0.93V5 H1.875V4H0.93V3H0v9H15z M0.93,9.993h0.945v-1h0.938V8h0.93v0.992h-0.93v1H1.875V11H0.93V9.993z M2.812,4v1h0.93v1h0.945v1h0.938v1 h0.938v0.992h1.875V8h0.938V7h0.938V6h0.951V5h0.93V4h0.931V3H1.875v1H2.812z M11.266,8h0.93v0.992h0.93v1h0.945V11h-0.945V9.993 h-0.93v-1h-0.93V8z',
		thin:'M6.773,8.984 L8.199,12.336 L12.49,3.51 L3.5,7.404 L6.773,8.984 L12.466,3.5'
	},
	navInfo:{
		default:'M0.576,10.401c0.384,0.922,0.924,1.724,1.621,2.404c2.891,2.908,7.741,2.946,10.624,0c2.904-2.923,2.905-7.705,0-10.629 c-2.88-2.92-7.736-2.881-10.624,0c-0.738,0.715-1.274,1.525-1.607,2.43C-0.192,6.534-0.197,8.465,0.576,10.401 C0.959,11.324,0.192,9.479,0.576,10.401z M1.9,5.131c0.311-0.753,0.745-1.403,1.303-1.95c2.34-2.383,6.292-2.274,8.654,0 c2.316,2.448,2.284,6.187,0,8.643c-2.387,2.29-6.288,2.39-8.654,0c-0.543-0.542-0.985-1.207-1.329-1.994 c-0.293-0.738-0.44-1.528-0.44-2.371C1.435,6.661,1.59,5.885,1.9,5.131C2.211,4.378,1.59,5.885,1.9,5.131z M4.792,7.981 c0.562,0,1.844-0.876,2.245-0.566C7.531,7.798,6.011,9.726,5.89,9.94c-0.605,1.064-0.754,2.451,0.931,2.24 c1.02-0.128,2.904-0.903,3.41-1.88c0.232-0.451-2.039,0.442-2.189,0.278C7.69,10.194,8.925,8.421,9.058,8.096 C10.812,3.81,4.583,6.318,4.792,7.981C4.796,7.981,4.792,7.981,4.792,7.981z M8.151,4.869c0.465,0.459,1.194,0.432,1.651-0.025 c0.701-0.62,0.341-1.849-0.572-2.041C8.067,2.56,7.326,4.053,8.151,4.869C8.38,5.094,7.923,4.644,8.151,4.869z',
		thin:'M7.5,12.5 C4.739,12.5 2.5,10.261 2.5,7.5 C2.5,4.739 4.739,2.5 7.5,2.5 C10.261,2.5 12.5,4.739 12.5,7.5 C12.5,10.261 10.261,12.5 7.5,12.5 z M7.5,5.694 L7.5,4.306 M7.5,10.37 L7.5,6.435'
	},
	navCart:{
		default:'M 1.248,8.985 H 3.254 V 6.989 H 1.248 V 8.985 z M 0,0 1.05,5.992 h 9.235 L 11.271,0.966 13.248,0.968 13.256,0 H 0 z m 3.25,3.981 h -1 v -1 h 1 v 1 z M 3.25,2 h -1 V 1 h 1 v 1 z m 2,2 h -1 V 3 h 1 v 1 z m 0,-2 h -1 V 1 h 1 v 1 z m 2,1.979 h -1 v -1 h 1 v 1 z M 7.25,2 h -1 V 1 h 1 v 1 z m 2,1.979 h -1 v -1 h 1 v 1 z M 9.25,2 h -1 V 1 h 1 V 2 z M 7.252,9.007 H 9.25 V 7.002 H 7.252 v 2.005 z',
		thin:'M3.673,7.806 C3.866,7.806 4.023,7.963 4.023,8.157 C4.023,8.35 3.866,8.507 3.673,8.507 C3.479,8.507 3.322,8.35 3.322,8.157 C3.322,7.963 3.479,7.806 3.673,7.806 z M10.034,1.526 L8.552,6.278 L2.701,6.278 L1.5,1.5 L11.542,1.5 M7.333,7.806 C7.139,7.806 6.982,7.963 6.982,8.157 C6.982,8.35 7.139,8.507 7.333,8.507 C7.527,8.507 7.684,8.35 7.684,8.157 C7.684,7.963 7.527,7.806 7.333,7.806 z',
	},
	navThumbs:{
		default:'M0,3h7v4H0V3z M0,8h7v4H0V8z M8,3h7v4H8V3z M8,8h7v4H8V8z',
		thin:'M1.5,3.5 L6.5,3.5 L6.5,6.5 L1.5,6.5 L1.5,3.5 z M8.5,3.5 L8.5,6.5 L13.5,6.5 L13.5,3.5 L8.5,3.5 z M1.5,8.5 L1.5,11.5 L6.5,11.5 L6.5,8.5 L1.5,8.5 z M8.5,8.5 L8.5,11.5 L13.5,11.5 L13.5,8.5 L8.5,8.5 z'
	},
	play:'M2,1l8,5.031L2,11V1z',
	pause:'M2,2h3v8H2V2z M7,2h3v8H7V2z',
	volume:'M2,7.5h1V10H2V7.5z M4,7h1v3H4V7z M6,6h1v4H6V6z M8,4h1v6H8V4z M10,2h1v8h-1V2z M0,8h1v2H0V8z',
	mute:'M2,8h1v2H2V8z M4,8h1v2H4V8z M6,8h1v2H6V8z M8,8h1v2H8V8z M10,8h1v2h-1V8z M0,8h1v2H0V8z',
	arrowLeft:'M 8.812269,1.1126749 2.1862736,7.2790289 8.876226,13.512325',
	arrowRight:'M 1.0939806,1.1126749 7.719976,7.2790289 1.0300236,13.512325',
	arrowUp:'M 1.1126747,8.812269 7.2790287,2.1862738 13.512325,8.876226',
	arrowDown:'M 1.1126747,1.0939808 7.2790287,7.719976 13.512325,1.0300238',
	arrowUpSmall:'M10.535,8.768L7,5.232L3.465,8.768',
	arrowDownSmall:'M3.465,5.232L7,8.768l3.535-3.535',
	arrowRightSmall:'M4.5,12.001L9.5,7l-5-5',
	arrowLeftSmall:'M9.5,2l-5,5.001l5,5',
	edit:'M4.244,7.759L9.203,2.8l2.151,2.151L6.396,9.909L2.8,11.397L4.244,7.759z',
	remove:'M4,7h6 M7,2.5C4.515,2.5,2.5,4.515,2.5,7c0,2.486,2.015,4.5,4.5,4.5 c2.486,0,4.5-2.014,4.5-4.5C11.5,4.515,9.485,2.5,7,2.5z',
	spacer:'M12,10H2V4h10V10z',
	eyeSmall:'M2.613,6.95c0-1.391,2.021-2.518,4.513-2.518 c2.493,0,4.514,1.127,4.514,2.518 M7.125,5.691c-0.682,0-1.235,0.553-1.235,1.235c0,0.681,0.553,1.235,1.235,1.235 c0.681,0,1.235-0.554,1.235-1.235C8.36,6.244,7.807,5.691,7.125,5.691z',
	lock:'M10,9.875H4v-5h6V9.875z M9.5,4.625c0-1.381-1.119-2.5-2.5-2.5s-2.5,1.119-2.5,2.5 M5.5,4.625c0-0.828,0.672-1.5,1.5-1.5s1.5,0.672,1.5,1.5',
	plusSmall:'M3,7h8 M7,11V3',
	listSmall:'M11,4H3V3h8V4z M11,9H3v1h8V9z M11,6H3v1h8V6z',
	thumbXSmall:'M6,6H2V3h4V6z M12,3H8v3h4V3z M6,8H2v3h4V8z M12,8H8v3h4V8z',
	close:'M3,3l8,8 M3,11l8-8',
	plus:'M 6.5591462,0.00335385 6.5033537,13.059146',
	minus:'M 0.0033543,6.5033535 13.059146,6.5591465',
	operand:'m 0.07131516,7.5193495 14.99702684,0',
	fullscreen:'M0,2h2.77v0.898H0.923v1.801H0V2z M0,8.3h0.923v1.8H2.77V11H0V8.3z M1.846,3.8h8.308v5.4H1.846V3.8z M2.77,4.699V8.3h6.46 V4.699H2.77z M9.23,2H12v2.699h-0.923V2.898H9.23V2z M9.23,10.1h1.847V8.3H12V11H9.23V10.1z',
	resize:'M5.795,11l5.121-5.125 M9.293,11l1.623-1.623 M2.314,10.979l8.608-8.607',
	arrow1Left:'M7.5,20l18.338,18.336l6.662-6.664L20.829,20L32.5,8.327l-6.662-6.663L7.5,20z',
	arrow1Right:'M7.5,8.329L19.172,20L7.5,31.674l6.664,6.662L32.5,20L14.164,1.665L7.5,8.329z',
	arrow2Left:'M9.5,20l16.792,16.151l4.208-4.046L17.913,20L30.5,7.896l-4.208-4.047L9.5,20z',
	arrow2Right:'M9.5,7.894L22.084,20L9.5,32.104l4.208,4.047L30.5,20L13.708,3.849L9.5,7.894z',
	plus1Left:'M0,15v10h40V15H0z',
	plus1Right:'M0,15v9.999h15V40h9.998V24.999H40V15H24.998V0H15v15H0z',
	plus2Left:'M5,17v6h30v-6H5z',
	plus2Right:'M5,17.001v5.998h12V35h6V22.999H35v-5.998H23.001V5h-6v12.001H5z',
	cursorThumbs:'M8,12h11v7H8V12z M8,20h11v7H8V20z M20,12h11v7H20V12z M20,20h11v7H20V20z',
	updates:'M7,3.563v4.649 M7,1.541C3.986,1.541,1.541,3.986,1.541,7c0,3.017,2.445,5.459,5.459,5.459c3.017,0,5.459-2.442,5.459-5.459C12.459,3.986,10.014,1.541,7,1.541z M6.333,9.022L7,9.832l0.665-0.81H6.333z'
};

var Svg = (function(imports) {

	var _Sprite = imports.Sprite,
		methodsToInherit = ['dispatchEvent', 'addEventListener', 'removeEventListener', 'removeAllListeners', 'addChild', 'removeChild', 'removeChildren', 'childAdded', 'moveToTop', 'event', 'hitTestPoint', 'hitTestAbs', 'globalToLocal', 'localToGlobal', 'focus', 'blur'];
		pixelValues = [ 'backgroundPositionX', 'backgroundPositionY', 'backgroundRepeatX', 'backgroundRepeatY', 'baselineShift', 'borderBottomLeftRadius', 'borderBottomRightRadius', 'borderBottomWidth', 'borderImageWidth', 'borderLeftWidth', 'borderRadius', 'borderRightWidth', 'borderSpacing', 'borderTopLeftRadius', 'borderTopRightRadius', 'borderTopWidth', 'borderWidth', 'bottom', 'fontSize', 'height', 'left', 'letterSpacing', 'lineHeight', 'marginBottom', 'marginLeft', 'marginRight', 'marginTop', 'maxHeight', 'maxWidth', 'minHeight', 'minWidth', 'outlineOffset', 'outlineWidth', 'overflowX', 'overflowY', 'paddingBottom', 'paddingLeft', 'paddingRight', 'paddingTop', 'right', 'strokeWidth', 'textIndent', 'textLineThroughWidth', 'textOverlineWidth', 'textUnderlineWidth', 'top', 'width', 'wordSpacing' ],
		svgAttribute = ['d', 'points', 'rx', 'ry', 'fill', 'stroke', /*'x', 'y', */'width', 'height'],
		properties = ["backfaceVisibility", "background", "backgroundAttachment", "backgroundBlendMode", "backgroundClip", "backgroundColor", "backgroundImage", "backgroundOrigin", "backgroundPosition", "backgroundPositionX", "backgroundPositionY", "backgroundRepeat", "backgroundRepeatX", "backgroundRepeatY", "backgroundSize", "border", "borderBottom", "borderBottomColor", "borderBottomLeftRadius", "borderBottomRightRadius", "borderBottomStyle", "borderBottomWidth", "borderCollapse", "borderColor", "borderImage", "borderImageOutset", "borderImageRepeat", "borderImageSlice", "borderImageSource", "borderImageWidth", "borderLeft", "borderLeftColor", "borderLeftStyle", "borderLeftWidth", "borderRadius", "borderRight", "borderRightColor", "borderRightStyle", "borderRightWidth", "borderSpacing", "borderStyle", "borderTop", "borderTopColor", "borderTopLeftRadius", "borderTopRightRadius", "borderTopStyle", "borderTopWidth", "borderWidth", "bottom", "boxShadow", "boxSizing", "bufferedRendering", "clear", "color", "content", "cursor", "direction", "display", "float", "font", "fontFamily", "fontKerning", "fontSize", "fontStretch", "fontStyle", "fontVariant", "fontWeight", "height", "imageRendering", "left", "letterSpacing", "lineHeight", "listStyle", "listStyleImage", "listStylePosition", "listStyleType", "margin", "marginBottom", "marginLeft", "marginRight", "marginTop", "mask", "maskType", "maxHeight", "maxWidth", "maxZoom", "minHeight", "minWidth", "minZoom", "opacity", "order", "orientation", "outline", "outlineColor", "outlineOffset", "outlineStyle", "outlineWidth", "overflow", "overflowWrap", "overflowX", "overflowY", "padding", "paddingBottom", "paddingLeft", "paddingRight", "paddingTop", "page", "pageBreakAfter", "paintOrder", "pointerEvents", "position", "resize", "right", "size", "src", "stroke", "strokeDasharray", "strokeDashoffset", "strokeLinecap", "strokeLinejoin", "strokeMiterlimit", "strokeOpacity", "strokeWidth", "tabSize", "tableLayout", "textAlign", "textAnchor", "textDecoration", "textIndent", "textLineThroughColor", "textLineThroughMode", "textLineThroughStyle", "textLineThroughWidth", "textOverflow", "textOverlineColor", "textOverlineMode", "textOverlineStyle", "textOverlineWidth", "textRendering", "textShadow", "textTransform", "textUnderlineColor", "textUnderlineMode", "textUnderlineStyle", "textUnderlineWidth", "top", "transform", "transformOrigin", "transformStyle", "transition", "transitionDelay", "transitionDuration", "transitionProperty", "transitionTimingFunction", "userZoom", "verticalAlign", "visibility", "webkitBackfaceVisibility", "webkitBoxShadow", "webkitFilter", "webkitFontSmoothing", "webkitHighlight", "webkitTransformStyle", "webkitTransition", "webkitTransitionDelay", "webkitTransitionDuration", "webkitTransitionProperty", "webkitTransitionTimingFunction", "webkitUserDrag", "webkitUserModify", "webkitUserSelect", "whiteSpace", "width", "wordBreak", "wordSpacing", "wordWrap", "zIndex", "zoom"];

	function Svg(_vars) {
		this.vars = {};
		var i;
		for(i in _vars) this.vars[i] = _vars[i];
		var el = document.createElementNS('http://www.w3.org/2000/svg', this.vars.type || 'svg');
		el.style.position = 'absolute';
		el.style.display = 'block';
		el.proxy = this;
		this._private = {};
		this.element = el;
		this.children = [];
		this.style = el.style;
		this.name = this.vars.type || 'svg';
		this.events = this.vars.events || globalEvents;
		this.listeners = this.events.listeners;
	}

	(function defineProperties (methodsToInherit, properties, attributes){
		var i = methodsToInherit.length;
		while(i --) {
			Svg.prototype[methodsToInherit[i]] = _Sprite.prototype[methodsToInherit[i]];
		}

		properties.forEach(function(prop) {
    		if(!/fill|stroke|strokeWidth|width|height|x|y|transition/.test(prop)) {
				Object.defineProperty (Svg.prototype, prop, {
					get: function () { return this._private[prop] ; },
					set: function (value) {
			        	this._private[prop] = value;
						this.element.style[prop] = pixelValues.indexOf(prop) > -1 ? value + 'px' : value;
			        }
				});
			}
		});

		attributes.forEach(function(prop) {
			Object.defineProperty (Svg.prototype, prop, {
				get: function () { return this._private[prop] ; },
				set: function (value) {
					this._private[prop] = value;
					this.element.setAttribute(prop, value);
				}
			});
		});

		Object.defineProperty (Svg.prototype, 'scale', {
			get: function () { return this._private.scale ; },
			set: function () {
				var value = !arguments[1] ? arguments[0] : arguments[0] + ',' + arguments[1];
				this._private.scale = value;
				this.element.setAttribute('transform', 'scale(' + value + ')');
			}
		});

		Object.defineProperty (Svg.prototype, 'fillRule', {
			get: function () { return this._private.fillRule ; },
			set: function (value) {
				this._private.fillRule = value;
				this.element.setAttribute('fill-rule', value);
			}
		});

		Object.defineProperty (Svg.prototype, 'strokeWidth', {
            get: function () { return this._private['strokeWidth'] ; },
            set: function (value) {
                this._private['strokeWidth'] = value;
                this.element.setAttribute('stroke-width', value);
            }
        });

		Object.defineProperty (Svg.prototype, 'topParentName', {
			get: function() {
				if(this.parent) {
					return this.parent.topParentName;
				}
				return this.topParentName;
			}
		});

		Object.defineProperty (Svg.prototype, 'stageX', {
			get: function() {
				if(this.parent) {
					return this.parent.stageX + this.x;
				}
				return this.x;
			}
		});

		Object.defineProperty (Svg.prototype, 'stageY', {
			get: function() {
				if(this.parent) {
					return this.parent.stageY + this.y;
				}
				return this.y;
			}
		});

		Object.defineProperty (Svg.prototype, 'absX', {
			get: function() {
				var x = 0;
				var el = this.element;
				if (el.offsetParent) {
					do { x += el.offsetLeft; } while (el = el.offsetParent);
				}
				return x;
			}
		});

		Object.defineProperty (Svg.prototype, 'absY', {
			get: function() {
				var y = 0;
				var el = this.element;
				if (el.offsetParent) {
					do { y += el.offsetTop; } while (el = el.offsetParent);
				}
				return y;
			}
		});

		Object.defineProperty (Svg.prototype, 'class', {
			get: function() {
				return this.element.className;
			},
			set: function(value) {
				this.element.setAttribute('class', value);
			}
		});

		Object.defineProperty (Svg.prototype, 'selectable', {
			get: function() {
				console.log('selectable', this);
				return this._private.selectable;
			},
			set: function(value) {
				this._private.selectable = value;
				if(!this._private.selectable && this.vars.type !== 'input' && this.vars.type !== 'textarea') {
					this.style.cursor = 'default';
					this.style['-webkit-touch-callout'] = 'none';
					this.style['-webkit-user-select'] = 'none';
					this.style['-khtml-user-select'] = 'none';
					this.style['-moz-user-select'] = 'none';
					this.style['-ms-touch-callout'] = 'none';
					this.style['user-select'] = 'none';
				} else {
					this.style.cursor = 'auto';
					this.style['-webkit-touch-callout'] = 'auto';
					this.style['-webkit-user-select'] = 'auto';
					this.style['-khtml-user-select'] = 'auto';
					this.style['-moz-user-select'] = 'auto';
					this.style['-ms-touch-callout'] = 'auto';
					this.style['user-select'] = 'auto';
				}
			}
		});

		Object.defineProperty (Svg.prototype, 'x', {
			get: function() {
				return this._private.x || 0;
			},
			set: function(value) {
				this._private.x = value;
				this.style.left = value + 'px';
			}
		});

		Object.defineProperty (Svg.prototype, 'y', {
			get: function() {
				return this._private.y || 0;
			},
			set: function(value) {
				this._private.y = value;
				this.style.top = value + 'px';
			}
		});

		Object.defineProperty (Svg.prototype, 'alpha', {
			get: function() {
				return this._private.opacity;
			},
			set: function(value) {
				this._private.opacity = value;
				this.style.opacity = value;
			}
		});

		Object.defineProperty (Svg.prototype, 'translate', {
			get: function() {
				return this._private.translate;
			},
			set: function(value) {
				this._private.translate = value;
				this._private.translateX = value[0];
				this._private.translateY = value[1];
				this.style['-webkit-transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
				this.style['-ms-transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
				this.style['transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
			}
		});

		Object.defineProperty (Svg.prototype, 'translateX', {
			get: function() {
				var matrix = new TransformMatrix(this.element);
				return matrix.x;
			},
			set: function(value) {
				this._private.translateX = value;
				this._private.translateY = this._private.translateY || 0;
				this.style['-webkit-transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
				this.style['-ms-transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
				this.style['transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
			}
		});

		Object.defineProperty (Svg.prototype, 'translateY', {
			get: function() {
				var matrix = new TransformMatrix(this.element);
				return matrix.y;
			},
			set: function(value) {
				this._private.translateY = value;
				this._private.translateX = this._private.translateX || 0;
				this.style['-webkit-transform'] = 'translate3d(' + this._private.translateX + 'px,' +this._private.translateY + 'px, 0px)';
				this.style['-ms-transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
				this.style['transform'] = 'translate3d(' + this._private.translateX + 'px,' + this._private.translateY + 'px, 0px)';
			}
		});

		Object.defineProperty (Svg.prototype, 'translateZ', {
			get: function() {
				return this._private.translateZ;
			},
			set: function(value) {
				this._private.translateZ = value;
				this._private.translateZ = this._private.translateZ || 0;
				this.style['-webkit-transform'] = 'translate3d(' + this._private.translateZ + 'px,' + this._private.translateZ + 'px, 0px)';
				this.style['-ms-transform'] = 'translate3d(' + this._private.translateZ + 'px,' + this._private.translateZ + 'px, 0px)';
				this.style['transform'] = 'translate3d(' + this._private.translateZ + 'px,' + this._private.translateZ + 'px, 0px)';
			}
		});

		Object.defineProperty (Svg.prototype, 'rotate', {
			get: function() {
				return this._private.rotate;
			},
			set: function(value) {
				this._private.rotate = value;
				this.style['-webkit-transform'] = 'rotate('+value+'deg)';
				this.style['-moz-transform'] = 'rotate('+value+'deg)';
				this.style['-o-transform'] = 'rotate('+value+'deg)';
				this.style.transform = 'rotate('+value+'deg)';
			}
		});
		Object.defineProperty (Svg.prototype, 'numChildren', {
			get: function() {
				return this.children.length;
			}
		});

		Object.defineProperty (Svg.prototype, 'transition', {
			get: function() {
	 			return this._private.transition;
			},
			set: function(value) {
				this._private.transition = value;
				value = value === 0 ? 'none' : 'all ' + value + 's cubic-bezier(1, 0, 0.3, 1)';
				this.style.WebkitTransition = value;
				this.style.MozTransition = value;
				this.style.OTransition = value;
				this.style.transition = value;
			}
		});

	})(methodsToInherit, properties, svgAttribute);

	return Svg;

})({
	Sprite:Sprite
});


function Path() {
	return new Svg({type:'path'});
}

function Rect() {
	return new Svg({type:'rect'});
}

function TextArea(vars) {
	var textarea;
	vars = vars || {};
	vars.type = 'textarea';
	vars.className = 'TextArea';
	textarea = new Sprite(vars);
	textarea.borderRadius = 0;
	textarea.style['-webkit-appearance'] = 'none';
	textarea.element.addEventListener('focus', function() {
		if(BROWSER_NAME === 'Safari') document.webkitCancelFullScreen();
		stage.disableKeyNavigation = true;
		stage.activeFocus = textarea;
	});
	textarea.element.addEventListener('blur', function() {
		stage.disableKeyNavigation = false;
	});
	return textarea;
}

function TextField(vars) {
	vars = vars || {};
	vars.type = 'span';
	vars.className = 'TextField';
	var textField = new Sprite(vars);
	textField.selectable = true;
	textField.fontFamily = 'sans-serif';
	textField.element.addEventListener('focus', function() {
		stage.disableKeyNavigation = true;
	});
	textField.element.addEventListener('blur', function() {
		stage.disableKeyNavigation = false;
	});
	return textField;
}

function ViewProxy(vars) {

	var proxy = vars || {};

	proxy.events = proxy.events || new EventSandbox();

	return new Sprite(proxy);
}

function VideoPlayer(vars) {
	vars = vars || {};
	vars.type = 'video';
	vars.className = 'VideoPlayer';
	var self = new Sprite(vars);

	self.play = function(){
		self.element.play();
		self.paused = false;
		self.dispatchEvent(PLAY);
		if(isPod()) self.element.webkitEnterFullscreen();
		stage.addEventListener(KEY_DOWN, checkSpaceBar);
	};

	self.pause = function(){
		self.element.pause();
		self.paused = true;
		self.dispatchEvent(PAUSED);
	};

	self.togglePlay = function(){
		if(self.element.paused) {
			self.play();
		} else {
			self.pause();
		}
	};

	self.setSize = function(w, h, updateSpeed) {
		if(updateSpeed === 0) {
			self.width = w;
			self.height = h;
		} else {
			Tween(self, updateSpeed, {width:w, height:h});
		}
	};

	self.setSource = function(value) {
		if(typeSupported('video/mp4','avc1.42E01E, mp4a.40.2')) {
			self.src = REWRITE_BASE + MEDIA_ORIGINAL + value;
			self.element.addEventListener('ended', ended);
		} else if(fileExist(REWRITE_BASE + MEDIA_ORIGINAL + value.replace(getExt(value),'webm'))) {
			self.src = REWRITE_BASE + MEDIA_ORIGINAL + value.replace(getExt(value),'webm');
			self.element.addEventListener('ended', ended);
		} else {
			window.open(REWRITE_BASE + MEDIA_ORIGINAL + value);
		}
	};

	self.destroy = function() {
		if(self) self.element.removeEventListener('ended', ended);
		self.removeKeyListener();
		self = null;
	};

	self.removeKeyListener = function() {
		stage.removeEventListener(KEY_DOWN, checkSpaceBar);
	};

	function typeSupported(vidType, codType) {
		var isSupported = self.element.canPlayType(vidType + ';codecs="' + codType + '"');
		if (isSupported === "") return false;
		return true;
	}

	function showErrorAlert(e) {
		alert("Unfortunately self browser will not play H.264 videos.\nPlease open another browser to view self video.");
	}

	function ended() {
		self.dispatchEvent('playbackEnd');
	}

	function checkSpaceBar(e) {
		if(self && keyCode[e.keyCode] === SPACE_BAR) {
			self.togglePlay();
		}
	}

	return self;
}


function VideoHud(video) {

	var hud = new Sprite(),
		btnWidth = 50,
		btnHeight = 50,
		bgColor = 'rgba(0,0,0,0.65)',
		playBtn,
		fullscreenBtn,
		muteBtn,
		scrub,
		curVideoWidth,
		curVideoHeight,
		scrubWidth,
		showing = true;

	function init() {
		hud.height = 50;
		hud.width = video.width;
		hud.alpha = 1;
		hud.zIndex = 5;

		video.parent.addChild(hud);

		var playIcon;

		if(video.element.paused) {
			playIcon = svgPaths.pause;
		} else {
			playIcon = svgPaths.play;
		}

		playBtn = buildBtn(playIcon, togglePlay);
		hud.addChild(playBtn);

		fullscreenBtn = buildBtn(svgPaths.fullscreen, fullscreen);
		hud.addChild(fullscreenBtn);

		var volumePath = svgPaths.volume;
		var volumeFunc = toggleMute;

		if(USER_AGENT === TABLET) {
			volumePath = '';
			volumeFunc = function() {};
		}

		muteBtn = buildBtn(volumePath, volumeFunc);
		hud.addChild(muteBtn);

		buildScrubZone();

		hud.interval = setInterval(updateProgress, 100);
		video.element.addEventListener('ended', ended);
		stage.addEventListener(MOUSE_MOVE, videoHit);

	}

	function videoHit(e) {
		var x = getX(e),
			y = getY(e);
		if(video.hitTestPoint(x, y)) {
			show();
		} else if(USER_AGENT !== TABLET) {
			hide();
		}
	}

	function show() {
		if(!showing) {
			showing = true;
			hud.display = 'block';
			Tween(hud, UPDATE_SPEED, {alpha:1});
		}
	}

	function hide() {
		if(showing) {
			showing = false;
			Tween(hud, UPDATE_SPEED, {alpha:0, onComplete:function(){
				hud.display = 'none';
				showing = false;
			}});
		}
	}

	hud.resize = function(updateSpeed, x, y, videoWidth, videoHeight) {

		var hudX = x,
			hudY = y,
			hudWidth = videoWidth,
			hudHeight = videoHeight;

		if(videoWidth > STATE.mediaView.width() || videoHeight > STATE.mediaView.height()) {
			hudX = STATE.mediaView.x();
			hudY = STATE.mediaView.y();
			hudWidth = STATE.mediaView.width();
			hudHeight = STATE.mediaView.height();
		}

		curVideoWidth = videoWidth;
		curVideoHeight = videoHeight;
		scrubWidth = hudWidth - (btnWidth * 3);

		if(updateSpeed === 0) {
			hud.width = hudWidth;
			hud.x = Mth.round(hudX);
			hud.y = Mth.round(hudY + hudHeight - hud.height);
			fullscreenBtn.x = hudWidth - fullscreenBtn.width;
			muteBtn.x = hudWidth - fullscreenBtn.width - muteBtn.width;
			scrub.x = btnWidth;
			scrub.width = scrubWidth;
			scrub.hit.width = scrubWidth;
		} else {
			Tween(hud, updateSpeed, {width:hudWidth, x:hudX, y:hudY + videoHeight - hud.height});
			Tween(fullscreenBtn, updateSpeed, {x:hudWidth - fullscreenBtn.width});
			Tween(muteBtn, updateSpeed, {x:hudWidth - fullscreenBtn.width - muteBtn.width});
			Tween(scrub, updateSpeed, {x:btnWidth, width:scrubWidth});
			Tween(scrub.hit, updateSpeed, {width:scrubWidth});
		}

		updateProgress();
	};

	function buildBtn(path, action) {
		var btn = new Sprite();
		btn.width = btnWidth;
		btn.height = btnHeight;
		btn.backgroundColor = bgColor;

		var svg = new Svg();
		svg.id = 'svg';
		svg.width = 12;
		svg.height = 12;
		svg.left = Mth.round((btn.width - svg.width) * 0.5);
		svg.top = Mth.round((btn.height - svg.height) * 0.5);
		btn.addChild(svg);

		var icon = new Path();
		icon.id = 'icon';
		icon.d = path;
		icon.fill = '#FFFFFF';
		icon.alpha = 0.65;
		svg.addChild(icon);

		var hit = new Sprite();
		hit.width = btn.width;
		hit.height = btn.height;
		btn.addChild(hit);

		btn.hit = hit;
		btn.icon = icon;
		btn.svg = svg;
		hit.icon = icon;
		hit.bg = btn;

		hit.addEventListener(CLICK, action);

		hit.addEventListener(MOUSE_OVER, function(e){
			Tween(this.bg, UPDATE_SPEED, {backgroundColor:'rgba(0,0,0,0.85)'});
			Tween(this.icon, UPDATE_SPEED, {alpha:1});
		});
		hit.addEventListener(MOUSE_OUT, function(){
			Tween(this.bg, UPDATE_SPEED, {backgroundColor:bgColor});
			Tween(this.icon, UPDATE_SPEED, {alpha:0.65});
		});

		return btn;
	}

	function buildScrubZone() {
		scrub = new Sprite();
		scrub.zIndex = -1;
		scrub.backgroundColor = bgColor;
		scrub.height = btnHeight;
		hud.addChild(scrub);

		scrub.buffer = new Sprite();
		scrub.buffer.backgroundColor = '#FFFFFF';
		scrub.buffer.alpha = .12;
		scrub.buffer.width = 1;
		scrub.buffer.height = hud.height;
		scrub.addChild(scrub.buffer);

		scrub.progress = new Sprite();
		scrub.progress.backgroundColor = '#FFFFFF';
		scrub.progress.alpha = .25;
		scrub.progress.width = 1;
		scrub.progress.height = hud.height;
		scrub.addChild(scrub.progress);

		scrub.time = new Sprite();
		scrub.time.fontFamily = "pixel";
		scrub.time.fontColor = '#FFF';
		scrub.time.fontSize = 8;
		scrub.time.text = "00:00 / 00:00";
		scrub.time.alpha = .5;
		scrub.addChild(scrub.time);
		scrub.time.x = 10;
		scrub.time.y = 18;

		scrub.head = new Sprite();
		scrub.head.backgroundColor = '#FFFFFF';
		scrub.head.alpha = 0;
		scrub.head.x = 30;
		scrub.head.width = 1;
		scrub.head.height = hud.height;
		scrub.addChild(scrub.head);

		scrub.headTime = new Sprite();
		scrub.headTime.fontFamily = "pixel";
		scrub.headTime.fontColor = '#FFFFFF';
		scrub.headTime.fontSize = 8;
		scrub.headTime.alpha = 0;
		scrub.headTime.text = "00:00";
		scrub.headTime.x = 30;
		scrub.headTime.y = -15;
		scrub.addChild(scrub.headTime);

		scrub.hit = new Sprite();
		scrub.hit.height = hud.height;
		scrub.addChild(scrub.hit);

		scrub.hit.addEventListener(MOUSE_OVER, function(e){
			Tween(scrub.buffer, UPDATE_SPEED, {alpha:0.2});
			Tween(scrub.progress, UPDATE_SPEED, {alpha:0.4});
			Tween(scrub.time, UPDATE_SPEED, {alpha:1});
			Tween(scrub.head, UPDATE_SPEED, {alpha:1});
			Tween(scrub.headTime, UPDATE_SPEED, {alpha:0.65});
			Tween(scrub, UPDATE_SPEED, {backgroundColor:'rgba(0,0,0,0.85)'});
		});
		scrub.hit.addEventListener(MOUSE_OUT, function(){
			Tween(scrub.buffer, UPDATE_SPEED, {alpha:0.12});
			Tween(scrub.progress, UPDATE_SPEED, {alpha:0.25});
			Tween(scrub.time, UPDATE_SPEED, {alpha:0.5});
			Tween(scrub.head, UPDATE_SPEED, {alpha:0});
			Tween(scrub.headTime, UPDATE_SPEED, {alpha:0});
			Tween(scrub, UPDATE_SPEED, {backgroundColor:bgColor});
		});

		scrub.hit.addEventListener(MOUSE_MOVE, scrubMove);
		scrub.hit.addEventListener(CLICK, scrubSeek);
	}

	function scrubMove(e) {
		var pointX = getScrubPoint(e);

		scrub.head.transition = 0;
		scrub.head.x = pointX;
		scrub.headTime.transition = 0;
		scrub.headTime.x = pointX;
		scrub.headTime.text = dropInPoint = secondsToTime((pointX / scrubWidth) * video.element.duration);
	}

	function scrubSeek(e) {
		var pointX = getScrubPoint(e);
		scrub.head.x = pointX;
		scrub.headTime.x = pointX;
		var dropInPoint = (pointX / scrubWidth) * video.element.duration;
		video.element.currentTime = dropInPoint;
		scrub.headTime.text = secondsToTime(dropInPoint);
		updateProgress(video);
	}

	function updateProgress() {
		if(video.element.buffered.length > 0) {
			bufferedPercent = video.element.buffered.end(0) / video.element.duration;
			scrub.buffer.transition = 0;
			scrub.buffer.width = bufferedPercent * scrubWidth;

			playedPercent = video.element.currentTime / video.element.duration;
			scrub.progress.transition = 0;
			scrub.progress.width = playedPercent * scrubWidth;

			scrub.time.text = secondsToTime(video.element.currentTime) + " / " + secondsToTime(video.element.duration);
		}
	}

	function ended() {
		clearInterval(hud.interval);
	}

	function togglePlay(e) {
		if(video.element.paused) {
			video.play();
			playBtn.icon.d = svgPaths.pause;
			hud.interval = setInterval(updateProgress, 50);
		} else {
			video.pause();
			playBtn.icon.d = svgPaths.play;
			/*clearInterval(hud.interval);*/
		}
	}

	function toggleMute(e) {
		if(video.element.volume == 1) {
			mute();
			muteBtn.icon.d = svgPaths.mute;
		} else {
			unmute();
			muteBtn.icon.d = svgPaths.volume;
		}
	}

	function mute() {
		video.element.volume = 0;
		window.alert(video.element);
	}

	function unmute() {
		video.element.volume = 1;
	}

	function getScrubPoint(e) {
		if(TOUCH_DEVICE && e.touches) {
			return e.touches[0].offsetX - btnWidth - scrub.x;
		} else {
			return e.offsetX;
		}
	}

	function secondsToTime(seconds) {
		minutes = Math.floor(seconds / 60);
		seconds = Math.floor(seconds - (minutes * 60));
		minutes = minutes < 10 ? "0" + minutes : minutes;
		seconds = seconds < 10 ? "0" + seconds : seconds;
		return minutes + ":" + seconds;
	}

	function fullscreen(e) {
		if (document.webkitIsFullScreen) {
			document.webkitCancelFullScreen();
		} else {
			if (video.element.mozRequestFullScreen) {
				video.element.mozRequestFullScreen();
				video.element.setAttribute("controls", "true");
			} else {
				video.element.webkitEnterFullscreen();
			}
		}
		document.addEventListener('webkitfullscreenchange', fullscreenChange, false);
		document.addEventListener('mozfullscreenchange', fullscreenChange, false);
	}

	function fullscreenChange(e) {
		var isFull = document.isFullScreen | document.mozFullScreen | document.webkitIsFullScreen;
		if(!isFull) {
			video.element.removeAttribute("controls");
		}
	}

	init.call(hud);
	return hud;
}


function VimeoPlayer(vars) {

	vars = vars || {};
	vars.type = 'iframe';
	vars.className = 'VimeoPlayer';
	var self = new Sprite(vars),
		currentPlayer,
		targetOrigin,
		source;

	self.style.pointerEvents = 'auto';

	init();

	self.pointerEvents = 'auto';

	self.setSource = function(value) {
		try {
			source = 'https://player.vimeo.com/video/' + value.split("vimeo:")[1];
			// bug #752
			targetOrigin = isPad() ? window.location.protocol + '//' + window.location.host : source;
			if(isPod()) {
				window.location.href = source;
			} else {
				self.src = source + '?api=1&player_id=' + currentPlayer;
				self.element.setAttribute('width', 640);
				self.element.setAttribute('height', 480);
				self.element.setAttribute('frameborder', 0);
				self.element.setAttribute('webkitallowfullscreen', true);
				self.element.setAttribute('mozallowfullscreen', true);
				self.element.setAttribute('allowfullscreen', true);
				window.addEventListener("message", messaging, false);
			}
		} catch(e) {
			trace('there may have been a vimeo api error: ', e);
		}
	};

	self.togglePlay = function(e) {
		if(self.paused) {
			self.play();
		} else {
			self.pause();
		}
	};

	self.play = function() {
		window.addEventListener("message", messaging, false);
		self.element.contentWindow.postMessage(JSON.stringify({
			"method": "play",
			"value": ""
		}), targetOrigin);
		stage.addEventListener(KEY_DOWN, checkSpaceBar);
		self.paused = false;
		self.dispatchEvent(PLAY);
	};

	self.pause = function() {
		if(self.element.contentWindow) {
			self.element.contentWindow.postMessage(JSON.stringify({
				"method": "pause",
				"value": ""
			}), targetOrigin);
		}
		self.paused = true;
		self.dispatchEvent(PAUSED);
		window.removeEventListener("message", messaging, false);
	};

	self.setSize = function(w, h, updateSpeed) {
		self.transition = 0;
		self.width = w;
		self.height = h;
	};

	self.align = function(x, y) {
		self.transition = 0;
		self.style.left = x + "px";
		self.style.top = y + "px";
	};

	self.destroy = function() {
		window.removeEventListener("message", messaging, false);
		self.removeKeyListener();
		self = null;
	};

	function ended() {
		self.dispatchEvent('playbackEnd');
	}

	function init() {
		currentPlayer = 'player' + VimeoPlayer.getNextPlayerID();
		self.element.id = currentPlayer;
		self.element.setAttribute('frameborder', '0');
		self.element.setAttribute('webkitAllowFullScreen','');
		self.element.setAttribute('mozallowfullscreen','');
		self.element.setAttribute('allowFullScreen', '');
		self.zIndex = 0;
	}

	function messaging(e) {

		var data = JSON.parse(e.data);

		if(data.event === 'ready') {
			onReady(data);
		}

		if(data.method === 'getVideoWidth') {
			self.width = data.value;
			self.videoWidth = data.value;
			self.element.setAttribute('width', data.value);
		}

		if(data.method === 'getVideoHeight') {
			self.height = data.value;
			self.videoHeight = data.value;
			self.element.setAttribute('height', data.value);
			self.dispatchEvent(VIMEO_METADATA_LOADED);
		}

		if(data.event === 'finish') {
			ended();
		}

		if(data.event === 'play') {
			self.dispatchEvent(PLAY);
		}

		if(data.event === 'pause') {
			self.dispatchEvent(PAUSED);
		}
	}

	function onReady(data) {
		if(self.element.contentWindow) {
			self.element.contentWindow.postMessage(JSON.stringify({
				"method": "getVideoWidth",
				"value": data.player_id
			}), source);

			self.element.contentWindow.postMessage(JSON.stringify({
				"method": "getVideoHeight",
				"value": data.player_id
			}), source);

			self.element.contentWindow.postMessage(JSON.stringify({
				"method": 'addEventListener',
				"value": 'finish'
			}), source);

			self.element.contentWindow.postMessage(JSON.stringify({
				"method": 'addEventListener',
				"value": 'pause'
			}), source);

			self.element.contentWindow.postMessage(JSON.stringify({
				"method": 'addEventListener',
				"value": 'play'
			}), source);
		}
	}

	function checkSpaceBar(e) {
		if(self && keyCode[e.keyCode] === SPACE_BAR) {
			self.togglePlay();
		}
	}

	self.removeKeyListener = function() {
		stage.removeEventListener(KEY_DOWN, checkSpaceBar);
	};

	return self;
}

VimeoPlayer.playerID = 1;

VimeoPlayer.getNextPlayerID = function() {
	return VimeoPlayer.playerID++;
};


function SiteController(vars) {

	var self = new ControllerProxy({events:new EventSandbox()});
	var popup,
		overlayMode,
		siteInit = true,
		state,
		passwd,
		authEvent,
		_captionLocal = {};

	vars.parent = self;
	vars.siteControllerEvents = self.events;

	self.siteView = new SiteView(vars);
	stage.addChild(self.siteView);

	function init() {

		stage.backgroundColor = LAYOUT_MODEL.siteBackgroundColor;

		self.siteView.updateStyle();
		webkitFontOptions();
		vars.parentView = self.siteView;
		vars.parentController = self;
		vars.events = self.events;
		vars.siteControllerEvents = self.events;
		self.mediaModule = new vars.MediaModule(self.events, self.siteView);
		self.menuController = new vars.MenuController(vars);
		self.footerController = new vars.FooterController(vars);
		self.logoController = new vars.LogoController(vars);
		self.navbarController = new vars.NavbarController(vars);
		self.caption = new Caption();
		self.siteView.addChild(self.caption.container);
		self.addressController = new vars.AddressController(vars);
		self.cursor = new vars.Cursor(vars);
		self.tooltip = new vars.Tooltip(vars);
		self.fullscreen = new vars.Fullscreen(vars);
		self.service = new vars.SiteService(vars);
		if(isLogin) self.login = new Login(vars);

		/*temp fix for unescaped html, can be removed by July 2015*/
		LAYOUT_MODEL.logoHtml = LAYOUT_MODEL.logoHtml.replace(/\\*"/g, '\\"');
		LAYOUT_MODEL.logoText = LAYOUT_MODEL.logoText.replace(/\\*"/g, '\\"');
		/***********/

		self.events.dispatchEvent(LAYOUT_MODEL_CHANGE, {id:'layoutModelInit'});
		self.events.addEventListener(NAVBAR_OVERLAY_BTN_CLICK, navbarOverlayBtnClick);
		self.events.addEventListener(NAVBAR_NAV_CLICK, navbarNavClick);
		self.events.addEventListener(NAVBAR_FULLSCREEN, navbarFullscreen);
		self.events.addEventListener(MENU_CLICK, menuClick);
		self.events.addEventListener(FOOTER_CLICK, footerClick);
		self.events.addEventListener(LOGO_CLICK, logoClick);
		self.events.addEventListener(THUMB_CLICK, thumbClick);
		self.events.addEventListener(ADDRESS_URI_CHANGE, addressChange);
		self.events.addEventListener(ADMIN_LOADED, adminEventListeners);
		self.events.addEventListener(CONTACT_FORM_SUBMIT, contactFormSubmit);
		self.events.addEventListener(SHARE_FORM_SUBMIT, shareFormSubmit);
		self.events.addEventListener(INQUIRY_FORM_SUBMIT, inquiryFormSubmit);
		self.events.addEventListener(POP_UP, onPopup);
		self.events.addEventListener('OVER_LOGO', checkMenuLogoOverlap);
		self.events.addEventListener('privateGalleryAuthCheck', privateGalleryAuthCheck);
		self.events.addEventListener('passwordViewUpdate', passwordUpdate);
		self.events.addEventListener('updateAssetId', checkCaptionOnScrollStop);

		self.events.addEventListener(PAGE_LOADED, loadCustomJs);

		stage.addEventListener(RESIZE_END, resize);
		stage.addEventListener(ORIENTATION_CHANGE, orientationChange);
		stage.addEventListener(KEY_DOWN, keyDown);
		self.events.dispatchEvent(RESIZE_END);

		self.events.addEventListener('cursorAxisUpdate', cursorAxisUpdate);

		ORIENTATION = stage.width > stage.height ? 'horizontal' : 'vertical';
	}

	function adminEventListeners(e) {
		dx.admin.events.addEventListener(ACCOUNT_MODEL_CHANGE, accountModelChange);
		dx.admin.events.addEventListener(FONTS_MODEL_CHANGE, fontsModelChange);
		dx.admin.events.addEventListener(FILES_MODEL_CHANGE, filesModelChange);
		dx.admin.events.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		dx.admin.events.addEventListener(MEDIA_MODEL_CHANGE, mediaModelChange);
		dx.admin.events.addEventListener(NAVBAR_MODEL_CHANGE, navbarModelChange);
		dx.admin.events.addEventListener(PDF_MODEL_CHANGE, pdfModelChange);
		dx.admin.events.addEventListener(SETTINGS_MODEL_CHANGE, settingsModelChange);
		dx.admin.events.addEventListener(SECTIONS_MODEL_CHANGE, sectionsModelChange);
		dx.admin.events.addEventListener(ADMIN_MOUSE_DOWN, adminMouseDown);
		dx.admin.events.addEventListener(ADMIN_MOUSE_UP, adminMouseUp);
	}

	function loadCustomJs(e) {
		self.events.dispatchEvent(SITE_SERVICE_GET_FILE, {name:'js'});
	}

	function adminMouseDown() {
		self.events.dispatchEvent(ADMIN_MOUSE_DOWN);
	}

	function adminMouseUp() {
		self.events.dispatchEvent(ADMIN_MOUSE_UP);
	}

	function resize(e) {
		if(!isVimeoFullscreen()) {
			ORIENTATION = stage.width > stage.height ? 'horizontal' : 'vertical';
			self.events.dispatchEvent(RESIZE_END);
		}
		self.siteView.updatePosition(e);
		updateCaptionStyle();
	}

	function orientationChange(e) {
		ORIENTATION = stage.width > stage.height ? 'horizontal' : 'vertical';
		self.events.dispatchEvent(ORIENTATION_CHANGE);
	}

	function onPopup(e) {
		popup = new vars.Popup(vars, e);
	}

	function isVimeoFullscreen() {
		if(screen.height === stage.height && screen.width === stage.width && !self.fullscreen.dxFullscreen) {
			showElementsForVimeo('none');
			return true;
		} else {
			showElementsForVimeo('block');
			return false;
		}
	}

	function showElementsForVimeo(display) {
		self.menuController.menuView.display = display;
		self.footerController.footerView.display = display;
		self.logoController.logoView.display = display;
		if(self.navbarController) self.navbarController.navbarView.display = display;
	}

	function navbarOverlayBtnClick(e) {
		self.events.dispatchEvent(ADDRESS_OVERLAY_CHANGE, e);
	}

	function navbarNavClick(e) {
		self.events.dispatchEvent(ADDRESS_ASSET_CHANGE, e);
	}

	function navbarFullscreen(e) {
		self.events.dispatchEvent(FULLSCREEN_TOGGLE);
	}

	function footerClick(e) {
		self.events.dispatchEvent(ADDRESS_SECTION_CHANGE, e);
	}

	function menuClick(e) {
		self.events.dispatchEvent(ADDRESS_SECTION_CHANGE, e);
	}

	function thumbClick(e) {
		self.events.dispatchEvent(ADDRESS_SECTION_CHANGE, e);
	}

	function logoClick(e) {
		self.events.dispatchEvent(ADDRESS_SECTION_CHANGE, e);
	}

	function keyDown(e) {
		if((e.keyCode === keyName.LEFT_ARROW || e.keyCode === keyName.RIGHT_ARROW) && !stage.disableKeyNavigation) {
			self.events.dispatchEvent(ADDRESS_ASSET_CHANGE, {navDir:keyCode[e.keyCode]});
		}
	}

	function buildIntro(e) {
		self.savedUriInfo = e;
		self.events.addEventListener(INTRO_COMPLETE, introComplete);
		self.introView = new vars.IntroView(vars);
		self.siteView.addChild(self.introView);
		self.events.addEventListener(RESIZE_END, self.introView.updatePosition);
	}

	function addressChange(e) {
		state = e;
		self.events.dispatchEvent(PAUSE_MEDIA);
		layoutCalcs.isLandingMedia = e.info.isLandingMedia;
		safariPulsingTextHack();
		/*check for valid media.  append it to the event object before dispatch*/
		cursorThumbsUpdate(e);

		if((!e.path || e.info.isIntroGallery) && siteInit && LAYOUT_MODEL.introFile) {
			buildIntro(e);
		} else {
			self.events.dispatchEvent(SITE_URI_CHANGE, e);
		}
		siteInit = false;
		if(passwd) removePasswordView(0.35);
		updateCaption();
	}

	function checkCaptionOnScrollStop(e) {
		if(USER_AGENT !== MOBILE) {
			var mediaToRender = removeLinksFromMedia(csvToArray(state.section.mediaItems));
			var mediaItem = getMediaById(mediaToRender[e.id]);
			_captionLocal = mediaItem.overrides || {};
			var anchorTo = firstValid(mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
			var captionDefault = firstValid(mediaItem.overrides.captionDefault, STATE.overrides.captionDefault);
			if((captionDefault || state.mode.indexOf('caption') > -1) && USER_AGENT !== MOBILE && mediaItem.caption && anchorTo === 'site') {
				updateCaptionStyle();
				self.caption.text = plainTextToHtml(mediaItem.caption);
				self.caption.show();
			} else {
				self.caption.text = '';
				self.caption.hide();
				if(self.caption.scroll) self.caption.scroll.destroy();
			}
		}
	}

	function updateCaption() {
		if(state && state.asset) {
			var mediaItem = state.asset;
			if(!mediaItem.overrides) mediaItem.overrides = {};
			_captionLocal = mediaItem.overrides || {};
			var anchorTo = firstValid(USER_AGENT === MOBILE ? 'site' : undefined, mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
			if(state.mode.indexOf('caption') > -1 && mediaItem.caption && anchorTo === 'site') {
				updateCaptionStyle();
				self.caption.text = plainTextToHtml(mediaItem.caption);
				self.caption.show();
			} else {
				self.caption.text = '';
				self.caption.hide();
				if(self.caption.scroll) self.caption.scroll.destroy();
			}
		} else if(self.caption){
			self.caption.text = '';
			self.caption.hide();
			if(self.caption.scroll) self.caption.scroll.destroy();
		}
	}

	function updateCaptionStyle() {
			self.caption.container.transition = 0;
			self.caption.container.zIndex = STATE.captionView.zIndex;

			var alignVars = {
				onInit:function() {
					if(self.caption.scroll) {
						self.caption.scroll.hide();
					}
				},
				onComplete:function() {
					if(self.caption.scroll) {
						self.caption.scroll.show();
						self.caption.scroll.resize();
					}
				}
			};
			
			var bgColor = firstValid(_captionLocal.captionBackgroundRectColor, STATE.overrides.captionBackgroundRectColor); 
			var bgAlpha = firstValid(USER_AGENT === MOBILE ? LAYOUT_MODEL.overlayAlpha : undefined, _captionLocal.captionBackgroundAlpha, STATE.overrides.captionBackgroundAlpha); 
			self.caption.backgroundColor = toRgba(bgColor, bgAlpha);		
			self.caption.fontFamily = _captionLocal.captionFont || STATE.overrides.captionFont;
			self.caption.fontSize = firstValid(_captionLocal.captionFontSize, STATE.overrides.captionFontSize);
			self.caption.fontColor = _captionLocal.captionFontColor || STATE.overrides.captionFontColor;
			self.caption.width = firstValid(USER_AGENT === MOBILE ? stage.width : undefined, _captionLocal.captionWidth, STATE.overrides.captionWidth);
			self.caption.height = firstValid(USER_AGENT === MOBILE ? stage.height : undefined, _captionLocal.captionHeight, STATE.overrides.captionHeight);
			alignVars.width = firstValid(_captionLocal.captionWidth, STATE.overrides.captionWidth);
			alignVars.height = firstValid(_captionLocal.captionHeight, STATE.overrides.captionHeight);
			alignVars.hOrigin = 0;
			alignVars.vOrigin = 0;
			alignVars.hRange = stage.width;
			alignVars.vRange = stage.height;
			alignVars.hAlign = _captionLocal.captionAlignHorizontal || STATE.overrides.captionAlignHorizontal;
			alignVars.vAlign = _captionLocal.captionAlignVertical || STATE.overrides.captionAlignVertical;
			alignVars.hOffset = firstValid(_captionLocal.captionOffsetX, STATE.overrides.captionOffsetX);
			alignVars.vOffset = firstValid(_captionLocal.captionOffsetY, STATE.overrides.captionOffsetY);
			self.caption.textAlign = _captionLocal.captionTextAlign || STATE.overrides.captionTextAlign;
			self.caption.paddingTop = firstValid(_captionLocal.captionPaddingTop, STATE.overrides.captionPaddingTop);
			self.caption.paddingRight = firstValid(_captionLocal.captionPaddingRight, STATE.overrides.captionPaddingRight);
			self.caption.paddingBottom = firstValid(_captionLocal.captionPaddingBottom, STATE.overrides.captionPaddingBottom);
			self.caption.paddingLeft = firstValid(_captionLocal.captionPaddingLeft, STATE.overrides.captionPaddingLeft);
			self.caption.buildScroll({
				color:_captionLocal.captionScrollbarColor || STATE.overrides.captionScrollbarColor,
				hover:_captionLocal.captionScrollbarHover || STATE.overrides.captionScrollbarHover,
				align: firstValid(USER_AGENT === MOBILE ? 'top' : undefined, _captionLocal.captionTextAlignVertical, STATE.overrides.captionTextAlignVertical),
				side:_captionLocal.captionScrollbarAlignment || STATE.overrides.captionScrollbarAlignment,
				alpha:firstValid(_captionLocal.captionScrollbarBgAlpha, STATE.overrides.captionScrollbarBgAlpha),
				width:firstValid(_captionLocal.captionScrollbarWidth, STATE.overrides.captionScrollbarWidth),
				offsetX:firstValid(_captionLocal.captionScrollbarHorizontalOffset, STATE.overrides.captionScrollbarHorizontalOffset),
				offsetY:firstValid(_captionLocal.captionScrollbarVerticalOffset, STATE.overrides.captionScrollbarVerticalOffset)
			});
			if(USER_AGENT === MOBILE) {
				self.caption.mask.y = 40;
				self.caption.mask.width = stage.width;
				self.caption.mask.height = stage.height - 40;
				self.caption.container.x = 0;
				self.caption.container.y = 0;
				self.caption.paddingTop = 10;
				self.caption.paddingRight = 10;
				self.caption.paddingBottom = 10;
				self.caption.paddingLeft = 10;
			} else {
				Align(self.caption.container, self.updateSpeed, alignVars);
			}
	};

	function safariPulsingTextHack() {
		if(isFillSite() && layoutCalcs.isLandingMedia) {
			self.events.dispatchEvent('fillSiteMode');
		} else {
			self.events.dispatchEvent('nonFillSiteMode');
		}
	}

	function introComplete(e) {
		self.events.removeEventListener(INTRO_COMPLETE, introComplete);
		self.events.removeEventListener(RESIZE_END, self.introView.updatePosition);
		if(self.introView) self.siteView.removeChild(self.introView);
		self.events.dispatchEvent(SITE_URI_CHANGE, self.savedUriInfo);
		delete self.savedUriInfo;
	}

	function privateGalleryAuthCheck(e) {
		if(!passwd) {
			passwd = password({events:self.events});
			self.events.dispatchEvent(PAUSE_MEDIA);
		} else {
			passwd.setMessage('PASSWORD');
			passwd.open();
		}
	}

	function passwordUpdate(passed) {
		if(passed) {
			removePasswordView();
		} else {
			passwd.setMessage('INCORRECT PASSWORD');
			setTimeout(function(){
				passwd.setMessage('');
			}, 1000);
		}
	}

	function removePasswordView() {
		if(passwd) passwd.close();
	}

	function onAuthenticated() {
		removePasswordView(0.35);
	}

	function accountModelChange(e) {
		self.events.dispatchEvent(ACCOUNT_MODEL_CHANGE, e);
	}

	function fontsModelChange(e) {
		self.events.dispatchEvent(FONTS_MODEL_CHANGE, e);
	}

	function filesModelChange(e) {
		/*trace('filesModelChange', e);*/
	}

	function layoutModelChange(e) {
		if(e && /site/.test(e.id)) self.siteView.updateStyle();
		webkitFontOptions();
		self.events.dispatchEvent(LAYOUT_MODEL_CHANGE, e);
		updateCaption();
	}

	function webkitFontOptions() {
		if(BROWSER_NAME == 'Safari') {
			if(LAYOUT_MODEL.fontRenderingOptions.enable) {
				self.siteView.style.webkitFontSmoothing = LAYOUT_MODEL.fontRenderingOptions.webkitFontSmoothing;
				self.siteView.style.webkitTextStrokeWidth = LAYOUT_MODEL.fontRenderingOptions.webkitTextStrokeWidth + 'px';
			} else {
				self.siteView.style.webkitFontSmoothing = '';
				self.siteView.style.webkitTextStrokeWidth = '';
			}
		}
	}

	function mediaModelChange(e) {
		self.addressController.setTitle();
		self.events.dispatchEvent(MEDIA_MODEL_CHANGE, e);
		if(exists(state, 'asset.id') === e.id) state.asset = e; 
		updateCaption();
	}

	function navbarModelChange(e) {
		self.events.dispatchEvent(NAVBAR_MODEL_CHANGE, e);
	}

	function pdfModelChange(e) {
		self.events.dispatchEvent(PDF_MODEL_CHANGE, e);
	}

	function settingsModelChange(e) {
		self.events.dispatchEvent(SETTINGS_MODEL_CHANGE, e);
	}

	function sectionsModelChange(e) {
		if(exists(state, 'section.id') === e.id) {
			var section = getSectionById(e.id);
			STATE.section(section);
		}
		self.events.dispatchEvent(SECTIONS_MODEL_CHANGE, e);
		updateCaption();
	}

	function contactFormSubmit(e) {
		self.events.dispatchEvent(SITE_SERVICE_CONTACT_FORM_SUBMIT, e);
	}

	function shareFormSubmit(e) {
		self.events.dispatchEvent(SITE_SERVICE_SHARE_FORM_SUBMIT, e);
	}

	function inquiryFormSubmit(e) {
		self.events.dispatchEvent(SITE_SERVICE_INQUIRY_FORM_SUBMIT, e);
	}

	function checkMenuLogoOverlap() {
		stage.addEventListener(MOUSE_MOVE, menuLogoHitTest);
	}

	function endCheckMenuLogoOverlap() {
		self.logoController.logoView.element.style.pointerEvents = 'auto';
	}

	function menuLogoHitTest(e) {
		if(self.menuController.menuView.menuText.hitTestPoint(e.pageX, e.pageY)) {
			self.logoController.logoView.element.style.pointerEvents = 'none';
		} else {
			self.logoController.logoView.element.style.pointerEvents = 'auto';
		}
	}

	function cursorAxisUpdate(e) {
		if(self.cursor) self.cursor.dispatchEvent('cursorAxisUpdate', e);
	}

	function cursorThumbsUpdate(e) {
		var isThumbIcon = STATE.overrides.thumbnailType === 'none' ? false : true;
		if(self.cursor) self.cursor.dispatchEvent('cursorThumbsUpdate', isThumbIcon);
	}

	init.call(self);
	return self;
}

stage.addEventListener(LOAD, function() {
	dx.site = new SiteController({
		Sprite:Sprite,
		TextField:TextField,
		Bitmap:Bitmap,
		Tile:Tile,
		FooterController:FooterController,
		FooterView:FooterView,
		LogoController:LogoController,
		LogoView:LogoView,
		MediaModule:MediaModule,
		MenuController:MenuController,
		MenuView:MenuView,
		NavbarController:NavbarController,
		NavbarView:NavbarView,
		AddressController:AddressController,
		OverlayController:OverlayController,
		OverlayView:OverlayView,
		ImageView:ImageView,
		VideoView:VideoView,
		PageView:PageView,
		ContactView:ContactView,
		VideoPlayer:VideoPlayer,
		VimeoPlayer:VimeoPlayer,
		LoadingIndicator:LoadingIndicator,
		ThumbsModule:ThumbsModule,
		Cursor:Cursor,
		Tooltip:Tooltip,
		Fullscreen:Fullscreen,
		password:password,
		IntroView:IntroView,
		SiteService:SiteService,
		Popup:Popup,
		TouchNav:TouchNav
	});
});

function SiteView(vars) {

	var self = new ViewProxy({events:vars.siteControllerEvents});
	self.zIndex = 0;
	self.overflow = 'hidden';

	self.addEventListener(CHILD_ADDED, function(child) {
		self.updatePosition();
	});

	self.updatePosition = function(e) {
		self.width = stage.width;
		self.height = stage.height;
	};

	self.updateStyle = function(e) {
		if(stage.backgroundColor) {
			Tween(self, UPDATE_SPEED, { backgroundColor:LAYOUT_MODEL.siteBackgroundColor });
		} else {
			self.backgroundColor = LAYOUT_MODEL.siteBackgroundColor;
		}
	};

	return self;

}

var layoutCalcs = {

	_logoWidth:0, _logoHeight:0,
	_footerWidth:0, _footerHeight:0,
	_fotomotoWidth:0, _fotomotoHeight:0,
	_navbarHeight:0,
	_thumbsVisible:false, _section:undefined,
	_maskView:{},
	mobileFooterPadding:5,
	isLandingMedia: false,
	_activeMediaType: undefined,
	_mediaMarginPrefix: undefined,
	set activeMediaType(value) {
		this._mediaMarginPrefix = formatMediaType(value);
		this._activeMediaType = value;
	},

	navbarView:{
		x:function(_navbarWidth) {
			var offsetX = percentToPixels(LAYOUT_MODEL.navbarOffsetX, stage.width);
			if(USER_AGENT !== MOBILE) {
				switch(LAYOUT_MODEL.navbarAlignHorizontal) {
					case 'left':
						return offsetX;
						break;
					case 'center':
						if(USER_AGENT === TABLET) return ((stage.width - _navbarWidth) * 0.5);
						return ((stage.width - _navbarWidth) * 0.5) + offsetX;
						break;
					case 'right':
						return stage.width - _navbarWidth + offsetX;
						break;
				}
			} else if(USER_AGENT === MOBILE && LAYOUT_MODEL.menuAlignHorizontal === 'right') {
				return 10;
			}
			return stage.width - _navbarWidth - 15;
		},
		y:function(_navbarHeight) {
			_navbarHeight = _navbarHeight || layoutCalcs._navbarHeight;
			layoutCalcs._navbarHeight = _navbarHeight;
			var offsetY = percentToPixels(LAYOUT_MODEL.navbarOffsetY, stage.height);
			if(USER_AGENT !== MOBILE) {
				switch(LAYOUT_MODEL.navbarAlignVertical) {
					case 'top':
						return offsetY;
						break;
					case 'center':
						return ((stage.height - _navbarHeight) * 0.5) + offsetY;
						break;
					case 'bottom':
						if(USER_AGENT === TABLET && layoutCalcs.isDisplace() && STATE.overrides.thumbnailSide === 'bottom') {
							return stage.height - 22;
						}
						return stage.height - _navbarHeight + offsetY;
						break;
				}
			}
			return 15;
		}
	},

	footerView:{
		x:function(_footerWidth) {
			_footerWidth = _footerWidth || layoutCalcs._footerWidth;
			layoutCalcs._footerWidth = _footerWidth;
			var offsetX = percentToPixels(LAYOUT_MODEL.copyrightOffsetX, stage.width);
			if(USER_AGENT !== MOBILE) {
				switch(LAYOUT_MODEL.copyrightAlignHorizontal) {
					case 'left':
						return offsetX;
						break;
					case 'center':
						if(USER_AGENT === TABLET) return ((stage.width - _footerWidth) * 0.5);
						return ((stage.width - _footerWidth) * 0.5) + offsetX;
						break;
					case 'right':
						return stage.width - _footerWidth + offsetX;
						break;
				}
			} else if(USER_AGENT === MOBILE) {
				return layoutCalcs.mobileFooterPadding;
			}
			return 0;
		},
		y:function(_footerHeight) {
			_footerHeight = _footerHeight || layoutCalcs._footerHeight;
			layoutCalcs._footerHeight = _footerHeight;
			var offsetY = percentToPixels(LAYOUT_MODEL.copyrightOffsetY, stage.height);
			if(USER_AGENT !== MOBILE) {
				switch(LAYOUT_MODEL.copyrightAlignVertical) {
					case 'top':
						return offsetY;
						break;
					case 'center':
						return ((stage.height - _footerHeight) * 0.5) + offsetY;
						break;
					case 'bottom':
						if(USER_AGENT === TABLET && layoutCalcs.isDisplace() && STATE.overrides.thumbnailSide === 'bottom') {
							return stage.height - 22;
						}
						return stage.height - _footerHeight + offsetY;
						break;
				}
			} else if(USER_AGENT === MOBILE) {
				return stage.height - _footerHeight - layoutCalcs.mobileFooterPadding;
			}
			return 0;
		}
	},

	logoView:{
		x:function(_logoWidth) {
			_logoWidth = _logoWidth || layoutCalcs._logoWidth;
			layoutCalcs._logoWidth = _logoWidth;
			var offsetX = 0;
			if(USER_AGENT === MOBILE) {
				return 0;
			} else if(USER_AGENT === TABLET) {
				offsetX = percentToPixels(LAYOUT_MODEL.tabletLogoOffsetX, stage.width);
				switch(LAYOUT_MODEL.logoAlignHorizontal) {
					case 'left':
						return offsetX;
						break;
					case 'center':
						return ((stage.width - _logoWidth) * 0.5) + offsetX;
						break;
					case 'right':
						return stage.width - _logoWidth - offsetX;
						break;
				}
			} else {
				offsetX = percentToPixels(LAYOUT_MODEL.logoOffsetX, stage.width);
				switch(LAYOUT_MODEL.logoAlignHorizontal) {
					case 'left':
						return offsetX;
						break;
					case 'center':
						return ((stage.width - _logoWidth) * 0.5) + offsetX;
						break;
					case 'right':
						return stage.width - _logoWidth - offsetX;
						break;
				}
			}
			return 0;
		},
		y:function(_logoHeight) {
			_logoHeight = _logoHeight || layoutCalcs._logoHeight;
			layoutCalcs._logoHeight = _logoHeight;
			var offsetY = 0;
			if(USER_AGENT === MOBILE) {
				return 0;
			} else if(USER_AGENT === TABLET) {
				offsetY = percentToPixels(LAYOUT_MODEL.tabletLogoOffsetY, stage.height);
				switch(LAYOUT_MODEL.logoAlignVertical) {
					case 'top':
						return offsetY;
						break;
					case 'center':
						return ((stage.height - _logoHeight) * 0.5) + offsetY;
						break;
					case 'bottom':
						return stage.height - _logoHeight - offsetY;
						break;
				}
			} else {
				offsetY = percentToPixels(LAYOUT_MODEL.logoOffsetY, stage.height);
				switch(LAYOUT_MODEL.logoAlignVertical) {
					case 'top':
						return offsetY;
						break;
					case 'center':
						return ((stage.height - _logoHeight) * 0.5) + offsetY;
						break;
					case 'bottom':
						return stage.height - _logoHeight - offsetY;
						break;
				}
			}
			return 0;
		}
	},

	menuBullet:{
		updateSize: function(isSub) {
			var testBuild = document.createElement('div'),
				fontSize = isSub ? LAYOUT_MODEL.menuSubFontSize : LAYOUT_MODEL.menuFontSize;
			testBuild.innerHTML = menuBullet[LAYOUT_MODEL.menuBulletType];
			testBuild.setAttribute('style', 'margin:0; padding:0; position:absolute; display:block; white-space:nowrap; opacity:0; font-family:' + LAYOUT_MODEL.menuFont + '; font-size:' + fontSize + 'px;');
			document.body.appendChild(testBuild);
			layoutCalcs.menuBullet.width = parseInt(window.getComputedStyle(testBuild, null).width, 10);
			layoutCalcs.menuBullet.height = parseInt(window.getComputedStyle(testBuild, null).height, 10);
			document.body.removeChild(testBuild);
			testBuild = null;
		}
	},

	menuText:{
		x:function(_menuTextWidth) {
			_menuTextWidth = _menuTextWidth || layoutCalcs._menuTextWidth;
			layoutCalcs._menuTextWidth = _menuTextWidth;
			var hPadding = percentToPixels(LAYOUT_MODEL.menuTextPaddingHorizontal, stage.width);
			if(USER_AGENT === MOBILE) {
				return 0;
			} else if(USER_AGENT === TABLET && /top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				hPadding = 10;
			}
			switch(LAYOUT_MODEL.menuTextAlignHorizontal) {
				case 'left':
					return hPadding;
					break;
				case 'center':
					return ((layoutCalcs.menuView.width() - _menuTextWidth) * 0.5);
					break;
				case 'right':
					return layoutCalcs.menuView.width() - _menuTextWidth - hPadding;
					break;
			}
		},
		y:function(_menuTextHeight) {
			if(USER_AGENT === TABLET && LAYOUT_MODEL.menuAlignHorizontal !== 'right' && LAYOUT_MODEL.logoAlignHorizontal === 'left' && percentToPixels(LAYOUT_MODEL.menuTextPaddingVertical, stage.height) < layoutCalcs.logoView.y() + layoutCalcs._logoHeight) {
				return layoutCalcs._logoHeight + 10;
			} else if(USER_AGENT === MOBILE) {
				return layoutCalcs._logoHeight;
			} else {
				switch(LAYOUT_MODEL.menuTextAlignVertical) {
					case 'top':
						return percentToPixels(LAYOUT_MODEL.menuTextPaddingVertical, stage.height);
						break;
					case 'center':
						if(_menuTextHeight > layoutCalcs.menuView.height()) {
							return 0;
						}
						return ((layoutCalcs.menuView.height() - _menuTextHeight) * 0.5) + percentToPixels(LAYOUT_MODEL.menuTextPaddingVertical, stage.height);
						break;
					case 'bottom':
						return layoutCalcs.menuView.height() - _menuTextHeight - percentToPixels(LAYOUT_MODEL.menuTextPaddingVertical, stage.height);
						break;
				}
			}
			return 0;
		}
	},

	menuView:{
		x:function() {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return 0;
			}
			if(/top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.height) + percentToPixels(LAYOUT_MODEL.menuOffsetY, stage.width);
			} else if(LAYOUT_MODEL.menuAlignHorizontal === 'right') {
				return percentToPixels(LAYOUT_MODEL.sitePaddingRight, stage.width);
			}
			return percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.height);
		},
		y:function() {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return 0;
			}
			if(/left|right/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height) + percentToPixels(LAYOUT_MODEL.menuOffsetY, stage.height);
			} else if(LAYOUT_MODEL.menuAlignHorizontal === 'bottom') {
				return percentToPixels(LAYOUT_MODEL.sitePaddingBottom, stage.width);
			} 
			return percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.width);
		},
		width:function() {
			if(USER_AGENT === MOBILE) {
				return stage.width;
			}
			var defaultWidth = layoutCalcs._menuTextWidth < 150 ? 150 : layoutCalcs._menuTextWidth;
			if(USER_AGENT === TABLET && LAYOUT_MODEL.menuWidthMobile) {
				return LAYOUT_MODEL.menuWidthMobile ? LAYOUT_MODEL.menuWidthMobile : defaultWidth;
			} else if(USER_AGENT === TABLET && /top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return defaultWidth;
			}
		   	if(/left|right/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return percentToPixels(LAYOUT_MODEL.menuWidth, stage.width);
			}
			return (stage.width - (percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.width) + percentToPixels(LAYOUT_MODEL.sitePaddingRight, stage.width)) - percentToPixels(LAYOUT_MODEL.menuOffsetY, stage.width));
		},
		height:function() {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return stage.height;
			}
			if(/top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return percentToPixels(LAYOUT_MODEL.menuWidth, stage.height);
			}
			return (stage.height - (percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height) + percentToPixels(LAYOUT_MODEL.sitePaddingBottom, stage.height)) - percentToPixels(LAYOUT_MODEL.menuOffsetY, stage.height));
		}
	},

	mediaView:{
		x:function() {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return 0;
			} 
			if(LAYOUT_MODEL.menuAlignHorizontal === 'left') {
				return percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.width) + percentToPixels(LAYOUT_MODEL.menuWidth, stage.width) - percentToPixels(LAYOUT_MODEL.menuOffsetX, stage.width);
			}
			return percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.width);
		},
		y:function() {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return 0;
			}
			if(LAYOUT_MODEL.menuAlignHorizontal === 'top') {
				return percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height) + percentToPixels(LAYOUT_MODEL.menuWidth, stage.height) - percentToPixels(LAYOUT_MODEL.menuOffsetX, stage.height);
			}
			return percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height);
		},
		width:function(thumbHMargin) {
			var margin = thumbHMargin || 0;
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return stage.width;
			} else if(/left|right/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return (stage.width - (percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.width) + percentToPixels(LAYOUT_MODEL.sitePaddingRight, stage.width) + percentToPixels(LAYOUT_MODEL.menuWidth, stage.width) - percentToPixels(LAYOUT_MODEL.menuOffsetX, stage.width) + margin));
			}
			return (stage.width - (percentToPixels(LAYOUT_MODEL.sitePaddingLeft, stage.width) + percentToPixels(LAYOUT_MODEL.sitePaddingRight, stage.width)));
		},
		height:function() {
			if(USER_AGENT === TABLET && LAYOUT_MODEL.navbarAlignVertical === 'bottom' && layoutCalcs.isDisplace() && STATE.overrides.thumbnailSide === 'bottom') {
				return stage.height - 30;
			}
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				return stage.height;
			}
			if(/top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal)) {
				return (stage.height - (percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height) + percentToPixels(LAYOUT_MODEL.sitePaddingBottom, stage.height) + percentToPixels(LAYOUT_MODEL.menuWidth, stage.height) - percentToPixels(LAYOUT_MODEL.menuOffsetX, stage.height)));
			}
			return (stage.height - (percentToPixels(LAYOUT_MODEL.sitePaddingTop, stage.height) + percentToPixels(LAYOUT_MODEL.sitePaddingBottom, stage.height)));
		},
		size:{
			get x() {
				return layoutCalcs.mediaView.x();
			},
			get y() {
				return layoutCalcs.mediaView.y();
			},
			get width() {
				return layoutCalcs.mediaView.width();
			},
			get height() {
				return layoutCalcs.mediaView.height();
			}
		}
	},

	landingMediaView:{
		x:function() {
			return 0;
		},
		y:function() {
			return 0;
		},
		width:function(mediaItemWidth) {
			return stage.width;
		},
		height:function(mediaItemHeight) {
			return stage.height;
		}
	},

	mediaMask: {
		x:function() {
			if(layoutCalcs._mediaMarginPrefix === 'contact') {
				return 0;
			}
			if(USER_AGENT === MOBILE) {
				return layoutCalcs._mediaMarginPrefix === 'page' ? LAYOUT_MODEL.pageScrollbarWidth : 0;
			}
			var x = percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginLeft'], stage.width);
			return x;
		},
		y:function() {
			if(layoutCalcs._mediaMarginPrefix === 'contact') {
				return 0;
			}
			if(USER_AGENT === MOBILE) {
				return layoutCalcs._mediaMarginPrefix === 'page' ? 50 : 0;
			}
			var y = percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginTop'], stage.height);
			return y;
		},
		width:function(mediaItemWidth) {
			if(layoutCalcs._mediaMarginPrefix === 'contact') {
				return layoutCalcs.mediaView.width();
			}
			if(USER_AGENT === MOBILE) {
				return layoutCalcs._mediaMarginPrefix === 'page' ? stage.width - (LAYOUT_MODEL.pageScrollbarWidth * 2) -5 : stage.width;
			}
			var width = (mediaItemWidth || layoutCalcs.mediaView.width()) - (percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginLeft'], stage.width) + percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginRight'], stage.width));
			return width;
		},
		height:function(mediaItemHeight) {
			if(layoutCalcs._mediaMarginPrefix === 'contact') {
				return layoutCalcs.mediaView.height();
			}
			if(USER_AGENT === MOBILE) {
				return layoutCalcs._mediaMarginPrefix === 'page' ? stage.height - 50 : stage.height;
			}
			var height = (mediaItemHeight || layoutCalcs.mediaView.height()) - (percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginTop'], stage.height) + percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginBottom'], stage.height));
			return height;
		}
	},

	captionView:{
		size: function(captionText) {
			layoutCalcs.captionView.currentText = captionText || layoutCalcs.captionView.currentText;
			var testBuild = document.createElement('span'), padding = 10;
			testBuild.innerHTML = layoutCalcs.captionView.currentText;
			testBuild.setAttribute('style', 'position:absolute; display:block; white-space:nowrap; opacity:0; font-family:' + LAYOUT_MODEL.captionFont + '; font-size:' + LAYOUT_MODEL.captionFontSize + 'px;');
			document.body.appendChild(testBuild);
			var leftMargin = percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginLeft'], stage.height);
			var rightMargin = percentToPixels(STATE.overrides[layoutCalcs._mediaMarginPrefix + 'MarginRight'], stage.height);
			var width = STATE.mediaView.width() - (leftMargin + rightMargin);
			if(testBuild.clientWidth > width) {
				layoutCalcs.captionView.width = width;
				testBuild.style.width = width + 'px';
				testBuild.style.whiteSpace = 'normal';
				layoutCalcs.captionView.height = testBuild.clientHeight;
			} else {
				layoutCalcs.captionView.width = testBuild.clientWidth;
				layoutCalcs.captionView.height = testBuild.clientHeight;
			}
			document.body.removeChild(testBuild);
			testBuild = null;
		}
	},

	isDisplace:function() {
		return USER_AGENT !== MOBILE && layoutCalcs._section && layoutCalcs._thumbsVisible ? layoutCalcs._section.thumb && STATE.overrides.thumbnailType === 'strip' && STATE.overrides.thumbnailDock === 'displace': false;
	}

};

function touchDeviceTransition() {
	return TOUCH_DEVICE ? 'hSlide' : undefined;
}

var STATE = {
	overrides: {
		containerColor: LAYOUT_MODEL.containerColor,
		transitionType: touchDeviceTransition() || LAYOUT_MODEL.transitionType,
		transitionDuration: LAYOUT_MODEL.transitionDuration,
		imageAlignHorizontal: LAYOUT_MODEL.imageAlignHorizontal,
		imageAlignVertical: LAYOUT_MODEL.imageAlignVertical,
		imageScaleType: LAYOUT_MODEL.imageScaleType,
		videoScaleType: LAYOUT_MODEL.videoScaleType,
		videoAutoPlay: LAYOUT_MODEL.videoAutoPlay,
		imageVideoMarginTop: LAYOUT_MODEL.imageVideoMarginTop,
		imageVideoMarginRight: LAYOUT_MODEL.imageVideoMarginRight,
		imageVideoMarginBottom: LAYOUT_MODEL.imageVideoMarginBottom,
		imageVideoMarginLeft: LAYOUT_MODEL.imageVideoMarginLeft,
		imageVideoInactiveAlpha: LAYOUT_MODEL.imageVideoInactiveAlpha,
		imageVideoScrollbarAlignment: LAYOUT_MODEL.imageVideoScrollbarAlignment,
		imageVideoScrollbarHorizontalOffset: LAYOUT_MODEL.imageVideoScrollbarHorizontalOffset,
		imageVideoScrollbarVerticalOffset: LAYOUT_MODEL.imageVideoScrollbarVerticalOffset,
		imageVideoScrollbarColor: LAYOUT_MODEL.imageVideoScrollbarColor,
		imageVideoScrollbarHover: LAYOUT_MODEL.imageVideoScrollbarHover,
		imageVideoScrollbarBgTransparency: LAYOUT_MODEL.imageVideoScrollbarBgTransparency,
		imageVideoScrollbarWidth: LAYOUT_MODEL.imageVideoScrollbarWidth,
		pageMarginTop: LAYOUT_MODEL.pageMarginTop,
		pageMarginRight: LAYOUT_MODEL.pageMarginRight,
		pageMarginBottom: LAYOUT_MODEL.pageMarginBottom,
		pageMarginLeft: LAYOUT_MODEL.pageMarginLeft,
		thumbnailDefaultOn: LAYOUT_MODEL.thumbnailDefaultOn,
		thumbnailMasonry: LAYOUT_MODEL.thumbnailMasonry,
		thumbnailGap: LAYOUT_MODEL.thumbnailGap,
		thumbnailDock: LAYOUT_MODEL.thumbnailDock,
		thumbnailType: LAYOUT_MODEL.thumbnailType,
		thumbnailSize: LAYOUT_MODEL.thumbnailSize,
		thumbnailSide: LAYOUT_MODEL.thumbnailSide,
		thumbnailHorizontalMargin: LAYOUT_MODEL.thumbnailHorizontalMargin,
		thumbnailVerticalMargin: LAYOUT_MODEL.thumbnailVerticalMargin,
		thumbnailGridTransparency: LAYOUT_MODEL.thumbnailGridTransparency,
		thumbnailHoverAlpha: LAYOUT_MODEL.thumbnailHoverAlpha,
		thumbnailHoverColor: LAYOUT_MODEL.thumbnailHoverColor,
		thumbnailScrollbarAlignment: LAYOUT_MODEL.thumbnailScrollbarAlignment,
		thumbnailScrollbarColor: LAYOUT_MODEL.thumbnailScrollbarColor,
		thumbnailScrollbarHover: LAYOUT_MODEL.thumbnailScrollbarHover,
		thumbnailSelectedColor: LAYOUT_MODEL.thumbnailSelectedColor,
		thumbnailScrollbarHorizontalOffset: LAYOUT_MODEL.thumbnailScrollbarHorizontalOffset,
		thumbnailScrollbarVerticalOffset: LAYOUT_MODEL.thumbnailScrollbarVerticalOffset,
		thumbnailScrollType: LAYOUT_MODEL.thumbnailScrollType,
		thumbnailScrollbarBgAlpha: LAYOUT_MODEL.thumbnailScrollbarBgAlpha,
		thumbnailScrollbarWidth: LAYOUT_MODEL.thumbnailScrollbarWidth,

		captionDefault: LAYOUT_MODEL.captionDefault,
		captionBackgroundAlpha: LAYOUT_MODEL.captionBackgroundAlpha,
		captionBackgroundRectColor: LAYOUT_MODEL.captionBackgroundRectColor,
		captionFont: LAYOUT_MODEL.captionFont,
		captionFontColor: LAYOUT_MODEL.captionFontColor,
		captionFontSize: LAYOUT_MODEL.captionFontSize,
		captionWidth: LAYOUT_MODEL.captionWidth,
		captionHeight: LAYOUT_MODEL.captionHeight,
		captionAlignHorizontal: LAYOUT_MODEL.captionAlignHorizontal,
		captionAlignVertical: LAYOUT_MODEL.captionAlignVertical,
		captionOffsetX: LAYOUT_MODEL.captionOffsetX,
		captionOffsetY: LAYOUT_MODEL.captionOffsetY,
		captionTextAlign: LAYOUT_MODEL.captionTextAlign,
		captionTextAlignVertical: LAYOUT_MODEL.captionTextAlignVertical,
		captionPaddingTop: LAYOUT_MODEL.captionPaddingTop,
		captionPaddingRight: LAYOUT_MODEL.captionPaddingRight,
		captionPaddingBottom: LAYOUT_MODEL.captionPaddingBottom,
		captionPaddingLeft: LAYOUT_MODEL.captionPaddingLeft,
		captionScrollbarWidth: LAYOUT_MODEL.captionScrollbarWidth,
		captionScrollbarAlignment: LAYOUT_MODEL.captionScrollbarAlignment,
		captionScrollbarColor: LAYOUT_MODEL.captionScrollbarColor,
		captionScrollbarHover: LAYOUT_MODEL.captionScrollbarHover,
		captionScrollbarHorizontalOffset: LAYOUT_MODEL.captionScrollbarHorizontalOffset,
		captionScrollbarVerticalOffset: LAYOUT_MODEL.captionScrollbarVerticalOffset,
		captionScrollbarBgAlpha: LAYOUT_MODEL.captionScrollbarBgAlpha,
		captionAnchorTo: LAYOUT_MODEL.captionAnchorTo
	},
	section: function(section) {
		var sectionOverrides = section.overrides || {};
		var thumbnail = section.thumb || {};
		STATE.overrides = {
			get containerColor() { return firstValid(sectionOverrides.containerColor, LAYOUT_MODEL.containerColor) },
			get transitionType() { return firstValid(touchDeviceTransition(), sectionOverrides.transitionType, LAYOUT_MODEL.transitionType) },
			get transitionDuration() { return firstValid(sectionOverrides.transitionDuration, LAYOUT_MODEL.transitionDuration) },
			get imageAlignHorizontal() { return firstValid(sectionOverrides.imageAlignHorizontal, LAYOUT_MODEL.imageAlignHorizontal) },
			get imageAlignVertical() { return firstValid(sectionOverrides.imageAlignVertical, LAYOUT_MODEL.imageAlignVertical) },
			get imageScaleType() { return firstValid(sectionOverrides.imageScaleType, LAYOUT_MODEL.imageScaleType) },
			get videoScaleType() { return firstValid(sectionOverrides.videoScaleType, LAYOUT_MODEL.videoScaleType) },
			get videoAutoPlay() { return firstValid(sectionOverrides.videoAutoPlay, LAYOUT_MODEL.videoAutoPlay) },
			get imageVideoMarginTop() { return firstValid(sectionOverrides.imageVideoMarginTop, LAYOUT_MODEL.imageVideoMarginTop) },
			get imageVideoMarginRight() { return firstValid(sectionOverrides.imageVideoMarginRight, LAYOUT_MODEL.imageVideoMarginRight) },
			get imageVideoMarginBottom() { return firstValid(sectionOverrides.imageVideoMarginBottom, LAYOUT_MODEL.imageVideoMarginBottom) },
			get imageVideoMarginLeft() { return firstValid(sectionOverrides.imageVideoMarginLeft, LAYOUT_MODEL.imageVideoMarginLeft) },
			get pageMarginTop() { return LAYOUT_MODEL.pageMarginTop },
			get pageMarginRight() { return LAYOUT_MODEL.pageMarginRight },
			get pageMarginBottom() { return LAYOUT_MODEL.pageMarginBottom },
			get pageMarginLeft() { return LAYOUT_MODEL.pageMarginLeft },
			get imageVideoInactiveAlpha() { return firstValid(sectionOverrides.imageVideoInactiveAlpha, LAYOUT_MODEL.imageVideoInactiveAlpha) },
			get imageVideoScrollbarAlignment() { return firstValid(sectionOverrides.imageVideoScrollbarAlignment, LAYOUT_MODEL.imageVideoScrollbarAlignment) },
			get imageVideoScrollbarHorizontalOffset() { return firstValid(sectionOverrides.imageVideoScrollbarHorizontalOffset, LAYOUT_MODEL.imageVideoScrollbarHorizontalOffset) },
			get imageVideoScrollbarVerticalOffset() { return firstValid(sectionOverrides.imageVideoScrollbarVerticalOffset, LAYOUT_MODEL.imageVideoScrollbarVerticalOffset) },
			get imageVideoScrollbarColor() { return firstValid(sectionOverrides.imageVideoScrollbarColor, LAYOUT_MODEL.imageVideoScrollbarColor) },
			get imageVideoScrollbarHover() { return firstValid(sectionOverrides.imageVideoScrollbarHover, LAYOUT_MODEL.imageVideoScrollbarHover) },
			get imageVideoScrollbarBgTransparency() { return firstValid(sectionOverrides.imageVideoScrollbarBgTransparency, LAYOUT_MODEL.imageVideoScrollbarBgTransparency) },
			get imageVideoScrollbarWidth() { return firstValid(sectionOverrides.imageVideoScrollbarWidth, LAYOUT_MODEL.imageVideoScrollbarWidth) },
			get thumbnailDefaultOn() { return firstValid(thumbnail.defaultOn, LAYOUT_MODEL.thumbnailDefaultOn) },
			get thumbnailMasonry() { return firstValid(thumbnail.masonry, LAYOUT_MODEL.thumbnailMasonry) },
			get thumbnailGap() { return firstValid(thumbnail.gap, LAYOUT_MODEL.thumbnailGap) },
			get thumbnailDock() { return firstValid(thumbnail.dock, LAYOUT_MODEL.thumbnailDock) },
			get thumbnailType() { return thumbnail.type === 'default' ? LAYOUT_MODEL.thumbnailType : firstValid(thumbnail.type, LAYOUT_MODEL.thumbnailType) },
			get thumbnailSize() { return firstValid(thumbnail.size, LAYOUT_MODEL.thumbnailSize) },
			get thumbnailSide() { return firstValid(thumbnail.side, LAYOUT_MODEL.thumbnailSide) },
			get thumbnailHorizontalMargin() { return firstValid(thumbnail.horizontalMargin, LAYOUT_MODEL.thumbnailHorizontalMargin) },
			get thumbnailVerticalMargin() { return firstValid(thumbnail.verticalMargin, LAYOUT_MODEL.thumbnailVerticalMargin) },
			get thumbnailGridTransparency() { return firstValid(thumbnail.gridTransparency, LAYOUT_MODEL.thumbnailGridTransparency) },
			get thumbnailHoverAlpha() { return firstValid(thumbnail.hoverAlpha, LAYOUT_MODEL.thumbnailHoverAlpha) },
			get thumbnailHoverColor() { return firstValid(thumbnail.hoverColor, LAYOUT_MODEL.thumbnailHoverColor) },
			get thumbnailScrollbarAlignment() { return firstValid(thumbnail.scrollbarAlignment, LAYOUT_MODEL.thumbnailScrollbarAlignment) },
			get thumbnailScrollbarColor() { return firstValid(thumbnail.scrollbarColor, LAYOUT_MODEL.thumbnailScrollbarColor) },
			get thumbnailScrollbarHover() { return firstValid(thumbnail.scrollbarHover, LAYOUT_MODEL.thumbnailScrollbarHover) },
			get thumbnailSelectedColor() { return firstValid(thumbnail.selectedColor, LAYOUT_MODEL.thumbnailSelectedColor) },
			get thumbnailScrollbarHorizontalOffset() { return firstValid(thumbnail.scrollbarHorizontalOffset, LAYOUT_MODEL.thumbnailScrollbarHorizontalOffset) },
			get thumbnailScrollbarVerticalOffset() { return firstValid(thumbnail.scrollbarVerticalOffset, LAYOUT_MODEL.thumbnailScrollbarVerticalOffset) },
			get thumbnailScrollType() { return firstValid(thumbnail.scrollType, LAYOUT_MODEL.thumbnailScrollType) },
			get thumbnailScrollbarBgAlpha() { return firstValid(thumbnail.scrollbarBgAlpha, LAYOUT_MODEL.thumbnailScrollbarBgAlpha) },
			get thumbnailScrollbarWidth() { return firstValid(thumbnail.scrollbarWidth, LAYOUT_MODEL.thumbnailScrollbarWidth) },

			get captionDefault() { return firstValid(sectionOverrides.captionDefault, LAYOUT_MODEL.captionDefault) },
			get captionBackgroundAlpha() { return firstValid(sectionOverrides.captionBackgroundAlpha, LAYOUT_MODEL.captionBackgroundAlpha) },
			get captionBackgroundRectColor() { return firstValid(sectionOverrides.captionBackgroundRectColor, LAYOUT_MODEL.captionBackgroundRectColor) },
			get captionFont() { return firstValid(sectionOverrides.captionFont, LAYOUT_MODEL.captionFont) },
			get captionFontColor() { return firstValid(sectionOverrides.captionFontColor, LAYOUT_MODEL.captionFontColor) },
			get captionFontSize() { return firstValid(sectionOverrides.captionFontSize, LAYOUT_MODEL.captionFontSize) },
			get captionWidth() { return firstValid(sectionOverrides.captionWidth, LAYOUT_MODEL.captionWidth) },
			get captionHeight() { return firstValid(sectionOverrides.captionHeight, LAYOUT_MODEL.captionHeight) },
			get captionAlignHorizontal() { return firstValid(sectionOverrides.captionAlignHorizontal, LAYOUT_MODEL.captionAlignHorizontal) },
			get captionAlignVertical() { return firstValid(sectionOverrides.captionAlignVertical, LAYOUT_MODEL.captionAlignVertical) },
			get captionOffsetX() { return firstValid(sectionOverrides.captionOffsetX, LAYOUT_MODEL.captionOffsetX) },
			get captionOffsetY() { return firstValid(sectionOverrides.captionOffsetY, LAYOUT_MODEL.captionOffsetY) },
			get captionTextAlign() { return firstValid(sectionOverrides.captionTextAlign, LAYOUT_MODEL.captionTextAlign) },
			get captionTextAlignVertical() { return firstValid(sectionOverrides.captionTextAlignVertical, LAYOUT_MODEL.captionTextAlignVertical) },
			get captionPaddingTop() { return firstValid(sectionOverrides.captionPaddingTop, LAYOUT_MODEL.captionPaddingTop) },
			get captionPaddingRight() { return firstValid(sectionOverrides.captionPaddingRight, LAYOUT_MODEL.captionPaddingRight) },
			get captionPaddingBottom() { return firstValid(sectionOverrides.captionPaddingBottom, LAYOUT_MODEL.captionPaddingBottom) },
			get captionPaddingLeft() { return firstValid(sectionOverrides.captionPaddingLeft, LAYOUT_MODEL.captionPaddingLeft) },

			get captionScrollbarWidth() { return firstValid(sectionOverrides.captionScrollbarWidth, LAYOUT_MODEL.captionScrollbarWidth) },
			get captionScrollbarAlignment() { return firstValid(sectionOverrides.captionScrollbarAlignment, LAYOUT_MODEL.captionScrollbarAlignment) },
			get captionScrollbarColor() { return firstValid(sectionOverrides.captionScrollbarColor, LAYOUT_MODEL.captionScrollbarColor) },
			get captionScrollbarHover() { return firstValid(sectionOverrides.captionScrollbarHover, LAYOUT_MODEL.captionScrollbarHover) },
			get captionScrollbarHorizontalOffset() { return firstValid(sectionOverrides.captionScrollbarHorizontalOffset, LAYOUT_MODEL.captionScrollbarHorizontalOffset) },
			get captionScrollbarVerticalOffset() { return firstValid(sectionOverrides.captionScrollbarVerticalOffset, LAYOUT_MODEL.captionScrollbarVerticalOffset) },
			get captionScrollbarBgAlpha() { return firstValid(sectionOverrides.captionScrollbarBgAlpha, LAYOUT_MODEL.captionScrollbarBgAlpha) },
			get captionAnchorTo() { return firstValid(sectionOverrides.captionAnchorTo, LAYOUT_MODEL.captionAnchorTo) }
		}
	},
	footerView: {
		zIndex: 6
	},
	introView: {
		zIndex: 500
	},
	logoView: {
		zIndex: 7
	},
	mediaView: {
		zIndex: 1,
		zoneX: function() { return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.x() : layoutCalcs.mediaView.x(); },
		zoneY: function() { return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.y() : layoutCalcs.mediaView.y() },
		zoneWidth: function() {
			return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.width() : layoutCalcs.mediaView.width();
		},
		zoneHeight: function() {
			return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.height() : layoutCalcs.mediaView.height();
		},
		x: function() {
			var x = isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.x() : layoutCalcs.mediaView.x();
			if(layoutCalcs.isDisplace() && STATE.overrides.thumbnailSide === 'left') {
				return x + percentToPixels(STATE.overrides.thumbnailHorizontalMargin, stage.width) + THUMB_SIZES[STATE.overrides.thumbnailSize].width;
			}
			return x;
		},
		y: function() {
			var y = isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.y() : layoutCalcs.mediaView.y();
			if(layoutCalcs.isDisplace() && STATE.overrides.thumbnailSide === 'top') {
				return y + percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height) + THUMB_SIZES[STATE.overrides.thumbnailSize].height;
			}
			return y;
		},
		width: function() {
			var width = isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.width() : layoutCalcs.mediaView.width();
			if(layoutCalcs.isDisplace() && (STATE.overrides.thumbnailSide === 'left' || STATE.overrides.thumbnailSide === 'right')) {
				return width - percentToPixels(STATE.overrides.thumbnailHorizontalMargin, stage.width) - THUMB_SIZES[STATE.overrides.thumbnailSize].width;
			}
			return width;
		},
		height: function() {
			var height = isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.height() : layoutCalcs.mediaView.height();
			if(layoutCalcs.isDisplace() && (STATE.overrides.thumbnailSide === 'top' || STATE.overrides.thumbnailSide === 'bottom')) {
				return height - percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height) - THUMB_SIZES[STATE.overrides.thumbnailSize].height;
			}
			return height;
		},
		maskX: function() { return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.x() : layoutCalcs.mediaMask.x() },
		maskY: function() { return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.y() : layoutCalcs.mediaMask.y() },
		maskWidth: function(mediaItemWidth) {
			return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.width() : layoutCalcs.mediaMask.width(mediaItemWidth);
		},
		maskHeight: function(mediaItemHeight) {
			return isFillSite() && layoutCalcs.isLandingMedia ? layoutCalcs.landingMediaView.height() : layoutCalcs.mediaMask.height(mediaItemHeight);
		},
		hAlign: function() { return isFillSite() && layoutCalcs.isLandingMedia ? LAYOUT_MODEL.landingMediaAlignHorizontal : STATE.overrides.imageAlignHorizontal },
		vAlign: function() { return isFillSite() && layoutCalcs.isLandingMedia ? LAYOUT_MODEL.landingMediaAlignVertical : STATE.overrides.imageAlignVertical },
		transitionDuration: function() { return layoutCalcs.isLandingMedia ? LAYOUT_MODEL.landingMediaTransitionDuration : STATE.overrides.transitionDuration },
		imageScaleType: function() {
			return layoutCalcs.isLandingMedia ? LAYOUT_MODEL.landingMediaScaleType : STATE.overrides.imageScaleType;
		},
		videoScaleType: function() {
			return layoutCalcs.isLandingMedia ? LAYOUT_MODEL.landingMediaScaleType : STATE.overrides.videoScaleType;
		},
		videoAutoPlay: function() {
			return STATE.overrides.videoAutoPlay;
		},
		backgroundColor: function() {
			if(isFillSite() && layoutCalcs.isLandingMedia) {
				return LAYOUT_MODEL.siteBackgroundColor;
			} else if(layoutCalcs.isLandingMedia) {
				return LAYOUT_MODEL.containerColor;
			}
			return STATE.overrides.containerColor; 
		}
	},
	menuView: {
		zIndex: 4
	},
	navbarView: {
		zIndex: 6
	},
	overlayView: {
		x: function() {	
			return STATE.mediaView.x()
		},
		y: function() {
			return STATE.mediaView.y()
		},
		zIndex: 3
	},
	captionView: {
		zIndex: USER_AGENT === MOBILE ? 2 : 5
	}

};

function SiteService(vars) {

	var self = new ControllerProxy({events:vars.events});

	function init() {
		self.events.addEventListener(SITE_SERVICE_CONTACT_FORM_SUBMIT, contactFormSubmit);
		self.events.addEventListener(SITE_SERVICE_SHARE_FORM_SUBMIT, shareFormSubmit);
		self.events.addEventListener(SITE_SERVICE_INQUIRY_FORM_SUBMIT, inquiryFormSubmit);
		self.events.addEventListener(SITE_SERVICE_GET_FILE, getFile);
		self.events.addEventListener('getMediaList', getMediaList);
	}

	function getMediaList(e) {
		new JSONXHR({url:REWRITE_BASE + PHP + 'SiteService.php', params:{
			method:'getMediaList',
			ids:e.ids
		}, callback:self.getMediaListResponse});
	}

	self.getMediaListResponse = function(media) {
		for(var item in media) {
			MEDIA_MODEL[item] = media[item];
		}
		dx.site.events.dispatchEvent('mediaListResponse');
	};

	function contactFormSubmit(e) {
		new JSONP({url:REWRITE_BASE + PHP + 'SiteService.php', params:'method=contactForm' + e, callback:'dx.site.service.contactResponse'});
	}

	self.contactResponse = function(response) {
		if(response.status === 'pass') {
			dx.site.events.dispatchEvent(CONTACT_FORM_SENT, response);
		} else {
			throw 'contact form failed';
		}
	};

	function shareFormSubmit(e) {
		new JSONP({url:REWRITE_BASE + PHP + 'SiteService.php', params:'method=shareForm' + e, callback:'dx.site.service.shareResponse'});
	}

	self.shareResponse = function(response) {
		if(response.status === 'pass') {
			dx.site.events.dispatchEvent(SHARE_FORM_SENT, response);
		} else {
			throw 'share form failed';
		}
	};

	function inquiryFormSubmit(e) {
		new JSONP({url:REWRITE_BASE + PHP + 'SiteService.php', params:'method=inquiryForm' + e, callback:'dx.site.service.inquiryResponse'});
	}

	self.inquiryResponse = function(response) {
		if(response.status === 'pass') {
			dx.site.events.dispatchEvent(INQUIRY_FORM_SENT, response);
		} else {
			throw 'inquiry form failed';
		}
	};

	function getFile(e) {
		new JSONXHR({url:REWRITE_BASE + PHP + 'SiteService.php', params:{
			method:'getFile',
			name:e.name
		}, callback:self.customJsResponse});
	}

	self.customJsResponse = function(response) {
		if(response.content) {
			var head = document.getElementsByTagName('head')[0];
			var script = document.createElement('script');
		    script.type = 'text/javascript';
		    script.id = 'customJs';
		    script.innerHTML = response.content.replace(/\\/g, '');
			var id = document.getElementById("customJs");
			if(!id) {
				head.appendChild(script);
			} else {
				head.replaceChild(script, id);
			}
		}
	};

	init.call(self);
	return self;
}

var Address = {

	path: '',
	pathNames: [],
	listeners: [],
	firstload: true,
	docTitle: document.title || '',
	base: REWRITE_BASE,
	ga: (ACCOUNT_MODEL.pageStatistics.search("UA-") > -1),

	addEventListener: function(type, callback) {

		if(window.history.pushState && window.location.hash) {
			this.removeHash(window.location.hash);
		} else if(!window.history.pushState) {
			this.addHash();
		}

		this.listeners.push({'type':type, 'listener':callback});

		this.setListeners();

		setTimeout(function(){
			Address.fireListeners.call(Address);
		}, 0);
	},

	setListeners: function() {
		if(window.attachEvent) {
			this.savedHash = window.location.hash;
			setInterval(this.checkHash, 200);
		} else {
			window.onpopstate = window.onhashchange = function() {
				Address.fireListeners();
			};
		}
	},

	fireListeners: function() {
		var i;
		this.path = this.getPath();
		this.pathNames = this.getPathNames();
		for(i in this.listeners) {
			if(document.webkitIsFullScreen) {
				this.listeners[i].listener(this.value);
			} else {
				this.listeners[i].listener(this.path);
			}
		}
	},

	setValue: function(value) {
		this.firstload = false;
		value = this.trim(value);
		this.value = value;
		if(value.indexOf("http") === 0) {
			window.location = value;
		} else if(window.history.pushState && !document.webkitIsFullScreen) {
			value = this.addDashes(value);
			window.history.pushState({value:this.base + value}, '', this.base + value);
			this.fireListeners();
		} else if(!document.webkitIsFullScreen) {
			value = this.addDashes(value);
			window.location = this.base + '#/' + value;
		} else {
			value = this.addDashes(value);
			this.fireListeners();
		}
		if(window._gaq && this.ga) {
			window._gaq.push(['_trackPageview']);
		}
	},

	setPath: function(value) {
		this.setValue(value.replace("?", "%3F"));
	},

	back: function() {
		history.back();
	},

	setLocation: function(value) {
		window.location = value;
	},

	getBase: function() {
		return this.base;
	},

	getPath: function() {
		if(this.value && document.webkitIsFullScreen) {
			return decodeURIComponent(this.trim(this.value));
		} else if(window.location.hash) {
			return decodeURIComponent(this.trim(window.location.hash));
		} else {
			return decodeURIComponent(this.trim(window.location.pathname));
		}
	},

	getQuery: function() {
		return window.location.search;
	},

	getPathNames: function() {
		return this.getPath().split('/');
	},

	setTitle: function(title) {
		document.title = this.docTitle = title;
	},

	getTitle: function() {
		return this.docTitle || document.title;
	},

	addHash: function() {
		window.location = this.base + '#/' + this.trim(this.getPath());
	},

	removeHash: function(hash) {
		window.location = this.base + this.trim(hash);
	},

	getHost: function() {
		return window.location.host;
	},

	addDashes: function(str) {
		str = str.replace(/ /g, '-');
		str = str.replace(/%20/g, '-');
		return str;
	},

	trim: function(str) {
		if(this.base !== '/') {
			str = str.replace(this.base, '');
		}
		return str.replace(/^#/, '').replace(/^\s+|\s+$/g, '').replace(/^\/|\/$/g, '');
	},

	checkHash: function() {
		if(Address.savedHash !== window.location.hash) {
			Address.savedHash = window.location.hash;
			Address.fireListeners();
		}
	}
};

function AddressController(vars) {

	var self = new ControllerProxy({parentView:vars.parentView, parentController:vars.parentController, events:vars.siteControllerEvents});

	var section = {},
		path = '',
		assetId = 0,
		mediaTitle,
		mode = '',
		lastSectionId = -1,
		lastUri,
		curState,
		prevState = {mode:''},
		isInit = true,
		isSectionChangeEvent = false,
		savedUri = undefined,
		captionManualOverride,
		flickSpeed;

	Address.addEventListener(ADDRESS_CHANGE, uriChange);

	self.events.addEventListener(ADDRESS_SECTION_CHANGE, filterSectionChange);
	self.events.addEventListener(ADDRESS_OVERLAY_CHANGE, overlayChange);
	self.events.addEventListener(ADDRESS_ASSET_CHANGE, assetChange);
	self.events.addEventListener('updateAssetId', updateAssetId);
	self.events.addEventListener('passwordViewAuthCheck', passwordViewAuthCheck);
	self.events.addEventListener('mediaListResponse', mediaListResponse);
	self.events.addEventListener('resetUriChange', function(){
		uriChange("");
	});
	self.events.addEventListener('clearFotomotoMode', overlayChange);

	function passwordViewAuthCheck(value) {
		if(section && section.password === value) {
			section.hasPassed = true;
			uriChange(savedUri);
		}
		self.events.dispatchEvent('passwordViewUpdate', !!section.hasPassed);
	}

	function uriChange(uri) {
		parseState(uri);
		var mediaToRender = removeLinksFromMedia(csvToArray(section.mediaItems));
		if(section && section.password.length > 0 && !section.hasPassed) {
			savedUri = uri;
			self.events.dispatchEvent('privateGalleryAuthCheck', {section:section});
		} else {
			savedUri = undefined;
			if((lastUri !== uri && section) || uri === "") {
				lastSectionId = section.id;
				var mediaViewState = getMediaViewState(section);
				var state = {
					section:section,
					mediaToRender:mediaToRender,
					path:path,
					assetId:assetId,
					asset:getMediaById(mediaToRender[assetId]),
					mode:mode,
					info:{
						isSectionChange: section !== exists(prevState, 'section'),
						isAssetChange: assetId !== exists(prevState, 'assetId'),
						isModeChange: mode !== exists(prevState, 'mode'),
						isLandingMedia: section.label === LANDING_MEDIA,
						mediaViewState: mediaViewState,
						isDeepLink: isInit && uri !== '',
						isMediaViewStateChange: exists(prevState, 'info.mediaViewState') !== mediaViewState,
						isIntroGallery:section.isIntroGallery,
						flickSpeed: flickSpeed,
						lastUri: lastUri,
						isThumbsFirst: isThumbsFirst(section)
					}
				};
				STATE.uri = state;
				self.setTitle();
				layoutCalcs._section = state.section;
				layoutCalcs._thumbsVisible = hasMode('thumbs');
				curState = state;
				checkMediaModelContent();
				deepLinkedyLink(section);
				prevState = state;
			}
			lastUri = uri;
			isInit = false;
			isSectionChangeEvent = false;
			flickSpeed = undefined;
		}
	}

	function checkMediaModelContent() {
		// #bug 728 - 6-29-15 - intro view was not being init'd when sectionMedia was false
		var sectionMedia = exists(curState, "section.media") || '';
		var media = sectionMedia.split(',');
		var i = media.length;
		var requestMediaStr = '';
		while(i--) {
			if(Number(media[i]) > 9999 && !MEDIA_MODEL[media[i]]) requestMediaStr += media[i] + ',';
		}
		if(requestMediaStr !== '') {
			self.events.dispatchEvent('getMediaList', {ids:requestMediaStr.slice(0, -1)});
		} else {
			self.events.dispatchEvent(ADDRESS_URI_CHANGE, curState);
		}
	}
	
	function mediaListResponse() {
		var mediaToRender = removeLinksFromMedia(csvToArray(section.mediaItems));
		curState.asset = getMediaById(mediaToRender[assetId]);
		self.events.dispatchEvent(ADDRESS_URI_CHANGE, curState);
	}

	function deepLinkedyLink(section) {
		var mediaItem = getMediaById(csvToArray(section.mediaItems)[0]);
		if(mediaItem.type === 'link' && !mediaItem.thumb) {
			if(mediaItem.linkTarget === '_blank') {
				window.open(mediaItem.content);
			} else if(mediaItem.linkTarget === '_self') {
				window.location.href = mediaItem.content;
			}
		}
	}

	function getMediaViewState(section) {
		return section.label === LANDING_MEDIA ? 'landingMedia' : 'mediaView';
	}

	function updateAssetId(e) {
		assetId = e.id;
	}

	function parseState(uri) {
		uri = uri.split("/");
		mode = isOverlayState(uri);
		delete section.isIntroGallery;
		section = getSection(uri);
		assetId = isAssetNumber(uri) ? isAssetNumber(uri) : 0;
		assetId = assetId !== 0 ? assetId -1 : assetId;
		if(!isAssetNumber(uri) && isThumbsFirst(section) && hasMode('thumbs')) {
			assetId = -1;
		}
		if(isInit && USER_AGENT === MOBILE && hasMode('caption')) {
			removeMode('caption');
			Address.setPath(buildPath());
		}
	}

	function getSection(uri) {
		path = dashCheck(uri);
		if(path) {
			section = SECTIONS_MODEL[path];
			STATE.section(section);
			return section;
		} else if(SETTINGS_MODEL.backgroundImages) {
			var landingSection = {id:LANDING_MEDIA,label:LANDING_MEDIA,visible:1,password:'',media:SETTINGS_MODEL.backgroundImages,mediaItems:SETTINGS_MODEL.backgroundImages};
			STATE.section(landingSection);
			return landingSection;
		} else {
			getFirstMediaItem();
			if(!path) return false; /*no valid sections found*/
			assetId = 0;
			section = SECTIONS_MODEL[path];
			section.isIntroGallery = true;
			STATE.section(section);
			if(STATE.overrides.thumbnailType !== 'none' && STATE.overrides.thumbnailDefaultOn) {
				addMode('thumbs');
			} else {
				removeMode('thumbs');
			}
			return section;
		}
	}

	function isGetSection(uri) {
		path = dashCheck(uri);
		if(path) {
			section = SECTIONS_MODEL[path];
			STATE.section(section);
			return section;
		}
		return false;
	}

	function dashCheck(uri) {
		var tests = [
			uri[0] + '/' + uri[1],
			uri[0]
		];
		var length = tests.length;
		if(length > 0) {
			var i = 0;
			for(; i < length; i++) {
				var dashes = testDashes(tests[i]);
				if(SECTIONS_MODEL[dashes]) {
					return dashes;
				}
			}
		}
		return false;
	}

	function testDashes(str) {
		var arr = str.split('-');
		var combos = binaryCombos(arr.length);
		var x = combos.length;
		while(x--) {
			var length = arr.length;
			var y = 0;
			var newString = '';
			for(;y < length; y++) {
				newString += arr[y];
				if(y < length - 1) {
					newString += combos[x][y];
				}
			}
			if(SECTIONS_MODEL[newString]) {
				return newString;
			}
		}
		return false;
	}

	function binaryCombos(n){
		var result = [],
			x,
			y;
		for(y = 0; y < Math.pow(2, n); y++){
			var combo = [];
			for(x = 0; x < n; x++){
				if((y >> x) & 1)
					combo.push(" ");
				else
					combo.push("-");
			}
			result.push(combo);
		}
		return result;
	}

	function getFirstMediaItem() {
		var firstSection = getFirstValidSub(SECTIONS_MODEL['ROOT_SECTION']);
		var firstSub = getFirstValidSub(firstSection);

		if(firstSub) {
			path = firstSection.label + "/" + firstSub.label;
			checkThumbsDefaultOn(firstSub);
		} else {
			path = firstSection.label;
			checkThumbsDefaultOn(firstSection);
		}
		checkCaptionDefault();
	}

	function checkThumbsDefaultOn(section) {
		if(STATE.overrides.thumbnailDefaultOn) {
			addMode('thumbs');
		}
	}

	function isThumbsFirst(section) {
		return (STATE.overrides.thumbnailDefaultOn && STATE.overrides.thumbnailType === 'fill' && (USER_AGENT !== MOBILE || isIndexSection(section)) && (LAYOUT_MODEL.overlayAlpha === 1 || isIndexSection(section)));
	}

	function checkCaptionDefault() {
		if(USER_AGENT !== MOBILE && section && assetId > -1) {
			var mediaToRender = removeLinksFromMedia(csvToArray(section.mediaItems));
			var asset = getMediaById(mediaToRender[assetId]);
			if(!asset) asset = {overrides:{}};
			var captionDefault = firstValid(asset.overrides.captionDefault, STATE.overrides.captionDefault);
			if(captionManualOverride === 'caption') {
				addMode('caption');
			} else if(captionManualOverride === '') {
				removeMode('caption');
			} else if(captionDefault) {
				addMode('caption');
			} else {
				removeMode('caption');
			}
			hideCaptionOnThumbsGrid();
		}
	}

	function isAssetNumber(uri) {
		if(!isNaN(uri[2]) && uri[2].length > 0) {
			return Number(uri[2]);
		} else if(!isNaN(uri[1])) {
			return Number(uri[1]);
		}
		return false;
	}

	function isOverlayState(uri) {
		var overlay = /thumbs|email|inquiry|caption|fotomoto/;
		if(overlay.test(uri[3])) {
			return uri[3];
		} else if(overlay.test(uri[2])) {
			return uri[2];
		} else if(overlay.test(uri[1])) {
			return uri[1];
		}
		return '';
	}

	function isLink(str) {
		return (str.indexOf("http") === 0 || str.indexOf("/") === 0 || str.indexOf("ftp") === 0);
	}

	function formatEmail(str) {
		return "mailTo:" + str.replace("mailto:", "").replace("mailTo:", "");
	}

	function getEmail(e) {
		var isEmail = /[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/g.test(e.path);
		return isEmail ? function() {
			window.location.href = formatEmail(e.path);
		} : false;
	}

	function getSocialPopup(e) {
		return (e.label === '[one]' || e.label === '[like]') ? function() {
			self.events.dispatchEvent(POP_UP, e);
		} : false;
	}

	function getNewWindow(e) {
		return e.linkTarget === '_blank' ? function() {
			window.open(e.path);
		} : false;
	}

	function getNewLocation(e) {
		return !internalLink(e) && e.linkTarget === '_self' && e.type === 'external' ? function() {
			window.location.href = e.path;
		} : false;
	}

	function buildPath(value) {
		var newPath = value || path || '';
		var strPath = '';
		if(newPath && !isCustomPath(newPath)) {
			strPath = REWRITE_BASE + newPath + '/';
			if(assetId > -1) {
				strPath += (Number(assetId) + 1) + '/';
			}
			if(mode.length > 0) {
				strPath += mode + '/';
			}
		} else {
			strPath = REWRITE_BASE + newPath;
		}
		return strPath;
	}

	function isCustomPath(path) {
		return /^(ht|f)tp(s?)\:\/\//.test(path);
	}

	function isCrossDomainLink(url) {
		var domain = window.location.protocol + '//' + window.location.host;
		return url.indexOf('http') === 0 && url.indexOf(domain) === -1;
	}

	function stripLocalDomain(url) {
		var domain = window.location.protocol + '//' + window.location.host;
		return url.replace(domain, '').replace(/^\/|\/$/g, '');
	}

	function internalLink(e) {
		if(e.path) {
			if(isGetSection(e.path.split("/"))) {
				e.section = isGetSection(e.path.split("/"));
				e.type = 'internal';
				return true;
			} else {
				e.path = stripLocalDomain(e.path);
				e.section = getSectionFromPath(e.path);
				e.type = 'internal';
				return true;
			}
			return false;
		}
		return false;
	}
	
	function setThumbsMode(e) {
		if(USER_AGENT === MOBILE && (e.section && !isIndexSection(e.section))) {
			removeMode('thumbs');
		} else if(STATE.overrides.thumbnailType === 'none') {
			removeMode('thumbs');
		} else if(e.section && csvToArray(e.section.mediaItems).length > 1 && STATE.overrides.thumbnailDefaultOn && !e.isThumbClick) {
			addMode('thumbs');
		} else if(e.section && csvToArray(e.section.mediaItems).length > 1 && e.isThumbClick && STATE.overrides.thumbnailType === 'strip' && STATE.overrides.thumbnailDefaultOn && STATE.overrides.thumbnailDock === 'displace') {
			addMode('thumbs');
		}
		if(e.section && isThumbsFirst(e.section) && assetId === 0 && hasMode('thumbs')) {
			assetId = -1;
		}
	}

	function getSectionFromPath(path) {
		var pathArr = path.split("/"),
			section = pathArr[0],
			subSection;
		if(pathArr[0] && pathArr[1]) subSection = pathArr[0] + '/' + pathArr[1];
		if(subSection) return getSection(subSection);
		if(section) return getSection(section);
		return false;
	}

	function filterSectionChange(e) {
		isSectionChangeEvent = true;
		action = getSocialPopup(e) ||
				getEmail(e) ||
				getNewWindow(e) ||
				getNewLocation(e) ||
				sectionChange(e);
		action();	
	}

	function sectionChange(e) {
		if(e.section) STATE.section(e.section);
		path = e.path;
		assetId = e.assetId || 0;
		mode = e.mode;
		setThumbsMode(e);
		checkCaptionDefault();
		removeMode('inquiry');
		removeMode('email');
		return function() {
			Address.setPath(buildPath(e.path));
		}
	}

	function overlayChange(e) {
		toggleOverlayState(e);
		hideCaptionOnThumbsGrid();
		Address.setPath(buildPath());
	}
	function hideCaptionOnThumbsGrid() {
		if(hasMode('thumbs') && STATE.overrides.thumbnailType === 'fill') {
			removeMode('caption');
		} 
	}

	function assetChange(e) {
		if(e.navDir === 'prev' || e.navDir === LEFT_ARROW) {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				assetId = assetId > 0 ? assetId - 1 : 0;
			} else {
				assetId = assetId > 0 ? assetId - 1 : 0;
			}
		} else if(e.navDir === 'next' || e.navDir === RIGHT_ARROW) {
			if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
				assetId = assetId < csvToArray(section.mediaItems).length - 1 ? assetId + 1 : csvToArray(section.mediaItems).length - 1;
			} else {
				assetId = assetId < csvToArray(section.mediaItems).length - 1 ? assetId + 1 : 0;
			}
		}
		checkCaptionDefault();
		removeMode('inquiry');
		removeMode('email');
		flickSpeed = e.flickSpeed;
		Address.setPath(buildPath());
	}

	function hasMode(value) {
		return mode ? mode.indexOf(value) !== -1 : false;
	}

	function addMode(value) {
		removeMode('email');
		removeMode('inquiry');
		if(!hasMode(value)) {
			mode = mode ? mode + '-' + value : value;
		}
	}

	function removeMode(value) {
		mode = mode ? mode.replace(value, '').replace(/^-|-$/g, '').replace(/(--)/g, '-') : '';
	}

	function toggleOverlayState(value) {
		if(hasMode(value)) {
			if(value === 'caption') captionManualOverride = '';
			removeMode(value);
		} else {
			if(value === 'caption') captionManualOverride = 'caption';
			addMode(value);
		}
	}

	self.setTitle = function() {
		var media = csvToArray(section.mediaItems);
		var mediaItem = MEDIA_MODEL[media[assetId]];
		if(SETTINGS_MODEL.advancedSeo && section.id === LANDING_MEDIA) {
			Address.setTitle(decodeURIComponent(SETTINGS_MODEL.browserTitle));
		} else if(SETTINGS_MODEL.advancedSeo && section.id !== LANDING_MEDIA && mediaItem && mediaItem.label) {
			Address.setTitle(mediaItem.label);
		} else if(mediaItem && mediaItem.label && section.id !== LANDING_MEDIA && !SETTINGS_MODEL.globalBrowserTitle) {
			if(mediaItem.label === SETTINGS_MODEL.browserTitle) {
				Address.setTitle(mediaItem.label);
			} else {
				Address.setTitle(mediaItem.label + ' | ' + decodeURIComponent(SETTINGS_MODEL.browserTitle));
			}
		} else {
			if(mediaItem && mediaItem.label && section.id !== LANDING_MEDIA) {
				var fullpath = path.split('/');
				mediaTitle = " | " + fullpath[fullpath.length - 1] + " | " + (assetId + 1);
			} else {
				mediaTitle = '';
			}
			Address.setTitle(decodeURIComponent(SETTINGS_MODEL.browserTitle) + mediaTitle);
		}
	};

	return self;
}

function FooterController(vars) {

	var self = new ControllerProxy({parentView:vars.parentView, parentController:vars.parentController, events:vars.siteControllerEvents});

	self.updateSpeed = 0;

	self.footerView = new vars.FooterView(vars);
	self.footerView.alpha = 0;
	self.parentView.addChild(self.footerView);

	self.events.addEventListener(LAYOUT_MODEL_CHANGE, modelChange);
	self.events.addEventListener(MEDIA_MODEL_CHANGE, modelChange);
	self.events.addEventListener(SETTINGS_MODEL_CHANGE, modelChange);
	self.events.addEventListener(RESIZE_END, self.footerView.updatePosition);
	self.events.addEventListener(MENU_DOCK_CLOSE, menuDockClose);
	self.events.addEventListener(MENU_DOCK_OPEN, menuDockOpen);

	self.footerView.addEventListener(FOOTER_CLICK, clickListener);

	function clickListener(e) {
		var navEvent = {
			type: e.type === 'link' ? 'external' : 'internal',
			path: e.content,
			linkTarget: e.linkTarget,
			label: e.label
		};
		self.events.dispatchEvent(FOOTER_CLICK, navEvent);
	}

	function modelChange(e) {
		if(e) {
			if(/copyright|social|layoutModel|copyrightOffset|footerKerning|footerIcon/.test(e.id)) {
				self.footerView.updateStyle(e);
				self.footerView.updatePosition(e);
			} else if(e.filters === 'Footer Links') {
				self.footerView.updateStyle(e);
				self.footerView.updatePosition(e);
			}
		}
	}

	function menuDockClose() {
		self.footerView.hide();
	}

	function menuDockOpen() {
		self.footerView.show();
	}

	return self;
}

function FooterView(vars) {

	var textGroup,
		iconGroup,
		self = new ViewProxy({events:vars.events});
	self.zIndex = STATE.footerView.zIndex;
	self.updateSpeed = 0;
	self.alpha = 0;

	self.element.setAttribute('class', 'footerview');

	var tile,
		footerBtns;

	self.events.addEventListener('fillSiteMode', setSafariHack);
	self.events.addEventListener('nonFillSiteMode', removeSafariHack);

	function setSafariHack(e) {
		if(BROWSER_NAME === 'Safari') self.translateZ = 0;
	}

	function removeSafariHack(e) {
		if(BROWSER_NAME === 'Safari') {
			self.style['-webkit-transform'] = 'none';
			self.style['-ms-transform'] = 'none';
			self.style['transform'] = 'none';
		}
	}

	self.addEventListener(CHILD_ADDED, function(child) {
		setTimeout(function() {
			if(USER_AGENT !== MOBILE) self.show();
		}, 1200);
	});

	self.updateStyle = function(e) {
		self.text = '';
		self.children = [];
		buildLinks();
		self.updatePosition();
	};

	self.updatePosition = function(e) {
		Tween(self, self.updateSpeed, {x:layoutCalcs.footerView.x(self.width)});
		Tween(self, self.updateSpeed, {y:layoutCalcs.footerView.y(self.height)});
		self.updateSpeed = UPDATE_SPEED;
	};

	self.hide = function() {
		Tween(self, UPDATE_SPEED, {alpha:0, onComplete:function() {
			if(self.alpha === 0) self.display = 'none';
		}});
	};

	self.show = function() {
		self.display = 'block';
		self.updateStyle();
		Tween(self, UPDATE_SPEED, {alpha:1});
	};

	function buildLinks() {
		footerBtns = csvToArray(SETTINGS_MODEL.socialLinks);
		if(SETTINGS_MODEL.copyright !== '') footerBtns.unshift(SETTINGS_MODEL.copyright);
		var i = 0,
			length = footerBtns.length,
			axis = USER_AGENT === MOBILE ? 'y' : 'x';

		iconGroup = new FooterTileGroup('x');
		textGroup = new FooterTileGroup(axis);

		self.addChild(textGroup);
		self.addChild(iconGroup);

		for(;i<length;i++) {
			var item = footerBtns[i];
			var btn = new Sprite();
			var isIconGroup = false;

			var link;

			var mediaItem = getMediaById(item);
			if(mediaItem) {
				if(isCustomIcon(mediaItem)) {
					link = loadCustomIcon(mediaItem);
					btn.txt = link;
				} else if(isValidSocialIcon(item)) {
					var icon = socialIcons[mediaItem.label.toLowerCase()],
						isIconGroup = true;
					if(LAYOUT_MODEL.footerIconType === 'png') {
						link = loadSocialIcon(icon.filename, icon.width, icon.height);
						btn.icon = link;
					} else if(LAYOUT_MODEL.footerIconType === 'vector') {
						link = createVectorIcon(icon, icon.width, icon.height);
						btn.icon = link;
					}
				} else {
					link = buildLabel(mediaItem.label);
					btn.txt = link;
				}
			} else {
				link = buildLabel(item);
			}

			btn.addChild(link);
			btn.width = link.width;
			btn.height = link.height;
			btn.label = link;

			if(isIconGroup) {
				iconGroup.addChild(btn);
			} else {
				textGroup.addChild(btn);
			}

			if(MEDIA_MODEL[item]) {

				btn.btn = btn;
				btn.data = MEDIA_MODEL[item];

				if(TOUCH_DEVICE) {
					btn.addEventListener(TOUCH_END, function(e){
						self.dispatchEvent(FOOTER_CLICK, e.target.data);
					});
				} else {
					btn.addEventListener(CLICK, function(e){
						self.dispatchEvent(FOOTER_CLICK, e.target.data);
					});
					btn.addEventListener(MOUSE_OVER, over);
					btn.addEventListener(MOUSE_OUT, out);
				}
			}
		}

		if(length > 0) layoutBtns();
	}

	function isCustomIcon(mediaItem) {
		return /src=/.test(mediaItem.label); 
	}

	function isSocialIcon(mediaItem) {
		return !!socialIcons[mediaItem.label.toLowerCase()];
	}

	function parseIconPath(str) {
		return str.replace(' ', '').split('=')[1].replace(']', '');	
	}

	function loadCustomIcon(mediaItem) {
		var icon = new Bitmap();
		icon.src = REWRITE_BASE + MEDIA_ORIGINAL + parseIconPath(mediaItem.label);
		icon.width = 20;
		icon.height = 20;
		icon.style.padding = '2px 0';
		icon.customLabel = mediaItem.label.toLowerCase();
		return icon;
	}

	function loadSocialIcon(src, width, height) {
		var icon = new vars.Bitmap();
		icon.src = REWRITE_BASE + ICONS + src;
		icon.width = width;
		icon.height = height;
		icon.addEventListener(LOAD, iconLoaded);
		return icon;
	}

	function createVectorIcon(socialIcon, width, height) {
		var icon = new Svg(),
			group = new Svg({type:'g'}),
			bg = new Rect(),
			path = new Path(),
			isCircle = LAYOUT_MODEL.footerIconShape === 'circle',
			dPath = isCircle ? socialIcon.svgCircPath : socialIcon.svgRectPath,
			scale = USER_AGENT === TABLET || USER_AGENT === MOBILE ? 1 : LAYOUT_MODEL.footerIconScale;
		group.scale = scale;
		bg.rx = isCircle ? socialIcon.bgCircRadius : socialIcon.bgRectRadius;
		bg.width = width;
		bg.height = height;
		bg.fill = LAYOUT_MODEL.footerIconColor;
		path.d = dPath;
		path.fill = LAYOUT_MODEL.footerIconBgColor;
		path.fillRule = 'evenodd';
		group.addChild(bg);
		group.addChild(path);
		icon.addChild(group);
		icon.width = width * scale;
		icon.height = height * scale;
		return icon;
	}

	function iconLoaded(e) {
		layoutBtns();
		self.updatePosition();
	}

	function isValidSocialIcon(item) {
		var mediaItem = getMediaById(item);
		return item && mediaItem && mediaItem.label && socialIcons[mediaItem.label.toLowerCase()] && !isNaN(item);
	}

	function buildLabel(name) {
		var tester = document.createElement('span');
		tester.style.position = 'absolute';
		tester.style.display = 'block';
		if(USER_AGENT === MOBILE) tester.style.width = stage.width - 12 + 'px';
		tester.style.fontFamily = LAYOUT_MODEL.copyrightFont;
		tester.style.fontSize = LAYOUT_MODEL.copyrightFontSize.toString().replace('px', '') + 'px';
		tester.style.letterSpacing = LAYOUT_MODEL.footerKerning + 'px';
		tester.innerHTML = name;
		tester.whiteSpace = USER_AGENT === MOBILE ? 'normal' : 'nowrap';
		document.body.appendChild(tester);
		var label = new vars.Sprite();
		label.fontFamily = LAYOUT_MODEL.copyrightFont;
		label.fontSize = LAYOUT_MODEL.copyrightFontSize.toString().replace('px', '') + 'px';
		label.fontColor = LAYOUT_MODEL.copyrightColor;
		label.letterSpacing = LAYOUT_MODEL.footerKerning;
		label.text = name;
		label.width = tester.offsetWidth;
		label.height = tester.offsetHeight;
		label.textWrap = USER_AGENT === MOBILE;
		document.body.removeChild(tester);
		tester = null;
		return label;
	}

	function over(e) {
		if(this.btn.txt) {
			Tween(this.btn.txt, UPDATE_SPEED, {fontColor: toRgba(LAYOUT_MODEL.copyrightColor, 0.5)});
		} else {
			Tween(this.btn, UPDATE_SPEED, {alpha: 0.5});
		}
	}

	function out(e) {
		if(this.btn.txt) {
			Tween(this.btn.txt, UPDATE_SPEED, {fontColor: toRgba(LAYOUT_MODEL.copyrightColor, 1)});
		} else {
			Tween(this.btn, UPDATE_SPEED, {alpha: 1});
		}
	}

	function layoutBtns() {
		var groups = self.children,
			i,
			length = groups.length;

		textGroup.layoutContent();
		iconGroup.layoutContent();

		tile = new Tile();
		tile.gap = 6;
		tile.axis = USER_AGENT === MOBILE ? 'y' : 'x';
		tile.align = 'left';
		tile.wrap = false;
		if(tile.axis === 'x') {
			tile.perpLength = stage.height;
		} else {
			tile.perpLength = stage.width;
		}

		for(i = 0; i < length; i++) {
			tile.addItem(groups[i].width, groups[i].height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			groups[i].x = position.x;
			groups[i].y = position.y;
		}

		if(iconGroup.children.length > 0 && USER_AGENT !== MOBILE) textGroup.y = iconGroup.height - textGroup.height;
		
		var bounds = tile.getBounds();
		self.transition = 0;
		self.width = bounds.width;
		self.height = bounds.height;
	}

	function FooterTileGroup(axis) {
		var me = new Sprite();

		me.layoutContent = function() {
			var t = new Tile();
			t.gap = 6;
			t.axis = axis;
			t.align = 'left';
			t.wrap = false;
			t.perpLength = 150;

			var i = 0,
				panels = me.children,
				length = panels.length;

			for(; i < length; i++) {
				t.addItem(panels[i].width, panels[i].height);
			}

			t.layoutItems();

			for(i = 0; i < length; i++) {
				var position = t.getPosition(i);
				panels[i].y = position.y;
				panels[i].x = position.x;
			}

			var bounds = t.getBounds();
			me.width = bounds.width;
			me.height = bounds.height;
		};

		return me;
	}

	return self;
}


function LogoController(vars) {

	var self = new ControllerProxy({parentView:vars.parentView, parentController:vars.parentController, events:vars.siteControllerEvents});
	self.updateSpeed = 0;

	self.logoView = new vars.LogoView({parentView:self.parentView, parentController:self, events:vars.siteControllerEvents});
	self.logoView.alpha = 0;

	self.events.addEventListener('LOGO_CHILD_ADDED', show);

	self.parentView.addChild(self.logoView);

	self.events.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	self.events.addEventListener(RESIZE_END, self.logoView.updatePosition);
	self.events.addEventListener(MENU_DOCK_CLOSE, menuDockClose);
	self.events.addEventListener(MENU_DOCK_OPEN, menuDockOpen);

	self.logoView.addEventListener(CLICK, click);
	if(USER_AGENT !== MOBILE && USER_AGENT !== TABLET) {
		self.logoView.addEventListener(MOUSE_OVER, over);
		self.logoView.addEventListener(MOUSE_OUT, out);
	}

	function layoutModelChange(e) {
		self.logoView.updateStyle(e);
		self.logoView.updatePosition(e);
	}

	function over(e) {
		if(this.txt && this.txt.text.indexOf('<a') > -1) {
			/*html content*/
		} else {
			if(this.txt) {
				Tween(this.txt, UPDATE_SPEED, {fontColor: toRgba(LAYOUT_MODEL.logoFontColor, 0.5)});
			} else {
				Tween(this, UPDATE_SPEED, {alpha: 0.5});
			}
		}
	}

	function out(e) {
		if(this.txt && this.txt.text.indexOf('<a') > -1) {
			/*html content*/
		} else {
			if(this.txt) {
				Tween(this.txt, UPDATE_SPEED, {fontColor: toRgba(LAYOUT_MODEL.logoFontColor, 1)});
			} else {
				Tween(this, UPDATE_SPEED, {alpha: 1});
			}
		}
	}

	function menuDockClose() {
		hide();
	}

	function menuDockOpen() {
		show();
	}

	function hide() {
		self.logoView.style.pointerEvents = 'none';
		Tween(self.logoView, UPDATE_SPEED, {alpha:0, display:'none'});
	}

	function show() {
		self.logoView.display = 'block';
		Tween.defer(self.logoView, UPDATE_SPEED, {alpha:1, onComplete:function(){
			self.logoView.style.pointerEvents = 'auto';
		}});
	}

	function click(e) {
		if(this.txt && this.txt.text.indexOf('<a') > -1) {
			/*html content*/
		} else {
			var navEvent = {
				type:'internal',
				path:'',
				target:'_self'
			};
			self.events.dispatchEvent(LOGO_CLICK, navEvent);
		}
	}

	return self;
}

function LogoView(vars) {

	var self = new ViewProxy({events:vars.events});
	if(isPod()) {
		self.textWrap = true;
	} else {
		self.textWrap = false;
	}
	self.zIndex = STATE.logoView.zIndex;
	self.updateSpeed = 0;

	self.events.addEventListener('fillSiteMode', setSafariHack);
	self.events.addEventListener('nonFillSiteMode', removeSafariHack);

	function setSafariHack(e) {
		if(BROWSER_NAME === 'Safari') self.translateZ = 0;
	}

	function removeSafariHack(e) {
		if(BROWSER_NAME === 'Safari') {
			self.style['-webkit-transform'] = 'none';
			self.style['-ms-transform'] = 'none';
			self.style['transform'] = 'none';
		}
	}

	self.addEventListener(CHILD_ADDED, function(child) {
		self.updatePosition();
		setTimeout(function(){
			self.updatePosition();
			self.updateSpeed = UPDATE_SPEED;
		}, 500);
		self.events.dispatchEvent('LOGO_CHILD_ADDED');
	});

	self.addEventListener(MOUSE_OVER, overLogo);

	function overLogo(e) {
		self.events.dispatchEvent('OVER_LOGO');
	}

	self.updatePosition = function(e) {
		self.transition = 0;
		if(self.txt) {
			if(isPod() && self.txt.element.offsetWidth > stage.width) {
				self.width = stage.width;
			} else {
				self.width = self.txt.width;
			}
			self.height = self.txt.height;
		} else if(self.img) {
			self.width = self.img.width;
			self.height = self.img.height;
		}
		Tween(self, self.updateSpeed, {x:layoutCalcs.logoView.x(self.width), y:layoutCalcs.logoView.y(self.height)});
	};

	self.updateStyle = function(e) {

		if(e && e.id && /logoText|logoHtml|logoFile|layoutModelInit|tabletLogoFile|mobileLogoFile|logoFont|logoFontSize|logoFontColor|logoAlignHorizontal|logoAlignVertical|logoOffsetX|logoOffsetY|tabletLogoOffsetX|tabletLogoOffsetY|logoKerning/.test(e.id)){
			var src;

			if(USER_AGENT === MOBILE && LAYOUT_MODEL.mobileLogoFile) {
				src = REWRITE_BASE + MEDIA_ORIGINAL + LAYOUT_MODEL.mobileLogoFile;
			} else if(USER_AGENT === TABLET && LAYOUT_MODEL.tabletLogoFile) {
				src = REWRITE_BASE + MEDIA_ORIGINAL + LAYOUT_MODEL.tabletLogoFile;
			} else if(BROWSER_NAME === 'Safari' && !RETINA && LAYOUT_MODEL.logoFile !== '' && fileExist(REWRITE_BASE + MEDIA_ORIGINAL +  LAYOUT_MODEL.logoFile.replace('@2x',''))) {
				src = REWRITE_BASE + MEDIA_ORIGINAL + LAYOUT_MODEL.logoFile.replace('@2x','');
			} else if(LAYOUT_MODEL.logoFile !== '') {
				src = REWRITE_BASE + MEDIA_ORIGINAL + LAYOUT_MODEL.logoFile;
			}

			if(self.txt) {
				self.removeChild(self.txt);
				self.txt = undefined;
			}
			if(self.img) {
				self.removeChild(self.img);
				self.img = undefined;
			}
			if(src) {
				self.img = new Bitmap();
				self.img.src = src;
				self.img.alpha = 0;
				self.addChild(self.img);
				self.img.element.addEventListener(LOAD, logoImgLoaded);
			} else {
				self.txt = new Sprite();
				self.txt.text = LAYOUT_MODEL.logoHtml.replace(/(\\*'|\\*")/g, "'") || LAYOUT_MODEL.logoText.replace(/(\\*'|\\*")/g, "'");
				self.addChild(self.txt);
				if(LAYOUT_MODEL.logoFontSize !== self.txt.fontSize) {
					self.txt.fontSize = LAYOUT_MODEL.logoFontSize;
				}
				if(LAYOUT_MODEL.logoFontColor !== self.txt.fontColor) {
					Tween(self.txt, vars.parentController.updateSpeed, {fontColor:LAYOUT_MODEL.logoFontColor});
				}
				if(LAYOUT_MODEL.logoFont !== self.txt.fontFamily) {
					self.txt.fontFamily = LAYOUT_MODEL.logoFont;
				}
				if(LAYOUT_MODEL.logoKerning !== self.txt.letterSpacing) {
					self.txt.letterSpacing = LAYOUT_MODEL.logoKerning;
				}
			}
		}
	};

	function logoImgLoaded(e) {
		var logoObj = {width:self.img.element.offsetWidth, height:self.img.element.offsetHeight, filename:this.src};
		setTimeout(function() {
			// delay to allow for element offset size info
			var retinaSize = RetinaResizeEngine(logoObj);
			self.img.width = retinaSize.width;
			self.img.height = retinaSize.height;
			self.updatePosition();
			self.events.dispatchEvent(LOGO_LOADED);
			Tween(self.img, UPDATE_SPEED, {alpha:1});
		}, 10);
	}

	return self;
}

var MediaController = function(imports) {

	var _localEvents,
		_sysEvents,
		navigationMode,
		section,
		mediaToRender,
		contactSettings = /contactTitleFont|contactTitleFontSize|contactTitleShow|contactFont|contactFontSize|contactFontColor|contactFieldRectColor/,
		imageVideoSettings = /containerColor|transitionType|imageAlignHorizontal|imageAlignVertical|imageScaleType|videoScaleType|imageVideoInactiveAlpha|imageVideoMarginTop|imageVideoMarginRight|imageVideoMarginBottom|imageVideoMarginLeft/,
		textPageSettings = /pageMarginTop|pageMarginRight|pageMarginBottom|pageMarginLeft|pageScrollVerticalMargin|pageTextFont|pageTextKerning|pageTextFontSize|pageTextFontColor|pageTitle|pageTitleFont|pageTitleKerning|pageTitleFontSize|pageTitleFontColor|pageScrollbarAlignment|pageScrollbarHorizontalOffset|pageScrollbarVerticalOffset|pageScrollbarColor|pageScrollbarHover|pageScrollbarBgAlpha|pageScrollbarWidth/,
		landingMediaSettings = /landingMediaRandomize|landingMediaTransitionType|landingMediaSpeed|landingMediaTransitionDuration|landingMediaAlignHorizontal|landingMediaAlignVertical|landingMediaScaleType/,
		state;

	function MediaController(localEvents, sysEvents) {
		_localEvents = localEvents;
		_sysEvents = sysEvents;
		_sysEvents.addEventListener(SITE_URI_CHANGE, uriChange);
		_sysEvents.addEventListener(RESIZE_END, resize);
		_sysEvents.addEventListener(ORIENTATION_CHANGE, orientationChange);
		_sysEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		_sysEvents.addEventListener(SECTIONS_MODEL_CHANGE, sectionsModelChange);
		_sysEvents.addEventListener(SETTINGS_MODEL_CHANGE, settingsModelChange);
		_sysEvents.addEventListener(MEDIA_MODEL_CHANGE, mediaModelChange);
		_sysEvents.addEventListener(PAUSE_MEDIA, pauseMedia);
		_sysEvents.addEventListener(CONTACT_FORM_SENT, contactFormSent);
		_sysEvents.addEventListener(SHARE_FORM_SENT, shareFormSent);
		_sysEvents.addEventListener(INQUIRY_FORM_SENT, inquiryFormSent);
		_sysEvents.addEventListener('thumbStripDisplaceChange', resize);

		_localEvents.addEventListener('SectionMediaFactory/mediaBuilt', mediaBuilt);
		_localEvents.addEventListener('MediaView/ContentAdded', layoutMediaView);
		_localEvents.addEventListener('ScrollTransition/updateAssetId', updateAssetId);
		_localEvents.addEventListener(MEDIA_LOADED, mediaLoaded);
		_localEvents.addEventListener(TRANSITION_START, transitionStart);
		_localEvents.addEventListener(TRANSITION_END, transitionEnd);
		_localEvents.addEventListener('cursorAxisUpdate', cursorAxisUpdate);
		_localEvents.addEventListener(ADDRESS_ASSET_CHANGE, addressAssetChange);
		_localEvents.addEventListener(CONTACT_FORM_SUBMIT, contactFormSubmit);
		_localEvents.addEventListener(SHARE_FORM_SUBMIT, shareFormSubmit);
		_localEvents.addEventListener(INQUIRY_FORM_SUBMIT, inquiryFormSubmit);
		_localEvents.addEventListener(NAVBAR_OVERLAY_BTN_CLICK, overlayBtnClick);
		_localEvents.addEventListener(TOUCH_NAVIGATION_END, touchNavEnd);
		_localEvents.addEventListener(PAGE_LOADED, pageLoaded);
	}

	function uriChange(e) {
		state = e;
		navigationMode = e.info.mediaViewState;
		section = e.section;
		mediaToRender = e.mediaToRender;

		if(e.assetId > -1) {
			var activeMediaItem = getMediaById(e.mediaToRender[e.assetId]);
			layoutCalcs.activeMediaType = activeMediaItem.type;
		}

		if(e.info.isMediaViewStateChange) {
			_localEvents.dispatchEvent('MediaViewBehavior/navigationModeChange', e.info.mediaViewState);
		}

		if(e.info.isSectionChange) {
			_localEvents.dispatchEvent('destroy');
			_localEvents.dispatchEvent('SectionMediaFactory/buildItems', {media:mediaToRender});
		}

		_localEvents.dispatchEvent('siteUriChange', e);

		checkCaption();
	}

	function pauseMedia(e) {
		_localEvents.dispatchEvent(PAUSE_MEDIA);
	}

	function addressAssetChange(e) {
		_sysEvents.dispatchEvent(ADDRESS_ASSET_CHANGE, e);
	}

	function pageLoaded(e) {
		_sysEvents.dispatchEvent(PAGE_LOADED);
	}

	function layoutModelChange(e) {
		_localEvents.dispatchEvent(LAYOUT_MODEL_CHANGE, e);
		if(e.id !== 'layoutModelInit' && (contactSettings.test(e.id) || imageVideoSettings.test(e.id) || textPageSettings.test(e.id) || landingMediaSettings.test(e.id))) {
			_localEvents.dispatchEvent('SectionMediaFactory/buildItems', {media:csvToArray(section.media)});
			_localEvents.dispatchEvent('assetReset');
		}
		checkCaption();
	}

	function sectionsModelChange(e) {
		if(section) {
		_localEvents.dispatchEvent(SECTIONS_MODEL_CHANGE, e);
			if(e.method === 'update' && e.id === section.id && e.field === 'media') {
				_localEvents.dispatchEvent('SectionMediaFactory/buildItems', {media:csvToArray(e.value)});
				_localEvents.dispatchEvent('assetReset');
			} else if(e.method === 'update' && e.id === section.id) {
				_localEvents.dispatchEvent('SectionMediaFactory/buildItems', {media:csvToArray(section.media)});
				_localEvents.dispatchEvent('assetReset');
			}
			checkCaption();
		}
	}

	function settingsModelChange(e) {
		_localEvents.dispatchEvent(SETTINGS_MODEL_CHANGE, e);
		if(e.method === 'update' && (section.id === 'landingMedia' || section.isIntroGallery) && e.id === 'backgroundImages') {
			_sysEvents.dispatchEvent('resetUriChange', e);
		}
	}

	function mediaModelChange(e) {
		_localEvents.dispatchEvent(MEDIA_MODEL_CHANGE, e);
		if(e.method === 'update' && section.media.indexOf(e.id) > -1) {
			_localEvents.dispatchEvent('SectionMediaFactory/buildItems', {media:csvToArray(section.media)});
			_localEvents.dispatchEvent('assetReset');
		}
		checkCaption();
	}

	function checkCaption() {
		if(state && state.mode.indexOf('caption') > -1 && USER_AGENT !== MOBILE) {
			_localEvents.dispatchEvent('showCaption');
		} else {
			_localEvents.dispatchEvent('hideCaption');
		}
	}

	function mediaBuilt(e) {
		_localEvents.dispatchEvent('MediaView/ContentReady', e.media);
	}

	function layoutMediaView(e) {
		_localEvents.dispatchEvent('layoutMediaView', {section:section});
		if(navigationMode === 'landingMedia' || mediaToRender.length < 2) {
			_localEvents.dispatchEvent('hideCursor');
		} else {
			_localEvents.dispatchEvent('showCursor');
		}
	}

	function resize(e) {
		_localEvents.dispatchEvent(RESIZE);
	}

	function orientationChange(e) {
		_localEvents.dispatchEvent(ORIENTATION_CHANGE);
	}

	function updateAssetId(e) {
		if(state && state.assetId !== e.id) {
			state.assetId = e.id;
			_sysEvents.dispatchEvent('updateAssetId', e);
			_localEvents.dispatchEvent('checkCaption', state);
		}
	}

	function mediaLoaded(e) {
		if(/video|vimeo/.test(e.type)) {
			_localEvents.dispatchEvent('mediaSizeUpdate', e);
		}
	}

	function transitionStart(e) {
		_sysEvents.dispatchEvent(TRANSITION_START);
	}

	function transitionEnd(e) {
		_sysEvents.dispatchEvent(TRANSITION_END);
	}

	function cursorAxisUpdate(e) {
		_sysEvents.dispatchEvent('cursorAxisUpdate', e);
	}

	function contactFormSubmit(e) {
		_sysEvents.dispatchEvent(CONTACT_FORM_SUBMIT, e);
	}

	function shareFormSubmit(e) {
		_sysEvents.dispatchEvent(SHARE_FORM_SUBMIT, e);
	}

	function inquiryFormSubmit(e) {
		_sysEvents.dispatchEvent(INQUIRY_FORM_SUBMIT, e);
	}

	function contactFormSent(e) {
		_localEvents.dispatchEvent(CONTACT_FORM_SENT, e);
	}

	function shareFormSent(e) {
		_localEvents.dispatchEvent(SHARE_FORM_SENT, e);
	}

	function inquiryFormSent(e) {
		_localEvents.dispatchEvent(INQUIRY_FORM_SENT, e);
	}

	function overlayBtnClick(e) {
		_sysEvents.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, e);
	}

	function touchNavEnd(e) {
		_sysEvents.dispatchEvent(TOUCH_NAVIGATION_END, e);
	}

	return MediaController;
}({});

var MediaModule = function(imports) {

	var _mediaModuleEvents = new EventSandbox();

	function MediaModule(siteEvents, siteView) {
		var mediaController = new MediaController(_mediaModuleEvents, siteEvents);
		var mediaUpdater = new MediaUpdater(_mediaModuleEvents);
		var mediaView = new MediaView({localEvents:_mediaModuleEvents, siteView:siteView});
		new SectionMediaFactory({localEvents:_mediaModuleEvents});
		var mediaViewBehavior = new MediaViewBehavior({localEvents:_mediaModuleEvents, mediaView:mediaView});
		var overlayController = new OverlayController({siteEvents:siteEvents, localEvents:_mediaModuleEvents, siteView:siteView, mediaView:mediaView});
	}

	return MediaModule;
}({
});

function MediaNavigation(imports) {

	var _localEvents = imports.localEvents,
		_mediaView = imports.mediaView,
		_mediaViewContainer = imports.mediaView.container,
		transition,
		layout,
		contentIsReady = false,
		state = {assetId:0},
		transitionType,
		isOrientationChange,
		_scrollAssetId = 0;

	_localEvents.addEventListener('layoutMediaView', layoutMediaView);
	_localEvents.addEventListener(SECTIONS_MODEL_CHANGE, layoutModelChange);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	_localEvents.addEventListener(RESIZE, mediaNavigationResize);
	_localEvents.addEventListener(ORIENTATION_CHANGE, orientationChange);
	_localEvents.addEventListener('mediaSizeUpdate', mediaSizeUpdate);
	_localEvents.addEventListener('siteUriChange', siteUriChange);
	_localEvents.addEventListener('assetReset', assetReset);
	_localEvents.addEventListener(TOUCH_NAVIGATION_END, touchNavEnd);
	_localEvents.addEventListener('ScrollTransition/updateAssetId', updateAssetId);

	function touchNavEnd(e) {
		if(e.isMove) {
			if(isStartOfGallery() && e.swipeDirection === 'right') {
				assetReset();
			} else if(isEndOfGallery() && e.swipeDirection === 'left') {
				assetReset();
			} else if(e.swipeDirection === 'left' || e.swipeDirection === 'right') {
				e.navDir = e.swipeDirection === 'left' ? 'next' : 'prev';
				_localEvents.dispatchEvent(ADDRESS_ASSET_CHANGE, e);
			} else {
				assetReset();
			}
		} else {
			assetReset();
		}
	}

	function mediaSizeUpdate(){
		if(!layout) {
			defineTransition();
		}
		layout();
		assetReset();
	}

	function isStartOfGallery() {
		return state.assetId === 0;
	}

	function isEndOfGallery() {
		return state.assetId === csvToArray(state.section.media).length - 1;
	}

	function defineTransition() {

		if(_mediaView.scroll) {
			_mediaView.scroll.destroy();
			_mediaView.scroll = null;
		}

		if(!self.touchNav && TOUCH_DEVICE) {
			self.touchNav = new TouchNav({events:_localEvents, mediaViewContainer:_mediaViewContainer});
		}

		transitionType = STATE.overrides.transitionType;

		var lazyLoaderType = transitionType === 'fade' ? 'fade' : 'default';

		_mediaView.lazyLoader = new LazyLoader(_mediaView.container, _mediaView.mask, {
			type:lazyLoaderType,
			property:'translate'
		});

		switch(transitionType) {
			case 'fade':
				layout = new FadeLayout({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new FadeTransition({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'x');
				break;
			case 'hSlide':
				layout = new SlideLayoutHorizontal({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new SlideTransitionHorizontal({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'x');
				break;
			case 'vSlide':
				layout = new SlideLayoutVertical({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new SlideTransitionVertical({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'y');
				break;
			case 'hScroll':
				layout = new ScrollLayoutHorizontal({mediaView:_mediaView});
				transition = new ScrollTransitionHorizontal({mediaView:_mediaView, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'x');
				break;
			case 'vScroll':
				layout = new ScrollLayoutVertical({mediaView:_mediaView});
				transition = new ScrollTransitionVertical({mediaView:_mediaView, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'y');
				break;
			case 'grid':
				layout = new GridLayout({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new GridTransition({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				_localEvents.dispatchEvent('cursorAxisUpdate', 'x');
				break;
		}
	}

	function siteUriChange(e) {
		state = e;
		var hasContent = _mediaViewContainer.children.length > 0;
		if(state.mediaToRender && hasContent) {
			if(state.mode.indexOf('thumbs') !== -1 && state.assetId === -1) {
				_mediaViewContainer.transition = 0;
				_mediaViewContainer.alpha = 0;
			} else if(_mediaViewContainer.alpha !== 1) {
				_mediaViewContainer.transition = 0;
				_mediaViewContainer.alpha = 1;
			}

			if(state.assetId > -1) {
				if(state.info.isDeeplink) {
					jumpToAsset(state.assetId);
				} else if(state.info.isModeChange && STATE.overrides.thumbnailType === 'fill' && /thumbs/.test(state.info.lastUri)) {
					jumpToAsset(state.assetId);
				} else {
					transition(state.assetId, state.info.flickSpeed);
				}
			}

			if(!(STATE.overrides.thumbnailType === 'fill' && /thumbs/.test(e.mode)) && STATE.mediaView.videoAutoPlay()) {
				var mediaId = _mediaViewContainer.children[state.assetId].id;
				_localEvents.dispatchEvent('mediaAutoPlay', mediaId);
			}

			if(state.assetId > -1 && _mediaViewContainer.children[state.assetId].type === 'html') {
				_localEvents.dispatchEvent(PAGE_LOADED);
			}
		}
	}

	function assetReset() {
		if(state.mediaToRender.length > state.assetId && transition) {
			if(state.assetId > -1) transition(state.assetId, 0);
		} else if(transition) {
			transition(0, 0);
		}
	}

	function jumpToAsset(assetId) {
		transition(assetId, 0);
	}

	function mediaNavigationResize() {
		if(isAppleMobile()) window.scrollTo(0, 0);
		if(layout) layout();
		if((state.mediaToRender && state.mediaToRender.length > 0 && state.assetId > -1)) {
			if(!transition) defineTransition();
			if(state.info.isModeChange && STATE.overrides.thumbnailType === 'fill') {
				jumpToAsset(state.assetId);
			} else {
				transition(state.assetId);
			}
			isOrientationChange = false;
		}
	}

	function orientationChange(e) {
		isOrientationChange = true;
	}

	function layoutMediaView(e) {
		layoutContent(e);
		resetMediaViewContainer();
	}

	function layoutContent() {
		defineTransition();
		layout();
	}

	function layoutModelChange(e) {
		if(layout) layout();
	}

	function updateAssetId(e) {
		_scrollAssetId = e.id;
		if(state) state.assetId = e.id;
	}

	function resetMediaViewContainer() {
		_mediaViewContainer.transition = 0;
		_mediaViewContainer.translateX = 0;
		_mediaViewContainer.translateY = 0;
		_mediaViewContainer.x = 0;
		_mediaViewContainer.y = 0;
		Tween(_mediaViewContainer, UPDATE_SPEED, {backgroundColor:STATE.mediaView.backgroundColor()});
	}

	this.destroy = function() {
		if(transition && transition.destroy) transition.destroy();
		layout = undefined;
		transition = undefined;
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		_localEvents.removeEventListener(SECTIONS_MODEL_CHANGE, layoutModelChange);
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		_localEvents.removeEventListener(RESIZE, mediaNavigationResize);
		_localEvents.removeEventListener(ORIENTATION_CHANGE, orientationChange);
		_localEvents.removeEventListener('siteUriChange', siteUriChange);
		_localEvents.removeEventListener('layoutMediaView', layoutMediaView);
		_localEvents.removeEventListener('mediaSizeUpdate', mediaSizeUpdate);
		_localEvents.removeEventListener('assetReset', assetReset);
		_localEvents.removeEventListener(TOUCH_NAVIGATION_END, touchNavEnd);
		_localEvents.removeEventListener('ScrollTransition/updateAssetId', updateAssetId);
		if(_mediaView.scroll) _mediaView.scroll.destroy();
		if(self.touchNav) self.touchNav.destroy();
		self.touchNav = null;
		_mediaView.scroll = null;
	};

}

function MediaSlideshow(vars) {

	var _localEvents = vars.localEvents,
		_mediaView = vars.mediaView,
		_mediaViewContainer = vars.mediaView.container,
		assetLength = 0,
		slideShowTimer,
		transition,
		layout,
		_assetId = -1,
		landingMediaTransitionType;

	_localEvents.addEventListener('layoutMediaView', layoutMediaView);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	_localEvents.addEventListener(SETTINGS_MODEL_CHANGE, settingsModelChange);
	_localEvents.addEventListener(RESIZE, mediaSlideshowResize);
	_localEvents.addEventListener('mediaSizeUpdate', layoutContent);
	_localEvents.addEventListener('siteUriChange', siteUriChange);
	_localEvents.addEventListener('assetReset', assetReset);

	function siteUriChange(e) {
		assetLength = _mediaViewContainer.children.length;
		if(assetLength > 1 && !slideShowTimer) {
			initSlideShow();
		} else {
			singleMediaItem();
		}
	}

	function mediaLoaded(e) {
		slideShowTimer.resume();
	}

	function singleMediaItem() {
		_assetId = 0;
		transition(_assetId);
		var mediaViewItem = _mediaViewContainer.children[_assetId];
		if(mediaViewItem.type === 'video') {
			mediaViewItem.autoPlay();
		}
	}

	function slideShow() {
		_assetId = setAssetId();
		var mediaViewItem = _mediaViewContainer.children[_assetId];
		if(mediaViewItem.type === 'video') {
			slideShowTimer.pause();
			mediaViewItem.autoPlay();
			_localEvents.addEventListener('playbackEnd', playbackEnd);
		} else if(mediaViewItem.type === 'image' && !mediaViewItem.loaded) {
			slideShowTimer.pause();
			mediaViewItem.addEventListener(MEDIA_LOADED, mediaLoaded);
		}
		transition(_assetId);
	}

	function playbackEnd(e) {
		slideShowTimer.resume();
		slideShow();
	}

	function setAssetId() {
		if(LAYOUT_MODEL.landingMediaRandomize) {
			return getRandomInt(0, assetLength - 1);
		} else {
			return _assetId < assetLength - 1 ? _assetId + 1 : 0;
		}
	}

	function assetReset() {
		if(transition) transition(_assetId);
	}

	function initSlideShow() {
		slideShowTimer = new Timer(slideShow, LAYOUT_MODEL.landingMediaSpeed, {loop:true});
		slideShowTimer.start();
		slideShow();
	}

	function defineTransition() {

		transitionType = LAYOUT_MODEL.landingMediaTransitionType;

		var lazyLoaderType = transitionType === 'fade' ? 'fade' : 'default';

		_mediaView.lazyLoader = new LazyLoader(_mediaView.container, _mediaView.mask, {
			type:lazyLoaderType,
			property:'translate'
		});

		switch(LAYOUT_MODEL.landingMediaTransitionType) {
			case 'fade':
				layout = new FadeLayout({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new FadeTransition({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				break;
			case 'hSlide':
				layout = new SlideLayoutHorizontal({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new SlideTransitionHorizontal({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				break;
			case 'vSlide':
				layout = new SlideLayoutVertical({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new SlideTransitionVertical({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				break;
			case 'grid':
				layout = new GridLayout({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer});
				transition = new GridTransition({mediaView:_mediaView, mediaViewContainer:_mediaViewContainer, localEvents:_localEvents});
				break;
		}
		layoutContent();
	}

	function mediaSlideshowResize(e) {
		layoutContent(e);
		assetReset();
	}

	function layoutMediaView(e) {
		layoutContent(e);
	}

	function layoutContent(e) {
		if(!layout) defineTransition();
		layout();
	}

	function layoutModelChange(e) {
		if((e && e.id && /landingMediaRandomize|landingMediaTransitionType|landingMediaSpeed|landingMediaTransitionDuration|landingMediaAlignHorizontal|landingMediaAlignVertical|landingMediaScaleType/.test(e.id)) || transitionType !== STATE.overrides.transitionType || !layout) {
			if(slideShowTimer) slideShowTimer.duration = LAYOUT_MODEL.landingMediaSpeed;
			defineTransition();
			transition(_assetId);
			layout();
		}
	}

	function settingsModelChange(e) {

	}

	function getRandomInt(min, max) {
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}

	this.destroy = function() {
		layout = undefined;
		transition = undefined;
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		_localEvents.removeEventListener('siteUriChange', siteUriChange);
		_localEvents.removeEventListener(RESIZE, mediaSlideshowResize);
		_localEvents.removeEventListener('layoutMediaView', layoutMediaView);
		_localEvents.removeEventListener(SETTINGS_MODEL_CHANGE, settingsModelChange);
		_localEvents.removeEventListener('mediaSizeUpdate', layoutContent);
		_localEvents.removeEventListener('assetReset', assetReset);
		if(slideShowTimer) slideShowTimer.destroy();
	};

	defineTransition();
}

var MediaView = function(imports) {

	var self,
		mask,
		container,
		_localEvents;

	function MediaView(vars) {
		self = this;
		mask = new Sprite();
		mask.overflow = 'hidden';
		mask.zIndex = STATE.mediaView.zIndex;

		container = new Sprite();

		mask.addChild(container);

		_localEvents = vars.localEvents;

		updatePosition();
		updateStyle();

		_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
		_localEvents.addEventListener(SECTIONS_MODEL_CHANGE, sectionsModelChange);
		_localEvents.addEventListener(RESIZE, updatePosition);
		_localEvents.addEventListener('MediaView/ContentReady', updateContent);
		mask.addEventListener(CHILD_ADDED, childAdded);

		this.mask = mask;
		this.container = container;

		vars.siteView.addChild(mask);
	}

	function childAdded(child) {
	}

	function sectionsModelChange(e) {
		updateStyle();
		updatePosition();
	}

	function layoutModelChange(e) {
		updateStyle();
		updatePosition();
	}

	function updateStyle() {
		Tween(container, UPDATE_SPEED, {backgroundColor:STATE.mediaView.backgroundColor()});
	}

	function updateContent(items) {
		container.removeChildren(container);
		var i = 0,
			l = items.length;
		for(; i < l; i++) {
			container.addChild(items[i]);
		}
		updatePosition();
		_localEvents.dispatchEvent('MediaView/ContentAdded', container);
	}

	function updatePosition() {
		Tween(mask, 0, {
			x:STATE.mediaView.x(),
			y:STATE.mediaView.y(),
			width:STATE.mediaView.width(),
			height:STATE.mediaView.height()
		});
	}

	return MediaView;
}({
});

function MediaViewBehavior(imports) {

	var _localEvents = imports.localEvents,
		_mediaView = imports.mediaView,
		_mediaViewContainer = imports.mediaView.container,
		viewMode,
		behavior,
		init;

	_localEvents.addEventListener('MediaViewBehavior/navigationModeChange', navigationModeChange);

	function defineNavigation() {
		if(behavior) behavior.destroy();
		_mediaViewContainer.transition = 0;
		_mediaViewContainer.alpha = 1;
		switch(viewMode) {
			case 'landingMedia':
				behavior = new MediaSlideshow({localEvents:_localEvents, mediaView:_mediaView});
				break;
			case 'mediaView':
				behavior = new MediaNavigation({localEvents:_localEvents, mediaView:_mediaView});
				break;
		}
	}

	function navigationModeChange(mode) {
		viewMode = mode;
		defineNavigation();
	}

}

function SectionMediaFactory(imports) {

	var _localEvents = imports.localEvents;

	_localEvents.addEventListener('SectionMediaFactory/buildItems', buildItems);

	function buildItems(e) {
		var i = 0,
			media = e.media,
			l = media.length,
			mediaItems = [];
		for(; i < l; i++) {
			var mediaItem = getMediaById(media[i]),
				item,
				mediaVars = {size:mediaItem.size, localEvents:_localEvents, mediaItem:mediaItem, loaderColor:getLoaderColor(STATE.mediaView.backgroundColor())};
			switch(mediaItem.type) {
				case IMAGE:
					item = new ImageView(mediaVars);
					break;
				case VIDEO:
					item = new VideoView(mediaVars);
					break;
				case HTML:
					item = new PageView(mediaVars);
					break;
				case CONTACT:
					item = new ContactView(mediaVars);
					break;
				default:
					break;
			}
			if(item) mediaItems.push(item);
		}

		_localEvents.dispatchEvent('SectionMediaFactory/mediaBuilt', {media:mediaItems});
	}
}

function MediaUpdater(localEvents) {

	var _localEvents = localEvents,
		_container,
		_items;

	_localEvents.addEventListener('MediaUpdater/updateContainer', updateContainer);
	_localEvents.addEventListener('MediaUpdater/updateItems', updateItems);

	function updateContainer(e) {
		_container = e;
		_items = _container.children;
		trace('updateContainer', e);
	}

	function updateItems(e) {
		trace('updateItems', e);
		if(_container) {
			var i = 0,
				l = _items.length;
			for(; i < l; i++) {
				if(_items[i].id === e.id) {
					trace('found it: ', e.id);
				}
			}
		}
	}

}

function FadeLayout(imports) {

	var _container = imports.mediaViewContainer,
		_mediaView = imports.mediaView;

	function layout() {

		var i = 0,
			items = _container.children,
			length = items.length,
			maxWidth = 0,
			maxHeight = 0;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.x = 0;
			item.y = 0;
			item.zIndex = 0;
			// chrome emulator blank when vimeo on landing media
			// if(BROWSER_NAME === 'Mobile Safari') item.visibility = 'hidden';
		}

		_container.transition = 0;
		_container.translateX = 0;
		_container.translateY = 0;
		_container.x = 0;
		_container.y = 0;
		_container.width = STATE.mediaView.width();
		_container.height = STATE.mediaView.height();

		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		item.width = STATE.mediaView.width();
		item.height = STATE.mediaView.height();
	}

	return layout;
}

function FadeTransition(imports) {

	var _container = imports.mediaViewContainer,
		_localEvents = imports.localEvents,
		_mediaView = imports.mediaView,
		timeout,
		currentIndex,
		transitionDuration,
		ease = TOUCH_DEVICE ? 'cubic-bezier(0.1, 0.6, 0.4, 1)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

	function transition(assetId, transitionDuration) {

		transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		var i = 0,
			items = _container.children,
			length = items.length;

		_localEvents.dispatchEvent(TRANSITION_START);

		for(; i < length; i++) {
			var item = items[i];
			item.i = i;
			if(i === assetId) {
				currentIndex = i;
				item.transition = 0;
				item.x = 0;
				if(_mediaView.lazyLoader) _mediaView.lazyLoader.update(assetId);
				if(BROWSER_NAME === 'Mobile Safari') item.visibility = 'visible';
				item.pointerEvents = 'auto';
				item.zIndex = 100;
				Tween.defer(item, STATE.mediaView.transitionDuration(), {alpha:1, ease:ease, onComplete:function(){
					_localEvents.dispatchEvent(TRANSITION_END);
				}});
			} else {
				item.pointerEvents = 'none';
				item.zIndex = 0;
				new Tween(item, transitionDuration, {alpha:0, ease:ease});
			}
		}
	}

	return transition;
}

function GridLayout(imports) {

	var _Tile = Tile,
		_container = imports.mediaViewContainer,
		_mediaView = imports.mediaView;

	function layout() {
		var tile = new _Tile();
		tile.gap = 0;
		tile.axis = 'y';
		tile.align = 'left';
		tile.wrap = true;
		tile.perpLength = STATE.mediaView.width() * 4;

		var i = 0,
			items = _container.children,
			length = items.length;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.display = 'block';
			item.alpha = 1;
			tile.addItem(item.width, item.height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			items[i].x = position.x;
			items[i].y = position.y;
		}

		var bounds = tile.getBounds();
		_container.transition = 0;
		_container.width = bounds.width;
		_container.height = bounds.height;

		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		item.width = STATE.mediaView.width();
		item.height = STATE.mediaView.height();
	}

	return layout;
}

function GridTransition(imports) {

	var _container = imports.mediaViewContainer,
		_localEvents = imports.localEvents,
		_mediaView = imports.mediaView;

	_localEvents.dispatchEvent(TRANSITION_START);

	var ease = TOUCH_DEVICE ? 'cubic-bezier(0.1, 0.6, 0.4, 1)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

	function transition(assetId, transitionDuration) {

		var transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		var asset = _container.children[assetId];
		var assetX = asset.x;
		var assetY = asset.y;
		Tween(_container, transitionDuration, {translateX:-assetX, translateY:-assetY, ease:ease, onComplete:function(){
			_localEvents.dispatchEvent(TRANSITION_END);
			if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
		}});
	}

	return transition;
}

function ScrollLayoutHorizontal(imports) {

	var _Tile = Tile,
		_mediaView = imports.mediaView,
		_container = _mediaView.container,
		_mask = _mediaView.mask;

	if(!_mediaView.scroll) {
		_mediaView.scroll = new Scroll(_container, _mask, {
			types:['bar','wheel','touch'],
			axis:'x',
			align:'left',
			color:STATE.overrides.imageVideoScrollbarColor,
			hover:STATE.overrides.imageVideoScrollbarHover,
			side:STATE.overrides.imageVideoScrollbarAlignment,
			alpha:STATE.overrides.imageVideoScrollbarBgTransparency,
			width:STATE.overrides.imageVideoScrollbarWidth,
			offsetX:STATE.overrides.imageVideoScrollbarHorizontalOffset,
			offsetY:STATE.overrides.imageVideoScrollbarVerticalOffset,
			topPad:0,
			parent:dx.site.siteView,
			property:'translate',
			zIndex:STATE.mediaView.zIndex
		});
	}

	function layout() {
		var tile = new _Tile();
		tile.gap = 0;
		tile.axis = 'x';
		tile.align = 'left';
		tile.wrap = false;
		tile.perpLength = STATE.mediaView.height();

		var i = 0,
			items = _container.children,
			length = items.length;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.display = 'block';
			item.alpha = 1;
			tile.addItem(item.width, item.height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			items[i].x = position.x;
			items[i].y = position.y;
		}

		var bounds = tile.getBounds();
		_container.transition = 0;
		_container.width = bounds.width;
		_container.height = bounds.height;

		if(_mediaView.scroll) {
			setTimeout(function(){
				_mediaView.scroll.resize();
			}, UPDATE_SPEED * 1000);
		}
		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		var mediaTypePrefix = formatMediaType(MEDIA_MODEL[item.id].type);
		var leftMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginLeft'], stage.width);
		var rightMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginRight'], stage.width);
		var topMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginTop'], stage.height);
		var bottomMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginBottom'], stage.height);
		var scale = new ScaleEngine();
		scale.type = 'fit';
		if(MEDIA_MODEL[item.id].type === 'video' && !item.videoLoaded) {
			scale.width = MEDIA_MODEL[item.id].size.thumb.width;
			scale.height = MEDIA_MODEL[item.id].size.thumb.height;
		} else {
			scale.width = MEDIA_MODEL[item.id].size.content.width;
			scale.height = MEDIA_MODEL[item.id].size.content.height;
		}
		scale.hRange = STATE.mediaView.width() * 3;
		scale.vRange = STATE.mediaView.height() - (topMargin + bottomMargin);
		if(/html|contact/.test(MEDIA_MODEL[item.id].type)) {
			item.width = STATE.mediaView.width();
			item.height = STATE.mediaView.height();
		} else {
			item.width = Mth.floor(scale.width) + (leftMargin + rightMargin); /*need to Math.floor() the perp-axis so that the image scale gets the same hRange*/
			item.height = Mth.round(scale.height) + (topMargin + bottomMargin);
		}
	}

	return layout;
}

function ScrollTransitionHorizontal(imports) {

	var _mediaView = imports.mediaView,
		_container = _mediaView.container,
		_mask = _mediaView.mask,
		_localEvents = imports.localEvents,
		_scrollInteraction;

	_mediaView.scroll.addEventListener('scrollStop', scrollStop);
	_mediaView.scroll.addEventListener('scrollStart', scrollStart);
	_mediaView.scroll.addEventListener(SCROLL, scroll);

	function transition(assetId, transitionDuration) {

		var transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		_localEvents.dispatchEvent(TRANSITION_START);

		var ease = TOUCH_DEVICE ? 'cubic-bezier(0.1, 0.6, 0.4, 1)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

		var asset = _container.children[assetId];
		var assetX = asset.x;
		var assetY = asset.y;

		var alignBehavior = getAlignBehavior(assetId, _container.children.length);

		var hAlign = AlignEngine({width:asset.width, hRange:_mask.width, hAlign:alignBehavior});
		assetX = asset.x - hAlign.x;

		var scollDist = _container.width - _mask.width;
		var percent = assetX / scollDist;
		_mediaView.scroll.percent = percent;
		_mediaView.scroll.bar.moveHandle(STATE.mediaView.transitionDuration());
		Tween(_container, transitionDuration, {translateX:-assetX, translateY:-assetY, ease:ease, onComplete:function(){
			_localEvents.dispatchEvent(TRANSITION_END);
			if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
		}});
		setActiveAlpha(assetId);
		_scrollInteraction = false;
	}

	transition.destroy = function destroy() {
		_mediaView.scroll.removeEventListener('scrollStop', scrollStop);
		_mediaView.scroll.removeEventListener('scrollStart', scrollStart);
		_mediaView.scroll.removeEventListener(SCROLL, scroll);
	};

	function setActiveAlpha(activeIndex) {
		var i = _container.children.length;
		while(i--) {
			var child = _container.children[i],
				alpha = activeIndex === undefined || (!isNaN(activeIndex) && activeIndex === i) ? 1 : STATE.overrides.imageVideoInactiveAlpha;
			Tween(child, STATE.mediaView.transitionDuration(), {alpha:alpha});
		}
	}

	function getAlignBehavior(assetId, arrLen) {
		if(assetId === 0) {
			return 'left';
		} else if(assetId === arrLen - 1) {
			return 'right';
		}
		return STATE.mediaView.hAlign();
	}

	function getCurrentAssetPosition() {
		var i = _container.children.length;
		while(i--) {
			var child = _container.children[i];
			var mediaViewCenter = _mask.width * 0.5;
			if(-_container.translateX + mediaViewCenter >= child.x && -_container.translateX + mediaViewCenter <= child.x + child.width) {
				_localEvents.dispatchEvent('ScrollTransition/updateAssetId', {id:i});
			}
		}
	}

	function scrollStart(e) {
		_localEvents.dispatchEvent('mediaScrollStart');
		_localEvents.dispatchEvent('pauseMedia');
		setActiveAlpha();
	}

	function scrollStop(e) {
		if(_scrollInteraction) getCurrentAssetPosition();
	}

	function scroll(e) {
		_scrollInteraction = true;
		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	return transition;
}

function ScrollLayoutVertical(imports) {

	var _Tile = Tile,
		_mediaView = imports.mediaView,
		_container = _mediaView.container,
		_mask = _mediaView.mask;

	if(!_mediaView.scroll) {
		_mediaView.scroll = new Scroll(_container, _mask, {
			types:['bar','wheel','touch'],
			axis:'y',
			align:'left',
			color:STATE.overrides.imageVideoScrollbarColor,
			hover:STATE.overrides.imageVideoScrollbarHover,
			side:STATE.overrides.imageVideoScrollbarAlignment,
			alpha:STATE.overrides.imageVideoScrollbarBgTransparency,
			width:STATE.overrides.imageVideoScrollbarWidth,
			offsetX:STATE.overrides.imageVideoScrollbarHorizontalOffset,
			offsetY:STATE.overrides.imageVideoScrollbarVerticalOffset,
			topPad:0,
			parent:dx.site.siteView,
			property:'translate',
			zIndex:STATE.mediaView.zIndex
		});
	}

	function layout() {
		var tile = new _Tile();
		tile.gap = 0;
		tile.axis = 'y';
		tile.align = 'left';
		tile.wrap = false;
		tile.perpLength = STATE.mediaView.width();

		var i = 0,
			items = _container.children,
			length = items.length;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.display = 'block';
			item.alpha = 1;
			tile.addItem(item.width, item.height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			items[i].x = position.x;
			items[i].y = position.y;
		}

		var bounds = tile.getBounds();
		_container.transition = 0;
		_container.width = bounds.width;
		_container.height = bounds.height;

		if(_mediaView.scroll) {
			setTimeout(function(){
				_mediaView.scroll.resize();
			}, UPDATE_SPEED * 1000);
		}
		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		var mediaTypePrefix = formatMediaType(MEDIA_MODEL[item.id].type);
		var leftMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginLeft'], stage.width);
		var rightMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginRight'], stage.width);
		var topMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginTop'], stage.height);
		var bottomMargin = percentToPixels(STATE.overrides[mediaTypePrefix + 'MarginBottom'], stage.height);
		var scale = new ScaleEngine();
		scale.type = 'fit';
		if(MEDIA_MODEL[item.id].type === 'video' && !item.videoLoaded) {
			scale.width = MEDIA_MODEL[item.id].size.thumb.width;
			scale.height = MEDIA_MODEL[item.id].size.thumb.height;
		} else {
			scale.width = MEDIA_MODEL[item.id].size.content.width;
			scale.height = MEDIA_MODEL[item.id].size.content.height;
		}
		scale.hRange = STATE.mediaView.width() - (leftMargin + rightMargin);
		scale.vRange = STATE.mediaView.height() * 3;
		if(/html|contact/.test(MEDIA_MODEL[item.id].type)) {
			item.width = STATE.mediaView.width();
			item.height = STATE.mediaView.height();
		} else {
			item.width = Mth.floor(scale.width) + (leftMargin + rightMargin); /*need to Math.floor() the perp-axis so that the image scale gets the same hRange*/
			item.height = Mth.round(scale.height) + (topMargin + bottomMargin);
		}
	}

	return layout;
}

function ScrollTransitionVertical(imports) {

	var _mediaView = imports.mediaView,
		_container = _mediaView.container,
		_mask = _mediaView.mask,
		_localEvents = imports.localEvents,
		_scrollInteraction;

	_mediaView.scroll.addEventListener('scrollStop', scrollStop);
	_mediaView.scroll.addEventListener('scrollStart', scrollStart);
	_mediaView.scroll.addEventListener(SCROLL, scroll);

	function transition(assetId, transitionDuration) {

		var transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		_localEvents.dispatchEvent(TRANSITION_START);

		var ease = TOUCH_DEVICE ? 'cubic-bezier(0.1, 0.6, 0.4, 1)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

		var asset = _container.children[assetId];
		var assetX = asset.x;
		var assetY = asset.y;

		var alignBehavior = getAlignBehavior(assetId, _container.children.length);

		var hAlign = AlignEngine({width:asset.width, hRange:_mask.width, hAlign:alignBehavior});
		assetY = asset.y - hAlign.y;

		var scollDist = _container.height - _mask.height;
		var percent = assetY / scollDist;
		_mediaView.scroll.percent = percent;
		_mediaView.scroll.bar.moveHandle(STATE.mediaView.transitionDuration());
		Tween(_container, transitionDuration, {translateX:-assetX, translateY:-assetY, ease:ease, onComplete:function(){
			_localEvents.dispatchEvent(TRANSITION_END);
			if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
		}});
		setActiveAlpha(assetId);
		_scrollInteraction = false;
	}

	transition.destroy = function destroy() {
		_mediaView.scroll.removeEventListener('scrollStop', scrollStop);
		_mediaView.scroll.removeEventListener('scrollStart', scrollStart);
		_mediaView.scroll.removeEventListener(SCROLL, scroll);
	};

	function setActiveAlpha(activeIndex) {
		var i = _container.children.length;
		while(i--) {
			var child = _container.children[i],
				alpha = activeIndex && i !== activeIndex ? STATE.overrides.imageVideoInactiveAlpha : 1;
			Tween(child, STATE.mediaView.transitionDuration(), {alpha:alpha});
		}
	}

	function getAlignBehavior(assetId, arrLen) {
		if(assetId === 0) {
			return 'left';
		} else if(assetId === arrLen - 1) {
			return 'right';
		}
		return STATE.mediaView.hAlign();
	}

	function getCurrentAssetPosition() {
		var i = _container.children.length;
		while(i--) {
			var child = _container.children[i];
			var mediaViewCenter = _mask.height * 0.5;
			if(-_container.translateY + mediaViewCenter >= child.y && -_container.translateY + mediaViewCenter <= child.y + child.height) {
				_localEvents.dispatchEvent('ScrollTransition/updateAssetId', {id:i});
			}
		}
	}

	function scrollStart(e) {
		_localEvents.dispatchEvent('mediaScrollStart');
		_localEvents.dispatchEvent('pauseMedia');
		setActiveAlpha();
	}

	function scrollStop(e) {
		if(_scrollInteraction) getCurrentAssetPosition();
	}

	function scroll(e) {
		_scrollInteraction = true;
		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	return transition;
}

function SlideLayoutHorizontal(imports) {

	var _Tile = Tile,
		_container = imports.mediaViewContainer,
		_mediaView = imports.mediaView;

	function layout() {
		var tile = new _Tile();
		tile.gap = 0;
		tile.axis = 'x';
		tile.align = 'left';
		tile.wrap = false;
		tile.perpLength = STATE.mediaView.height();

		var i = 0,
			items = _container.children,
			length = items.length;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.display = 'block';
			item.alpha = 1;
			tile.addItem(item.width, item.height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			items[i].x = position.x;
			items[i].y = position.y;
		}

		var bounds = tile.getBounds();
		_container.transition = 0;
		_container.width = bounds.width;
		_container.height = bounds.height;

		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		item.width = STATE.mediaView.width();
		item.height = STATE.mediaView.height();
	}

	return layout;
}

function SlideTransitionHorizontal(imports) {

	var _container = imports.mediaViewContainer,
		_localEvents = imports.localEvents,
		_mediaView = imports.mediaView;

	function transition(assetId, transitionDuration) {

		var transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		_localEvents.dispatchEvent(TRANSITION_START);

		var ease = TOUCH_DEVICE ? 'cubic-bezier(0.5, 0.3, 0.3, 1.0)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

		var asset = _container.children[assetId];
		var assetX = asset.x;
		var assetY = asset.y;
		Tween(_container, transitionDuration, {translateX:-assetX, translateY:-assetY, ease:ease, onComplete:function(){
			_localEvents.dispatchEvent(TRANSITION_END);
			if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
		}});
	}

	return transition;
}



function SlideLayoutVertical(imports) {

	var _Tile = Tile,
		_container = imports.mediaViewContainer,
		_mediaView = imports.mediaView;

	function layout() {
		var tile = new _Tile();
		tile.gap = 0;
		tile.axis = 'y';
		tile.align = 'left';
		tile.wrap = false;
		tile.perpLength = STATE.mediaView.width();

		var i = 0,
			items = _container.children,
			length = items.length;

		for(; i < length; i++) {
			var item = items[i];
			scaleItem(item);
			item.transition = 0;
			item.display = 'block';
			item.alpha = 1;
			tile.addItem(item.width, item.height);
		}

		tile.layoutItems();

		for(i = 0; i < length; i++) {
			var position = tile.getPosition(i);
			items[i].x = position.x;
			items[i].y = position.y;
		}

		var bounds = tile.getBounds();
		_container.transition = 0;
		_container.width = bounds.width;
		_container.height = bounds.height;

		if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
	}

	function scaleItem(item) {
		item.width = STATE.mediaView.width();
		item.height = STATE.mediaView.height();
	}

	return layout;
}

function SlideTransitionVertical(imports) {

	var _container = imports.mediaViewContainer,
		_localEvents = imports.localEvents,
		_mediaView = imports.mediaView;

	function transition(assetId, transitionDuration) {

		var transitionDuration = transitionDuration !== undefined ? transitionDuration : STATE.mediaView.transitionDuration();

		_localEvents.dispatchEvent(TRANSITION_START);

		var ease = TOUCH_DEVICE ? 'cubic-bezier(0.1, 0.6, 0.4, 1)' : 'cubic-bezier(0.7, 0, 0.3, 1)';

		var asset = _container.children[assetId];
		var assetX = asset.x;
		var assetY = asset.y;
		Tween(_container, transitionDuration, {translateX:-assetX, translateY:-assetY, ease:ease, onComplete:function(){
			_localEvents.dispatchEvent(TRANSITION_END);
			if(_mediaView.lazyLoader) _mediaView.lazyLoader.update();
		}});
	}

	return transition;
}

var Caption = (function() {

	function Caption() {
		this._properties = {};
		this.container = new Sprite();
		this.mask = new Sprite();
		this.container.addChild(this.mask);
		this.hide();
		this.content = new Sprite();
		this.mask.addChild(this.content);
		this.mask.overflow = 'hidden';
	}

	Caption.prototype = {
		get text() {
			return this._properties.text;	
		},
		set text(value) {
			this._properties.text = value;
			this.content.text = value;
		},
		get backgroundColor() {
			return this._properties.backgroundColor;	
		},
		set backgroundColor(value) {
			this._properties.backgroundColor = value;
			this.container.backgroundColor = value;
		},
		get fontFamily() {
			return this._properties.fontFamily;	
		},
		set fontFamily(value) {
			this._properties.fontFamily = value;
			this.content.fontFamily = value;
		},
		get fontColor() {
			return this._properties.fontColor;	
		},
		set fontColor(value) {
			this._properties.fontColor = value;
			this.content.fontColor = value;
		},
		get fontSize() {
			return this._properties.fontSize;	
		},
		set fontSize(value) {
			this._properties.fontSize = value;
			this.content.fontSize = value;
		},
		get textAlign() {
			return this._properties.textAlign;	
		},
		set textAlign(value) {
			this._properties.textAlign = value;
			this.content.textAlign = value;
		},
		get paddingTop() {
			return this._properties.paddingTop;	
		},
		set paddingTop(value) {
			this._properties.paddingTop = value;
			this.content.paddingTop = value;
		},
		get paddingRight() {
			return this._properties.paddingRight;	
		},
		set paddingRight(value) {
			this._properties.paddingRight = value;
			this.content.paddingRight = value;
			this.width = this._properties.width;
		},
		get paddingBottom() {
			return this._properties.paddingBottom;	
		},
		set paddingBottom(value) {
			this._properties.paddingBottom = value;
			this.content.paddingBottom = value;
		},
		get paddingLeft() {
			return this._properties.paddingLeft;	
		},
		set paddingLeft(value) {
			this._properties.paddingLeft = value;
			this.content.paddingLeft = value;
			this.width = this._properties.width;
		},
		get width() {
			return this._properties.width;	
		},
		set width(value) {
			this._properties.width = value;
			this.container.width = value;
			this.mask.width = value;
			this.content.width = value - (this._properties.paddingLeft + this._properties.paddingRight);
		},
		get height() {
			return this._properties.height;	
		},
		set height(value) {
			this._properties.height = value;
			this.container.height = value;
			this.mask.height = value;
		},
		show:function show() {
			var thisCaption = this;
			if(this.text) {
				setTimeout(function() {
					thisCaption.container.display = 'block';
					Tween(thisCaption.container, UPDATE_SPEED, {alpha:1});
					if(thisCaption.scroll) {
						setTimeout(thisCaption.scroll.resize, UPDATE_SPEED * 1000);
					}
				}, 0);
			}
		},
		hide:function hide() {
			this.container.alpha = 0;
			this.container.display = 'none';
		},
		buildScroll:function buildScroll(scrollVars) {
			if(this.scroll) this.scroll.destroy();
			this.scroll = new Scroll(this.content, this.mask, {
				types:['bar','wheel','touch'],
				axis:'y',
				align:scrollVars.align,
				margin:0,
				color:scrollVars.color,
				hover:scrollVars.hover,
				side:scrollVars.side,
				alpha:scrollVars.alpha,
				width:scrollVars.width,
				offsetX:scrollVars.offsetX,
				offsetY:scrollVars.offsetY
			});
			this.scroll.captionScroll = true;
		}
	};

	return Caption;
})();


function ContactView(imports) {

	var self = new Sprite({events:imports.events}),
		formContainer = new Sprite(),
		contactExtra = new Sprite(),
		contactFields = new Sprite(),
		responseMessage = new Sprite(),
		contactFormObj,
		formFieldsArr,
		contactLabel,
		_thumbState,
		_localEvents = imports.localEvents;

	self.alpha = 0;
	formContainer.alpha = 0;
	self.updateSpeed = 0;
	self.id = imports.mediaItem.id;
	self.type = imports.mediaItem.type;
	self.dims = imports.size.content;
	self.element.navigationCursor = true;

	self.addEventListener(CHILD_ADDED, childAdded);
	_localEvents.addEventListener(RESIZE, updatePosition);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
	_localEvents.addEventListener('destroy', destroy);
	_localEvents.addEventListener('showCursor', showCursor);
	_localEvents.addEventListener('hideCursor', hideCursor);

	function showCursor(e) {
		self.element.navigationCursor = true;
	}

	function hideCursor(e) {
		self.element.navigationCursor = false;
	}

	function childAdded(child) {
		self.addChild(formContainer);

		if(imports.mediaItem.content.contactFormFields) {
			contactFormObj = imports.mediaItem.content;
		} else {
			contactFormObj = {contactFormEmail:SETTINGS_MODEL.contactFormEmail, contactFormFields:SETTINGS_MODEL.contactFormFields, contactFormSubject:'Contact Form Submitted', contactFormExtra:SETTINGS_MODEL.contactFormExtra};
		}

		formFieldsArr = csvToArray(contactFormObj.contactFormFields);

		contactExtra.text = contactFormObj.contactFormExtra.replace(/\r\n/g, '<br>').replace(/\\r\\n/g, '<br>').replace(/\n\r/g, '<br>').replace(/\\n\\r/g, '<br>').replace(/\r/g, '<br>').replace(/\\r/g, '<br>').replace(/\n/g, '<br>').replace(/\\n/g, '<br>').replace(/\\/g, '');
		contactExtra.fontFamily = LAYOUT_MODEL.contactFont;
		contactExtra.fontSize = LAYOUT_MODEL.contactFontSize;
		contactExtra.fontColor = LAYOUT_MODEL.contactFontColor;
		contactExtra.textAlign = 'right';
		contactExtra.textWrap = false;
		formContainer.addChild(contactExtra);
		formContainer.addChild(contactFields);

		var contactImgs = formContainer.element.getElementsByTagName('img'),
			i = contactImgs.length;

		if(contactImgs.length > 0) {
			while(i--) {
				var img = contactImgs[i];
				img.addEventListener(LOAD, function(e) {
					updatePosition();
				});
			}
		}

		if(contactExtra.width > 320) {
			contactExtra.width = 320;
			contactExtra.textWrap = true;
			contactExtra.style['word-wrap'] = 'break-word';
		}


		var i = 0,
			length = formFieldsArr.length,
			fieldY = 0;

		for(;i < length; i++) {
			var input = buildFormInput(formFieldsArr[i]);
			input.x = 16;
			input.y = fieldY;
			contactFields.addChild(input);
			fieldY += formFieldsArr[i] === 'Comments' ? 180 : 50;
		}

		var submit = new Button();
		submit.text = 'Submit';
		submit.x = 16;
		submit.y = fieldY + 5;
		submit.fontSize = 12;
		submit.fontColor = LAYOUT_MODEL.contactFontColor;
		submit.backgroundColor = LAYOUT_MODEL.contactFieldRectColor;
		submit.paddingTop = 2;
		submit.paddingRight = 14;
		submit.paddingBottom = 2;
		submit.paddingLeft = 14;
		contactFields.addChild(submit);
		submit.addEventListener(FOCUS, onFocusSubmit);
		submit.addEventListener(BLUR, onBlurSubmit);
		submit.addEventListener(MOUSE_OVER, onFocusSubmit);
		submit.addEventListener(MOUSE_OUT, onBlurSubmit);
		submit.addEventListener(CLICK, onSubmit);

		_localEvents.addEventListener('destroy', destroy);

		function destroy(e) {
			_localEvents.removeEventListener('destroy', destroy);
			submit.removeEventListener(FOCUS, onFocusSubmit);
			submit.removeEventListener(BLUR, onBlurSubmit);
			submit.removeEventListener(MOUSE_OVER, onFocusSubmit);
			submit.removeEventListener(MOUSE_OUT, onBlurSubmit);
			submit.removeEventListener(CLICK, onSubmit);
		}

		fieldY += 25;

		contactFields.width = 318;
		contactFields.height = fieldY;
		contactFields.borderLeft = '1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.3);

		if(LAYOUT_MODEL.contactTitleShow) {
			contactLabel = new TextField();
			contactLabel.text = imports.mediaItem.label;
			formContainer.addChild(contactLabel);
			contactLabel.fontFamily = LAYOUT_MODEL.contactTitleFont;
			contactLabel.fontSize = LAYOUT_MODEL.contactTitleFontSize;
			contactLabel.fontColor = LAYOUT_MODEL.contactFontColor;
			contactLabel.textWrap = false;
			contactLabel.x = contactExtra.width + 16;
			contactLabel.y = percentToPixels(LAYOUT_MODEL.contactTitleFontSize, 100) - 36;
		}

		formContainer.width = contactExtra.width + contactFields.width;
		var formHeight = 22;
		if(LAYOUT_MODEL.contactTitleShow) {
			formHeight += contactLabel.height;
		}
		if(contactExtra.height > contactFields.height) {
			formHeight += contactExtra.height;
		} else {
			formHeight += contactFields.height;
		}
		formHeight += submit.height + 5;
		formContainer.height = formHeight;

		responseMessage.alpha = 0;
		responseMessage.x = contactExtra.width + 17;
		responseMessage.y = 44;
		responseMessage.fontSize = 14;
		formContainer.addChild(responseMessage);

		_localEvents.addEventListener(CONTACT_FORM_SENT, contactResponse);

		var types = USER_AGENT === MOBILE ? ['wheel','touch'] : ['bar','wheel','touch'];

		self.scroll = new Scroll(formContainer, self, {
			types:types,
			axis:'y',
			align:'center',
			color:LAYOUT_MODEL.pageScrollbarColor,
			hover:LAYOUT_MODEL.pageScrollbarHover,
			side:LAYOUT_MODEL.pageScrollbarAlignment,
			width:8,
			margin:20,
			offsetX:-8,
			parent:self
		});

		updateStyle();
		updatePosition();
	}

	function buildFormInput(label) {
		var holder = new Sprite();
		holder.width = 300;
		var title = new TextField();
		title.fontFamily = LAYOUT_MODEL.contactTitleFont;
		title.fontColor = LAYOUT_MODEL.contactFontColor;
		title.fontSize = 11;
		title.text = label;
		holder.addChild(title);
		var input = label === 'Comments' ? new TextArea() : new Input();
		input.backgroundColor = toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.1);
		input.border = '1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.3);
		input.fontFamily = LAYOUT_MODEL.contactTitleFont;
		input.fontColor = LAYOUT_MODEL.contactFontColor;
		input.fontSize = 14;
		input.height = label === 'Comments' ? 150 : 20;
		input.width = 300;
		input.y = 17;

		input.addEventListener(FOCUS, onFocus);
		input.addEventListener(BLUR, onBlur);
		_localEvents.addEventListener('destroy', destroy);

		function destroy(e) {
			_localEvents.removeEventListener('destroy', destroy);
			input.removeEventListener(FOCUS, onFocus);
			input.removeEventListener(BLUR, onBlur);
		}

		holder.addChild(input);
		holder.id = label;
		holder.input = input;
		return holder;
	}

	function onFocus(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.2), border:'1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.7)});
	}

	function onBlur(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.1), border:'1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.3)});
	}

	function onFocusSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.8)});
	}

	function onBlurSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.contactFieldRectColor, 1)});
	}

	function contactResponse(e) {
		responseMessage.text = e.response;
		Tween(contactFields, UPDATE_SPEED, {alpha:0, onComplete:function(e){
			contactFields.display = 'none';
		}});
		Tween(responseMessage, UPDATE_SPEED, {alpha:1});
	}

	function onSubmit(e) {
		var i = 0,
			length = contactFields.children.length,
			str = '&Title=' + encodeURIComponent(imports.mediaItem.label) + '&to=' + encodeURIComponent(contactFormObj.contactFormEmail) + '&subject=' + encodeURIComponent(contactFormObj.contactFormSubject);
		for(; i < length; i++) {
			var fields = contactFields.children[i];
			if(fields.id && fields.input) {
				if(fields.id === 'Name' && fields.input.value === '') {
					alert('Name field cannot be blank.');
					return false;
				} else if(fields.id === 'Email' && (fields.input.value.indexOf("@") === -1 || fields.input.value.indexOf(".") === -1)) {
					alert('Please enter valid email address.');
					return false;
				} else if(fields.id === 'Comments' && fields.input.value === '') {
					alert('Comments field cannot be blank.');
					return false;
				}
				str += '&' + fields.id + '=' + encodeURIComponent(fields.input.value);
			}
		}
		str = str.replace(/\r/g,"<br>").replace(/\n/g,"<br>");
		_localEvents.dispatchEvent(CONTACT_FORM_SUBMIT, str);
	}

	function updateStyle(e) {
		Tween(self, self.updateSpeed, {backgroundColor:STATE.mediaView.backgroundColor()});
	}

	self.load = function load() {
		self.loaded = true;
	};

	self.unload = function unload() {

	};

	self.show = function() {
		self.display = 'block';
		Tween(self, UPDATE_SPEED, {alpha:1});
	};

	self.hide = function() {
		Tween(self, UPDATE_SPEED, {alpha:0,onComplete:function() {
			self.display = 'none';
		}});
	};

	function updatePosition(e) {
		layoutCalcs.activeMediaType = self.type;
		formContainer.width = contactExtra.width + contactFields.width;
		if(formContainer.width > STATE.mediaView.width()) {
			contactExtra.x = 16;
			contactFields.x = 0;
			if(LAYOUT_MODEL.contactTitleShow) {
				contactLabel.x = 16;
				contactLabel.y = percentToPixels(LAYOUT_MODEL.contactTitleFontSize, 100);
				contactExtra.y = contactLabel.y + percentToPixels(LAYOUT_MODEL.contactTitleFontSize, 100) + 16;
				contactFields.y = contactExtra.y + contactExtra.height + 16;
				} else {
				contactFields.y = contactExtra.height;
			}
			if(self.scroll) self.scroll.align = 'top';
			contactFields.borderLeft = '1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0);
			contactExtra.textAlign = 'left';
		} else {
			contactExtra.x = -16;
			contactFields.x = contactExtra.width;
			contactFields.y = 44;
			contactFields.borderLeft = '1px solid ' + toRgba(LAYOUT_MODEL.contactFieldRectColor, 0.3);
			contactExtra.textAlign = 'right';
			if(LAYOUT_MODEL.contactTitleShow) {
				contactLabel.textWrap = true;
				contactLabel.x = contactExtra.width + 16;
				contactLabel.y = percentToPixels(LAYOUT_MODEL.contactTitleFontSize, 100) - 36;
			}
			if(self.scroll) self.scroll.align = 'center';
		}

		formContainer.height = contactFields.y + contactFields.height;
		formContainer.transition = 0;
		Tween.defer(formContainer, self.updateSpeed, {x:getFormX(), y:getFormY(), onComplete:function(){
			if(self.scroll) self.scroll.resize();
			Tween(formContainer, UPDATE_SPEED, {alpha:1});
		}});

		self.updateSpeed = UPDATE_SPEED;
		isInit = false;

	};

	function getFormX() {
		layoutCalcs._activeView = 'contact';
		if(formContainer.width > STATE.mediaView.width()) {
			return ((STATE.mediaView.width() - contactFields.width) * 0.5) - 8;
		} else {
			return ((STATE.mediaView.width() - formContainer.width) * 0.5);
		}
	}

	function getFormY() {
		layoutCalcs._activeView = 'contact';
		return ((STATE.mediaView.height() - formContainer.height) * 0.5);
	}

	function destroy(e) {
		_localEvents.removeEventListener(RESIZE, updatePosition);
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
		_localEvents.removeEventListener('destroy', destroy);
		_localEvents.removeEventListener('showCursor', showCursor);
		_localEvents.removeEventListener('hideCursor', hideCursor);
		_localEvents.removeEventListener(CONTACT_FORM_SENT, contactResponse);
		self.removeEventListener(CHILD_ADDED, childAdded);
	}

	return self;
}

function ImageView(imports) {

	var self = new Sprite({events:imports.localEvents});
	self.alpha = 0;
	self.updateSpeed = 0;
	self.overflow = 'hidden';
	self.id = imports.mediaItem.id;
	self.type = imports.mediaItem.type;
	self.dims = imports.size.content;
	self.element.navigationCursor = true;

	var image = new Bitmap(),
		mask = new Sprite(),
		caption,
		loader,
		originalImageWidth = imports.size.content.width,
		originalImageHeight = imports.size.content.height,
		imageWidth = 0,
		imageHeight = 0,
		imageX = 0,
		imageY = 0,
		maskWidth = 0,
		maskHeight = 0,
		loaded = false,
		_thumbState,
		_captionLocal,
		_localEvents = imports.localEvents;

	image.alpha = 0;
	image.selectable = false;
	mask.overflow = 'hidden';

	_localEvents.addEventListener(RESIZE, updatePosition);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
	_localEvents.addEventListener('destroy', destroy);
	_localEvents.addEventListener('showCursor', showCursor);
	_localEvents.addEventListener('hideCursor', hideCursor);
	self.addEventListener(CHILD_ADDED, childAdded);

	function childAdded(child) {
		image.element.navigationCursor = true;
		mask.element.navigationCursor = true;
		image.element.addEventListener('contextmenu', disable);
		image.element.addEventListener('dragstart', disable);
		self.addChild(mask);
		mask.addChild(image);
		loader = new LoadingIndicator({color:imports.loaderColor});
		mask.addChild(loader);
		updateStyle();
		updatePosition();
	}

	function disable(e) {
		e.preventDefault();
	}

	function showCursor(e) {
		self.element.navigationCursor = true;
		image.element.navigationCursor = true;
		mask.element.navigationCursor = true;
	}

	function hideCursor(e) {
		self.element.navigationCursor = false;
		image.element.navigationCursor = false;
		mask.element.navigationCursor = false;
	}

	function updateStyle(e) {
		if(image && LAYOUT_MODEL.imageRendering.optimizeQuality) image.style['image-rendering'] = 'optimizeQuality';
		if(image && LAYOUT_MODEL.imageRendering.webkitOptimizeContrast) image.style['image-rendering'] = '-webkit-optimize-contrast';
		if(image && BROWSER_NAME === 'Safari' && LAYOUT_MODEL.imageRendering.webkitBackfaceVisibility) image.style['-webkit-backface-visibility'] = 'hidden';
		Tween(self, self.updateSpeed, {backgroundColor:STATE.mediaView.backgroundColor()});
		if(caption) setTimeout(updateCaptionStyle, self.updateSpeed * 1000);
	}

	function updateCaptionStyle(e) {
		caption.container.transition = 0;

		var alignVars = {
			onInit:function() {
				if(caption.scroll) {
					caption.scroll.hide();
				}
			},
			onComplete:function() {
				if(caption.scroll) {
					caption.scroll.show();
					caption.scroll.resize();
				}
			}
		};

		var bgColor = _captionLocal.captionBackgroundRectColor || STATE.overrides.captionBackgroundRectColor; 
		var bgAlpha = firstValid(_captionLocal.captionBackgroundAlpha, STATE.overrides.captionBackgroundAlpha); 
		caption.backgroundColor = toRgba(bgColor, bgAlpha);		
		caption.fontFamily = _captionLocal.captionFont || STATE.overrides.captionFont;
		caption.fontSize = firstValid(_captionLocal.captionFontSize, STATE.overrides.captionFontSize);
		caption.fontColor = _captionLocal.captionFontColor || STATE.overrides.captionFontColor;

		if(LAYOUT_MODEL.captionAutoPosition !== false) {
			var padding = 10;
			layoutCalcs.captionView.size(caption.text);
			caption.width = layoutCalcs.captionView.width + (padding * 2);
			caption.height = layoutCalcs.captionView.height + (padding * 2);
			alignVars.width = layoutCalcs.captionView.width + (padding * 2);
			alignVars.height = layoutCalcs.captionView.height + (padding * 2);
			alignVars.hRange = self.width;
			alignVars.vRange = self.height;
			alignVars.hAlign = 'center';
			alignVars.vAlign = 'bottom';
			alignVars.hOffset = 0;
			alignVars.vOffset = 33;
			caption.textAlign = 'center';
			caption.paddingTop = padding;
			caption.paddingRight = 0;
			caption.paddingBottom = padding;
			caption.paddingLeft = 0;
			caption.buildScroll({
				color:STATE.overrides.captionScrollbarColor,
				hover:STATE.overrides.captionScrollbarHover,
				align:STATE.overrides.captionTextAlignVertical,
				side:STATE.overrides.captionScrollbarAlignment,
				alpha:STATE.overrides.captionScrollbarBgAlpha,
				width:STATE.overrides.captionScrollbarWidth,
				offsetX:STATE.overrides.captionScrollbarHorizontalOffset,
				offsetY:STATE.overrides.captionScrollbarVerticalOffset
			});
		} else {
			caption.width = firstValid(_captionLocal.captionWidth, STATE.overrides.captionWidth);
			caption.height = firstValid(_captionLocal.captionHeight, STATE.overrides.captionHeight);
			alignVars.width = firstValid(_captionLocal.captionWidth, STATE.overrides.captionWidth);
			alignVars.height = firstValid(_captionLocal.captionHeight, STATE.overrides.captionHeight);
			if(_captionLocal.captionAnchorTo === 'media item' || STATE.overrides.captionAnchorTo === 'media item') {
				alignVars.hOrigin = STATE.mediaView.maskX() + imageX;
				alignVars.vOrigin = STATE.mediaView.maskY() + imageY;
				alignVars.hRange = imageWidth;
				alignVars.vRange = imageHeight;
			} else if(_captionLocal.captionAnchorTo === 'media area' || STATE.overrides.captionAnchorTo === 'media area') {
				alignVars.hOrigin = 0;
				alignVars.vOrigin = 0;
				alignVars.hRange = layoutCalcs.mediaView.width();
				alignVars.vRange = layoutCalcs.mediaView.height();
			}
			alignVars.hAlign = _captionLocal.captionAlignHorizontal || STATE.overrides.captionAlignHorizontal;
			alignVars.vAlign = _captionLocal.captionAlignVertical || STATE.overrides.captionAlignVertical;
			alignVars.hOffset = firstValid(_captionLocal.captionOffsetX, STATE.overrides.captionOffsetX);
			alignVars.vOffset = firstValid(_captionLocal.captionOffsetY, STATE.overrides.captionOffsetY);
			caption.textAlign = _captionLocal.captionTextAlign || STATE.overrides.captionTextAlign;
			caption.paddingTop = firstValid(_captionLocal.captionPaddingTop, STATE.overrides.captionPaddingTop);
			caption.paddingRight = firstValid(_captionLocal.captionPaddingRight, STATE.overrides.captionPaddingRight);
			caption.paddingBottom = firstValid(_captionLocal.captionPaddingBottom, STATE.overrides.captionPaddingBottom);
			caption.paddingLeft = firstValid(_captionLocal.captionPaddingLeft, STATE.overrides.captionPaddingLeft);
			caption.buildScroll({
				color:_captionLocal.captionScrollbarColor || STATE.overrides.captionScrollbarColor,
				hover:_captionLocal.captionScrollbarHover || STATE.overrides.captionScrollbarHover,
				align:_captionLocal.captionTextAlignVertical || STATE.overrides.captionTextAlignVertical,
				side:_captionLocal.captionScrollbarAlignment || STATE.overrides.captionScrollbarAlignment,
				alpha:firstValid(_captionLocal.captionScrollbarBgAlpha, STATE.overrides.captionScrollbarBgAlpha),
				width:firstValid(_captionLocal.captionScrollbarWidth, STATE.overrides.captionScrollbarWidth),
				offsetX:firstValid(_captionLocal.captionScrollbarHorizontalOffset, STATE.overrides.captionScrollbarHorizontalOffset),
				offsetY:firstValid(_captionLocal.captionScrollbarVerticalOffset, STATE.overrides.captionScrollbarVerticalOffset)
			});
		}

		Align(caption.container, self.updateSpeed, alignVars);
	};

	function checkCaptionOnScrollStop(e) {
		var mediaToRender = removeLinksFromMedia(csvToArray(e.section.mediaItems));
		var mediaItem = imports.mediaItem;
		var anchorTo = firstValid(mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		var captionDefault = firstValid(mediaItem.overrides.captionDefault, STATE.overrides.captionDefault);
		if((captionDefault || e.mode.indexOf('caption') > -1) && USER_AGENT !== MOBILE && mediaItem.caption && anchorTo !== 'site') {
			updateCaptionStyle();
			caption.show();
		} else {
			caption.text = '';
			caption.hide();
			if(caption.scroll) caption.scroll.destroy();
		}
	}

	function updateCaptionText(e) {
		if(/media/.test(_captionLocal.captionAnchorTo) || /media/.test(STATE.overrides.captionAnchorTo)) {
			caption.text = plainTextToHtml(e);
		} else {
			caption.hide();
			if(caption.scroll) caption.scroll.destroy();
		}
	}

	function showCaption() {
		var anchorTo = firstValid(imports.mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		if(!caption.text) caption.text = plainTextToHtml(imports.mediaItem.caption);
		// bug #756
		// if(anchorTo !== 'site')	caption.show();
		if(anchorTo === 'media area' || (anchorTo === 'media item' && loaded)) {
			caption.show();
		}
	}
	
	function hideCaption() {
		caption.hide();
		if(caption.scroll) caption.scroll.destroy();
	}

	self.load = function load() {
		self.loaded = true;
		image.src = REWRITE_BASE + MEDIA_ORIGINAL + imports.mediaItem.content;
		image.addEventListener(LOAD, imageLoaded);
		if(imports.mediaItem.caption !== '') {
			caption = new Caption();
			self.addChild(caption.container);
			_captionLocal = imports.mediaItem.overrides || {};
			_localEvents.addEventListener('showCaption', showCaption);
			_localEvents.addEventListener('hideCaption', hideCaption);
			_localEvents.addEventListener('checkCaption', checkCaptionOnScrollStop);
			updateCaptionText(imports.mediaItem.caption);
			// bug #756
			// if(STATE.uri.mode.indexOf('caption') > -1) caption.show();
			setTimeout(updateCaptionStyle, self.updateSpeed * 1000);
		}
	};

	self.unload = function unload() {

	};

	self.hide = function() {
		if(self.alpha === 1) {
			Tween(self, UPDATE_SPEED, {alpha:0, onComplete:function(){
				self.display = 'none';
			}});
		}
	};

	self.show = function() {
		if(self.alpha === 0) {
			self.display = 'block';
			Tween(self, UPDATE_SPEED, {alpha:1});
		}
	};

	function updatePosition(e) {
		layoutCalcs.activeMediaType = self.type;
		maskWidth = STATE.mediaView.maskWidth(self.width);
		maskHeight = STATE.mediaView.maskHeight(self.height);
		Tween(mask, self.updateSpeed, {x:STATE.mediaView.maskX(), y:STATE.mediaView.maskY(), width:maskWidth, height:maskHeight});
		positionLoader();
		if(loaded) resizeImage();
		if(caption) updateCaptionStyle();
	}

	function imageLoaded(e) {
		self.updateSpeed = 0;
		loaded = true;
		if(originalImageWidth !== this.width) originalImageWidth = this.width;
		if(originalImageHeight !== this.height) originalImageHeight = this.height;
		loader.removeLoader();
		mask.removeChild(loader);
		updatePosition();
		var anchorTo = firstValid(imports.mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		// bug #756
		// added !isLandingMedia bug #787
		if(loaded && (anchorTo === 'media area' || anchorTo === 'media item')) {
				if(caption && STATE.uri.mode.indexOf('caption') > -1 && !layoutCalcs.isLandingMedia) {
					caption.show();
				}
		}
		self.dispatchEvent(MEDIA_LOADED, {type:'image', id:imports.mediaItem.id, width:this.width, height:this.height});
		self.events.dispatchEvent(MEDIA_LOADED, {type:'image', id:imports.mediaItem.id, width:this.width, height:this.height});
		self.updateSpeed = UPDATE_SPEED;
	}

	function resizeImage() {
		var resize = Resize(image, self.updateSpeed, {
			type:STATE.mediaView.imageScaleType(),
			width:originalImageWidth,
			height:originalImageHeight,
			hRange:maskWidth,
			vRange:maskHeight,
			hAlign:STATE.mediaView.hAlign(),
			vAlign:STATE.mediaView.vAlign(),
			onComplete:function(){
				setTimeout(function(){
					Tween(image, STATE.mediaView.transitionDuration(), {alpha:1, ease:'cubic-bezier(0.7, 0, 0.3, 1)'});
				}, 0);
			}
		});
		imageWidth = resize.scale.width;
		imageHeight = resize.scale.height;
		imageX = resize.align.x;
		imageY = resize.align.y;
		if(caption) updateCaptionStyle();
	}

	function positionLoader() {
		if(loader) {
			loader.x = (maskWidth - loader.width) * 0.5;
			loader.y = (maskHeight - loader.height) * 0.5;
		}
	}

	function destroy(e) {
		_localEvents.removeEventListener('destroy', destroy);
		_localEvents.removeEventListener(RESIZE, updatePosition);
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
		_localEvents.removeEventListener('showCursor', showCursor);
		_localEvents.removeEventListener('hideCursor', hideCursor);
		image.removeEventListener(LOAD, imageLoaded);
		self.removeEventListener(CHILD_ADDED, childAdded);
	}

	return self;
}

function PageView(imports) {

	var self = new Sprite({events:imports.events}),
		text = new Sprite(),
		image,
		mask = new Sprite(),
		loader,
		originalImageWidth = imports.size.featuredImage.width || 0,
		originalImageHeight = imports.size.featuredImage.height || 0,
		imageGap = 30,
		maskWidth = 0,
		maskHeight = 0,
		loaded = false,
		isVerticalPage = isVerticalPageBuild(),
		_thumbState,
		_localEvents = imports.localEvents,
		pageImgs,
		responsiveWidthElements,
		responsiveElements;

	self.alpha = 0;
	text.alpha = 0;
	self.updateSpeed = 0;
	self.setClass('dx_page_text');
	self.id = imports.mediaItem.id;
	self.type = imports.mediaItem.type;
	self.dims = imports.size.content;
	self.element.navigationCursor = true;
	mask.overflow = 'hidden';
	text.selectable = true;

	_localEvents.addEventListener(RESIZE, updatePosition);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	_localEvents.addEventListener('destroy', destroy);
	_localEvents.addEventListener('showCursor', showCursor);
	_localEvents.addEventListener('hideCursor', hideCursor);
	self.addEventListener(CHILD_ADDED, childAdded);

	function showCursor(e) {
		self.element.navigationCursor = true;
		if(image) image.element.navigationCursor = true;
		mask.element.navigationCursor = true;
	}

	function hideCursor(e) {
		self.element.navigationCursor = false;
		if(image) image.element.navigationCursor = false;
		mask.element.navigationCursor = false;
	}

	function layoutModelChange(e) {
		if(/imageRendering|pageTitleKerning|pageTextKerning|pageHorizontalMargin|pageMarginTop|pageMarginRight|pageMarginBottom|pageMarginLeft|pageVerticalMargin|pageScrollbarAlignment|pageScrollbarColor|pageScrollbarHorizontalOffset|pageScrollbarHover|pageScrollbarVerticalOffset|pageScrollbarBgAlpha|pageScrollbarWidth|pageScrollVerticalMargin|pageTextFont|pageTextFontColor|pageTextFontSize|pageTitle|pageTitleFont|pageTitleFontColor|pageTitleFontSize/.test(e.id)) {
			updateStyle();
			updatePosition();
		}
	}

	function init() {
		var retinaSize = RetinaResizeEngine({width:originalImageWidth, height:originalImageHeight, filename:imports.mediaItem.featuredImage});
		originalImageWidth = retinaSize.width;
		originalImageHeight = retinaSize.height;
		if(hasFeaturedImage() && !isVerticalPageBuild()) {
			image = new Bitmap();
			image.src = REWRITE_BASE + MEDIA_ORIGINAL + imports.mediaItem.featuredImage;
			image.element.navigationCursor = true;
			mask.element.navigationCursor = true;
			image.addEventListener(LOAD, imageLoaded);
			image.alpha = 0;
			self.addChild(image);
		} else {
			self.events.dispatchEvent(MEDIA_LOADED, {});
			setTimeout(function(){
				self.updateSpeed = STATE.mediaView.transitionDuration();
			}, 0);
		}

		text.text = "";

		if(isValidPageTitle()) {
			var titleFontSize = percentToPixels(LAYOUT_MODEL.pageTitleFontSize, 22);
			text.text += "<h2 style='font-weight:normal; font-family:"+LAYOUT_MODEL.pageTitleFont+"; color:"+LAYOUT_MODEL.pageTitleFontColor+"; font-size:"+titleFontSize+"px; letter-spacing:"+LAYOUT_MODEL.pageTitleKerning+"px;'><b></b>" + imports.mediaItem.label + "</b></h2><br/>";
		}

		if(isVerticalPageBuild() && hasFeaturedImage()) {
			text.text += "<img style='max-width:100%;' src='" + REWRITE_BASE + MEDIA_ORIGINAL + imports.mediaItem.featuredImage + "'/><br/><br/>";
			isVerticalPage = true;
		} else {
			isVerticalPage = false;
		}

		text.text += plainTextToHtml(imports.mediaItem.content);
		self.addChild(mask);
		mask.addChild(text);

		/*this is to prevent page images from being cropped when browser is small*/
		pageImgs = text.element.getElementsByTagName('img');
		var i = pageImgs.length;
		if(i > 0) {
			while(i--) {
				var img = pageImgs[i];
				img.addEventListener(LOAD, function(e) {
					if(this.offsetLeft === 0 && this.offsetWidth > maskWidth) {
						this.width = maskWidth;
					}
				});
			}
		}

		responsiveElements = text.element.getElementsByClassName('responsive');
		responsiveWidthElements = text.element.getElementsByClassName('responsive-width');
	}

	function childAdded(child) {
		init();
		updateStyle();
		updatePosition();
	}

	function updateScroll() {

		if(self.scroll) {
			self.scroll.destroy();
		}

		var scrollBarWidth = LAYOUT_MODEL.pageScrollbarWidth;
		var scrollBarOffsetXDevice = USER_AGENT === MOBILE ? -(scrollBarWidth + 5) : LAYOUT_MODEL.pageScrollbarHorizontalOffset;
		var scrollBarOffsetX = LAYOUT_MODEL.pageScrollbarAlignment === 'right' ? -scrollBarOffsetXDevice - scrollBarWidth : scrollBarOffsetXDevice + scrollBarWidth;

		self.scroll = new Scroll(text, mask, {
			types:['bar','wheel','touch'],
			axis:'y',
			align:'top',
			margin:LAYOUT_MODEL.pageScrollVerticalMargin,
			color:LAYOUT_MODEL.pageScrollbarColor,
			hover:LAYOUT_MODEL.pageScrollbarHover,
			side:LAYOUT_MODEL.pageScrollbarAlignment,
			alpha:LAYOUT_MODEL.pageScrollbarBgAlpha,
			width:scrollBarWidth,
			offsetX:scrollBarOffsetX,
			offsetY:LAYOUT_MODEL.pageScrollbarVerticalOffset,
			scrollTopCheck:true
		});

		self.scroll.addEventListener('WINDOW_SCROLL_TOP', function(){
			self.scroll.percent = 0;
			self.scroll.update(UPDATE_SPEED);
		});

		setTimeout(function() {
			self.scroll.resize();
			/*make sure scroll is resized before showing text*/
			Tween(text, UPDATE_SPEED, {alpha:1});
		}, 0);
	}

	function isValidPageTitle() {
		return LAYOUT_MODEL.pageTitle && imports.mediaItem.label !== '';
	}

	function hasFeaturedImage() {
		return imports.mediaItem.featuredImage !== '';
	}

	function updateStyle(e) {
		if(image && LAYOUT_MODEL.imageRendering.optimizeQuality) image.style['image-rendering'] = 'optimizeQuality';
		if(image && LAYOUT_MODEL.imageRendering.webkitOptimizeContrast) image.style['image-rendering'] = '-webkit-optimize-contrast';
		if(image && BROWSER_NAME === 'Safari' && LAYOUT_MODEL.imageRendering.webkitBackfaceVisibility) image.style['-webkit-backface-visibility'] = 'hidden';
		text.fontFamily = LAYOUT_MODEL.pageTextFont;
		text.fontColor = LAYOUT_MODEL.pageTextFontColor;
		text.fontSize = LAYOUT_MODEL.pageTextFontSize;
		text.letterSpacing = LAYOUT_MODEL.pageTextKerning;
		Tween(self, self.updateSpeed, {backgroundColor:STATE.mediaView.backgroundColor()});
	};

	self.load = function load() {
		self.loaded = true;
		updatePosition();
	};

	self.unload = function unload() {

	};

	self.show = function() {
		self.display = 'block';
		Tween(self, UPDATE_SPEED, {alpha:1});
	};

	self.hide = function() {
		Tween(self, UPDATE_SPEED, {alpha:0,onComplete:function() {
			self.display = 'none';
		}});
	};

	function updatePosition(e) {

		layoutCalcs.activeMediaType = self.type;

		var maskX = STATE.mediaView.maskX(),
			maskY = STATE.mediaView.maskY();

		maskWidth = STATE.mediaView.maskWidth(self.element.offsetWidth);
		maskHeight = STATE.mediaView.maskHeight(self.element.offsetHeight);

		if(image && hasFeaturedImage() && !isVerticalPageBuild()) {
			maskX += originalImageWidth + imageGap;
			maskWidth -= (originalImageWidth + imageGap);
			Tween(image, self.updateSpeed, {x:maskX - originalImageWidth - imageGap, y:maskY});
		}

		if(!isVerticalPage && isVerticalPageBuild()) {
			if(image) {
				self.removeChild(image);
				image = undefined;
			}
			init();
		} else if(isVerticalPage && !isVerticalPageBuild()) {
			text.text = '';
			init();
		}

		Tween(mask, 0, {x:maskX, y:maskY, width:maskWidth, height:maskHeight});

		updateResponsiveElements();

		if(responsiveElements.length > 0) {
			if(isPod() || isPad()) {
				mask.style.overflow = 'auto';
				mask.style['-webkit-overflow-scrolling'] = 'touch';
			}
			Tween(text, UPDATE_SPEED, {alpha:1});
		} else {
			updateScroll();
		}
	};

	function updateResponsiveElements() {
		var el = responsiveElements[0];
		if(el) {
			el.style.overflow = 'hidden';
			el.style.width = (maskWidth - el.offsetLeft) + 'px';
			el.style.height = (maskHeight - el.offsetTop) + 'px';
			el.style.border = 'none';
		}
		var el2 = responsiveWidthElements[0];
		if(el2) {
			el2.style.overflow = 'hidden';
			el2.style.width = (maskWidth - el2.offsetLeft) + 'px';
			el2.style.border = 'none';
		}
	}

	function imageLoaded(e) {
		self.updateSpeed = 0;
		loaded = true;
		var retinaSize = RetinaResizeEngine({width:image.width, height:image.height, filename:image.src});
		originalImageWidth = retinaSize.width;
		originalImageHeight = retinaSize.height;
		image.width = originalImageWidth;
		image.height = originalImageHeight;
		Tween(image, 1, {alpha:1});
		self.updateSpeed = STATE.mediaView.transitionDuration();
		updatePosition();
		self.events.dispatchEvent(MEDIA_LOADED, {type:'featuredImage', id:imports.mediaItem.id, width:image.width, height:image.height});
	}

	function positionLoader() {
		if(loader) {
			Tween(loader, self.updateSpeed, {x:(maskWidth - loader.width) * 0.5, y:(maskHeight - loader.height) * 0.5});
		}
	}

	function destroy(e) {
		_localEvents.removeEventListener(RESIZE, updatePosition);
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
		_localEvents.removeEventListener('destroy', destroy);
		_localEvents.removeEventListener('showCursor', showCursor);
		_localEvents.removeEventListener('hideCursor', hideCursor);
		if(image) image.removeEventListener(LOAD, imageLoaded);
		self.removeEventListener(CHILD_ADDED, childAdded);
	}

	function isVerticalPageBuild() {
		if(USER_AGENT === MOBILE) return true;
		if(STATE.mediaView.width() < STATE.mediaView.height()) return true;
		if(originalImageWidth && STATE.mediaView.maskWidth(self.width) < STATE.mediaView.maskX() + originalImageWidth + imageGap + 250) return true;
		return false;
	}

	return self;
}


function VideoView(imports) {

	var self = new Sprite({events:imports.localEvents});
	self.alpha = 0;
	self.updateSpeed = 0;
	self.overflow = 'hidden';
	self.id = imports.mediaItem.id;
	self.type = imports.mediaItem.type;
	self.dims = imports.size.content;

	if(!imports.mediaItem.thumb.length) {
		MEDIA_MODEL[self.id].size.thumb.width = 1200;
		MEDIA_MODEL[self.id].size.thumb.height = 800;
	}

	var image = new Bitmap(),
		mask = new Sprite(),
		caption,
		video,
		bigPlayIcon = new Bitmap(),
		loader,
		originalImageWidth = imports.size.thumb.width,
		originalImageHeight = imports.size.thumb.height,
		imageWidth = 0,
		imageHeight = 0,
		imageX = 0,
		imageY = 0,
		maskWidth = 0,
		maskHeight = 0,
		originalVideoWidth = imports.size.content.width,
		originalVideoHeight = imports.size.content.height,
		videoWidth = 0,
		videoHeight = 0,
		videoLoaded = false,
		posterLoaded = false,
		_captionLocal,
		_localEvents = imports.localEvents,
		vimeoCursorMask,
		vimeoCursorMask2;

	image.alpha = 0;
	image.zIndex = 1;
	mask.overflow = 'hidden';

	bigPlayIcon.width = 70;
	bigPlayIcon.height = 70;
	bigPlayIcon.alpha = 0;
	bigPlayIcon.zIndex = 4;

	self.addEventListener(CHILD_ADDED, childAdded);
	self.events.addEventListener(PAUSE_MEDIA, pauseMedia);
	self.events.addEventListener(DESTROY_MEDIA, destroyMedia);
	self.events.addEventListener(ADMIN_MOUSE_DOWN, vimeoPointerEventsOff);
	self.events.addEventListener(ADMIN_MOUSE_UP, vimeoPointerEventsOn);
	_localEvents.addEventListener(RESIZE, updatePosition);
	_localEvents.addEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
	_localEvents.addEventListener('mediaSizeUpdate', updatePosition);
	_localEvents.addEventListener(MEDIA_MODEL_CHANGE, updateMedia);
	_localEvents.addEventListener('mediaAutoPlay', mediaAutoPlay);
	_localEvents.addEventListener('destroy', destroy);
	_localEvents.addEventListener('showCursor', showCursor);
	_localEvents.addEventListener('hideCursor', hideCursor);

	function showCursor(e) {
		image.element.navigationCursor = true;
		mask.element.navigationCursor = true;
		if(video) video.element.navigationCursor = image.element.navigationCursor;
	}

	function hideCursor(e) {
		image.element.navigationCursor = false;
		mask.element.navigationCursor = false;
		if(video) video.element.navigationCursor = image.element.navigationCursor;
	}

	function childAdded(child) {
		loader = new LoadingIndicator({color:imports.loaderColor});
		loader.zIndex = 2;
		image.element.navigationCursor = true;
		mask.element.navigationCursor = true;
		image.element.addEventListener('contextmenu', disable);
		image.element.addEventListener('dragstart', disable);
		if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
			bigPlayIcon.addEventListener(TOUCH_END, bigPlayClick);
		} else {
			bigPlayIcon.addEventListener(CLICK, bigPlayClick);
		}
		self.addChild(mask);
		mask.addChild(image);
		mask.addChild(loader);
		mask.addChild(bigPlayIcon);
	}

	function disable(e) {
		e.preventDefault();
	}

	self.load = function load() {
		self.loaded = true;
		if(!STATE.videoAutoPlay || USER_AGENT === TABLET || USER_AGENT === MOBILE) {
			image.addEventListener(LOAD, imageLoaded);
			image.src = imports.mediaItem.thumb.length > 0 ? REWRITE_BASE + MEDIA_ORIGINAL + imports.mediaItem.thumb : REWRITE_BASE + ICONS + "videoLarge.png";
		}
		if(imports.mediaItem.caption) {
			caption = new Caption();
			self.addChild(caption.container);
			caption.container.zIndex = 3;
			_captionLocal = imports.mediaItem.overrides || {};
			_localEvents.addEventListener('showCaption', showCaption);
			_localEvents.addEventListener('hideCaption', hideCaption);
			_localEvents.addEventListener('checkCaption', checkCaptionOnScrollStop);
			updateCaptionText(imports.mediaItem.caption);
			// bug #756
			// if(STATE.uri.mode.indexOf('caption') > -1) caption.show();
			setTimeout(updateCaptionStyle, self.updateSpeed * 1000);
		}
	};

	self.unload = function unload() {

	};

	self.play = function() {
		if(video && video.src) {
			video.play();
		} else if(video && !video.src) {
			video.setSource(imports.mediaItem.content);
			if(isPod() || isPad()) video.play();
		} else {
			createVideoPlayer();
			video.setSource(imports.mediaItem.content);
		}
		if(isPod() || isPad()) {
			/*resolves issue with mobile safari when playing vimeo videos*/
			loader.removeLoader();
			loader.zIndex = 0;
		}
		if(!(isPod() && isVimeo())) {
			Tween(bigPlayIcon, UPDATE_SPEED, {alpha:0, onComplete:function(){
				bigPlayIcon.display = 'none';
			}});
		}
	};

	self.pause = function() {
		if(video) video.pause();
	};

	self.destroy = function() {
		destroyMedia();
	};

	self.autoPlay = function(e) {
		if(!isPod() && !isPad()) {
			self.play();
		}
	};

	function mediaAutoPlay(e) {
		if(!isPod() && !isPad()) {
			if(e === self.id) {
				self.play();
			} else if(video && video.src) {
				video.pause();
			}
		}
	}

	function vimeoPointerEventsOff() {
		if(isVimeo()) {
			video.pointerEvents = 'none';
		}
	}

	function vimeoPointerEventsOn() {
		if(isVimeo()) {
			video.pointerEvents = 'auto';
		}
	}

	function bigPlayIconLoaded(e) {
		bigPlayIcon.transition = 0;
		bigPlayIcon.width = 70;
		bigPlayIcon.height = 70;
		alignBigPlay();
		setTimeout(function(){
			Tween(bigPlayIcon, UPDATE_SPEED, {alpha:1});
		}, 0);
	}

	function alignBigPlay() {
		bigPlayIcon.transition = 0;
		bigPlayIcon.x = image.x + ((image.width - 70) * 0.5);
		bigPlayIcon.y = image.y + ((image.height - 70) * 0.5);
	}

	function pauseMedia(e) {
		if(videoLoaded) {
			self.events.removeEventListener(TRANSITION_END, createVideoPlayer);
			video.pause();
			if(isVimeo()) {
				bigPlayIcon.display = 'block';
			}
			video.removeKeyListener();
		}
	}

	function destroyMedia(e) {
		if(video) {
			pauseMedia(e);
			self.events.removeEventListener(PAUSE_MEDIA, pauseMedia);
			mask.removeChild(video);
			video.destroy();
			self.events.removeEventListener(DESTROY_MEDIA, destroyMedia);
		}
	}

	function isVimeo() {
		return imports.mediaItem.content.indexOf("vimeo:") > -1;
	}

	function buildMask() {
		var mask = new Sprite();
		mask.element.navigationCursor = image.element.navigationCursor;
		// mask.backgroundColor = 'rgba(255,0,0,0.3)';
		return mask;
	}

	function buildVimeoCursorMask() {
		return {
			top:buildMask(),
			right:buildMask(),
			bottom:buildMask(),
			left:buildMask()
		}
	}

	function createVideoPlayer() {
		if(isVimeo() && !video) {
			video = new VimeoPlayer({events:imports.events});
			video.element.navigationCursor = image.element.navigationCursor;
			self.video = video;
			video.addEventListener(VIMEO_METADATA_LOADED, onVimeoMetadataLoaded);
			mask.addChild(video);

			vimeoCursorMask = buildVimeoCursorMask();
			mask.addChild(vimeoCursorMask.top);
			mask.addChild(vimeoCursorMask.right);
			mask.addChild(vimeoCursorMask.bottom);
			mask.addChild(vimeoCursorMask.left);

			video.alpha = 0.01;
		} else if(!video) {
			video = new VideoPlayer({events:imports.events});
			video.element.navigationCursor = image.element.navigationCursor;
			self.video = video;
			video.element.addEventListener(METADATA_LOADED, metadataLoaded, false);
			video.element.addEventListener(ERROR, loadError, false);
			mask.addChild(video);
			video.display = 'none';
			video.alpha = 0;
		}

		video.addEventListener(PAUSED, paused);
		video.addEventListener(PLAY, playEvent);
		video.addEventListener('playbackEnd', playbackEnd);
	}

	function paused(e) {
		if(isPod()) {
			video.display = 'none';
		}
		resizeVideo({isPlaying:false});
	}

	function playEvent(e) {
		if(isPod()) {
			video.display = 'block';
			video.alpha = 1;
		}
		resizeVideo({isPlaying:true});
		self.events.dispatchEvent(PLAY);
	}

	function playbackEnd() {
		if(isVimeo()) {
			bigPlayIcon.display = 'block';
			resizeVideo({isPlaying:false});
		}
		self.events.dispatchEvent('playbackEnd');
	}

	function bigPlayClick(e) {
		Tween(loader, UPDATE_SPEED, {alpha:1});
		createVideoPlayer();
		self.play();
		if(isPod() || isPad()) {
			video.element.addEventListener('webkitendfullscreen', playbackEnd);
		}
	}

	function metadataLoaded(e) {

		video.element.addEventListener(METADATA_LOADED, metadataLoaded, false);
		video.element.removeEventListener(ERROR, loadError, false);

		if(!layoutCalcs.isLandingMedia) {
			self.hud = new VideoHud(video);
		}
		initializePlay(this);
		video.display = 'block';

		originalVideoWidth = this.videoWidth,
		originalVideoHeight = this.videoHeight,

		MEDIA_MODEL[self.id].size.content.width = this.videoWidth;
		MEDIA_MODEL[self.id].size.content.height = this.videoHeight;

		self.events.dispatchEvent(MEDIA_LOADED, {type:'video', id:imports.mediaItem.id, width:this.videoWidth, height:this.videoHeight});
	}

	function onVimeoMetadataLoaded(e) {

		video.removeEventListener(VIMEO_METADATA_LOADED, onVimeoMetadataLoaded);

		originalVideoWidth = this.videoWidth,
		originalVideoHeight = this.videoHeight,

		MEDIA_MODEL[self.id].size.content.width = this.videoWidth;
		MEDIA_MODEL[self.id].size.content.height = this.videoHeight;

		initializePlay(this);
		setTimeout(function(){
			updatePosition();
			self.events.dispatchEvent(MEDIA_LOADED, {type:'vimeo', id:imports.mediaItem.id, width:originalVideoWidth, height:originalVideoHeight});
		}, 500);
	}

	function loadError(e) {
		loader.removeLoader();
		mask.removeChild(loader);
	}

	function initializePlay(reference) {
		videoLoaded = true;
		self.videoLoaded = true;
		self.updateSpeed = 0;
		if(originalVideoWidth !== reference.videoWidth) originalVideoWidth = reference.videoWidth;
		if(originalVideoHeight !== reference.videoHeight) originalVideoHeight = reference.videoHeight;
		updatePosition();
		updateStyle();
		loader.removeLoader();
		mask.removeChild(loader);
		Tween(image, UPDATE_SPEED, {alpha:0,onComplete:function(){
			image.display = 'none';
		}});
		if(!isPod() && !isPad()) self.play();
		video.addEventListener(CLICK, video.togglePlay);
	}

	function updateStyle(e) {
		Tween(self, self.updateSpeed, {backgroundColor:STATE.mediaView.backgroundColor()});
		if(caption) setTimeout(updateCaptionStyle, self.updateSpeed * 1000);
	}

	function updateCaptionStyle(e) {
		caption.container.transition = 0;

		var alignVars = {
			onInit:function() {
				if(caption.scroll) {
					caption.scroll.hide();
				}
			},
			onComplete:function() {
				if(caption.scroll) {
					caption.scroll.show();
					caption.scroll.resize();
				}
			}
		};

		var bgColor = _captionLocal.captionBackgroundRectColor || STATE.overrides.captionBackgroundRectColor; 
		var bgAlpha = firstValid(_captionLocal.captionBackgroundAlpha, STATE.overrides.captionBackgroundAlpha); 
		caption.backgroundColor = toRgba(bgColor, bgAlpha);		
		caption.fontFamily = _captionLocal.captionFont || STATE.overrides.captionFont;
		caption.fontSize = firstValid(_captionLocal.captionFontSize, STATE.overrides.captionFontSize);
		caption.fontColor = _captionLocal.captionFontColor || STATE.overrides.captionFontColor;

		if(LAYOUT_MODEL.captionAutoPosition !== false) {
			var padding = 10;
			layoutCalcs.captionView.size(caption.text);
			caption.width = layoutCalcs.captionView.width + (padding * 2);
			caption.height = layoutCalcs.captionView.height + (padding * 2);
			alignVars.width = layoutCalcs.captionView.width + (padding * 2);
			alignVars.height = layoutCalcs.captionView.height + (padding * 2);
			alignVars.hRange = self.width;
			alignVars.vRange = self.height;
			alignVars.hAlign = 'center';
			alignVars.vAlign = 'bottom';
			alignVars.hOffset = 0;
			alignVars.vOffset = 33;
			caption.textAlign = 'center';
			caption.paddingTop = padding;
			caption.paddingRight = 0;
			caption.paddingBottom = padding;
			caption.paddingLeft = 0;
			caption.buildScroll({
				color:STATE.overrides.captionScrollbarColor,
				hover:STATE.overrides.captionScrollbarHover,
				align:STATE.overrides.captionTextAlignVertical,
				side:STATE.overrides.captionScrollbarAlignment,
				alpha:STATE.overrides.captionScrollbarBgAlpha,
				width:STATE.overrides.captionScrollbarWidth,
				offsetX:STATE.overrides.captionScrollbarHorizontalOffset,
				offsetY:STATE.overrides.captionScrollbarVerticalOffset
			});
		} else {
			caption.width = firstValid(_captionLocal.captionWidth, STATE.overrides.captionWidth);
			caption.height = firstValid(_captionLocal.captionHeight, STATE.overrides.captionHeight);
			alignVars.width = firstValid(_captionLocal.captionWidth, STATE.overrides.captionWidth);
			alignVars.height = firstValid(_captionLocal.captionHeight, STATE.overrides.captionHeight);
			if(_captionLocal.captionAnchorTo === 'media item' || STATE.overrides.captionAnchorTo === 'media item') {
				alignVars.hOrigin = STATE.mediaView.maskX() + imageX;
				alignVars.vOrigin = STATE.mediaView.maskY() + imageY;
				alignVars.hRange = imageWidth;
				alignVars.vRange = imageHeight;
			} else if(_captionLocal.captionAnchorTo === 'media area' || STATE.overrides.captionAnchorTo === 'media area') {
				alignVars.hOrigin = 0;
				alignVars.vOrigin = 0;
				alignVars.hRange = layoutCalcs.mediaView.width();
				alignVars.vRange = layoutCalcs.mediaView.height();
			}
			alignVars.hAlign = _captionLocal.captionAlignHorizontal || STATE.overrides.captionAlignHorizontal;
			alignVars.vAlign = _captionLocal.captionAlignVertical || STATE.overrides.captionAlignVertical;
			alignVars.hOffset = firstValid(_captionLocal.captionOffsetX, STATE.overrides.captionOffsetX);
			alignVars.vOffset = firstValid(_captionLocal.captionOffsetY, STATE.overrides.captionOffsetY);
			caption.textAlign = _captionLocal.captionTextAlign || STATE.overrides.captionTextAlign;
			caption.paddingTop = firstValid(_captionLocal.captionPaddingTop, STATE.overrides.captionPaddingTop);
			caption.paddingRight = firstValid(_captionLocal.captionPaddingRight, STATE.overrides.captionPaddingRight);
			caption.paddingBottom = firstValid(_captionLocal.captionPaddingBottom, STATE.overrides.captionPaddingBottom);
			caption.paddingLeft = firstValid(_captionLocal.captionPaddingLeft, STATE.overrides.captionPaddingLeft);
			caption.buildScroll({
				color:_captionLocal.captionScrollbarColor || STATE.overrides.captionScrollbarColor,
				hover:_captionLocal.captionScrollbarHover || STATE.overrides.captionScrollbarHover,
				align:_captionLocal.captionTextAlignVertical || STATE.overrides.captionTextAlignVertical,
				side:_captionLocal.captionScrollbarAlignment || STATE.overrides.captionScrollbarAlignment,
				alpha:firstValid(_captionLocal.captionScrollbarBgAlpha, STATE.overrides.captionScrollbarBgAlpha),
				width:firstValid(_captionLocal.captionScrollbarWidth, STATE.overrides.captionScrollbarWidth),
				offsetX:firstValid(_captionLocal.captionScrollbarHorizontalOffset, STATE.overrides.captionScrollbarHorizontalOffset),
				offsetY:firstValid(_captionLocal.captionScrollbarVerticalOffset, STATE.overrides.captionScrollbarVerticalOffset)
			});
		}

		Align(caption.container, self.updateSpeed, alignVars);
	};

	function checkCaptionOnScrollStop(e) {
		var mediaToRender = removeLinksFromMedia(csvToArray(e.section.mediaItems));
		var mediaItem = imports.mediaItem;
		var anchorTo = firstValid(mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		var captionDefault = firstValid(mediaItem.overrides.captionDefault, STATE.overrides.captionDefault);
		if((captionDefault || e.mode.indexOf('caption') > -1) && USER_AGENT !== MOBILE && mediaItem.caption && anchorTo !== 'site') {
			updateCaptionStyle();
			caption.show();
		} else {
			caption.text = '';
			caption.hide();
			if(caption.scroll) caption.scroll.destroy();
		}
	}

	function updateCaptionText(e) {
		if(/media/.test(_captionLocal.captionAnchorTo) || /media/.test(STATE.overrides.captionAnchorTo)) {
			caption.text = plainTextToHtml(e);
		} else {
			caption.hide();
			if(caption.scroll) caption.scroll.destroy();
		}
	}

	function showCaption() {
		var anchorTo = firstValid(imports.mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		if(!caption.text) caption.text = plainTextToHtml(imports.mediaItem.caption);
		// bug #756
		// if(anchorTo !== 'site')	caption.show();
		if(anchorTo === 'media area' || (anchorTo === 'media item' && posterLoaded)) caption.show();
	}
	
	function hideCaption() {
		caption.hide();
		if(caption.scroll) caption.scroll.destroy();
	}

	self.hide = function() {
		if(self.alpha === 1) {
			Tween(self, UPDATE_SPEED, {alpha:0,onComplete:function(){
				self.display = 'none';
			}});
		}
	};

	self.show = function() {
		if(self.alpha === 0) {
			self.display = 'block';
			Tween(self, UPDATE_SPEED, {alpha:1});
		}
	};

	function updatePosition(e) {
		if(image && LAYOUT_MODEL.imageRendering.optimizeQuality) image.style['image-rendering'] = 'optimizeQuality';
		if(image && LAYOUT_MODEL.imageRendering.webkitOptimizeContrast) image.style['image-rendering'] = '-webkit-optimize-contrast';
		if(image && BROWSER_NAME === 'Safari' && LAYOUT_MODEL.imageRendering.webkitBackfaceVisibility) image.style['-webkit-backface-visibility'] = 'hidden';
		layoutCalcs.activeMediaType = self.type;
		maskWidth = STATE.mediaView.maskWidth(self.width);
		maskHeight = STATE.mediaView.maskHeight(self.height);
		alignBigPlay();
		Tween(mask, self.updateSpeed, {x:STATE.mediaView.maskX(), y:STATE.mediaView.maskY(), width:maskWidth, height:maskHeight, onComplete:function(){
			alignBigPlay();
		}});
		positionLoader();
		if(isVimeo() && isPod()) {
			/*dont do nuthin*/
		} else if(!posterLoaded) {
			Tween(loader, UPDATE_SPEED, {alpha:1});
		}
		if(posterLoaded && !videoLoaded) {
			resizeImage();
		}
		if(videoLoaded) {
			resizeVideo({isPlaying:true});
		}
	};

	function imageLoaded(e) {
		self.updateSpeed = 0;
		posterLoaded = true;
		updatePosition();
		resizeImage();
		Tween(loader, UPDATE_SPEED, {alpha:0});
		self.events.dispatchEvent(MEDIA_LOADED, {type:'posterImage', id:imports.mediaItem.id, width:originalImageWidth, height:originalImageHeight});
		self.updateSpeed = UPDATE_SPEED;
		bigPlayIcon.addEventListener(LOAD, bigPlayIconLoaded);
		bigPlayIcon.src = REWRITE_BASE + ICONS + 'play@2x.png';
		var anchorTo = firstValid(imports.mediaItem.overrides.captionAnchorTo, STATE.overrides.captionAnchorTo);
		// bug #756
		// added !isLandingMedia bug #787
		if(posterLoaded && (anchorTo === 'media area' || anchorTo === 'media item')) {
				if(caption && STATE.uri.mode.indexOf('caption') > -1 && !layoutCalcs.isLandingMedia) {
					caption.show();
				}
		}
	}

	function resizeImage() {
		maskWidth = STATE.mediaView.maskWidth(self.width);
		maskHeight = STATE.mediaView.maskHeight(self.height);

		var resize = Resize(image, self.updateSpeed, {
			type:STATE.mediaView.imageScaleType(),
			width:originalImageWidth,
			height:originalImageHeight,
			hRange:maskWidth,
			vRange:maskHeight,
			hAlign:STATE.mediaView.hAlign(),
			vAlign:STATE.mediaView.vAlign(),
			onComplete:function(){
				setTimeout(function(){
					if(layoutCalcs.isLandingMedia && !isPod() && !isPad()) {
						/*dont show image*/
					} else {
						Tween(image, STATE.mediaView.transitionDuration(), {alpha:1, ease:'cubic-bezier(0.7, 0, 0.3, 1)'});
					}
				}, 1000);
			}
		});
		imageWidth = resize.scale.width;
		imageHeight = resize.scale.height;
		imageX = resize.align.x;
		imageY = resize.align.y;
		if(caption) updateCaptionStyle();
	}

	function resizeVideo(state) {

		video.display = 'block';
		setTimeout(function() {
			video.display = 'block';
		}, 1000);

		maskWidth = STATE.mediaView.maskWidth(self.width);
		maskHeight = STATE.mediaView.maskHeight(self.height);

		if(isVimeo() && STATE.mediaView.videoScaleType() === 'fill') {
			videoWidth = maskWidth;
			videoHeight = maskHeight;
			originalVideoWidth = maskWidth;
			originalVideoHeight = maskHeight;
		}
		
		var resize = Resize(video, self.updateSpeed, {
			type:STATE.mediaView.videoScaleType(),
			width:originalVideoWidth,
			height:originalVideoHeight,
			hRange:maskWidth,
			vRange:maskHeight,
			hAlign:STATE.mediaView.hAlign(),
			vAlign:STATE.mediaView.vAlign(),
			onComplete:function(){
				setTimeout(function(){
					Tween(video, UPDATE_SPEED, {alpha:1, ease:'cubic-bezier(0.7, 0, 0.3, 1)'});
				}, 1000);
			}
		});

		videoWidth = Mth.round(resize.scale.width);
		videoHeight = Mth.round(resize.scale.height);

		video.setSize(videoWidth, videoHeight, self.updateSpeed);

		resizeVimeoMask(state.isPlaying, resize);

		if(self.hud) self.hud.resize(self.updateSpeed, Mth.round(resize.align.x), Mth.round(resize.align.y), videoWidth, videoHeight);
	}

	function vimeoPlayMask() {
		return {
			banner:{ width:0, height:150 },
			hdpopup:{ width:170, height:150 },
			shareCtrls:{ width:50, height:130 },
			videoCtrls:{ width:videoWidth, height:50 }
		}	
	}

	function vimeoEndMask() {
		return {
			banner:{ width:550, height:180 },
			hdpopup:{ width:170, height:150 },
			shareCtrls:{ width:50, height:130 },
			videoCtrls:{ width:videoWidth, height:50 }
		}	
	}	

	function resizeVimeoMask(isPlaying, resize) {
		if(vimeoCursorMask) {
			var vimeoHud = isPlaying ? vimeoPlayMask() : vimeoEndMask();
			var cMaskW = (videoWidth - vimeoHud.banner.width) * 0.5;
			var cMaskH = (videoHeight - vimeoHud.banner.height) * 0.5;
			vimeoCursorMask.top.x = resize.align.x;
			vimeoCursorMask.top.y = resize.align.y;
			vimeoCursorMask.top.width = videoWidth - vimeoHud.shareCtrls.width;
			vimeoCursorMask.top.height = cMaskH;
			vimeoCursorMask.right.x = resize.align.x + videoWidth - cMaskW;
			vimeoCursorMask.right.y = resize.align.y + vimeoHud.shareCtrls.height;
			vimeoCursorMask.right.width = cMaskW;
			vimeoCursorMask.right.height = videoHeight - vimeoHud.shareCtrls.height - vimeoHud.hdpopup.height;
			vimeoCursorMask.bottom.x = resize.align.x;
			vimeoCursorMask.bottom.y = resize.align.y + videoHeight - cMaskH;
			vimeoCursorMask.bottom.width = videoWidth - vimeoHud.hdpopup.width;
			vimeoCursorMask.bottom.height = cMaskH - vimeoHud.videoCtrls.height;
			vimeoCursorMask.left.x = resize.align.x;
			vimeoCursorMask.left.y = resize.align.y;
			vimeoCursorMask.left.width = cMaskW;
			vimeoCursorMask.left.height = videoHeight - vimeoHud.videoCtrls.height;
		}

	}

	function updateMedia(e) {
		if(e.id === imports.mediaItem.id) {
			if(imports.mediaItem.thumb !== e.thumb) {
				trace('posterImage changed!');
			}
			if(imports.mediaItem.content !== e.content) {
				trace('src changed!');
			}
		}
	}

	function positionLoader() {
		if(loader) {
			loader.transition = 0;
			loader.x = ((STATE.mediaView.maskWidth(self.width) - loader.width) * 0.5);
			loader.y = ((STATE.mediaView.maskHeight(self.height) - loader.height) * 0.5);
		}
	}

	function destroy(e) {
		self.events.removeEventListener(PAUSE_MEDIA, pauseMedia);
		self.events.removeEventListener(DESTROY_MEDIA, destroyMedia);
		self.events.removeEventListener(TRANSITION_END, createVideoPlayer);
		self.events.removeEventListener(ADMIN_MOUSE_DOWN, vimeoPointerEventsOff);
		self.events.removeEventListener(ADMIN_MOUSE_UP, vimeoPointerEventsOn);
		_localEvents.removeEventListener(RESIZE, updatePosition);
		_localEvents.removeEventListener(LAYOUT_MODEL_CHANGE, updatePosition);
		_localEvents.removeEventListener('mediaSizeUpdate', updatePosition);
		_localEvents.removeEventListener(MEDIA_MODEL_CHANGE, updateMedia);
		_localEvents.removeEventListener('mediaAutoPlay', mediaAutoPlay);
		_localEvents.removeEventListener('destroy', destroy);
		_localEvents.removeEventListener('showCursor', showCursor);
		_localEvents.removeEventListener('hideCursor', hideCursor);
		image.removeEventListener(LOAD, imageLoaded);
		if(video) {
			video.element.removeEventListener('webkitendfullscreen', playbackEnd);
			if(isVimeo()) {
				video.removeEventListener(VIMEO_METADATA_LOADED, onVimeoMetadataLoaded);
			} else {
				video.element.removeEventListener(METADATA_LOADED, metadataLoaded, false);
			}
			video.destroy();
		}
		self.removeEventListener(CHILD_ADDED, childAdded);
	}

	return self;
}

function OverlayController(vars) {
	var self = new ControllerProxy({parentView:vars.mediaView.mask, parentController:vars.parentController, events:vars.siteEvents});
	var mode,
		sectionChange = false,
		section,
		assetId,
		path,
		settings,
		mediaItems,
		event,
		mouseOverThumbsOnce = false,
		isModeChange = false,
		_localEvents = vars.localEvents,
		thumbsOpen;

	self.overlayView = new OverlayView(vars);
	self.overlayView.zIndex = STATE.overlayView.zIndex;
	vars.siteView.addChild(self.overlayView);

	vars.siteEvents.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	vars.siteEvents.addEventListener(SITE_URI_CHANGE, overlayControllerSiteUriChange);
	vars.siteEvents.addEventListener(SECTIONS_MODEL_CHANGE, sectionUpdate);
	vars.siteEvents.addEventListener(SETTINGS_MODEL_CHANGE, settingsUpdate);
	vars.siteEvents.addEventListener(RESIZE_END, resizeEnd);

	function sectionUpdate(e) {
		if(section) {
			sectionChange = true;
			e.section = e.section ? e.section : section;
			section = e.section ? e.section : section;
			if(e.field === 'thumb' && e.id === section.id) {
				e.mode = mode;
			} else if(e.field === 'media' && e.id === section.id) {
				e.mode = mode;
				section.media = e.value;
			}
			if(e && e.field === 'thumb') {
				sectionChange = true;
				self.overlayView.updatePosition(e);
				checkThumbs({mode:mode, section:section});
				if(self.thumbs) self.thumbs.resize();
			}
		}
	}

	function settingsUpdate(e) {
		if(self.inquiry) {
			self.inquiry.updateInquiryInfo();
		}
	}

	function layoutModelChange(e) {
		if(e && self.share) {
			self.share.updateStyle(e);
			self.share.updatePosition(e);
		}
		if(e && self.inquiry) {
			self.inquiry.updateStyle(e);
			self.inquiry.updatePosition(e);
		}
		if(e && /overlay/.test(e.id) && (STATE.overrides.thumbnailDock === 'overlay' || STATE.overrides.thumbnailType === 'fill')) {
			sectionChange = true;
			self.overlayView.updatePosition(e);
			checkThumbs({mode:mode, section:section});
		}
		if(e && /thumbnail|menuWidth|menuAlignHorizontal|menuOffsetX|sitePaddingTop|sitePaddingRight|sitePaddingBottom|sitePaddingLeft/.test(e.id)) {
			sectionChange = true;
			self.overlayView.updatePosition(e);
			checkThumbs({mode:mode, section:section});
			if(self.thumbs) self.thumbs.resize();
		}
	}

	function resizeEnd(e) {
		self.overlayView.updatePosition(e);
		if(self.share) self.share.updatePosition(e);
		if(self.inquiry) self.inquiry.updatePosition(e);
		resizeThumbs(e);
	}

	function overlayControllerSiteUriChange(e) {
		if(e.info.isMediaViewStateChange) self.overlayView.updatePosition(e);
		if(e.assetId) assetId = e.assetId;
		checkThumbs(e);
		checkShare(e);
		checkInquiry(e);
		checkFotomoto(e);
	}

	function checkFotomoto(e) {
		if(e.section && e.mode.indexOf('fotomoto') > -1) {
			var media = csvToArray(e.section.media);
			var mediaItem = getMediaById(media[e.assetId]);
			if(ACCOUNT_MODEL.fotoMotoId !== '' && mediaItem && mediaItem.type === IMAGE) {
				if(window.FOTOMOTO) window.FOTOMOTO.API.showWindow(10, 'http://' + window.location.host + REWRITE_BASE + MEDIA_ORIGINAL + mediaItem.content);
			}
			setTimeout(function() {
				vars.siteEvents.dispatchEvent('clearFotomotoMode', 'fotomoto');
			}, 100);
		}
	}

	function checkThumbs(e) {

		/*
		 this function needs to be extremely simple
		 and merely obey the uri

		 if thumbs is in the uri then you build and turn them on
		 else you turn them off
		 */

		if(mode !== e.mode && section === e.section) {
			isModeChange = true;
		}

		mode = e.mode || '';
		section = e.section || section;
		if(e.assetId > -1) assetId = e.assetId;
		path = e.path || path;
		mediaItems = csvToArray(e.section.media) || mediaItems;

		if(STATE.overrides.thumbnailType === 'fill' && /thumbs/.test(mode)) {
			vars.siteEvents.dispatchEvent(PAUSE_MEDIA);
			if(vars.mediaView.scroll) vars.mediaView.scroll.hide();
		} else if(STATE.overrides.thumbnailType === 'fill') {
			if(exists(vars, "mediaView.scroll.bar.handle.alpha") === 0) {
				vars.mediaView.scroll.show();
				vars.mediaView.scroll.update();
			}
		}

		if(self.thumbs && (self.thumbs.section !== section || sectionChange)) {
			self.thumbs.hide()
			self.overlayView.removeChild(self.thumbs);
			delete self.thumbs;
		}

		if(e.section && e.section.thumb) {

			settings = e.section.thumb;

			if(!self.thumbs && mode.indexOf('thumbs') > -1) {
				self.thumbs = new ThumbsModule({
					assetId:assetId,
					path:path,
					mediaItems:mediaItems,
					settings:settings,
					events:vars.siteEvents,
					parent: vars.siteView
				});
				self.thumbs.section = section;
				self.thumbs.settings = settings;
				self.overlayView.addChild(self.thumbs);
				stage.addEventListener(MOUSE_MOVE, thumbsMouseMove);
			}
			if(self.thumbs && mode.indexOf('thumbs') > -1 && !self.thumbs.toggleState()) {
				stripDisplaceChange();
				self.thumbs.show();
			} else if(self.thumbs && self.thumbs.toggleState() && mode.indexOf('thumbs') === -1) {
				if(isModeChange) {
					stripDisplaceChange();
					self.thumbs.hide();
				} else {
					vars.siteEvents.addEventListener(TRANSITION_START, mediaTransitionStart);
				}
			}
		}

		thumbHoldersBuilt();
		isModeChange = false;
		sectionChange = false;
	}

	function stripDisplaceChange() {
		if(STATE.overrides.thumbnailType === 'strip' && STATE.overrides.thumbnailDock === 'displace') {
			vars.siteEvents.dispatchEvent('thumbStripDisplaceChange');
		}
	}

	function mediaTransitionStart() {
		vars.siteEvents.removeEventListener(TRANSITION_START, mediaTransitionStart);
		if(LAYOUT_MODEL.overlayAlpha === 1) {
			vars.siteEvents.dispatchEvent('OPAQUE_OVERLAY_CLOSE');
		}
		self.thumbs.hide();
	}

	function thumbHoldersBuilt() {
		if(self.thumbs) {
			if(assetId > -1) {
				self.thumbs.highlight(assetId);
			} else {
				self.thumbs.highlight(-1);
			}
			if(self.thumbs.scroll && self.thumbs.toggleState() && !self.thumbs.mouseHover) {
				self.thumbs.scroll.percent = assetId / (mediaItems.length - 1);
				self.thumbs.scroll.update(UPDATE_SPEED);
			}
		}
	}

	function resizeThumbs() {
		if(self.thumbs) {
			self.thumbs.resize();
		}
	}

	function thumbsMouseMove(e) {
		var x = e.clientX,
			y = e.clientY;

		if(self.thumbs) {
			self.thumbs.mouseHover = self.thumbs.mask.hitTestPoint(x, y);
			if(STATE.overrides.thumbnailType === 'strip' && STATE.overrides.thumbnailDock === 'overlay') {
				if(self.thumbs.mask.hitTestPoint(x, y) && !thumbsOpen && !self.thumbs.toggleState()) {
					vars.siteEvents.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, 'thumbs');
					thumbsOpen = true;
				} else if(!self.thumbs.mask.hitTestPoint(x, y) && thumbsOpen && self.thumbs.toggleState()) {
					vars.siteEvents.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, 'thumbs');
					thumbsOpen = false;
				}
			}
		}
	}

	function checkShare(e) {
		if(!self.share && e.mode.indexOf('email') > -1) {
			self.share = new ShareView(vars);
			self.share.pointerEvents = 'auto';
			self.overlayView.addChild(self.share);
			self.share.updateContent(e);
		} else if(self.share && e.mode.indexOf('email') > -1) {
			self.share.updateContent(e);
			self.share.show();
		} else if(self.share && e.mode.indexOf('email') === -1) {
			self.share.hide();
		}
	}

	function checkInquiry(e) {
		if(!self.inquiry && e.mode.indexOf('inquiry') > -1) {
			self.inquiry = new InquiryView(vars);
			self.inquiry.pointerEvents = 'auto';
			self.overlayView.addChild(self.inquiry);
			self.inquiry.updateContent(e);
		} else if(self.inquiry && e.mode.indexOf('inquiry') > -1) {
			self.inquiry.updateContent(e);
			self.inquiry.show();
		} else if(self.inquiry && e.mode.indexOf('inquiry') === -1) {
			self.inquiry.hide();
		}
	}

	return self;
}

function OverlayView(vars) {

	var self = new ViewProxy({events:vars.events});
	self.zIndex = STATE.overlayView.zIndex;
	self.overflow = 'hidden';
	self.pointerEvents = 'none';
	self.updateSpeed = 0;

	self.addEventListener(CHILD_ADDED, function(child) {
		self.updatePosition();
	});

	self.show = function() {
		self.display = 'block';
		Tween(self, UPDATE_SPEED, {alpha:1});
	};

	self.hide = function() {
		Tween(self, UPDATE_SPEED, {alpha:0,onComplete:function() {
			self.display = 'none';
		}});
	};

	self.updatePosition = function(e) {
		Tween(self, self.updateSpeed, {
			x:STATE.mediaView.zoneX(),
			y:STATE.mediaView.zoneY(),
			width:STATE.mediaView.zoneWidth(),
			height:STATE.mediaView.zoneHeight()
		});
		self.updateSpeed = UPDATE_SPEED;
	};

	return self;
}

function ThumbsModule(vars) {

	"use strict";

	var self = new Sprite({events:vars.events}),
		mask,
		grid,
		axis = STATE.overrides.thumbnailSide === 'left' || STATE.overrides.thumbnailSide === 'right' || STATE.overrides.thumbnailType === 'fill' ? 'y' : 'x',
		align = axis === 'y' ? 'top' : 'left',
		thumbArr = [],
		thumbsStyle,
		toggle,
		dock,
		tile = new Tile({
			marginHorizontal: percentToPixels(STATE.overrides.thumbnailHorizontalMargin, stage.width),
			marginVertical: percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height),
			gap: Number(STATE.overrides.thumbnailGap)
		}),
		assetId,
		lazyLoaderTimeout;

	self.currentThumb = 1;
	self.settings = vars.settings;
	self.tile = tile;
	self.pointerEvents = 'auto';
	self.isInit = true;

	self.build = function() {
		self.updateSpeed = 0;
		self.holdersBuilt = false;
		self.id = 'thumbs';
		self.overflow = 'hidden';
		self.zIndex = 200;
		self.alpha = 0;

		mask = self.mask = new Sprite();
		mask.id = 'mask';
		mask.overflow = 'hidden';
		mask.zIndex = 1;
		if(STATE.overrides.thumbnailDock === 'overlay' || STATE.overrides.thumbnailType === 'fill') {
			mask.backgroundColor = toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha);
		}
		self.addChild(mask);
		self.mask = mask;

		grid = new Sprite();
		grid.id = 'grid';

		mask.grid = grid;

		self.lazyLoader = new LazyLoader(grid, mask);

		toggle = new Toggle({
			target: self,
			on: self.hide,
			off: self.show
		});

		if(USER_AGENT === TABLET || TOUCH_DEVICE) {

			self.scroll = new Scroll(grid, mask, {
				types:['touch'],
				axis:axis,
				align:align,
				margin:percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height),
				scrollTopCheck:true
			});

		} else if(STATE.overrides.thumbnailScrollType === 'scrollbar' && STATE.overrides.thumbnailType === 'fill') {

			makeCloseHit();

			var scrollBarWidth = STATE.overrides.thumbnailScrollbarWidth;
			var scrollBarOffsetX = STATE.overrides.thumbnailScrollbarAlignment === 'right' ? -STATE.overrides.thumbnailScrollbarHorizontalOffset - scrollBarWidth : STATE.overrides.thumbnailScrollbarHorizontalOffset + scrollBarWidth;

			self.scroll = new Scroll(grid, mask, {
				types:['bar','wheel','touch'],
				axis:'y',
				align:align,
				zIndex: STATE.overlayView.zIndex + 1,
				margin:percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height),
				color:STATE.overrides.thumbnailScrollbarColor,
				hover:STATE.overrides.thumbnailScrollbarHover,
				side:STATE.overrides.thumbnailScrollbarAlignment,
				alpha:STATE.overrides.thumbnailScrollbarBgAlpha,
				width:scrollBarWidth,
				offsetX: STATE.overlayView.x() + scrollBarOffsetX,
				offsetY: STATE.overlayView.y() + STATE.overrides.thumbnailScrollbarVerticalOffset,
				parent: vars.parent
			});

		} else if(STATE.overrides.thumbnailScrollType === 'mouse cursor' && STATE.overrides.thumbnailType === 'fill') {

			makeCloseHit();

			self.scroll = new Scroll(grid, mask, {
				types:['hover','touch'],
				axis:'y',
				align:align,
				margin:percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height)
			});

		} else if(STATE.overrides.thumbnailScrollType === 'mouse cursor' || STATE.overrides.thumbnailType === 'strip') {

			self.scroll = new Scroll(grid, mask, {
				types:['hover','touch'],
				align:align,
				axis:axis
			});

		}

		self.scroll.addEventListener(SCROLL, function(){
			clearTimeout(lazyLoaderTimeout);
			lazyLoaderTimeout = setTimeout(function(){
				if(self.lazyLoader) self.lazyLoader.update();
			}, 15);
		});

		self.scroll.addEventListener('WINDOW_SCROLL_TOP', function(){
			self.scroll.percent = 0;
			self.scroll.update(UPDATE_SPEED);
		});

		defineThumbsStyle();
		toggle.state = true;

		if(vars.mediaItems.length > 0) makeHolders();

		self.resize();
		toggle.state = false;
		self.isInit = false;
	};

	function makeCloseHit() {
		var firstMediaItem = getMediaById(vars.mediaItems[0]);
		if(!(firstMediaItem.type === 'link' && firstMediaItem.thumb)) mask.addEventListener(CLICK, closeOverlay);
	}

	function isHorizontalStrip() {
		return STATE.overrides.thumbnailType === 'strip' && (STATE.overrides.thumbnailSide === 'top' || STATE.overrides.thumbnailSide === 'bottom');
	}

	function isVerticalStrip() {
		return STATE.overrides.thumbnailType === 'strip' && (STATE.overrides.thumbnailSide === 'left' || STATE.overrides.thumbnailSide === 'right');
	}

	function isMasonryGrid() {
		return STATE.overrides.thumbnailType === 'fill' && STATE.overrides.thumbnailMasonry;
	}

	function getFilename(mediaItem, width, height) {
		var filename = '';
		if(mediaItem.type === 'image') filename = mediaItem.content;
		if(mediaItem.thumb) filename = mediaItem.thumb;
		if(getExt(filename) === 'gif') {
			return REWRITE_BASE + MEDIA_ORIGINAL + filename;
		} else if(filename) {
			return getThumbQuery(width, height, filename);
		}
		return getDefaultThumb(mediaItem.type);
	}

	function getLoaderColor() {
		var c1, avg, tint;
		if(STATE.overrides.thumbnailType === 'fill' && !STATE.overrides.thumbnailMasonry) {
			c1 = parseColor(LAYOUT_MODEL.overlayColor);
			avg = (c1[0] + c1[1] + c1[2]) * 0.33;
			return avg < 128 ? '#FFFFFF' : '#000000';
		}
		c1 = parseColor(LAYOUT_MODEL.containerColor);
		avg = (c1[0] + c1[1] + c1[2]) * 0.33;
		return avg < 128 ? '#FFFFFF' : '#000000';
	}

	function getThumbWidth(mediaItem) {
		return !isDefaultThumb(mediaItem) && (isHorizontalStrip() || isMasonryGrid() || isVerticalStrip()) ? mediaItem.size.thumb.width || mediaItem.size.content.width : THUMB_SIZES[STATE.overrides.thumbnailSize].width;
	}

	function getThumbHeight(mediaItem) {
		return !isDefaultThumb(mediaItem) && (isHorizontalStrip() || isMasonryGrid() || isVerticalStrip()) ? mediaItem.size.thumb.height || mediaItem.size.content.height : THUMB_SIZES[STATE.overrides.thumbnailSize].height;
	}

	function getHRange() {
		var width = THUMB_SIZES[STATE.overrides.thumbnailSize].width;
		return isHorizontalStrip() ? width * 10 : width;
	}

	function getVRange() {
		var height = THUMB_SIZES[STATE.overrides.thumbnailSize].height;
		return isMasonryGrid() || isVerticalStrip() ? height * 10 : height;
	}

	function isThumbLink(mediaItem) {
		return mediaItem.type === 'link' && mediaItem.thumb;
	}

	function isDefaultThumb(mediaItem) {
		return !mediaItem.thumb && mediaItem.type !== 'image';
	}

	function makeHolders() {

		var items = vars.mediaItems,
			l = items.length,
			i = 0;

		for(; i < l; i++) {
			(function(i) {
				setTimeout(function() {
					var mediaItem = getMediaById(items[i]),
						width = getThumbWidth(mediaItem),
						height = getThumbHeight(mediaItem),
						hRange = getHRange(),
						vRange = getVRange(),
						holder = new Sprite();

					holder.alpha = 0;
					holder.mediaItem = mediaItem;
					holder.backgroundColor = toRgba(LAYOUT_MODEL.overlayColor, STATE.overrides.thumbnailGridTransparency);

					var scale = ScaleEngine({
						type:'fit',
						hRange:hRange,
						vRange:vRange,
						width:width,
						height:height,
						disableOrientationCheck:true
					});

					width = scale.width;
					height = scale.height;

					var widthFloor = Math.floor(width),
						heightFloor = Math.floor(height);

					if(!(mediaItem.type === 'link' && mediaItem.thumb)) {
						holder.width = widthFloor;
						holder.height = heightFloor;
					}

					holder.filename = getFilename(mediaItem, width, height);
					holder.index = i;
					holder.thumb = new Bitmap();

					var thumbScale = ScaleEngine({
						type:'fit',
						hRange:hRange,
						vRange:vRange,
						width:mediaItem.size.thumb.width || mediaItem.size.content.width || THUMB_SIZES[STATE.overrides.thumbnailSize].width,
						height:mediaItem.size.thumb.height || mediaItem.size.content.height || THUMB_SIZES[STATE.overrides.thumbnailSize].height,
						disableOrientationCheck:true
					});

					var align = new AlignEngine({
						hRange:width,
						vRange:height,
						hAlign:'center',
						vAlign:'center',
						width:thumbScale.width,
						height:thumbScale.height
					});

					holder.thumb.width = Math.floor(thumbScale.width);
					holder.thumb.height = Math.floor(thumbScale.height);
					holder.thumb.x = align.x;
					holder.thumb.y = align.y;

					if(mediaItem.type === VIDEO) buildPlayIcon(holder, width, height);

					if(isThumbLink(mediaItem)) {
						holder.label = new TextField();
						holder.label.text = mediaItem.label;
						holder.label.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
						holder.label.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
						holder.label.fontSize = LAYOUT_MODEL.thumbnailTitleFontSize;
						holder.label.width = width;
						holder.label.textAlign = 'center';
						holder.label.y = height + 10;
						var textDims = getSpriteDims(holder.label);
						holder.width = width;
						holder.height = height + 10 + textDims.height;
						widthFloor = Math.floor(width),
						heightFloor = Math.floor(height + 10 + textDims.height);
						holder.addChild(holder.label);
					}

					holder.loader = new LoadingIndicator({type:'spinner', alpha:0.65, color:getLoaderColor()});
					holder.addChild(holder.loader);

					holder.loader.x = (width - holder.loader.width) * 0.5;
					holder.loader.y = (height - holder.loader.height) * 0.5;

					var hit = new Sprite();
					hit.id = 'hit';
					hit.zIndex = 4;
					hit.alpha = 0;
					hit.width = widthFloor;
					hit.height = heightFloor;
					hit.backgroundColor = STATE.overrides.thumbnailHoverColor;
					if(BROWSER_NAME === 'Safari') hit.style['-webkit-backface-visibility'] = 'hidden';
					holder.addChild(hit);
					holder.hit = hit;

					tile.addItem(widthFloor, heightFloor);
					grid.addChild(holder);
					thumbArr.push(holder);

					hit.addEventListener(MOUSE_OVER, onMouseOver);
					hit.addEventListener(MOUSE_OUT, onMouseOut);
					hit.addEventListener(CLICK, select);

					holder.load = load;
					holder.unload = unload;

					if(i === l - 1) {
						mask.addChild(grid);
						self.holdersBuilt = true;
						self.updateSpeed = UPDATE_SPEED;
						if(self.scroll && STATE.overrides.thumbnailType === 'strip') {
							self.scroll.align = 'center';
						}
						self.resize();
					}
				}, 0);
			})(i);
		}
	}

	function getDefaultThumb(type) {
		var link = REWRITE_BASE + ICONS;
		switch(type) {
			case VIDEO:
				link += 'video@2x.png';
				break;
			case HTML:
				link += 'text@2x.png';
				break;
			case SWF:
				link += 'swf@2x.png';
				break;
			case LINK:
				link += 'link@2x.png';
				break;
			case PDF:
				link += 'pdf@2x.png';
				break;
			case CONTACT:
				link += 'contact@2x.png';
				break;
		}
		return link;
	}

	function defineThumbsStyle() {
		switch(STATE.overrides.thumbnailType) {
			case 'fill':
				thumbsStyle = new ThumbsFill({
					container: self,
					mask: mask,
					items: thumbArr,
					side: STATE.overrides.thumbnailSide,
					size: STATE.overrides.thumbnailSize,
					horizontalMargin: percentToPixels(STATE.overrides.thumbnailHorizontalMargin, stage.width),
					verticalMargin: percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height),
					masonry: STATE.overrides.thumbnailMasonry,
					tile: tile,
					parent: self,
					grid: grid
				});
				break;
			case 'strip':
				var reveal = STATE.overrides.thumbnailDock === 'displace' ? 0 : 24;
				if(BROWSER_NAME === 'Safari') self.style['-webkit-backface-visibility'] = 'hidden';
				dock = new Dock(self, layoutCalcs.mediaView.size, {
					side:STATE.overrides.thumbnailSide,
					align:'left',
					offset:0,
					margin:0,
					reveal:reveal,
					updateSpeed:UPDATE_SPEED
				});
				thumbsStyle = new ThumbsStrip({
					container: self,
					mask: mask,
					items: thumbArr,
					side: STATE.overrides.thumbnailSide,
					size: STATE.overrides.thumbnailSize,
					horizontalMargin: percentToPixels(STATE.overrides.thumbnailHorizontalMargin, stage.width),
					verticalMargin: percentToPixels(STATE.overrides.thumbnailVerticalMargin, stage.height),
					tile: tile,
					parent: self
				});
				break;
		}
	}

	function buildPlayIcon(holder, width, height) {
		var playBtn = new Bitmap();
		playBtn.src = REWRITE_BASE + ICONS + 'play@2x.png';
		playBtn.width = 50;
		playBtn.height = 50;
		playBtn.alpha = 0;
		playBtn.zIndex = 3;
		playBtn.thumbHolder = holder;
		playBtn.index = holder.index;
		playBtn.x = Math.floor((width - 50) * 0.5);
		playBtn.y = Math.floor((height - 50) * 0.5);
		Tween(playBtn, 1, {alpha:0.85});
		holder.playBtn = playBtn;
		holder.addChild(playBtn);
	}

	function onMouseOver(e) {
		if(assetId !== e.target.parent.index) {
			Tween(e.target, 0.2, {alpha:STATE.overrides.thumbnailHoverAlpha, backgroundColor:STATE.overrides.thumbnailHoverColor});
		} else {
			Tween(e.target, 0.2, {alpha:STATE.overrides.thumbnailHoverAlpha, backgroundColor:STATE.overrides.thumbnailSelectedColor});
		}
	}

	function onMouseOut(e) {
		if(assetId !== e.target.parent.index) {
			Tween(e.target, 0.25, {alpha:0});
		} else {
			Tween(e.target, 0.2, {alpha:STATE.overrides.thumbnailHoverAlpha, backgroundColor:STATE.overrides.thumbnailSelectedColor});
		}
	}

	function select(e) {
		e.stopPropagation();
		var mediaItem = e.target.parent.mediaItem;
		if(mediaItem.type === 'link') {
			self.events.dispatchEvent(THUMB_CLICK, {
				assetId:0,
				type:'internal',
				path:mediaItem.content,
				linkTarget:mediaItem.linkTarget,
				isThumbClick:false
			});
		} else if(!self.scroll.ing) {
			self.events.dispatchEvent(THUMB_CLICK, {
				assetId:Number(e.target.parent.index),
				type:'internal',
				path:vars.path,
				linkTarget:'_self',
				isThumbClick:true
			});
		}
	}

	function closeOverlay(e) {
		vars.events.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, "thumbs");
	}

	function load() {
		if(!this.thumb.src) {
			this.thumb.addEventListener('load', thumbsStyle.thumbLoaded);
			this.thumb.src = this.filename;
			this.thumb.alpha = 0;
			this.loaded = true;
			this.addChild(this.thumb);
		}
	}

	function unload() {
		if(this.thumb) {
			this.loaded = false;
			this.removeChild(this.thumb);
			delete this.thumb;
		}
	}

	self.highlight = function(value) {
		var i = thumbArr.length;
		assetId = value !== undefined ? value : vars.assetId;
		while(i--) {
			if(i === assetId) {
				self.currentThumb = i + 1;
				thumbArr[i].hit.backgroundColor = STATE.overrides.thumbnailSelectedColor;
				Tween(thumbArr[i].hit, UPDATE_SPEED, {alpha:STATE.overrides.thumbnailHoverAlpha});
			} else {
				Tween(thumbArr[i].hit, UPDATE_SPEED, {alpha:0});
			}
		}
	};

	self.hide = function() {
		if(toggle.state) {
			Tween(self, UPDATE_SPEED, {alpha:0, onComplete:function() {
				self.display = 'none';
				self.updateSpeed = 0;
				toggle.state = false;
			}});
			if(STATE.overrides.thumbnailType === 'strip') {
				if(dock) dock.hide();
			}
			if(self.scroll) {
				self.scroll.hide()
			}
		}
	};

	self.show = function() {
		if(!toggle.state) {
			self.display = 'block';
			self.alpha = 0;
			if(dock) dock.resize(0);
			setTimeout(function() {
				if(dock) dock.show();
				Tween(self, UPDATE_SPEED, {alpha:1, onComplete:showComplete});
				if(STATE.overrides.thumbnailScrollType === 'scrollbar' && STATE.overrides.thumbnailType === 'fill') {
					self.scroll.show()
				}
			}, 0);
		}
	};

	function showComplete() {
		toggle.state = true;
		if(self.holdersBuilt) self.updateSpeed = UPDATE_SPEED;
	}

	self.toggle = function() {
		toggle.flip();
		if(STATE.overrides.thumbnailType === 'strip') {
			dock.toggle();
		}
		if(toggle.state) {
			self.show();
		} else {
			self.hide();
		}
	};

	self.toggleState = function() {
		return toggle.state;
	};

	self.resize = function() {
		if(thumbsStyle) {
			thumbsStyle.resize();
		}
		if(self.scroll) self.scroll.resize();
	};

	self.build();

	return self;
}

function ThumbsFill(vars) {

	var self = this,
		container = vars.container,
		mask = vars.mask,
		side = vars.side,
		size = vars.size,
		masonry = vars.masonry,
		grid = vars.grid,
		tile = vars.tile;

	tile.axis = 'y';
	tile.align = 'left';
	tile.wrap = true;

	function arrange() {
		tile.perpLength = STATE.mediaView.zoneWidth() - (vars.horizontalMargin * 2);
		tile.layoutItems();
		items = mask.grid.children;
		var i = 0,
			l = items.length;
		for(; i < l; i++) {
			var position = tile.getPosition(i);
			if(i === items.length - 1) {
				items[i].lastItem = true;
			}
			Tween(items[i], vars.parent.updateSpeed, {x:position.x, y:position.y, onComplete:function(){
				Tween(this, UPDATE_SPEED, {alpha:1});
				if(this.lastItem && vars.parent.lazyLoader && vars.parent.holdersBuilt) vars.parent.lazyLoader.update();
			}});
		}
	}

	this.resize = function() {
		container.transition = 0;
		container.x = 0;
		container.y = 0;
		container.width = STATE.mediaView.zoneWidth();
		container.height = STATE.mediaView.zoneHeight();
		mask.width = container.width;
		mask.height = container.height;
		arrange();
		var bounds = tile.getBounds();
		mask.grid.width = bounds.width;
		mask.grid.height = bounds.height;
		var align = new AlignEngine({hRange:STATE.mediaView.zoneWidth(), vRange:STATE.mediaView.zoneHeight(), width:bounds.width, height:bounds.height, hAlign:'center', vAlign:'top', hOffset:0, vOffset:vars.verticalMargin});
		mask.grid.x = align.x;
	};

	this.thumbLoaded = function(e) {
		if(this.parent.loader) this.parent.removeChild(this.parent.loader);
		Tween(this, 0.25, {alpha:1});
	};

}

function ThumbsStrip(vars) {

	var self = this,
		container = vars.container,
		mask = vars.mask,
		side = vars.side,
		size = vars.size,
		tile = vars.tile;

	tile.align = 'bottom';
	tile.wrap = true;

	function Const() {
		switch(side) {
			case 'top':
				tile.axis = 'x';
				tile.perpLength = THUMB_SIZES[size].height;
				container.height = THUMB_SIZES[size].height;
				mask.height = THUMB_SIZES[size].height;
				break;
			case 'right':
				tile.axis = 'y';
				tile.perpLength = THUMB_SIZES[size].width;
				container.width = THUMB_SIZES[size].width;
				mask.width = THUMB_SIZES[size].width;
				break;
			case 'bottom':
				tile.axis = 'x';
				tile.perpLength = THUMB_SIZES[size].height;
				container.height = THUMB_SIZES[size].height;
				mask.height = THUMB_SIZES[size].height;
				break;
			case 'left':
				tile.axis = 'y';
				tile.perpLength = THUMB_SIZES[size].width;
				container.width = THUMB_SIZES[size].width;
				mask.width = THUMB_SIZES[size].width;
				break;
		}
	}

	function arrange() {
		tile.layoutItems();
		items = mask.grid.children;
		var i = 0,
			l = items.length;
		for(; i < l; i++) {
			var position = tile.getPosition(i);
			items[i].transition = 0;
			items[i].alpha = 1;
			items[i].x = position.x;
			items[i].y = position.y;
			if(i === items.length - 1) {
				if(vars.parent.lazyLoader && vars.parent.holdersBuilt) vars.parent.lazyLoader.update();
			}
		}
	}

	this.resize = function() {
		if(side === 'top' || side === 'bottom') {
			container.width = STATE.mediaView.zoneWidth();
			mask.width = STATE.mediaView.zoneWidth();
		} else {
			mask.height = STATE.mediaView.zoneHeight();
			container.height = STATE.mediaView.zoneHeight();
		}
		arrange();
		var bounds = tile.getBounds();
		mask.grid.width = bounds.width;
		mask.grid.height = bounds.height;
		var updateSpeed = vars.parent.isInit ? 0 : UPDATE_SPEED;
		container.transition = 0;
		setTimeout(function(){
			Docks.resize(updateSpeed);
		},0);
	};

	this.thumbLoaded = function(e) {
		if(this.parent.loader) this.parent.removeChild(this.parent.loader);
		Tween(this, 0.25, {alpha:1});
	};

	Const.call(this);
}


function InquiryView(vars) {

	var self = new Sprite(vars);

	var width = 573,
		height = 225,
		inquiry,
		title,
		line,
		info,
		preview,
		form,
		mediaItem,
		yourName,
		yourEmail,
		message,
		submit,
		closeHit,
		responseMessage = new Sprite(),
		_localEvents = vars.localEvents;

	self.updateSpeed = 0;
	self.backgroundColor = toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha);
	self.zIndex = 100;
	self.alpha = 0;
	self.visible = false;

	function init() {
		closeHit = new Sprite();
		closeHit.backgroundColor = '#cccccc';
		closeHit.alpha = 0;
		closeHit.addEventListener(MOUSE_DOWN, closeOverlay);
		self.addChild(closeHit);

		inquiry = new Sprite();
		inquiry.width = width;
		inquiry.height = height;
		self.addChild(inquiry);

		title = new TextField();
		title.text = SETTINGS_MODEL.inquiryTitle ? decodeURIComponent(SETTINGS_MODEL.inquiryTitle) : 'Inquire about this image';
		title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		title.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		title.fontSize = LAYOUT_MODEL.thumbnailTitleFontSize;
		inquiry.addChild(title);

		line = new Sprite();
		line.backgroundColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35);
		line.width = width;
		line.height = 1;
		line.y = title.height + 10;
		inquiry.addChild(line);

		if(SETTINGS_MODEL.inquiryInfo) {
			info = new TextField();
			info.text = SETTINGS_MODEL.inquiryInfo;
			info.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			info.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
			info.x = 2;
			info.y = title.height + 20;
			info.fontSize = 13;
			inquiry.addChild(info);
		}

		preview = new Bitmap();
		preview.alpha = 0;
		inquiry.addChild(preview);
		preview.addEventListener(LOAD, previewLoaded);

		form = new Sprite();
		if(SETTINGS_MODEL.inquiryInfo) {
			form.x = 222;
			form.y = info.y + info.height + 10;
		} else {
			form.x = 222;
			form.y = 40;
		}
		form.width = width - form.x;
		form.height = height - form.y;
		inquiry.addChild(form);

		yourName = buildFormInput("Your Name");
		yourName.x = 0;
		yourName.y = 0;
		form.addChild(yourName);

		yourEmail = buildFormInput('Your Email');
		yourEmail.x = 180;
		yourEmail.y = 0;
		form.addChild(yourEmail);

		message = buildFormInput("Message");
		message.x = 0;
		message.y = 50;
		form.addChild(message);

		submit = new Button();
		submit.text = 'Submit';
		submit.y = 135;
		submit.fontSize = 12;
		submit.fontColor = LAYOUT_MODEL.overlayColor;
		submit.backgroundColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		submit.paddingTop = 2;
		submit.paddingRight = 14;
		submit.paddingBottom = 2;
		submit.paddingLeft = 14;
		form.addChild(submit);
		submit.x = form.width - submit.width;
		submit.addEventListener(FOCUS, onFocusSubmit);
		submit.addEventListener(BLUR, onBlurSubmit);
		submit.addEventListener(MOUSE_OVER, onFocusSubmit);
		submit.addEventListener(MOUSE_OUT, onBlurSubmit);
		if(TOUCH_DEVICE) {
			submit.addEventListener(TOUCH_END, onSubmit);
		} else {
			submit.addEventListener(CLICK, onSubmit);
		}

		responseMessage.alpha = 0;
		if(SETTINGS_MODEL.inquiryInfo) {
			responseMessage.x = form.x;
			responseMessage.y = info.y + info.height + 10;
		} else {
			responseMessage.x = form.x;
			responseMessage.y = 40;
		}
		responseMessage.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		responseMessage.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		responseMessage.fontSize = 14;
		inquiry.addChild(responseMessage);

		self.updateStyle();
		self.updatePosition();
		self.show();

		_localEvents.addEventListener(INQUIRY_FORM_SENT, inquiryResponse);
	}

	function previewLoaded(e) {
		var retinaSize = RetinaResizeEngine({width:this.width, height:this.height, filename:preview.src});
		this.width = retinaSize.width;
		this.height = retinaSize.height;
		Tween(this, UPDATE_SPEED, {alpha:1});
	}

	function buildFormInput(label) {
		var holder = new Sprite();
		holder.width = 168;
		var title = new TextField();
		title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		title.fontColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.7);
		title.fontSize = 11;
		title.text = label;
		holder.addChild(title);
		var input = label === 'Message' ? new TextArea() : new Input();
		input.backgroundColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.1);
		input.border = '1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.3);
		input.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		input.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		input.fontSize = 14;
		input.height = label === 'Message' ? 55 : 20;
		input.width = label === 'Message' ? (holder.width * 2) + 12 : 168;
		input.y = 17;

		input.addEventListener(FOCUS, onFocus);
		input.addEventListener(BLUR, onBlur);

		holder.addChild(input);
		holder.id = label;
		holder.input = input;
		holder.title = title;
		return holder;
	}

	function onFocus(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.2), border:'1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.7)});
	}

	function onBlur(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.1), border:'1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.3)});
	}

	function onFocusSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.8)});
	}

	function onBlurSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 1)});
	}

	function onSubmit(e) {

		if(yourName.input.value === '') {
			alert('Name field cannot be blank.');
			return false;
		} else if(yourEmail.input.value === '' || !isValidEmail(yourEmail.input.value)) {
			alert('Please enter valid email address.');
			return false;
		}

		var str = '&shareItem=' + encodeURIComponent(getThumbQuery(1600, 1200, mediaItem.content)) +
			'&fromName=' + encodeURIComponent(yourName.input.value) +
			'&fromEmail=' + encodeURIComponent(yourEmail.input.value) +
			'&message=' + encodeURIComponent(message.input.value);

		str = str.replace(/\r\n/g,"<br>").replace(/\n\r/g,"<br>").replace(/\r/g,"<br>").replace(/\n/g,"<br>");

		_localEvents.dispatchEvent(INQUIRY_FORM_SUBMIT, str);
	}

	function isValidEmail(str) {
		return /[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/g.test(str);
	}

	function inquiryResponse(e) {
		responseMessage.text = e.response;
		Tween(form, UPDATE_SPEED, {alpha:0});
		Tween(responseMessage, UPDATE_SPEED, {alpha:1});
		self.addEventListener(MOUSE_DOWN, closeOverlay);
	}

	function closeOverlay(e) {
		if(e.target === self) self.removeEventListener(MOUSE_DOWN, closeOverlay);
		_localEvents.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, "inquiry");
	}

	self.updateStyle = function(e) {
		if(LAYOUT_MODEL.thumbnailTitleFont !== title.fontFamily) {
			title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			if(SETTINGS_MODEL.inquiryInfo) info.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			yourName.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			yourEmail.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			message.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			submit.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		}
		if(LAYOUT_MODEL.thumbnailTitleFontSize !== title.fontSize) {
			Tween(title, UPDATE_SPEED, {fontSize:LAYOUT_MODEL.thumbnailTitleFontSize, onComplete:function() {
				self.updatePosition(e);
			}});
		}
		if(LAYOUT_MODEL.thumbnailTitleFontColor !== title.fontColor) {
			Tween(title, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.thumbnailTitleFontColor});
			if(SETTINGS_MODEL.inquiryInfo) Tween(info, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.thumbnailTitleFontColor});
			Tween(line, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(yourName.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(yourEmail.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(message.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(submit, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.overlayColor, 0.35)});
			Tween(submit, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
		}
		if(toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha) !== self.backgroundColor) {
			Tween(self, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha)});
		}
	};

	self.updatePosition = function(e) {
		self.x = 0;
		self.y = 0;
		width = STATE.mediaView.width() > 573 ? 573 : STATE.mediaView.width();
		height = STATE.mediaView.height() > 225 ? 225 : STATE.mediaView.height();

		line.y = title.height + 10;

		if(SETTINGS_MODEL.inquiryInfo) {
			info.y = title.height + 20;
			preview.x = 2;
			preview.y = info.y + info.height + 10;
		} else {
			preview.x = 2;
			preview.y = title.height + 20;
		}

		if(layoutCalcs.mediaView.width() > 573) {
			if(SETTINGS_MODEL.inquiryInfo) {
				form.x = 222;
				form.y = info.y + info.height + 10;
			} else {
				form.x = 222;
				form.y = preview.y;
			}
		} else {
			form.x = 2;
			form.y = preview.y + preview.height + 10;
		}

		if(SETTINGS_MODEL.inquiryInfo) {
			responseMessage.x = form.x;
			responseMessage.y = info.y + info.height + 10;
		} else {
			responseMessage.x = form.x;
			responseMessage.y = 40;
		}

		if(self.updateSpeed === 0) {
			self.width = STATE.mediaView.width();
			self.height = STATE.mediaView.height();
			inquiry.x = ((STATE.mediaView.width() - width) * 0.5);
			inquiry.y = ((STATE.mediaView.height() - height) * 0.5);
			inquiry.width = width;
			inquiry.height = height;
		} else {
			Tween(self, self.updateSpeed, {
				width:STATE.mediaView.width(),
				height:STATE.mediaView.height()
			});
			Tween(inquiry, self.updateSpeed, {
				x:(STATE.mediaView.width() - width) * 0.5,
				y:(STATE.mediaView.height() - height) * 0.5,
				width:width,
				height:height
			});
		}

		closeHit.width = STATE.mediaView.width();
		closeHit.height = STATE.mediaView.height();
		self.updateSpeed = UPDATE_SPEED;
	};

	self.show = function() {
		self.updateSpeed = 0;
		self.updatePosition();
		if(!self.visible) {
			self.visible = true;
			self.display = 'block';
			Tween(self, UPDATE_SPEED, {alpha:1});
			Tween(form, UPDATE_SPEED, {alpha:1});
			Tween(responseMessage, UPDATE_SPEED, {alpha:0});
		}
	};

	self.hide = function() {
		if(self.visible) {
			self.visible = false;
			Tween(self, UPDATE_SPEED, {alpha:0, onComplete:function(){
				this.display = 'none';
			}});
		}
	};

	self.updateInquiryInfo = function() {
		title.text = SETTINGS_MODEL.inquiryTitle ? SETTINGS_MODEL.inquiryTitle : 'Inquire about this image';
		if(SETTINGS_MODEL.inquiryInfo) {
			info.text = SETTINGS_MODEL.inquiryInfo;
		}
		self.updatePosition();
	};

	self.updateContent = function(e) {
		var mediaItems = csvToArray(e.section.media);
		mediaItem = getMediaById(mediaItems[e.assetId]);
		if(preview) {
			inquiry.removeChild(preview);
		}
		preview = new Bitmap();
		preview.alpha = 0;
		if(SETTINGS_MODEL.inquiryInfo) {
			preview.x = 2;
			preview.y = info.y + info.height + 10;
		} else {
			preview.x = 2;
			preview.y = title.height + 20;
		}
		preview.src = getThumbQuery(200, 300, mediaItem.thumb||mediaItem.content);
		preview.width = 200;
		inquiry.addChild(preview);
		preview.addEventListener(LOAD, previewLoaded);
	};

	self.addEventListener(CHILD_ADDED, function(child) {
		init.call(self);
	});

	return self;

}

function ShareView(vars) {

	var self = new Sprite(vars);

	var width = 573,
		height = 225,
		share,
		title,
		line,
		preview,
		form,
		mediaItem,
		yourName,
		friendsName,
		yourEmail,
		friendsEmail,
		message,
		submit,
		closeHit,
		responseMessage = new Sprite(),
		_localEvents = vars.localEvents;

	self.updateSpeed = 0;
	self.backgroundColor = toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha);
	self.zIndex = 100;
	self.alpha = 0;
	self.visible = false;

	function init() {
		closeHit = new Sprite();
		closeHit.backgroundColor = '#cccccc';
		closeHit.alpha = 0;
		closeHit.addEventListener(MOUSE_DOWN, closeOverlay);
		self.addChild(closeHit);

		share = new Sprite();
		share.width = width;
		share.height = height;
		self.addChild(share);

		title = new TextField();
		title.text = "Email this image";
		title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		title.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		title.fontSize = LAYOUT_MODEL.thumbnailTitleFontSize;
		share.addChild(title);

		line = new Sprite();
		line.backgroundColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35);
		line.width = width;
		line.height = 1;
		line.y = LAYOUT_MODEL.thumbnailTitleFontSize + 10;
		share.addChild(line);

		preview = new Bitmap();
		preview.alpha = 0;
		share.addChild(preview);
		preview.addEventListener(LOAD, previewLoaded);

		form = new Sprite();
		form.x = 222;
		form.y = title.height + 20;
		form.width = width - form.x;
		form.height = height - form.y;
		share.addChild(form);

		yourName = buildFormInput("Your Name");
		yourName.x = 0;
		yourName.y = 0;
		form.addChild(yourName);

		friendsName = buildFormInput("Friend's Name");
		friendsName.x = 180;
		friendsName.y = 0;
		form.addChild(friendsName);

		yourEmail = buildFormInput('Your Email');
		yourEmail.x = 0;
		yourEmail.y = 50;
		form.addChild(yourEmail);

		friendsEmail = buildFormInput("Friend's Email");
		friendsEmail.x = 180;
		friendsEmail.y = 50;
		form.addChild(friendsEmail);

		message = buildFormInput("Message");
		message.x = 0;
		message.y = 100;
		form.addChild(message);

		submit = new Button();
		submit.text = 'Submit';
		submit.y = 185;
		submit.fontSize = 12;
		submit.fontColor = LAYOUT_MODEL.overlayColor;
		submit.backgroundColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		submit.paddingTop = 2;
		submit.paddingRight = 14;
		submit.paddingBottom = 2;
		submit.paddingLeft = 14;
		form.addChild(submit);
		submit.x = form.width - submit.width;
		submit.addEventListener(FOCUS, onFocusSubmit);
		submit.addEventListener(BLUR, onBlurSubmit);
		submit.addEventListener(MOUSE_OVER, onFocusSubmit);
		submit.addEventListener(MOUSE_OUT, onBlurSubmit);
		if(TOUCH_DEVICE) {
			submit.addEventListener(TOUCH_END, onSubmit);
		} else {
			submit.addEventListener(CLICK, onSubmit);
		}

		responseMessage.alpha = 0;
		responseMessage.x = form.x;
		responseMessage.y = 40;
		responseMessage.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		responseMessage.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		responseMessage.fontSize = 14;
		share.addChild(responseMessage);

		self.updateStyle();
		self.updatePosition();
		self.show();

		_localEvents.addEventListener(SHARE_FORM_SENT, shareResponse);

	}

	function previewLoaded(e) {
		var retinaSize = RetinaResizeEngine({width:this.width, height:this.height, filename:preview.src});
		this.width = retinaSize.width;
		this.height = retinaSize.height;
		Tween(this, UPDATE_SPEED, {alpha:1});
	}

	function buildFormInput(label) {
		var holder = new Sprite();
		holder.width = 168;
		var title = new TextField();
		title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		title.fontColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.7);
		title.fontSize = 11;
		title.text = label;
		holder.addChild(title);
		var input = label === 'Message' ? new TextArea() : new Input();
		input.backgroundColor = toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.1);
		input.border = '1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.3);
		input.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		input.fontColor = LAYOUT_MODEL.thumbnailTitleFontColor;
		input.fontSize = 14;
		input.height = label === 'Message' ? 55 : 20;
		input.width = label === 'Message' ? (holder.width * 2) + 12 : 168;
		input.y = 17;

		input.addEventListener(FOCUS, onFocus);
		input.addEventListener(BLUR, onBlur);

		holder.addChild(input);
		holder.id = label;
		holder.input = input;
		return holder;
	}

	function onFocus(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.2), border:'1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.7)});
	}

	function onBlur(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.1), border:'1px solid ' + toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.3)});
	}

	function onFocusSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.8)});
	}

	function onBlurSubmit(e) {
		Tween(this, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 1)});
	}

	function onSubmit(e) {

		if(friendsName.input.value === '') {
			alert('Name field cannot be blank.');
			return false;
		} else if(yourName.input.value === '') {
			alert('Name field cannot be blank.');
			return false;
		} else if(friendsEmail.input.value === '' || !isValidEmail(friendsEmail.input.value)) {
			alert('Please enter valid email address.');
			return false;
		} else if(yourEmail.input.value === '' || !isValidEmail(yourEmail.input.value)) {
			alert('Please enter valid email address.');
			return false;
		}

		var str = '&shareItem=' + encodeURIComponent(getThumbQuery(1600, 1200, mediaItem.content)) +
				'&toName=' + encodeURIComponent(friendsName.input.value) +
				'&toEmail=' + encodeURIComponent(friendsEmail.input.value) +
				'&fromName=' + encodeURIComponent(yourName.input.value) +
				'&fromEmail=' + encodeURIComponent(yourEmail.input.value) +
				'&message=' + encodeURIComponent(message.input.value);

		str = str.replace(/\r\n/g,"<br>").replace(/\n\r/g,"<br>").replace(/\r/g,"<br>").replace(/\n/g,"<br>");

		_localEvents.dispatchEvent(SHARE_FORM_SUBMIT, str);
	}

	function isValidEmail(str) {
		return /[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/g.test(str);
	}

	function shareResponse(e) {
		responseMessage.text = e.response;
		Tween(form, UPDATE_SPEED, {alpha:0});
		Tween(responseMessage, UPDATE_SPEED, {alpha:1});
		self.addEventListener(MOUSE_DOWN, closeOverlay);
	}

	function closeOverlay(e) {
		if(e.target === self) self.removeEventListener(MOUSE_DOWN, closeOverlay);
		_localEvents.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, "email");
	}

	self.updateStyle = function(e) {
		if(LAYOUT_MODEL.thumbnailTitleFont !== title.fontFamily) {
			title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			yourName.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			friendsName.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			yourEmail.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			friendsEmail.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			message.title.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
			submit.fontFamily = LAYOUT_MODEL.thumbnailTitleFont;
		}
		if(LAYOUT_MODEL.thumbnailTitleFontSize !== title.fontSize) {
			Tween(title, UPDATE_SPEED, {fontSize:LAYOUT_MODEL.thumbnailTitleFontSize, onComplete:function(){
				self.updatePosition(e);
			}});
		}
		if(LAYOUT_MODEL.thumbnailTitleFontColor !== title.fontColor) {
			Tween(title, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.thumbnailTitleFontColor});
			Tween(line, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(yourName.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(friendsName.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(yourEmail.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(friendsEmail.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(message.title, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
			Tween(submit, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.overlayColor, 0.35)});
			Tween(submit, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.thumbnailTitleFontColor, 0.35)});
		}
		if(toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha) !== self.backgroundColor) {
			Tween(self, UPDATE_SPEED, {backgroundColor:toRgba(LAYOUT_MODEL.overlayColor, LAYOUT_MODEL.overlayAlpha)});
		}
	};

	self.updatePosition = function(e) {
		self.x = 0;
		self.y = 0;
		width = STATE.mediaView.width() > 573 ? 573 : STATE.mediaView.width();
		height = STATE.mediaView.height() > 225 ? 225 : STATE.mediaView.height();

		preview.x = 2;
		preview.y = title.height + 20;
		line.y = LAYOUT_MODEL.thumbnailTitleFontSize + 10;

		if(layoutCalcs.mediaMask.width() > 573) {
			form.x = 222;
			form.y = title.height + 20;
		} else {
			form.x = 2;
			form.y = preview.y + preview.height + 10;
		}

		if(self.updateSpeed === 0) {
			self.width = STATE.mediaView.width();
			self.height = STATE.mediaView.height();
			share.x = ((STATE.mediaView.width() - width) * 0.5);
			share.y = ((STATE.mediaView.height() - height) * 0.5);
			share.width = width;
			share.height = height;
		} else {
			Tween(self, self.updateSpeed, {
				width:STATE.mediaView.width(),
				height:STATE.mediaView.height()
			});
			Tween(share, self.updateSpeed, {
				x:(STATE.mediaView.width() - width) * 0.5,
				y:(STATE.mediaView.height() - height) * 0.5,
				width:width,
				height:height
			});
		}
		closeHit.width = STATE.mediaView.width();
		closeHit.height = STATE.mediaView.height();
		self.updateSpeed = UPDATE_SPEED;
	};

	self.show = function() {
		self.updateSpeed = 0;
		self.updatePosition();
		if(!self.visible) {
			self.visible = true;
			self.display = 'block';
			Tween(self, UPDATE_SPEED, {alpha:1});
			Tween(form, UPDATE_SPEED, {alpha:1});
			Tween(responseMessage, UPDATE_SPEED, {alpha:0});
		}
	};

	self.hide = function(e) {
		if(self.visible) {
			self.visible = false;
			Tween(self, UPDATE_SPEED, {alpha:0, onComplete:function(){
				this.display = 'none';
			}});
		}
	};

	self.updateContent = function(e) {
		var mediaItems = csvToArray(e.section.media);
		mediaItem = getMediaById(mediaItems[e.assetId]);
		if(preview) {
			share.removeChild(preview);
		}
		preview = new Bitmap();
		preview.alpha = 0;
		preview.x = 2;
		preview.y = title.height + 20;
		preview.width = 200;
		preview.src = getThumbQuery(200, 300, mediaItem.thumb||mediaItem.content);
		form.y = title.height + 20;
		share.addChild(preview);
		preview.addEventListener(LOAD, previewLoaded);
	};

	self.addEventListener(CHILD_ADDED, function(child) {
		init.call(self);
	});

	return self;
}

function MenuController(vars) {

	var self = new ControllerProxy({parentView:vars.parentView, parentController:vars.parentController, events:vars.siteControllerEvents}),
		isInit = true,
		isInitUri = true,
		sectionsModelChangeTimer,
		isOrientationChange = false,
		autoCloseUriTimer;
	self.updateSpeed = 0;

	self.menuView = new vars.MenuView(vars);
	self.menuView.alpha = 0;
	self.parentView.addChild(self.menuView);

	self.menuView.menuText = new MenuText(vars);
	self.menuView.menuText.element.setAttribute('class', 'menuText');
	self.menuView.addContent(self.menuView.menuText);

	self.events.addEventListener(LAYOUT_MODEL_CHANGE, layoutModelChange);
	self.events.addEventListener(MEDIA_MODEL_CHANGE, mediaModelChange);
	self.events.addEventListener(SECTIONS_MODEL_CHANGE, sectionsModelChangeCheck);
	self.events.addEventListener(ORIENTATION_CHANGE, function(e) {
		isOrientationChange = true;
	});
	self.events.addEventListener(RESIZE_END, function(){
		self.menuView.menuText.updatePosition();
		self.menuView.updatePosition();
		if(isOrientationChange) {
			self.menuView.menuText.rebuild();
			isOrientationChange = false;
		}
	});
	self.events.addEventListener(LANDING_INIT, landingInit);
	self.events.addEventListener(SITE_URI_CHANGE, menuSiteUriChange);
	self.events.addEventListener(TOUCH_NAVIGATION_END, touchNavigationEnd);
	self.events.addEventListener(MENU_BUILT, function(){
		sectionsModelChangeTimer = setTimeout(function(){
			self.menuView.menuText.updatePosition();
			self.menuView.updatePosition();
		}, 0);
	});
	self.events.addEventListener(MENU_SIZE_CHANGE, self.menuView.updatePosition);

	self.events.addEventListener('fillSiteMode', setSafariHack);
	self.events.addEventListener('nonFillSiteMode', removeSafariHack);

	function setSafariHack(e) {
		if(BROWSER_NAME === 'Safari') self.menuView.menuText.translateZ = 0;
	}

	function removeSafariHack(e) {
		if(BROWSER_NAME === 'Safari') {
			self.menuView.menuText.style['-webkit-transform'] = 'none';
			self.menuView.menuText.style['-ms-transform'] = 'none';
			self.menuView.menuText.style['transform'] = 'none';
		}
	}

	function introComplete(e) {
		self.events.removeEventListener(INTRO_COMPLETE, introComplete);
		if(USER_AGENT === TABLET) {
			setTimeout(self.menuView.closeDock, 2000);
		}
	}

	function landingInit() {
		self.events.removeEventListener(LANDING_INIT, landingInit);
		if(USER_AGENT === TABLET || USER_AGENT === MOBILE) {
			setTimeout(function() {
				self.menuView.closeDock();
			}, 2000);
		}
	}

	function touchNavigationEnd(e) {
		self.menuView.closeDock();
	}

	function menuSiteUriChange(e) {
		if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
			if(LAYOUT_MODEL.introFile !== '' && !e.path) {
				self.events.addEventListener(INTRO_COMPLETE, introComplete);
			} else if(isInitUri)  {
				setTimeout(self.menuView.closeDock, 2000);
			} else {
				clearTimeout(autoCloseUriTimer);
				autoCloseUriTimer = setTimeout(self.menuView.closeDock, 200);
			}
		}
		self.menuView.menuText.setActiveMenuItem(e);
		isInitUri = false;
	}

	function isAddIconLink(e) {
		var media = csvToArray(e.value);
		return e.field === 'media' && e.method === 'update' && media.length === 1 && getMediaById(media[0]).type === 'link';
	}

	function isRemoveIconLink(e) {
		return e.field === 'media' && e.method === 'update' && e.value === '';
	}

	function sectionsModelChangeCheck(e) {
		if(sectionsModelChangeTimer) {
			clearTimeout(sectionsModelChangeTimer);
		}
		sectionsModelChangeTimer = setTimeout(function(){
			if(e.action && e.action === 'sectionReorder') {
				/*dont rebuild menu*/
			} else if(e.action && e.action === "remove") {
				/*dont rebuild menu*/
				/*allowed this to rebuild because of custom and social icons on menu*/
				if(isRemoveIconLink(e)) {
					self.menuView.menuText.rebuild(e);
				}
			} else if(e.action && e.action === "addMediaToSection") {
				/*dont rebuild menu*/
			} else if(e.action && e.action === "addSelectionToSection") {
				/*dont rebuild menu*/
				/*allowed this to rebuild because of custom and social icons on menu*/
				if(isAddIconLink(e)) {
					self.menuView.menuText.rebuild(e);
				}
			} else {
				self.menuView.menuText.rebuild(e);
			}
		}, 0);
	}

	function layoutModelChange(e) {
		if(isInit || e && /menu|sitePaddingTop|sitePaddingRight|sitePaddingBottom|sitePaddingLeft|footerIcon/.test(e.id)) {
			self.menuView.updateStyle();
			self.menuView.menuText.rebuild();
			self.menuView.menuText.updatePosition();
			self.menuView.updatePosition();
			self.menuView.updateScroll();
			isInit = false;
		}
	}

	function mediaModelChange(e) {
		if(e.type === 'link' && e.filters !== 'Footer Links') {
			self.menuView.updateStyle();
			self.menuView.menuText.rebuild();
			self.menuView.menuText.updatePosition();
			self.menuView.updatePosition();
			self.menuView.updateScroll();
		}
	}

	return self;
}

function MenuView(vars) {

	var self = new ViewProxy({events:vars.events});
	self.alpha = 0;
	self.updateSpeed = 0;
	self.zIndex = STATE.menuView.zIndex;
	self.style.pointerEvents = 'none';
	/*self.overflow = 'hidden';*/

	var mask = new Sprite();
	mask.element.setAttribute('class', 'mask');
	mask.backgroundColor = toRgba('#FF0000', 0);
	mask.width = layoutCalcs.menuView.width();
	mask.overflow = 'hidden';
	self.addChild(mask);
	self.alpha = 0;

	self.mask = mask;

	var isInit = true,
		menuToggleBtn,
		menuToggleToggleState = false,
		menuButtonCheck,
		touchTimeStart,
		touchTimeEnd,
		moveDistanceX = 0,
		moveDistanceY = 0,
		touchStartPointX = 0,
		touchStartPointY = 0,
		originX = 0,
		menuDir = 'open',
		lastMenuX = 0,
		menuScrolling = false,
		menuSwiping = false,
		align = isVerticalMenu() ? 'top' : 'left',
		margin = isHorizontalMenu() ? layoutCalcs.menuView.y() : layoutCalcs.menuView.x(),
		pOffset = isHorizontalMenu() ? layoutCalcs.menuView.x() : layoutCalcs.menuView.y();

	var dummyMask = {
		width:stage.width,
		height:stage.height
	};

	self.addEventListener(CHILD_ADDED, function(child) {
		self.updatePosition();
		Tween(self, UPDATE_SPEED, {delay:UPDATE_SPEED, alpha:1, onComplete:function(){
			isInit = false;
		}});
	});

	self.dock = new Dock(self, dummyMask, {
		side:LAYOUT_MODEL.menuAlignHorizontal,
		align:align,
		margin:margin,
		pOffset:pOffset,
		reveal:-1
	});

	if(USER_AGENT === TABLET || USER_AGENT === MOBILE) {
		menuToggleBtn = new Bitmap();
		menuToggleBtn.zIndex = 50;
		menuToggleBtn.width = 20;
		menuToggleBtn.height = 16;
		menuToggleBtn.padding = 8;
		menuToggleBtn.style.pointerEvents = 'auto';
		if(RETINA) {
			menuToggleBtn.src = REWRITE_BASE + ICONS + 'menu@2x.png?cache=2345';
		} else {
			menuToggleBtn.src = REWRITE_BASE + ICONS + 'menu.png?cache=1235';
		}
		menuToggleBtn.y = 16;
		self.addChild(menuToggleBtn);
		menuToggleBtn.addEventListener(CLICK, toggleDock);

		self.events.addEventListener(TOUCH_NAVIGATION_END, checkMenuToggle);
		self.events.addEventListener(INTRO_COMPLETE, closeDockIntroCompete);
		self.addEventListener(TOUCH_START, menuTouchStart);
		self.style.pointerEvents = 'auto';
	}

	function closeDockIntroCompete() {
		setTimeout(self.closeDock, 2000);
	}

	/*stage.addEventListener(MOUSE_MOVE, mouseOverDock);*/

	var userInterrupt = false;

	function checkMenuToggle(e) {
		if(!e.isMove && !self.dock.toggleState()) {
			toggleMenuToggleBtn();
		} else if(!userInterrupt) {
			self.closeDock();
		}
	}

	self.openDock = function(speed) {
		self.events.dispatchEvent(MENU_DOCK_OPEN);
		self.dock.show(speed);
		hideMenuToggleBtn();
		clearInterval(menuButtonCheck);
	};

	self.closeDock = function(speed) {
		if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
			self.events.dispatchEvent(MENU_DOCK_CLOSE);
			self.dock.hide(speed);
			menuIconCheckInterval();
		}
	};

	function menuTouchStart(e) {

		touchTimeStart = Date.now();
		moveDistanceX = 0;
		moveDistanceY = 0;
		originX = self.translateX;
		touchStartPointX = e.touches[0].pageX;
		touchStartPointY = e.touches[0].pageY;

		self.addEventListener(TOUCH_MOVE, menuTouchMove);
		self.addEventListener(TOUCH_END, menuTouchEnd);
		self.addEventListener(TOUCH_CANCEL, menuTouchEnd);
	}

	function menuTouchMove(e) {

		e.preventDefault();

		moveDistanceX = e.touches[0].pageX - touchStartPointX;
		moveDistanceY = e.touches[0].pageY - touchStartPointY;

		if(Mth.abs(moveDistanceX) > Mth.abs(moveDistanceY)) {
			menuSwiping = true;
			menuScrolling = false;
		} else {
			menuScrolling = true;
			menuSwiping = false;
		}

		var dockSide = /left|top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal) ? 'left' : 'right';

		if(menuSwiping) {
			self.transition = 0;
			var newPosition = moveDistanceX + originX;
			if(dockSide === 'left') {
				self.translateX = newPosition > 0 ? 0 : newPosition;
			} else {
				self.translateX = newPosition < stage.width - layoutCalcs.menuView.width() ? stage.width - layoutCalcs.menuView.width() : newPosition;
			}
		}

		if(lastMenuX <= e.touches[0].pageX) {
			menuDir = dockSide === 'left' ? 'open' : 'close';
			lastMenuX = e.touches[0].pageX;
		} else if(!menuScrolling) {
			menuDir = dockSide === 'left' ? 'close' : 'open';
			lastMenuX = e.touches[0].pageX;
		}
	}

	function menuTouchEnd(e) {

		if(menuSwiping && menuDir === 'close') {
			self.closeDock();
		}

		self.removeEventListener(TOUCH_MOVE, menuTouchMove);
		self.removeEventListener(TOUCH_END, menuTouchEnd);
		self.removeEventListener(TOUCH_CANCEL, menuTouchEnd);
	}

	function menuIconCheckInterval() {
		clearInterval(menuButtonCheck);
		menuButtonCheck = setInterval(function(){
			if(!self.dock.toggleState()) {
				showMenuToggleBtn();
			}
		}, 100);
	}

	function toggleDock() {
		if(self.dock.toggleState()) {
			userInterrupt = false;
			self.closeDock();
		} else {
			userInterrupt = true;
			self.openDock();
		}
	}

	function toggleMenuToggleBtn() {
		if(menuToggleToggleState) {
			showMenuToggleBtn();
		} else {
			showMenuToggleBtn();
		}
	}

	function showMenuToggleBtn() {
		menuToggleToggleState = true;
		Tween(menuToggleBtn, UPDATE_SPEED, {alpha:1});
	}

	function hideMenuToggleBtn() {
		menuToggleToggleState = false;
		Tween(menuToggleBtn, UPDATE_SPEED, {alpha:0});
	}

	function mouseOverDock(e) {
		if(self.hitTestPoint(e.clientX, e.clientY) && !self.dock.toggleState()) {
			self.openDock();
		} else if(!self.hitTestPoint(e.clientX, e.clientY) && self.dock.toggleState()) {
			self.closeDock();
		}
	}

	self.updateStyle = function(e) {
		var opacity;
		if(USER_AGENT === MOBILE || USER_AGENT === TABLET) {
			opacity = LAYOUT_MODEL.menuBgAlphaMobile;
		} else {
			opacity = LAYOUT_MODEL.menuBgAlpha;
		}
		Tween(self, self.updateSpeed, {backgroundColor: toRgba(LAYOUT_MODEL.menuBgColor, opacity)});
	};

	self.updatePosition = function(e) {
		var menuTextHeight = exists(self, 'menuText.height') || 0;
		var maskHeight = layoutCalcs.menuView.height() - layoutCalcs.menuText.y(menuTextHeight),
			maskY = layoutCalcs.menuText.y(menuTextHeight);

		if(USER_AGENT === MOBILE) {
			if(!layoutCalcs._footerHeight) {
				maskHeight = layoutCalcs.menuView.height() - layoutCalcs.menuText.y(menuTextHeight);
			} else {
				maskHeight = layoutCalcs.menuView.height() - layoutCalcs.menuText.y(menuTextHeight) - layoutCalcs._footerHeight - (layoutCalcs.mobileFooterPadding * 2);
			}
		} else if(maskHeight > layoutCalcs.menuView.height()) {
			maskHeight = layoutCalcs.menuView.height();
			maskY = 0;
		}

		if(USER_AGENT === TABLET || USER_AGENT === MOBILE) {
			if(LAYOUT_MODEL.menuAlignHorizontal === 'right') {
				menuToggleBtn.x = - 16 - menuToggleBtn.width;
			} else {
				menuToggleBtn.x = layoutCalcs.menuView.width() + 16;
			}
			menuToggleBtn.y = 16;
		}

		if(self.updateSpeed === 0) {
			self.width = layoutCalcs.menuView.width();
			self.height = layoutCalcs.menuView.height();

			mask.width = layoutCalcs.menuView.width();
			mask.height = maskHeight;
			mask.y = maskY;
		} else {
			Tween(self, self.updateSpeed, {width:layoutCalcs.menuView.width()});
			Tween(self, self.updateSpeed, {height:layoutCalcs.menuView.height()});

			Tween(mask, self.updateSpeed, {width:layoutCalcs.menuView.width(), height:maskHeight, y:maskY});
		}

		self.updateSpeed = UPDATE_SPEED;

		dummyMask.width = stage.width;
		dummyMask.height = stage.height;

		if(USER_AGENT === TABLET || USER_AGENT === MOBILE) {
			self.dock.side = /left|top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal) ? 'left' : 'right';
		} else {
			self.dock.side = LAYOUT_MODEL.menuAlignHorizontal;
		}
		self.dock.align = isVerticalMenu() ? 'top' : 'left';
		self.dock.margin = isHorizontalMenu() ? layoutCalcs.menuView.y() : layoutCalcs.menuView.x();
		self.dock.pOffset = isHorizontalMenu() ? layoutCalcs.menuView.x() : layoutCalcs.menuView.y();
		self.dock.resize(isInit ? 0 : UPDATE_SPEED);

		setTimeout(function() {
			if(self.scroll) {
				self.scroll.resize();
			}
		}, UPDATE_SPEED * 1000);

	};

	self.addContent = function(value) {
		self.mask.addChild(value);
		setTimeout(function() {
			self.updateScroll();
		}, UPDATE_SPEED * 1000);
	};

	self.updateScroll = function() {

		if(self.scroll) {
			self.scroll.destroy();
		}

		var scrollBarWidth = LAYOUT_MODEL.menuScrollbarWidth;
		var scrollBarOffsetX = LAYOUT_MODEL.menuScrollbarAlign === 'right' ? -scrollBarWidth : -percentToPixels(LAYOUT_MODEL.menuWidth, stage.width);
		var types = USER_AGENT === MOBILE ? ['wheel','touch'] : ['bar','wheel','touch'];

		self.scroll = new Scroll(self.menuText, mask, {
			types:types,
			axis: isVerticalMenu() ? 'y' : 'x',
			align: isVerticalMenu() ? 'top' : LAYOUT_MODEL.menuTextAlignHorizontal,
			alpha:LAYOUT_MODEL.menuScrollbarBgAlpha,
			color:LAYOUT_MODEL.menuScrollbarColor,
			hover:LAYOUT_MODEL.menuScrollbarHover,
			side:LAYOUT_MODEL.menuScrollbarAlignment,
			width:scrollBarWidth,
			topPad:0,
			margin: isVerticalMenu() ? 0 : LAYOUT_MODEL.menuTextPaddingHorizontal,
			offsetX: isVerticalMenu() ? scrollBarOffsetX : 0,
			zIndex:500
		});
	};

	self.updateStyle();

	return self;
}

function MenuText(vars) {

	var self = new ViewProxy({events:vars.events});
	self.zIndex = 5;
	self.style.pointerEvents = 'auto';

	var rootSections = csvToArray(SECTIONS_MODEL.ROOT_SECTION.media),
		subMenus = [];

	var menuBtns = {};
	var selectedBtn;
	var oldBtn;
	var menuAccordion;
	var path;
	var initTime = 700;

	self.updateSpeed = 0;

	function init() {
		self.text = '';
		self.children = [];
		menuAccordion = new Accordion(vars);
		menuAccordion.alpha = 0;
		menuAccordion.gap = USER_AGENT === MOBILE ? 0 : LAYOUT_MODEL.menuTextGap;
		if(USER_AGENT === MOBILE || LAYOUT_MODEL.menuExpandAll) {
			menuAccordion.expand = 'all';
		} else {
			menuAccordion.expand = 'single';
		}
		menuAccordion.toggle = false;
		menuAccordion.wrap = false;
		menuAccordion.align = (/top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal) && USER_AGENT !== TABLET) || USER_AGENT === MOBILE ? 'left' : LAYOUT_MODEL.menuTextAlignHorizontal;
		menuAccordion.updateSpeed = self.updateSpeed;
		menuAccordion.axis = isVerticalMenu() ? 'y' : 'x';
		menuAccordion.perpLength = isVerticalMenu() ? self.height : self.width;
		menuAccordion.animate = false;
		buildMenu(rootSections, false, menuAccordion, false);
		self.addChild(menuAccordion);
		self.width = menuAccordion.width;
		self.height = menuAccordion.height;
		menuAccordion.addEventListener(ACCORDION_SIZE_CHANGE, updateMenuSize);

		updateMenuSize();
		menuAccordion.layout();
		if(selectedBtn) {
			self.selectMenuItem();
		}

		setTimeout(function() {
			initLayout();
			alphaIn();
			self.events.dispatchEvent(MENU_BUILT);
			initTime = 0;
		}, initTime);
	}

	function initLayout() {
		layoutSubMenus();
		menuAccordion.perpLength = isVerticalMenu() ? self.height : self.width;
		menuAccordion.layout();
	}

	function alphaIn() {
		setTimeout(function() {
			Tween(menuAccordion, UPDATE_SPEED, {alpha:1});
		}, 350);
	}

	function updateMenuSize(e) {
		if(e) {
			self.width = e.width;
			self.height = e.height;
		}
		self.x = Mth.round(layoutCalcs.menuText.x(self.width));
		self.events.dispatchEvent(MENU_SIZE_CHANGE);
	}

	self.updatePosition = function(e) {
		if(self.updateSpeed === 0) {
			self.x = Mth.round(layoutCalcs.menuText.x(self.width));
		} else {
			Tween(self, self.updateSpeed, {x:Mth.round(layoutCalcs.menuText.x(self.width))});
		}
	};

	self.rebuild = function(e) {
		rootSections = csvToArray(SECTIONS_MODEL.ROOT_SECTION.media);
		self.updateSpeed = 0;
		init();
		menuAccordion.updateSpeed = 0;
		self.selectMenuItem();
	};

	self.setActiveMenuItem = function(e) {
		path = e.path;
		if(menuAccordion) menuAccordion.updateSpeed = UPDATE_SPEED;
		self.selectMenuItem();
	};

	self.selectMenuItem = function() {
		oldBtn = selectedBtn;
		if(path && (menuBtns[path] || menuBtns[removeDashes(path)])) {
			if(menuBtns[path]) {
				selectedBtn = menuBtns[path].label;
			} else {
				selectedBtn = menuBtns[removeDashes(path)].label;
			}
			selected.call(selectedBtn);
			selectedBtn.parentAccordion = selectedBtn.parent.parent.parent;
			if(selectedBtn.parentAccordion) {
				menuAccordion.select.call(selectedBtn.parentAccordion.label);

			}
		} else {
			selectedBtn = undefined;
		}
		if(oldBtn) {
			out.call(oldBtn);
			if(!selectedBtn && oldBtn.parentAccordion) {
				menuAccordion.select(oldBtn.parentAccordion.label);
			}
		}
	};

	function buildMenu(sections, isSub, parent, parentLabel) {

		parent.parentLabel = parentLabel;

		var i = 0,
			length = sections.length;

		for(;i < length; i++) {

			var label,
				content = undefined,
				container = new Sprite(),
				section = getSectionById(Number(sections[i]));

			if(isValidSection(section)) {

				label = buildButton(section, isSub, parentLabel);
				if(USER_AGENT !== MOBILE && section.label !== '%SPACER%') label.bullet = buildBullet(isSub);

				if(isSub) {
					menuBtns[label.path] = container;
					parent.addChild(container);
				} else {
					menuBtns[label.path] = container;
					if(hasSubMenu(section)) {
						content = buildSubMenu(section, label);
						if(content) {
							container.parentAccordion = parent;
							container.parentAccordion.label = label;
							container.addChild(content);
						}
					}
					parent.addItem(container, label, content, false);
				}

				mouseEvents(label);
				container.label = label;
				container.addChild(label);
				if(USER_AGENT !== MOBILE && section.label !== '%SPACER%') container.addChild(label.bullet);
			}
		}

		return parent;
	}

	function buildSubMenu(section, label) {
		var content = buildMenu(csvToArray(section.media), true, buildSubMenuHolder(), label);
		var firstSub = getFirstValidSub(section);
		var firstMO = getMediaById(csvToArray(firstSub.media)[0]);
		if(firstMO.type === "link" && (!firstMO.thumb || isSocialIcon(firstMO))) {
			label.path = "";
			subMenus.push(content);
			return content;
		} else if(section.label === '%SPACER%') {
			label.path = false;
			return content;
		} else if(!firstSub.label) {
			return false;
		} else if(label && label.label && content.children[0]) {
			label.path = label.label.text + '/' + firstSub.label;
			label.section = SECTIONS_MODEL[label.path];
			subMenus.push(content);
			return content;
		}
		return false;
	}

	function isValidSection(section) {
		if(USER_AGENT === MOBILE && section.label === '%SPACER%') {
			return false;
		}
		return section.visible === 1;
	}

	function buildButton(section, isSub, parentLabel) {
		var label = buildLabel(section.label, isSub);

		var mediaItem = getMediaById(getFirstMediaId(section.media));
		if(mediaItem.type === 'link') {
			if(isCustomIcon(mediaItem)) {
				label = loadCustomIcon(mediaItem);
			} else if(isSocialIcon(mediaItem)) {
				if(LAYOUT_MODEL.footerIconType === 'png') {
					label = loadSocialIcon(mediaItem);
				} else if(LAYOUT_MODEL.footerIconType === 'vector') {
					label = createVectorIcon(mediaItem);
				}
			}
		}

		if(USER_AGENT === MOBILE) {
			label = buildPodLabel(label, isSub);
		}

		label.section = section;

		if(mediaItem && mediaItem.type === 'link' && (!mediaItem.thumb || isSocialIcon(mediaItem))) {
			label.type = 'external';
			label.path = mediaItem.content;
			label.linkTarget = mediaItem.linkTarget;
		} else {
			var path = '';
			if(isSub && exists(parentLabel, 'label') && exists(label, 'label')) {
				path = parentLabel.label.text + '/' + label.label.text;
			} else if(exists(label, 'label')) {
				path = label.label.text;
			}
			label.type = 'internal';
			label.path = path;
			label.linkTarget = '_self';
		}

		return label;
	}

	function isCustomIcon(mediaItem) {
		return /src=/.test(mediaItem.label); 
	}

	function isSocialIcon(mediaItem) {
		return !!socialIcons[mediaItem.label.toLowerCase()];
	}

	function parseIconPath(str) {
		return str.replace(' ', '').split('=')[1].replace(']', '');	
	}

	function loadCustomIcon(mediaItem) {
		var icon = new Bitmap();
		icon.src = REWRITE_BASE + MEDIA_ORIGINAL + parseIconPath(mediaItem.label);
		icon.width = 20;
		icon.height = 20;
		icon.style.padding = '2px 0';
		icon.customLabel = mediaItem.label.toLowerCase();
		return icon;
	}

	function loadSocialIcon(mediaItem) {
		var socialIcon = socialIcons[mediaItem.label.toLowerCase()];
		var icon = new Bitmap();
		icon.src = REWRITE_BASE + 'dx/icon/' + socialIcon.filename;
		icon.width = socialIcon.width;
		icon.height = socialIcon.height;
		icon.style.padding = '2px 0';
		icon.socialLabel = mediaItem.label.toLowerCase();
		return icon;
	}

	function createVectorIcon(mediaItem) {
		var socialIcon = socialIcons[mediaItem.label.toLowerCase()];
		var icon = new Svg(),
			group = new Svg({type:'g'}),
			bg = new Rect(),
			path = new Path(),
			isCircle = LAYOUT_MODEL.footerIconShape === 'circle',
			dPath = isCircle ? socialIcon.svgCircPath : socialIcon.svgRectPath,
			scale = USER_AGENT === TABLET || USER_AGENT === MOBILE ? 1 : LAYOUT_MODEL.footerIconScale;
		group.scale = scale;
		bg.rx = isCircle ? socialIcon.bgCircRadius : socialIcon.bgRectRadius;
		bg.width = socialIcon.width;
		bg.height = socialIcon.height;
		bg.fill = LAYOUT_MODEL.footerIconColor;
		path.d = dPath;
		path.fill = LAYOUT_MODEL.footerIconBgColor;
		path.fillRule = 'evenodd';
		group.addChild(bg);
		group.addChild(path);
		icon.addChild(group);
		icon.width = socialIcon.width * scale;
		icon.height = socialIcon.height * scale;
		icon.socialLabel = mediaItem.label.toLowerCase();
		return icon;
	}

	function buildLabel(name, isSub) {
		var label = new Sprite();
		label.fontFamily = LAYOUT_MODEL.menuFont;
		label.fontSize = isSub ? LAYOUT_MODEL.menuSubFontSize : LAYOUT_MODEL.menuFontSize;
		label.fontColor = LAYOUT_MODEL.menuFontColor;
		label.letterSpacing = LAYOUT_MODEL.menuKerning;
		label.textWrap = false;
		label.text = name === '%SPACER%' ? "&nbsp;" : name;
		label.label = label;
		return label;
	}

	function buildPodLabel(label, isSub) {
		var bg = new Sprite();
		bg.addChild(label);
		bg.label = label;
		bg.width = layoutCalcs.menuView.width();
		bg.height = 60;
		bg.backgroundColor = toRgba(LAYOUT_MODEL.menuBgColor, LAYOUT_MODEL.menuBgAlpha);
		bg.borderBottom = '1px solid ' + toRgba(LAYOUT_MODEL.menuFontColor, LAYOUT_MODEL.menuBgAlpha + 0.15);
		layoutCalcs.menuBullet.updateSize(isSub);
		// bug #754 (social icon positioning)
		if((label instanceof Svg) || label.type === 'img') {
			label.y = (bg.height - label.height) * 0.5;
		} else {
			label.y = 1;
		}
		label.lineHeight = 59;
		label.x = 20;
		return bg;
	}

	function buildBullet(isSub) {
		var bullet = new Sprite();
		layoutCalcs.menuBullet.updateSize(isSub);
		bullet.fontFamily = LAYOUT_MODEL.menuFont;
		bullet.fontColor = toRgba(LAYOUT_MODEL.menuFontColor, 0);
		bullet.fontSize = isSub ? LAYOUT_MODEL.menuSubFontSize : LAYOUT_MODEL.menuFontSize;
		bullet.width = layoutCalcs.menuBullet.width;
		bullet.text = menuBullet[LAYOUT_MODEL.menuBulletType];
		if(isSub) {
			bullet.x = Mth.round(-(bullet.width + 15) + LAYOUT_MODEL.menuSubBulletOffsetHorizontal);
			bullet.y = 0 + LAYOUT_MODEL.menuSubBulletOffsetVertical;
		} else {
			bullet.x = Mth.round(-(bullet.width + 15) + LAYOUT_MODEL.menuBulletOffsetHorizontal);
			bullet.y = 0 + LAYOUT_MODEL.menuBulletOffsetVertical;
		}
		return bullet;
	}

	function getSubAlign() {
		return LAYOUT_MODEL.menuSubTextAlignHorizontal === 'inherit' ? LAYOUT_MODEL.menuTextAlignHorizontal : LAYOUT_MODEL.menuSubTextAlignHorizontal;
	}

	function layoutSubMenus() {

		var i = 0,
			length = subMenus.length,
			subAlign = getSubAlign();

		for(;i < length; i++) {

			var subMenu = subMenus[i];
			jLength = subMenu.children.length;

			for(j = 0; j < jLength; j++) {
				subMenu.tile.perpLength = subMenu.children[j].label.width > subMenu.tile.perpLength ? subMenu.children[j].label.width : subMenu.tile.perpLength;
				subMenu.tile.addItem(subMenu.children[j].label.width, subMenu.children[j].label.height);
			}

			subMenu.tile.layoutItems();

			for(var k = 0; k < jLength; k++) {
				var position = subMenu.tile.getPosition(k);
				var alignX = isVerticalMenu() ? position.x : position.x - LAYOUT_MODEL.menuSubTextGap;
				subMenu.children[k].x = Mth.round(alignX);
				if(USER_AGENT === MOBILE) {
					subMenu.children[k].x = position.x + 10;
					subMenu.children[k].y = position.y;
				} else {
					subMenu.children[k].y = position.y + LAYOUT_MODEL.menuSubGapLeading;
				}
			}

			var bounds = subMenu.tile.getBounds();
			if(USER_AGENT === MOBILE) {
				subMenu.height = bounds.height;
			} else {
				subMenu.height = bounds.height + LAYOUT_MODEL.menuSubGapLeading + LAYOUT_MODEL.menuSubGapTrailing;
			}

			subMenu.width = isVerticalMenu() ? subMenu.tile.perpLength : bounds.width - LAYOUT_MODEL.menuSubTextGap;

			switch(subAlign) {
				case 'left':
					subMenu.x = LAYOUT_MODEL.menuSubIndent;
					break;
				case 'center':
					subMenu.x = Mth.round((subMenu.parentLabel.width - subMenu.width) * 0.5);
					break;
				case 'right':
					subMenu.x = Mth.round(subMenu.parentLabel.width - subMenu.width - (LAYOUT_MODEL.menuSubIndent * 2));
					break;
			}

			subMenu.y = subMenu.parentLabel.height;
		}
	}

	function mouseEvents(hit) {
		hit.addEventListener(MOUSE_OVER, over);
		hit.addEventListener(MOUSE_OUT, out);
		hit.addEventListener(CLICK, click);
	}

	function click(e) {
		menuAccordion.animate = true;
		var navEvent = {
			section:this.section,
			type:this.type,
			path:this.path,
			label:this.label || this.socialLabel || this.customLabel || '',
			linkTarget:this.linkTarget
		};
		if(this.path !== "" || this.socialLabel || this.customLabel) self.events.dispatchEvent(MENU_CLICK, navEvent);
	}

	function over(e) {
		if(this.src || this instanceof Svg) {
			Tween(this, UPDATE_SPEED, {alpha:0.65});
		} else {
			if(this !== selectedBtn) {
				this.label.transition = 0;
				Tween(this.label, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.menuFontColorHover});
				if(this.bullet) {
					this.bullet.transition = 0;
					this.bullet.x = -(this.bullet.width + 15) + LAYOUT_MODEL.menuBulletOffsetHorizontal;
					var bulletX = -(this.bullet.width + 4);
					this.bullet.fontColor = LAYOUT_MODEL.menuFontColorHover;
					this.bullet.isHover = true;
					Tween(this.bullet, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.menuFontColorHover, 1), x:bulletX + LAYOUT_MODEL.menuBulletOffsetHorizontal});
				}
			}
		}
	}

	function out(e) {
		if(this.src || this instanceof Svg) {
			Tween(this, UPDATE_SPEED, {alpha:1});
		} else {
			if(this !== selectedBtn) {
				this.label.transition = 0;
				Tween(this.label, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.menuFontColor});
				if(this.bullet) {
					this.bullet.transition = 0;
					var bulletX = -(this.bullet.width + 15);
					this.bullet.isHover = false;
					Tween(this.bullet, UPDATE_SPEED, {fontColor:toRgba(LAYOUT_MODEL.menuBgColor, 0), x:bulletX + LAYOUT_MODEL.menuBulletOffsetHorizontal, onComplete:function(){
						if(!this.isHover) {
							this.transition = 0;
							this.x = -200;
						}
					}});
				}
			}
		}
	}

	function selected(e) {
		this.label.transition = 0;
		this.label.fontColor = LAYOUT_MODEL.menuFontColorSelected;
		if(this.bullet) {
			this.bullet.transition = 0;
			this.bullet.x = Mth.round(-(this.bullet.width + 4) + LAYOUT_MODEL.menuBulletOffsetHorizontal);
			this.bullet.fontColor = toRgba(LAYOUT_MODEL.menuFontColorSelected, 1);
		}
	}

	function getFirstMediaId(media) {
		return csvToArray(media)[0];
	}

	function hasSubMenu(section) {
		var media = csvToArray(section.media);
		var i; for(i in media) {
			if(isSection(media[i])) {
				return true;
			}
		}
		return false;
	}

	function buildSubMenuHolder() {
		var content = new Sprite(),
			subAlign = getSubAlign();
		content.tile = new Tile();
		content.tile.gap = USER_AGENT === MOBILE ? 0 : percentToPixels(LAYOUT_MODEL.menuSubTextGap, 100);
		content.tile.axis = isVerticalMenu() ? 'y' : 'x';
		content.tile.align = (/top|bottom/.test(LAYOUT_MODEL.menuAlignHorizontal) && USER_AGENT !== TABLET) || USER_AGENT === MOBILE ? 'left' : subAlign;
		content.tile.wrap = false;
		content.tile.perpLength = isVerticalMenu() ? layoutCalcs.menuView.width() : layoutCalcs.menuView.height();
		return content;
	}

	self.addEventListener(CHILD_ADDED, function(child) {

	});

	return self;
}

var menuBullet = {
	'':'',
	'none':'',
	'arrow':'&#x203A',
	'arrow2':'&#x00BB',
	'bullet':'&#x2022',
	'bullet2':'&#x00B7',
	'dash':'-'
};

function NavbarController(vars) {

	var self = new ControllerProxy({parentView:vars.parentView, parentController:vars.parentController, events:vars.siteControllerEvents});

	self.updateSpeed = 0;
	self.navbarView = new vars.NavbarView(vars);
	self.navbarView.alpha = 0;
	self.parentView.addChild(self.navbarView);

	var initTime = 1000,
		state;

	self.events.addEventListener(NAVBAR_MODEL_CHANGE, self.navbarView.buildNavBtns);
	self.events.addEventListener(LAYOUT_MODEL_CHANGE, self.navbarView.updateStyle);
	self.events.addEventListener(SITE_URI_CHANGE, updateNavbarInfo);
	self.events.addEventListener(SECTIONS_MODEL_CHANGE, updateNavbarInfo);
	self.events.addEventListener(RESIZE_END, self.navbarView.resize);
	self.events.addEventListener('updateAssetId', updateNavbarInfo);

	function updateNavbarInfo(e) {
		if(e.section) {
			state = e;
		} else if(state) {
			state.assetId = e.id;
		}
		setTimeout(function(){
			if(state) {
				self.navbarView.updateSpeed = 0;
				self.navbarView.updateCount(state);
			}
			initTime = 0;
		}, initTime);
	}

	return self;

}

function NavbarView(vars) {

	var self = new ViewProxy({events:vars.events}),
		tile;
	self.alpha = 0;
	self.zIndex = STATE.navbarView.zIndex;
	self.updateSpeed = 0;

	var childAdded = false,
		assetId = 0,
		sectionLength = 0,
		thumbsMode = false,
		count,
		curMediaItem,
		isBuildFotomoto = false,
		navbarFontSize = percentToPixels(LAYOUT_MODEL.navbarFontSize, 100),
		isMobileCaptionBuild; 

	self.addEventListener(CHILD_ADDED, function(child) {
		childAdded = true;
	});

	self.updateStyle = function(e) {
		if(childAdded) {
			self.buildNavBtns();
		}
	};

	self.resize = function() {
		self.updateSpeed = UPDATE_SPEED;
		self.updatePosition();
	};

	self.updatePosition = function(e) {
		if(self.updateSpeed === 0) {
			self.x = layoutCalcs.navbarView.x(self.width);
			self.y = layoutCalcs.navbarView.y(self.height);
		} else {
			Tween(self, self.updateSpeed, {x:layoutCalcs.navbarView.x(self.width)});
			Tween(self, self.updateSpeed, {y:layoutCalcs.navbarView.y(self.height)});
		}
	};

	self.hide = function() {
		Tween(self, UPDATE_SPEED, {alpha:0,onComplete:function(){
			self.display = 'none';
		}});
	};

	self.show = function() {
		self.display = 'block';
		Tween(self, UPDATE_SPEED, {alpha:1});
	};

	self.updateCount = function(e) {
		if(e && typeof e.assetId === 'number') {
			curMediaItem = getMediaById(e.mediaToRender[e.assetId]);
			isMobileCaptionBuild = curMediaItem.caption !== '';
		}
		sectionLength = removeLinksFromMedia(csvToArray(e.section.mediaItems)).length;
		thumbsMode = STATE.overrides.thumbnailType;
		if(e.section.id === LANDING_MEDIA && childAdded) {
			self.hide();
		} else if(isMediaItem(e.section.mediaItems) && childAdded) {
			// 6-26-15 bug #726 (navbar was hiding on single image in gallery for mobile)
			if(USER_AGENT === MOBILE && isMobileCaptionBuild) {
				self.buildNavBtns();
				self.show();
			} else {
				self.hide();
			}
		} else if(e.assetId > -1 && childAdded) {
			assetId = e.assetId;
			if(sectionLength > 1) {
				self.show();
				if(window.FOTOMOTO && curMediaItem && curMediaItem.type === 'image') {
					checkFotomotoProductAvailability(curMediaItem.content);
				} else {
					self.buildNavBtns();
				}
			} else {
				self.hide();
			}
		} else {
			/*update count on media add/remove in section*/
			if(sectionLength > 1) {
				self.show();
				if(window.FOTOMOTO && curMediaItem && curMediaItem.type === 'image') {
					checkFotomotoProductAvailability(curMediaItem.content);
				} else {
					self.buildNavBtns();
				}
			} else {
				self.hide();
			}
		}
	};

	self.buildNavBtns = function() {
		navbarFontSize = percentToPixels(LAYOUT_MODEL.navbarFontSize, 100);
		self.parent.removeChildren(self);
		for(var i in NAVBAR_MODEL) {
			if(NAVBAR_MODEL.hasOwnProperty(i)) {
				
				if(NAVBAR_MODEL[i].type === 'fullscreen' && !isFullscreenCapable()) continue;
				if(NAVBAR_MODEL[i].type === 'thumbs' && thumbsMode === 'none') continue;
				if(NAVBAR_MODEL[i].type === 'fotomoto' && !isBuildFotomoto) continue;
				if(NAVBAR_MODEL[i].type !== 'caption' && USER_AGENT === MOBILE) continue;
				if(USER_AGENT === MOBILE && !isMobileCaptionBuild) continue;

				var btn = new Sprite();
				self.addChild(btn);

				if(NAVBAR_MODEL[i].type === 'spacer') {
					btn.label = buildLabel(" &nbsp; &nbsp;");
					btn.addChild(btn.label);
					btn.width = btn.label.width;
					btn.height = navbarFontSize;
					btn.label.x = 0;
					btn.label.y = (navbarFontSize - btn.label.height) * 0.5;
				} else if(NAVBAR_MODEL[i].iconType === 'label' || NAVBAR_MODEL[i].type === 'count') {
					btn.label = buildLabel(NAVBAR_MODEL[i].name);
					btn.addChild(btn.label);
					btn.width = btn.label.width;
					btn.height = navbarFontSize;
					btn.label.x = 0;
					btn.label.y = (navbarFontSize - btn.label.height) * 0.5;
				} else if(NAVBAR_MODEL[i].iconType === 'icon') {
					btn.icon = makeIcon(NAVBAR_MODEL[i].type);
					btn.addChild(btn.icon);
					btn.width = btn.icon.width;
					btn.height = navbarFontSize;
					btn.icon.left = 0;
					btn.icon.top = Math.round((navbarFontSize - btn.icon.height) * 0.5);
				} else if(NAVBAR_MODEL[i].iconType === 'both') {
					btn.icon = makeIcon(NAVBAR_MODEL[i].type);
					btn.addChild(btn.icon);
					btn.label = buildLabel(NAVBAR_MODEL[i].name);
					btn.addChild(btn.label);

					if(NAVBAR_MODEL[i].type === 'next') {
						if(LAYOUT_MODEL.navbarLayout === 'vertical') {
							btn.label.x = -3;
							btn.icon.left = Math.round(btn.label.width - LAYOUT_MODEL.navbarIconOffsetX);
						} else {
							btn.label.x = 0;
							btn.icon.left = Math.round(btn.label.width - LAYOUT_MODEL.navbarIconOffsetX + 3);
						}

						btn.label.y = (navbarFontSize - btn.label.height) * 0.5;
						btn.icon.top = Math.round(((navbarFontSize - btn.icon.height) * 0.5) + LAYOUT_MODEL.navbarIconOffsetY);
						btn.width = btn.icon.width + btn.label.width - LAYOUT_MODEL.navbarIconOffsetX;
					} else {
						btn.icon.left = 0;
						btn.icon.top = Math.round(((navbarFontSize - btn.icon.height) * 0.5) + LAYOUT_MODEL.navbarIconOffsetY);
						btn.label.x = btn.icon.width - LAYOUT_MODEL.navbarIconOffsetX + 3;
						btn.label.y = (navbarFontSize - btn.label.height) * 0.5;
						btn.width = btn.icon.width + btn.label.width - LAYOUT_MODEL.navbarIconOffsetX + 3;
					}

					btn.height = navbarFontSize;
				}

				var hit = new Sprite();
				hit.width = btn.width;
				hit.height = btn.height;
				hit.type = NAVBAR_MODEL[i].type;
				hit.tooltip = NAVBAR_MODEL[i].tooltip;
				if(btn.label) {
					hit.label = btn.label;
				}
				if(btn.icon) {
					hit.icon = btn.icon;
				}
				btn.addChild(hit);
				btn.hit = hit;

				if(NAVBAR_MODEL[i].type === 'count') {
					count = btn;
					count.label.text = assetId + 1 + '&nbsp;of&nbsp;' + sectionLength;
					count.width = count.label.element.offsetWidth;
					hit.width = count.label.element.offsetWidth;
				} else if(NAVBAR_MODEL[i].type === 'spacer') {
					/*no listeners*/
				} else {
					hit.addEventListener(MOUSE_OVER, over);
					hit.addEventListener(MOUSE_OUT, out);
					hit.addEventListener(CLICK, click);
				}
			}
		}

		if(Object.keys(NAVBAR_MODEL).length > 0) {
			layoutBtns();
			self.updatePosition();
		}
	};

	function click(e) {
		if(this.type === 'fullscreen') {
			self.events.dispatchEvent(NAVBAR_FULLSCREEN);
		} else if(this.type === 'prev' || this.type === 'next') {
			self.events.dispatchEvent(NAVBAR_NAV_CLICK, {navDir:this.type});
		} else {
			self.events.dispatchEvent(NAVBAR_OVERLAY_BTN_CLICK, this.type);
		}
	}

	function over(e) {
		if(this.label) {
			Tween(this.label, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.navbarColorHover});
		}
		if(this.icon && this.icon.path && this.icon.path.stroke !== 'none') {
			Tween(this.icon.path, UPDATE_SPEED, {stroke:LAYOUT_MODEL.navbarColorHover});
		}
		if(this.icon && this.icon.path && this.icon.path.fill !== 'none') {
			Tween(this.icon.path, UPDATE_SPEED, {fill:LAYOUT_MODEL.navbarColorHover});
		}
		if(USER_AGENT !== MOBILE && USER_AGENT !== TABLET) vars.parentController.tooltip.show(e);
	}

	function out(e) {
		if(this.label) {
			Tween(this.label, UPDATE_SPEED, {fontColor:LAYOUT_MODEL.navbarColor});
		}
		if(this.icon && this.icon.path && this.icon.path.stroke !== 'none') {
			Tween(this.icon.path, UPDATE_SPEED, {stroke:LAYOUT_MODEL.navbarColor});
		}
		if(this.icon && this.icon.path && this.icon.path.fill !== 'none') {
			Tween(this.icon.path, UPDATE_SPEED, {fill:LAYOUT_MODEL.navbarColor});
		}
	}

	function buildLabel(name) {
		var label = new Button();
		label.fontFamily = LAYOUT_MODEL.navbarFont;
		label.fontSize = navbarFontSize;
		label.fontColor = LAYOUT_MODEL.navbarColor;
		label.letterSpacing = LAYOUT_MODEL.navbarKerning;
		label.backgroundColor = 'transparent';
		label.textWrap = false;
		label.text = name;
		return label;
	}

	function makeIcon(type) {
		var scale = LAYOUT_MODEL.navbarIconScale;
		var icon = new Svg();
		icon.left = 0;
		icon.top = 0;
		icon.rotate = 0;
		icon.path = new Path();
		icon.path.scale = scale;
		switch(type) {
			case 'prev':
				icon.width = 8 * scale;
				icon.height = 15 * scale;
				icon.path.d = svgPaths.navArrowLeft['default'];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 3;
				icon.path.fill = 'none';
				icon.path.stroke = LAYOUT_MODEL.navbarColor;
				break;
			case 'next':
				icon.width = 8 * scale;
				icon.height = 15 * scale;
				icon.path.d = svgPaths.navArrowRight['default'];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 3;
				icon.path.fill = 'none';
				icon.path.stroke = LAYOUT_MODEL.navbarColor;
				break;
			case 'email':
				icon.width = 15 * scale;
				icon.height = 15 * scale;
				icon.path.d = svgPaths.navEmail[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
			case 'inquiry':
				icon.width = 14 * scale;
				icon.height = 9 * scale;
				icon.path.d = svgPaths.navCart[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
			case 'fotomoto':
				icon.width = 14 * scale;
				icon.height = 9 * scale;
				icon.path.d = svgPaths.navCart[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
			case 'thumbs':
				icon.width = 15 * scale;
				icon.height = 15 * scale;
				icon.path.d = svgPaths.navThumbs[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
			case 'caption':
				icon.width = 15 * scale;
				icon.height = 15 * scale;
				icon.path.d = svgPaths.navInfo[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
			case 'fullscreen':
				icon.width = 15 * scale;
				icon.height = 9 * scale;
				icon.path.d = svgPaths.navFullscreen[LAYOUT_MODEL.navbarIconSet];
				icon.path.strokeWidth = LAYOUT_MODEL.navbarIconSet === 'thin' ? 1 : 0;
				icon.path.fill = LAYOUT_MODEL.navbarIconSet === 'thin' ? 'none' : LAYOUT_MODEL.navbarColor;
				icon.path.stroke = LAYOUT_MODEL.navbarIconSet === 'thin' ? LAYOUT_MODEL.navbarColor : 'none';
				break;
		}
		icon.addChild(icon.path);
		return icon;
	}

	function checkFotomotoProductAvailability(imageId) {
		console.log('http://' + window.location.host + REWRITE_BASE + MEDIA_ORIGINAL + imageId)
		window.FOTOMOTO.API.getImageProducts('http://' + window.location.host + REWRITE_BASE + MEDIA_ORIGINAL + imageId, fotomotoResponse);
	}

	function fotomotoResponse(response) {
		console.log(response)
		if(response && (response[100] || response[101] || response[102] || response[103] || response[104] || response[105] || response[200] || response[300] || response[400])) {
			isBuildFotomoto = true;
			self.buildNavBtns();
		} else {
			isBuildFotomoto = false;
			self.buildNavBtns();
		}
	}

	function layoutBtns() {

		var btns = self.children,
			i,
			length = btns.length;
		if(length > 0) {

			tile = new Tile({id:'nav'});
			tile.gap = LAYOUT_MODEL.navbarGap + 2;
			tile.axis = LAYOUT_MODEL.navbarLayout === 'horizontal' ? 'x' : 'y';
			tile.align = LAYOUT_MODEL.navbarLayout === 'vertical' ? LAYOUT_MODEL.navbarJustification : 'left';
			tile.wrap = false;
			tile.perpLength = tile.axis === 'x' ? btns[0].height : btns[0].width;

			for(i = 0; i < length; i++) {
				if(tile.axis === 'x') {
					if(btns[i].height > tile.perpLength) {
						tile.perpLength = btns[i].height;
					}
				} else {
					if(btns[i].width > tile.perpLength) {
						tile.perpLength = btns[i].width;
					}
				}

				tile.addItem(btns[i].width, btns[i].height);
			}

			tile.layoutItems();

			for(i = 0; i < length; i++) {
				var position = tile.getPosition(i);
				btns[i].x = position.x;
				btns[i].y = position.y;
			}

			self.transition = 0;
			var bounds = tile.getBounds();
			self.width = bounds.width;
			self.height = bounds.height;
		}

	}

	return self;
}

function IntroView(vars) {

	var self = new Sprite({events:vars.events}),
		duration = 1400,
		parentView = vars.parentView,
		background,
		image,
		updateSpeed = 0;

	self.zIndex = STATE.introView.zIndex;

	self.addEventListener(CHILD_ADDED, function(child) {
		buildBackground();
		loadFile();
	});

	function buildBackground() {
		background = new Sprite();
		background.backgroundColor = LAYOUT_MODEL.siteBackgroundColor;
		background.width = stage.width;
		background.height = stage.height;
		self.addChild(background);
	}

	function loadFile() {
		image = new Bitmap();
		image.alpha = 0;
		image.addEventListener(LOAD, imageLoaded);
		image.src = REWRITE_BASE + MEDIA_ORIGINAL + LAYOUT_MODEL.introFile;
		self.addChild(image);
	}

	function fade() {
		setTimeout(function() {
			Tween(image, 1.5, {alpha:0, onComplete:function() {
				self.events.dispatchEvent(INTRO_COMPLETE);
			}});
		}, duration);
	}

	function imageLoaded(e) {
		var retinaSize = RetinaResizeEngine({width:image.width, height:image.height, filename:LAYOUT_MODEL.introFile});
		Resize(image, 0, {
			type:LAYOUT_MODEL.introScaleType,
			width:retinaSize.width,
			height:retinaSize.height,
			hRange:stage.width,
			vRange:stage.height,
			hAlign:'center',
			vAlign:'center',
			onComplete:function(){
				Tween(image, 1, {alpha:1, onComplete:fade});
				updateSpeed = UPDATE_SPEED;
			}
		});
	}

	self.updatePosition = function(e) {
		background.width = stage.width;
		background.height = stage.height;
		if(image) Tween(image, updateSpeed, {x:(stage.width - image.width) * 0.5 , y:(stage.height - image.height) * 0.5});
	};

	return self;
}

var lightSkin = {
	bgColor:"#EFEFEF",
	bgColorLight:"#FCFCFC",
	bgColorLighter:"#FFFFFF",
	bgColorDark:"#E5E5E5",
	bgColorDarker:"#D7D7D7",
	bgColorDarkest:"#999999",
	bgColorSelected:"#CFDEEE",
	bgColorHover:"#F5F5F5",
	bgColorHighlight:"#2292E2",
	bgColorEven:'#F6F6F6',
	bgColorOdd:'#F0F0F0',

	fontColor:"#444444",
	fontColorLight:"#777777",
	fontColorLighter:"#AAAAAA",
	fontColorLightest:"#CCCCCC",
	fontColorDark:"#111111",
	fontColorDarker:"#000000",
	fontColorSelected:"#2292E2",
	fontColorHover:"#000000",

	fontFamily:"Lato-Regular, Helvetica Neue, Arial, sans-serif",
	fontFamilyThin:"Lato-Hairline, Helvetica Neue, Arial, sans-serif",
	fontFamilyLight:"Lato-Light, Helvetica Neue, Arial, sans-serif",
	fontFamilyBold:"Lato-Bold, Helvetica Neue, Arial, sans-serif",

	fontSize:12,
	fontSizeSmall:11,
	fontSizeSmaller:10,
	fontSizeSmallest:9,
	fontSizeLarge:14,
	fontSizeXLarge:24,

	transition: 0.25,
	transitionSlow:0.50,
	transitionFast:0.10,

	titleBarHeight:30,
	titleTextTransform:'uppercase',
	btnHeight:36,
	gap:1,
	shadow:"0px 2px 10px rgba(0,0,0,0.04)",
	shadowDark:"0px 2px 10px rgba(0,0,0,0.1)",
	shadowDarker:"0px 2px 10px rgba(0,0,0,0.2)",
	scrollBarWidth:9,
	scrollBarAlign:'right',

	tooltip: {
		backgroundColor:'rgba(252,252,252,0.95)',
		fontColor:"#777777",
		fontFamily: 'Helvetica Neue, Arial, sans-serif',
		cornerRadius: 2
		/*border: '1px solid rgba(0,0,0,0.2)'*/
	},
	tooltip_warning: {
		backgroundColor:'rgba(34,146,226,0.95)',
		fontColor:"#FCFCFC",
		fontFamily: "Helvetica Neue, Arial, sans-serif",
		cornerRadius: 2,
		width: 200
	}
};

var darkSkin = {
	bgColor:"#333333",
	bgColorLight:"#F9F9F9",
	bgColorLighter:"#FFFFFF",
	bgColorDark:"#E9E9E9",
	bgColorDarker:"#DDDDDD",
	bgColorDarkest:"#999999",
	bgColorSelected:"#777777",
	bgColorHover:"#F7F7F7",
	bgColorEven:'#F9F9F9',
	bgColorOdd:'#F0F0F0',

	fontColor:"#444444",
	fontColorLight:"#777777",
	fontColorLighter:"#999999",
	fontColorLightest:"#BBBBBB",
	fontColorDark:"#111111",
	fontColorDarker:"#000000",
	fontColorSelected:"#0099FF",
	fontColorHover:"#0099FF",

	fontFamily:"Lato-Regular",
	fontFamilyThin:"Lato-Hairline",
	fontFamilyLight:"Lato-Light",
	fontFamilyBold:"Lato-Bold",

	fontSize:12,
	fontSizeSmall:11,
	fontSizeSmaller:10,
	fontSizeLarge:14,
	fontSizeXLarge:24,

	transition: 0.20,
	transitionSlow:0.50,
	transitionFast:0.10,

	titleBarHeight:30,
	titleTextTransform:'uppercase',
	btnHeight:35,
	gap:1,
	shadow:"0px 2px 10px rgba(0,0,0,0.04)",
	scrollBarWidth:8,
	scrollBarAlign:'right'
};

var theme = lightSkin;

var isLogin = false;

 this.tween = Tween;
 this.address = Address;
} window.dx = new DesignX();
